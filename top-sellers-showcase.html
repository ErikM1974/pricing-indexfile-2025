<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Browse Northwest Custom Apparel's top-selling products. Quality apparel for screen printing, embroidery, and DTG printing.">
    <meta name="keywords" content="custom apparel, screen printing, embroidery, promotional products, Pacific Northwest">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Top Sellers - Northwest Custom Apparel">
    <meta property="og:description" content="Discover our most popular products for custom decoration">
    <meta property="og:image" content="https://cdn.caspio.com/A0E15000/Safety%20Stripes/web%20northwest%20custom%20apparel%20logo.png?ver=1">
    <meta property="og:type" content="website">
    
    <title>Top Sellers Catalog - Northwest Custom Apparel</title>
    <link rel="icon" href="https://cdn.caspio.com/A0E15000/Safety%20Stripes/NWCA%20Favicon%20for%20TEAMNWCA.com.png?ver=1" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- EmailJS for sample request notifications -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- Embed Sample Request functionality directly to avoid path issues -->
    <script>
        // Embedded sample cart functionality  
        class SampleCart {
            constructor() {
                this.maxSamples = 3;
                this.samples = JSON.parse(sessionStorage.getItem('sampleCart') || '[]');
                this.eligibilityCache = {};
                this.apiBase = 'https://caspio-pricing-proxy-ab30a049961a.herokuapp.com';
                this.initializeUI();
                this.bindEvents();
            }

            initializeUI() {
                if (!document.getElementById('sampleCartWidget')) {
                    const widget = document.createElement('div');
                    widget.id = 'sampleCartWidget';
                    widget.className = 'sample-cart-widget';
                    widget.innerHTML = `
                        <div class="sample-cart-inner">
                            <div class="sample-cart-icon">
                                <i class="fas fa-box-open"></i>
                                <span class="sample-count-badge">${this.samples.length}</span>
                            </div>
                            <div class="sample-cart-text">
                                <span class="sample-cart-label">Samples</span>
                                <span class="sample-cart-status">${this.samples.length}/${this.maxSamples}</span>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(widget);
                }
                this.updateUI();
            }

            bindEvents() {
                const widget = document.getElementById('sampleCartWidget');
                if (widget) {
                    widget.addEventListener('click', () => this.openSampleModal());
                }
            }

            async checkEligibility(styleNumber) {
                // Check cache first
                if (this.eligibilityCache[styleNumber] !== undefined) {
                    return this.eligibilityCache[styleNumber];
                }

                try {
                    const response = await fetch(`${this.apiBase}/api/size-pricing?styleNumber=${styleNumber}`);
                    const data = await response.json();
                    
                    // Check if product is in Sanmar (has pricing data)
                    if (!data || data.error || data.length === 0) {
                        console.log(`Style ${styleNumber}: Not in Sanmar - no samples available`);
                        const result = { 
                            eligible: false, 
                            reason: 'not_sanmar'
                        };
                        this.eligibilityCache[styleNumber] = result;
                        return result;
                    }
                    
                    // Find MINIMUM price (not average)
                    const firstItem = data[0];
                    const prices = firstItem.basePrices || {};
                    const priceValues = Object.values(prices).filter(p => p > 0);
                    
                    if (priceValues.length === 0) {
                        const result = { eligible: false, reason: 'no_pricing' };
                        this.eligibilityCache[styleNumber] = result;
                        return result;
                    }
                    
                    // Extract available colors and sizes from all items
                    const colors = [];
                    const sizesSet = new Set();
                    
                    data.forEach(item => {
                        if (item.color) {
                            colors.push({
                                name: item.color,
                                code: item.color.toUpperCase().replace(/\s+/g, '_')
                            });
                        }
                        // Get sizes from basePrices keys
                        Object.keys(item.basePrices || {}).forEach(size => {
                            sizesSet.add(size);
                        });
                    });
                    
                    const sizes = Array.from(sizesSet).sort((a, b) => {
                        // Sort sizes logically
                        const sizeOrder = ['XS', 'S', 'M', 'L', 'XL', '2XL', '3XL', '4XL', '5XL', '6XL'];
                        return sizeOrder.indexOf(a) - sizeOrder.indexOf(b);
                    });
                    
                    const minPrice = Math.min(...priceValues);
                    console.log(`Style ${styleNumber}: Min price $${minPrice.toFixed(2)}, ${colors.length} colors, ${sizes.length} sizes`);
                    
                    if (minPrice < 10) {
                        const result = { 
                            eligible: true, 
                            type: 'free', 
                            price: 0,
                            minCost: minPrice,
                            colors: colors,
                            sizes: sizes
                        };
                        this.eligibilityCache[styleNumber] = result;
                        console.log(`  → FREE sample`);
                        return result;
                    } else {
                        // Calculate markup: cost / 0.60, round up
                        const samplePrice = Math.ceil(minPrice / 0.60);
                        const result = { 
                            eligible: true, 
                            type: 'paid', 
                            price: samplePrice,
                            minCost: minPrice,
                            colors: colors,
                            sizes: sizes
                        };
                        this.eligibilityCache[styleNumber] = result;
                        console.log(`  → PAID sample at $${samplePrice}`);
                        return result;
                    }
                } catch (error) {
                    console.error(`Error checking eligibility for ${styleNumber}:`, error);
                    const result = { eligible: false, reason: 'api_error' };
                    this.eligibilityCache[styleNumber] = result;
                    return result;
                }
            }

            addSample(product) {
                if (this.samples.length >= this.maxSamples) {
                    this.showNotification(`Maximum ${this.maxSamples} samples per request`, 'warning');
                    return false;
                }

                if (this.samples.find(s => s.style === product.style)) {
                    this.showNotification('This item is already in your sample cart', 'info');
                    return false;
                }

                this.samples.push({
                    style: product.style,
                    name: product.name,
                    description: product.description,
                    imageUrl: product.imageUrl || '',
                    color: product.color || '',  // Store actual color name
                    colorCode: product.colorCode || '',  // Store color code
                    size: product.size || '',  // Store selected size
                    price: product.price || 0,
                    type: product.type || 'free',
                    addedAt: new Date().toISOString()
                });

                this.save();
                this.updateUI();
                
                // Custom message based on sample type
                if (product.type === 'paid') {
                    this.showNotification(`${product.name} added - $${product.price} sample`, 'success');
                } else {
                    this.showNotification(`${product.name} added - FREE sample`, 'success');
                }
                
                this.showWidget();
                
                return true;
            }

            removeSample(styleNumber) {
                const index = this.samples.findIndex(s => s.style === styleNumber);
                if (index !== -1) {
                    const removed = this.samples.splice(index, 1)[0];
                    this.save();
                    this.updateUI();
                    this.showNotification(`${removed.name} removed from samples`, 'info');
                    
                    if (this.samples.length === 0) {
                        this.hideWidget();
                    }
                }
            }

            clearCart() {
                this.samples = [];
                this.save();
                this.updateUI();
                this.hideWidget();
            }

            save() {
                sessionStorage.setItem('sampleCart', JSON.stringify(this.samples));
            }

            updateUI() {
                const badge = document.querySelector('.sample-count-badge');
                if (badge) {
                    badge.textContent = this.samples.length;
                    badge.style.display = this.samples.length > 0 ? 'flex' : 'none';
                }

                const status = document.querySelector('.sample-cart-status');
                if (status) {
                    status.textContent = `${this.samples.length}/${this.maxSamples}`;
                }

                const widget = document.getElementById('sampleCartWidget');
                if (widget) {
                    if (this.samples.length > 0) {
                        widget.style.display = 'block';
                        widget.classList.add('sample-cart-bounce');
                        setTimeout(() => widget.classList.remove('sample-cart-bounce'), 600);
                    }
                }

                this.updateSampleButtons();
            }

            updateSampleButtons() {
                document.querySelectorAll('.btn-sample').forEach(btn => {
                    const style = btn.dataset.style;
                    if (style && this.samples.find(s => s.style === style)) {
                        btn.innerHTML = '<i class="fas fa-check"></i> In Sample Cart';
                        btn.classList.add('in-cart');
                        btn.disabled = false;
                    }
                });
            }

            showWidget() {
                const widget = document.getElementById('sampleCartWidget');
                if (widget && this.samples.length > 0) {
                    widget.style.display = 'block';
                    widget.classList.add('sample-cart-show');
                }
            }

            hideWidget() {
                const widget = document.getElementById('sampleCartWidget');
                if (widget) {
                    widget.classList.remove('sample-cart-show');
                    setTimeout(() => {
                        if (this.samples.length === 0) {
                            widget.style.display = 'none';
                        }
                    }, 300);
                }
            }

            openSampleModal() {
                window.dispatchEvent(new CustomEvent('openSampleModal', {
                    detail: { samples: this.samples }
                }));
            }

            showNotification(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `sample-toast sample-toast-${type}`;
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(toast);
                setTimeout(() => toast.classList.add('sample-toast-show'), 10);
                
                setTimeout(() => {
                    toast.classList.remove('sample-toast-show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            getCartSummary() {
                return {
                    items: this.samples,
                    count: this.samples.length,
                    remaining: this.maxSamples - this.samples.length,
                    isFull: this.samples.length >= this.maxSamples
                };
            }

            async checkAllProductEligibility() {
                console.log('Checking product eligibility for samples...');
                const buttons = document.querySelectorAll('.btn-sample[data-style]');
                const checks = [];
                
                buttons.forEach(btn => {
                    const style = btn.dataset.style;
                    if (style) {
                        checks.push(this.checkAndUpdateButton(btn, style));
                    }
                });
                
                await Promise.all(checks);
                console.log('Eligibility check complete');
            }
            
            async checkAndUpdateButton(button, styleNumber) {
                const result = await this.checkEligibility(styleNumber);
                
                if (!result.eligible) {
                    // Hide button for non-Sanmar products
                    button.style.display = 'none';
                    return;
                }
                
                button.style.display = 'inline-flex';
                button.style.width = '100%';
                
                // Store pricing data
                button.dataset.samplePrice = result.price;
                button.dataset.sampleType = result.type;
                
                // Check if already in cart
                if (this.samples.find(s => s.style === styleNumber)) {
                    button.innerHTML = '<i class="fas fa-check"></i> In Sample Cart';
                    button.classList.add('in-cart');
                } else if (result.type === 'free') {
                    button.innerHTML = '<i class="fas fa-box-open"></i> Request Free Sample';
                    button.className = 'btn-sample btn-sample-free';
                } else {
                    button.innerHTML = `<i class="fas fa-shopping-cart"></i> Order Sample - $${result.price}`;
                    button.className = 'btn-sample btn-sample-paid';
                }
            }
        }

        // Embedded sample request service
        class SampleRequestService {
            constructor() {
                this.baseURL = 'https://caspio-pricing-proxy-ab30a049961a.herokuapp.com';
                this.quotePrefix = 'SR';
            }

            generateSampleRequestID() {
                const now = new Date();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const dateKey = `${month}${day}`;
                
                // Use timestamp + random to ensure uniqueness across all users/sessions
                const timestamp = now.getTime().toString();
                const uniqueId = timestamp.slice(-6) + Math.random().toString(36).substr(2, 3);
                
                return `${this.quotePrefix}${dateKey}-${uniqueId}`;
            }

            generateSessionID() {
                return `sample_sess_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            }

            async checkDuplicateRequest(email) {
                // Simplified for testing
                return false;
            }

            async saveSampleRequest(formData, samples) {
                try {
                    const quoteID = this.generateSampleRequestID();
                    const sessionID = this.generateSessionID();
                    
                    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
                        .toISOString()
                        .replace(/\.\d{3}Z$/, '');
                    
                    // Build simple notes without newlines (Caspio doesn't like special characters)
                    let notesContent = formData.notes || 'Sample request';
                    
                    // Add project details with pipe separators instead of newlines
                    if (formData.projectType) {
                        notesContent += ` | Project: ${formData.projectType}`;
                    }
                    if (formData.estimatedQuantity) {
                        notesContent += ` | Qty: ${formData.estimatedQuantity}`;
                    }
                    if (formData.timeline) {
                        notesContent += ` | Timeline: ${formData.timeline}`;
                    }
                    
                    // Add delivery info
                    if (formData.deliveryMethod === 'ship') {
                        notesContent += ` | Ship to: ${formData.shippingCity || 'TBD'}, ${formData.shippingState || 'TBD'}`;
                    } else {
                        notesContent += ' | Pickup at NWCA';
                    }
                    
                    // Add sample count and total
                    if (samples && samples.length > 0) {
                        notesContent += ` | ${samples.length} samples`;
                    }
                    
                    // Get totals with proper defaults
                    const samplesCost = parseFloat((formData.samplesCost || 0).toFixed(2));
                    const totalAmount = parseFloat((formData.totalAmount || 0).toFixed(2));
                    
                    // Add total if there's a cost
                    if (totalAmount > 0) {
                        notesContent += ` | Total: $${totalAmount.toFixed(2)}`;
                    }
                    
                    const sessionData = {
                        QuoteID: quoteID,
                        SessionID: sessionID,
                        CustomerEmail: formData.email,
                        CustomerName: formData.name,
                        CompanyName: formData.company || '',
                        Phone: formData.phone || '',
                        TotalQuantity: samples.length,
                        SubtotalAmount: samplesCost,
                        LTMFeeTotal: 0, // No LTM fees for sample requests - this field is for Less Than Minimum fees only
                        TotalAmount: totalAmount,
                        Status: 'Sample Request',
                        ExpiresAt: expiresAt,
                        Notes: notesContent,
                        // ProjectName field - leave empty to avoid database type issues
                        ProjectName: ''
                    };
                    
                    // Validate data before sending
                    console.log('Saving sample request session:', sessionData);
                    console.log('Session data validation:', {
                        hasQuoteID: !!sessionData.QuoteID,
                        hasEmail: !!sessionData.CustomerEmail,
                        subtotalIsNumber: !isNaN(sessionData.SubtotalAmount),
                        ltmIsZero: sessionData.LTMFeeTotal === 0,
                        totalIsNumber: !isNaN(sessionData.TotalAmount),
                        notesLength: sessionData.Notes.length
                    });
                    
                    console.log('Sending session data to API:', JSON.stringify(sessionData, null, 2));
                    
                    const sessionResponse = await fetch(`${this.baseURL}/api/quote_sessions`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(sessionData)
                    });
                    
                    if (!sessionResponse.ok) {
                        const errorText = await sessionResponse.text();
                        console.error('Session save failed:', errorText);
                        console.error('Failed session data:', sessionData);
                        throw new Error(`Failed to save session: ${errorText}`);
                    }
                    
                    console.log('Session saved successfully');
                    
                    // Save individual sample items
                    console.log(`Saving ${samples.length} sample items...`);
                    const itemPromises = samples.map(async (sample, index) => {
                        // Use the sample price if it's a paid sample, ensure it's a number
                        const itemPrice = parseFloat((sample.price || 0).toFixed(2));
                        
                        // Simple size/color data for each item
                        let sizeBreakdownData = {
                            size: sample.size || 'L',
                            color: sample.color || 'TBD'
                        };
                        
                        // Order details now stored in session record, not in individual items
                        
                        const itemData = {
                            QuoteID: quoteID,
                            LineNumber: index + 1,
                            StyleNumber: sample.style || 'UNKNOWN',
                            ProductName: sample.name || sample.description || 'Sample Item',
                            Color: sample.color || '',  // Use actual selected color, never "Customer Choice"
                            ColorCode: sample.colorCode || '',
                            EmbellishmentType: 'sample',
                            PrintLocation: '',
                            PrintLocationName: '',
                            Quantity: 1,
                            HasLTM: 'No',
                            BaseUnitPrice: itemPrice,
                            LTMPerUnit: 0,
                            FinalUnitPrice: itemPrice,
                            LineTotal: itemPrice,
                            SizeBreakdown: JSON.stringify(sizeBreakdownData),
                            PricingTier: itemPrice > 0 ? 'Paid Sample' : 'Free Sample',
                            ImageURL: sample.imageUrl || '',
                            AddedAt: new Date().toISOString().replace(/\.\d{3}Z$/, '')
                        };
                        
                        console.log(`Saving item ${index + 1}:`, itemData);
                        
                        const itemResponse = await fetch(`${this.baseURL}/api/quote_items`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(itemData)
                        });
                        
                        if (!itemResponse.ok) {
                            const errorText = await itemResponse.text();
                            console.error(`Failed to save item ${index + 1} (LineNumber ${index + 1}):`, errorText);
                            console.error('Failed item data:', itemData);
                            // Return false but don't throw to allow other items to save
                            return false;
                        }
                        
                        console.log(`Successfully saved item ${index + 1} (LineNumber ${index + 1})`);
                        return true;
                    });
                    
                    const itemResults = await Promise.all(itemPromises);
                    const successCount = itemResults.filter(result => result === true).length;
                    const failCount = itemResults.filter(result => result === false).length;
                    
                    console.log(`Items saved: ${successCount} successful, ${failCount} failed out of ${samples.length} total`);
                    
                    // Log which items failed
                    itemResults.forEach((success, index) => {
                        if (!success) {
                            console.error(`Item ${index + 1} (LineNumber ${index + 1}) failed to save`);
                        }
                    });
                    
                    return {
                        success: true,
                        requestID: quoteID
                    };
                    
                } catch (error) {
                    console.error('Error saving sample request:', error);
                    return {
                        success: false,
                        error: error.message
                    };
                }
            }
        }

        // Initialize when DOM is ready to avoid document.body being null
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.sampleCart = new SampleCart();
                window.sampleRequestService = new SampleRequestService();
            });
        } else {
            // DOM already loaded (shouldn't happen in head, but just in case)
            window.sampleCart = new SampleCart();
            window.sampleRequestService = new SampleRequestService();
        }
    </script>
    
    <style>
        :root {
            --primary-color: #4cb354;
            --primary-dark: #409a47;
            --primary-light: #5bc85f;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
            --success: #22c55e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 3px solid var(--primary-color);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            height: 60px;
        }

        .company-name {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .tagline {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .contact-header {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .contact-item:hover {
            color: var(--primary-color);
        }

        .contact-item i {
            color: var(--primary-color);
        }

        /* Search Section */
        .search-section {
            max-width: 700px;
            margin: -2rem auto 3rem;
            padding: 0 2rem;
            position: relative;
            z-index: 10;
        }
        
        .search-container {
            background: white;
            border-radius: 50px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
        }
        
        .search-container:focus-within {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        
        .search-icon {
            color: var(--text-secondary);
            font-size: 1.25rem;
            margin-right: 0.75rem;
        }
        
        .search-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1rem;
            padding: 0.75rem 0;
            color: var(--text-primary);
        }
        
        .search-input::placeholder {
            color: var(--text-secondary);
        }
        
        .search-clear {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.25rem;
            padding: 0.5rem;
            display: none;
            transition: color 0.2s ease;
        }
        
        .search-clear:hover {
            color: var(--primary-color);
        }
        
        .search-clear.active {
            display: block;
        }
        
        .search-results {
            margin-top: 1rem;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .search-results strong {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .no-results {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
        }
        
        .no-results i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .no-results h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .no-results p {
            margin-bottom: 1.5rem;
        }
        
        .reset-search {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .reset-search:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .hero-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .hero h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .hero-subtitle {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            opacity: 0.95;
        }

        .hero-cta {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.875rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn-white {
            background: white;
            color: var(--primary-color);
        }

        .btn-white:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-outline:hover {
            background: white;
            color: var(--primary-color);
        }

        /* Filter Bar */
        .filter-bar {
            background: white;
            padding: 2rem 0;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 98px;
            z-index: 90;
        }

        .filter-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .filter-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 0.9375rem;
        }

        .decoration-filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 50px;
            font-size: 0.9375rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-btn:hover {
            border-color: var(--primary-color);
            background: var(--bg-color);
        }

        .filter-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .filter-btn i {
            font-size: 1.125rem;
        }

        /* Product Grid */
        .products-section {
            max-width: 1400px;
            margin: 3rem auto;
            padding: 0 2rem;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .product-badge {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(76, 179, 84, 0.95), rgba(76, 179, 84, 0.85));
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.8125rem;
            font-weight: 600;
            z-index: 10;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .product-image {
            height: 300px;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-style {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .product-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .color-swatches {
            display: flex;
            gap: 0.375rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .color-swatch {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .color-swatch:hover {
            transform: scale(1.2);
            border-color: var(--primary-color);
        }

        .color-swatch img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .more-colors {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--bg-color);
            border-radius: 50%;
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .product-cta {
            display: block;
            width: 100%;
            padding: 0.75rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .product-cta:hover {
            background: var(--primary-dark);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Contact Section */
        .contact-section {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            color: white;
            padding: 4rem 0;
            margin-top: 4rem;
        }

        .contact-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            text-align: center;
        }

        .contact-section h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .contact-subtitle {
            font-size: 1.125rem;
            margin-bottom: 3rem;
            opacity: 0.9;
        }

        .ae-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .ae-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 12px;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ae-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-4px);
        }

        .ae-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .ae-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .ae-title {
            font-size: 0.9375rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .ae-email {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9375rem;
        }

        /* Quick View Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            padding: 2rem;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .modal-body {
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .modal-images {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .modal-main-image {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
        }

        .modal-main-image img {
            width: 100%;
            height: auto;
        }

        .modal-thumbnails {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }

        .modal-thumbnail {
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s ease;
        }

        .modal-thumbnail:hover,
        .modal-thumbnail.active {
            border-color: var(--primary-color);
        }

        .modal-thumbnail img {
            width: 100%;
            height: auto;
        }

        .modal-info h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .modal-style {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .modal-description {
            margin-bottom: 2rem;
            line-height: 1.8;
        }

        .modal-features {
            background: var(--bg-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .modal-features h4 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
        }

        .modal-features ul {
            list-style: none;
        }

        .modal-features li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .modal-features li:before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        .modal-cta {
            display: flex;
            gap: 1rem;
        }

        .modal-cta button {
            flex: 1;
            padding: 1rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-quote {
            background: var(--primary-color);
            color: white;
            border: none;
        }

        .btn-quote:hover {
            background: var(--primary-dark);
        }

        .btn-contact {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-contact:hover {
            background: var(--bg-color);
        }

        /* Footer */
        .footer {
            background: var(--text-primary);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .footer p {
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .decoration-filters {
                justify-content: center;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                gap: 1.5rem;
            }

            .modal-body {
                grid-template-columns: 1fr;
            }

            .ae-grid {
                grid-template-columns: 1fr;
            }

            .contact-header {
                flex-direction: column;
                gap: 1rem;
            }
        }

        /* No products message */
        .no-products {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .no-products i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .no-products h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        /* Sample Request Styles */
        .btn-sample {
            padding: 0.625rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: none; /* Hidden until eligibility checked */
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            width: 100%;
            justify-content: center;
            border: 2px solid;
        }
        
        .btn-sample-free {
            background: white;
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-sample-paid {
            background: white;
            color: #2563eb;
            border-color: #2563eb;
        }
        
        .btn-sample:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-sample.in-cart {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-light);
        }
        
        .btn-sample:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Sample Cart Widget */
        .sample-cart-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--primary-color);
            color: white;
            border-radius: 60px;
            padding: 1rem 1.5rem;
            box-shadow: 0 4px 20px rgba(76, 179, 84, 0.3);
            cursor: pointer;
            z-index: 1000;
            display: none;
            transition: all 0.3s ease;
        }
        
        .sample-cart-widget:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 30px rgba(76, 179, 84, 0.4);
        }
        
        .sample-cart-inner {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .sample-cart-icon {
            position: relative;
            font-size: 1.5rem;
        }
        
        .sample-count-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .sample-cart-text {
            display: flex;
            flex-direction: column;
        }
        
        .sample-cart-label {
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .sample-cart-status {
            font-size: 0.75rem;
            opacity: 0.9;
        }
        
        /* Animation for widget */
        @keyframes sampleCartBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .sample-cart-bounce {
            animation: sampleCartBounce 0.6s ease;
        }
        
        .sample-cart-show {
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Sample Selection Modal */
        .sample-selection-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .sample-selection-modal.active {
            opacity: 1;
        }
        
        .sample-selection-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        
        .sample-selection-content h3 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
        }
        
        .sample-selection-content p {
            color: var(--text-secondary);
            margin: 0 0 1.5rem 0;
        }
        
        .selection-group {
            margin-bottom: 1.5rem;
        }
        
        .selection-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .selection-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .selection-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .selection-actions button {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-cancel {
            background: white;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        
        .btn-confirm {
            background: var(--primary-color);
            border: none;
            color: white;
        }
        
        .btn-confirm:hover {
            background: var(--primary-dark);
        }
        
        /* Toast Notifications */
        .sample-toast {
            position: fixed;
            bottom: 100px;
            right: 30px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 1100;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .sample-toast-show {
            transform: translateX(0);
        }
        
        .sample-toast-success {
            border-left: 4px solid var(--primary-color);
        }
        
        .sample-toast-warning {
            border-left: 4px solid #ff9800;
        }
        
        .sample-toast-info {
            border-left: 4px solid #2196f3;
        }
        
        /* Sample Request Modal */
        .sample-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .sample-modal.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 3rem;
        }
        
        .sample-modal-content {
            background: white;
            border-radius: 12px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .sample-modal-header {
            padding: 2rem;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }
        
        .sample-modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .sample-modal-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .sample-modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .sample-modal-close:hover {
            color: var(--text-primary);
        }
        
        .sample-modal-body {
            padding: 2rem;
        }
        
        .selected-samples {
            margin-bottom: 2rem;
        }
        
        .selected-samples h3 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        .sample-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-color);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }
        
        .sample-item-image {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            overflow: hidden;
            background: white;
        }
        
        .sample-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .sample-item-info {
            flex: 1;
        }
        
        .sample-item-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .sample-item-style {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .sample-item-remove {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 1.25rem;
            transition: color 0.2s ease;
        }
        
        .sample-item-remove:hover {
            color: #c82333;
        }
        
        /* Sample Request Form */
        .sample-form {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9375rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .delivery-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .radio-option {
            display: flex;
            align-items: flex-start;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .radio-option:hover {
            border-color: var(--primary-color);
            background: rgba(76, 179, 84, 0.05);
        }
        
        .radio-option input[type="radio"] {
            margin-right: 0.75rem;
            margin-top: 0.25rem;
        }
        
        .radio-option input[type="radio"]:checked + .radio-label {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .radio-label {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .radio-label i {
            margin-right: 0.5rem;
        }
        
        .radio-label small {
            display: block;
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            font-weight: normal;
        }
        
        .order-total-display {
            background: var(--bg-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }
        
        .order-total-display h4 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
        }
        
        .total-line {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            color: var(--text-secondary);
        }
        
        .total-line.total-final {
            border-top: 2px solid var(--border-color);
            margin-top: 0.5rem;
            padding-top: 1rem;
            font-weight: 600;
            font-size: 1.125rem;
            color: var(--text-primary);
        }
        
        .form-submit {
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 1rem;
        }
        
        .form-submit:hover:not(:disabled) {
            background: var(--primary-dark);
        }
        
        .form-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Sample eligibility badge */
        .sample-eligible-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary-color);
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 5;
        }
        
        /* Product card actions */
        .product-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo-section">
                <a href="/" style="display: flex; align-items: center; gap: 1rem; text-decoration: none;">
                    <img src="https://cdn.caspio.com/A0E15000/Safety%20Stripes/web%20northwest%20custom%20apparel%20logo.png?ver=1" alt="Northwest Custom Apparel" class="logo" style="cursor: pointer;">
                    <div>
                        <div class="company-name" style="color: var(--text-primary);">Northwest Custom Apparel</div>
                        <div class="tagline">Family Owned Since 1977</div>
                    </div>
                </a>
            </div>
            <div class="contact-header">
                <a href="tel:253-922-5793" class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>253-922-5793</span>
                </a>
                <a href="mailto:sales@nwcustomapparel.com" class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <span>Quick Quote</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-container">
            <h1>Start with Our Best Sellers</h1>
            <p class="hero-subtitle">These proven products are trusted by businesses across the Pacific Northwest</p>
            <div class="hero-cta">
                <a href="#contact" class="btn btn-white">
                    <i class="fas fa-user-tie"></i>
                    Contact an Account Executive
                </a>
                <a href="tel:253-922-5793" class="btn btn-outline">
                    <i class="fas fa-phone"></i>
                    Call for Quick Quote
                </a>
            </div>
        </div>
    </section>

    <!-- Search Section -->
    <section class="search-section">
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" 
                   class="search-input" 
                   id="searchInput" 
                   placeholder="Search products by name, style, brand..." 
                   autocomplete="off">
            <button class="search-clear" id="searchClear" onclick="clearSearch()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="search-results" id="searchResults" style="display: none;">
            Found <strong id="resultCount">0</strong> products
        </div>
    </section>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="filter-container">
            <div class="filter-header">
                <div class="filter-title">Filter by Decoration Type</div>
                <div class="results-count" id="resultsCount">Showing 0 products</div>
            </div>
            <div class="decoration-filters">
                <button class="filter-btn active" data-type="all">
                    <i class="fas fa-th"></i>
                    <span>All Products</span>
                </button>
                <button class="filter-btn" data-type="dtg">
                    <i class="fas fa-print"></i>
                    <span>DTG Printing</span>
                </button>
                <button class="filter-btn" data-type="screenprint">
                    <i class="fas fa-paint-brush"></i>
                    <span>Screen Printing</span>
                </button>
                <button class="filter-btn" data-type="embroidery">
                    <i class="fas fa-sewing-needle"></i>
                    <span>Embroidery</span>
                </button>
                <button class="filter-btn" data-type="caps">
                    <i class="fas fa-hat-cowboy"></i>
                    <span>Caps & Hats</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Products Section -->
    <section class="products-section">
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <p style="margin-top: 1rem; color: var(--text-secondary);">Loading products...</p>
        </div>
        <div class="products-grid" id="productsGrid" style="display: none;">
            <!-- Products will be dynamically loaded here -->
        </div>
        <div class="no-products" id="noProducts" style="display: none;">
            <i class="fas fa-box-open"></i>
            <h3>No products found</h3>
            <p>Try selecting a different category</p>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact-section" id="contact">
        <div class="contact-container">
            <h2>Ready to Order? Contact Our Team</h2>
            <p class="contact-subtitle">Our experienced account executives are here to help with your custom apparel needs</p>
            <div class="ae-grid">
                <a href="mailto:nika@nwcustomapparel.com" class="ae-card">
                    <i class="fas fa-user-circle ae-icon"></i>
                    <div class="ae-name">Nika Lao</div>
                    <div class="ae-title">Account Executive</div>
                    <div class="ae-email">
                        <i class="fas fa-envelope"></i>
                        nika@nwcustomapparel.com
                    </div>
                </a>
                <a href="mailto:taneisha@nwcustomapparel.com" class="ae-card">
                    <i class="fas fa-user-circle ae-icon"></i>
                    <div class="ae-name">Taneisha Clark</div>
                    <div class="ae-title">Account Executive</div>
                    <div class="ae-email">
                        <i class="fas fa-envelope"></i>
                        taneisha@nwcustomapparel.com
                    </div>
                </a>
                <a href="mailto:sales@nwcustomapparel.com" class="ae-card">
                    <i class="fas fa-users ae-icon"></i>
                    <div class="ae-name">Sales Team</div>
                    <div class="ae-title">General Inquiries</div>
                    <div class="ae-email">
                        <i class="fas fa-envelope"></i>
                        sales@nwcustomapparel.com
                    </div>
                </a>
            </div>
        </div>
    </section>

    <!-- Quick View Modal -->
    <div id="quickViewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Product Details</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Product details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 Northwest Custom Apparel. All rights reserved.</p>
            <p>2025 Freeman Road East, Milton, WA 98354 | 253-922-5793</p>
        </div>
    </footer>

    <!-- Sample Request Modal -->
    <div id="sampleRequestModal" class="sample-modal">
        <div class="sample-modal-content">
            <div class="sample-modal-header">
                <h2 class="sample-modal-title">Complete Your Sample Request</h2>
                <p class="sample-modal-subtitle">We'll send these samples to you for FREE!</p>
                <button class="sample-modal-close" onclick="closeSampleModal()">&times;</button>
            </div>
            <div class="sample-modal-body">
                <!-- Selected samples -->
                <div class="selected-samples">
                    <h3>Selected Samples (<span id="sampleCount">0</span>/3)</h3>
                    <div id="selectedSamplesList">
                        <!-- Samples will be dynamically added here -->
                    </div>
                </div>
                
                <!-- Contact form -->
                <form id="sampleRequestForm" class="sample-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sampleName">Your Name *</label>
                            <input type="text" id="sampleName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="sampleEmail">Email Address *</label>
                            <input type="email" id="sampleEmail" name="email" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="samplePhone">Phone Number</label>
                            <input type="tel" id="samplePhone" name="phone">
                        </div>
                        <div class="form-group">
                            <label for="sampleCompany">Company Name</label>
                            <input type="text" id="sampleCompany" name="company">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectType">What type of decoration are you interested in? *</label>
                        <select id="projectType" name="projectType" required>
                            <option value="">Select decoration type...</option>
                            <option value="Screen Printing">Screen Printing</option>
                            <option value="DTG Printing">DTG (Direct to Garment) Printing</option>
                            <option value="Embroidery">Embroidery</option>
                            <option value="Heat Transfer">Heat Transfer</option>
                            <option value="Not Sure Yet">Not Sure Yet</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="estimatedQuantity">Estimated Quantity Needed</label>
                            <select id="estimatedQuantity" name="estimatedQuantity">
                                <option value="">Select quantity...</option>
                                <option value="1-24">1-24 pieces</option>
                                <option value="25-49">25-49 pieces</option>
                                <option value="50-99">50-99 pieces</option>
                                <option value="100-249">100-249 pieces</option>
                                <option value="250-499">250-499 pieces</option>
                                <option value="500+">500+ pieces</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="timeline">When do you need these?</label>
                            <select id="timeline" name="timeline">
                                <option value="">Select timeline...</option>
                                <option value="ASAP">ASAP</option>
                                <option value="Within 1 week">Within 1 week</option>
                                <option value="Within 2 weeks">Within 2 weeks</option>
                                <option value="Within 1 month">Within 1 month</option>
                                <option value="Just researching">Just researching</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="sampleNotes">Additional Notes (optional)</label>
                        <textarea id="sampleNotes" name="notes" rows="3" placeholder="Tell us about your project or any specific requirements..."></textarea>
                    </div>
                    
                    <!-- Delivery Method -->
                    <div class="form-group">
                        <label>How would you like to receive your samples? *</label>
                        <div class="delivery-options">
                            <label class="radio-option">
                                <input type="radio" name="deliveryMethod" value="pickup" checked onchange="toggleShippingFields()">
                                <span class="radio-label">
                                    <i class="fas fa-store"></i> Pickup at NWCA (FREE)
                                    <small>2025 Freeman Road East, Milton, WA | Mon-Fri 9AM-5PM</small>
                                </span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="deliveryMethod" value="ship" onchange="toggleShippingFields()">
                                <span class="radio-label">
                                    <i class="fas fa-shipping-fast"></i> Ship to me (+$10.00)
                                    <small>2-3 business days via USPS/UPS</small>
                                </span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Shipping Address (hidden by default) -->
                    <div id="shippingFields" style="display: none;">
                        <h4 style="margin: 1.5rem 0 1rem 0;">Shipping Address</h4>
                        <div class="form-group">
                            <label for="shippingAddress">Street Address *</label>
                            <input type="text" id="shippingAddress" name="shippingAddress" placeholder="123 Main Street">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="shippingCity">City *</label>
                                <input type="text" id="shippingCity" name="shippingCity" placeholder="Seattle">
                            </div>
                            <div class="form-group" style="width: 30%;">
                                <label for="shippingState">State *</label>
                                <input type="text" id="shippingState" name="shippingState" placeholder="WA" maxlength="2">
                            </div>
                            <div class="form-group" style="width: 30%;">
                                <label for="shippingZip">ZIP *</label>
                                <input type="text" id="shippingZip" name="shippingZip" placeholder="98101" pattern="[0-9]{5}">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Total Display -->
                    <div class="order-total-display" id="orderTotalDisplay" style="display: none;">
                        <h4>Order Summary</h4>
                        <div class="total-line"><span>Samples:</span> <span id="samplesSubtotal">$0.00</span></div>
                        <div class="total-line" id="shippingLine" style="display: none;"><span>Shipping:</span> <span>$10.00</span></div>
                        <div class="total-line total-final"><span>Total to Collect:</span> <span id="finalTotal">$0.00</span></div>
                    </div>
                    
                    <button type="submit" class="form-submit" id="submitSampleRequest">
                        <i class="fas fa-paper-plane"></i> <span id="submitButtonText">Request Free Samples</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Complete top sellers data - ALL 60 products
        const completeTopSellers = {
            dtg: [
                { rank: 1, style: 'PC54', description: 'Port & Company - Core Cotton Tee', brand: 'Port & Company' },
                { rank: 2, style: 'PC450', description: 'Port & Company Fan Favorite Tee', brand: 'Port & Company' },
                { rank: 3, style: 'PC61', description: 'Port & Company - Essential Tee', brand: 'Port & Company' },
                { rank: 4, style: 'PC54', description: 'Port & Company - Core Cotton Tee', brand: 'Port & Company' },
                { rank: 5, style: 'PC78H', description: 'Port & Company - Core Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 6, style: 'PC55', description: 'Port & Company - Core Blend Tee', brand: 'Port & Company' },
                { rank: 7, style: 'PC61LS', description: 'Port & Company - Long Sleeve Essential Tee', brand: 'Port & Company' },
                { rank: 8, style: 'PC600', description: 'Port & Company Bouncer Tee', brand: 'Port & Company' },
                { rank: 9, style: 'PC90H', description: 'Port & Company - Essential Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 10, style: 'PC90H', description: 'Port & Company - Essential Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 11, style: 'PC450', description: 'Port & Company Fan Favorite Tee', brand: 'Port & Company' },
                { rank: 12, style: 'BC3001', description: 'BellaCanvas Unisex Jersey Short Sleeve Tee', brand: 'BellaCanvas' },
                { rank: 13, style: 'GRT-50', description: 'Logo Mockup & Print Review Service', brand: 'Service' },
                { rank: 14, style: 'PC54LS', description: 'Port & Company - Long Sleeve Core Cotton Tee', brand: 'Port & Company' },
                { rank: 15, style: 'CTK87', description: 'Carhartt Workwear Pocket Short Sleeve T-Shirt', brand: 'Carhartt' }
            ],
            caps: [
                { rank: 1, style: 'C112', description: 'Port Authority Snapback Trucker Cap', brand: 'Port Authority' },
                { rank: 2, style: '112', description: 'Richardson Trucker Cap with Mesh Snap Back', brand: 'Richardson' },
                { rank: 3, style: 'NE1000', description: 'New Era - Structured Stretch Cotton Cap', brand: 'New Era' },
                { rank: 4, style: 'C110', description: 'Port Authority Flexfit 110 Mesh Cap', brand: 'Port Authority' },
                { rank: 5, style: 'C112', description: 'Port Authority Snapback Trucker Cap', brand: 'Port Authority' },
                { rank: 6, style: 'CP90', description: 'Port & Company Knit Cap', brand: 'Port & Company' },
                { rank: 7, style: 'C826', description: 'Port Authority Pique Mesh Cap L/XL', brand: 'Port Authority' },
                { rank: 8, style: 'C114', description: 'Port Authority Digi Camo Snapback Trucker Cap', brand: 'Port Authority' },
                { rank: 9, style: 'C912', description: 'Port Authority Camouflage Cap With Air Mesh Back', brand: 'Port Authority' },
                { rank: 10, style: 'TM1MU423', description: 'Travismathew Cruz Trucker Cap', brand: 'TravisMathew' },
                { rank: 11, style: 'CP85', description: 'Port & Company Sandwich Bill Cap', brand: 'Port & Company' },
                { rank: 12, style: 'C865', description: 'Port Authority Flexfit Cap', brand: 'Port Authority' },
                { rank: 13, style: 'CP82', description: 'Port & Company Brushed Twill Cap', brand: 'Port & Company' },
                { rank: 14, style: 'OC771', description: 'Trucker Cap', brand: 'Generic' },
                { rank: 15, style: 'HDP-605', description: 'Weathered Cotton Twill', brand: 'Generic' }
            ],
            embroidery: [
                { rank: 1, style: 'NKDC1963', description: 'Nike Dri-Fit Micro Pique 2.0 Polo', brand: 'Nike' },
                { rank: 2, style: 'CT104670', description: 'Carhartt Storm Defender Shoreline Jacket', brand: 'Carhartt' },
                { rank: 3, style: 'EB532', description: 'Eddie Bauer Shaded Crosshatch Soft Shell Jacket', brand: 'Eddie Bauer' },
                { rank: 4, style: '267020', description: 'Nike Dri-Fit Classic Polo', brand: 'Nike' },
                { rank: 5, style: 'CT100617', description: 'Carhartt Rain Defender Paxton Heavyweight Hooded Zip Mock Sweatshirt', brand: 'Carhartt' },
                { rank: 6, style: 'ST253', description: 'Sport-Tek 1/4-Zip Sweatshirt', brand: 'Sport-Tek' },
                { rank: 7, style: 'C112', description: 'Port Authority Snapback Trucker Cap', brand: 'Port Authority' },
                { rank: 8, style: 'CTK121', description: 'Carhartt Midweight Hooded Sweatshirt', brand: 'Carhartt' },
                { rank: 9, style: 'CT103828', description: 'Carhartt Duck Detroit Jacket', brand: 'Carhartt' },
                { rank: 10, style: 'CT89176508', description: 'Carhartt Foundry Series Pro Backpack', brand: 'Carhartt' },
                { rank: 11, style: 'ST650', description: 'Sport-Tek Micropique Sport-Wick Polo', brand: 'Sport-Tek' },
                { rank: 12, style: 'CT104597', description: 'Carhartt Watch Cap 2.0', brand: 'Carhartt' },
                { rank: 13, style: 'EB550', description: 'Eddie Bauer - Rain Jacket', brand: 'Eddie Bauer' },
                { rank: 14, style: 'CT102286', description: 'Carhartt Gilliam Vest', brand: 'Carhartt' },
                { rank: 15, style: 'ST850', description: 'Sport-Tek Sport-Wick Stretch 1/4-Zip Pullover', brand: 'Sport-Tek' }
            ],
            screenprint: [
                { rank: 1, style: 'PC90H', description: 'Port & Company - Essential Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 2, style: 'PC55', description: 'Port & Company - Core Blend Tee', brand: 'Port & Company' },
                { rank: 3, style: '18500', description: 'Gildan - Heavy Blend Hooded Sweatshirt', brand: 'Gildan' },
                { rank: 4, style: 'PC78H', description: 'Port & Company - Core Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 5, style: 'PC600', description: 'Port & Company Bouncer Tee', brand: 'Port & Company' },
                { rank: 6, style: '996M', description: 'Jerzees - Nublend Pullover Hooded Sweatshirt', brand: 'Jerzees' },
                { rank: 7, style: 'BC3001', description: 'BellaCanvas Unisex Jersey Short Sleeve Tee', brand: 'BellaCanvas' },
                { rank: 8, style: '5186', description: 'Hanes Adult Long-Sleeve Beefy-T', brand: 'Hanes' },
                { rank: 9, style: 'PC55P', description: 'Port & Company - Core Blend Pocket Tee', brand: 'Port & Company' },
                { rank: 10, style: 'PC54', description: 'Port & Company - Core Cotton Tee', brand: 'Port & Company' },
                { rank: 11, style: 'CS204', description: 'CornerStone ANSI 107 Class 2 Segmented Tape Tee', brand: 'CornerStone' },
                { rank: 12, style: '5180', description: 'Hanes Beefy-T - 100 Cotton T-Shirt', brand: 'Hanes' },
                { rank: 13, style: 'DT6100', description: 'District V.I.T. Fleece Hoodie', brand: 'District' },
                { rank: 14, style: 'PC600', description: 'Port & Company Bouncer Tee (2X)', brand: 'Port & Company' },
                { rank: 15, style: 'SPRESET', description: 'Screen Reset Charge', brand: 'Service' }
            ]
        };

        // Brand placeholder styles for non-API products
        const brandPlaceholders = {
            'Nike': {
                background: 'linear-gradient(135deg, #111111, #333333)',
                icon: `<svg viewBox="0 0 24 24" style="width: 60px; height: 60px; fill: white;"><path d="M6.75 2.77l9.57 6.14c.27.18.57.27.9.27a1.5 1.5 0 0 0 1.02-.39c.77-.77.6-2.03-.39-2.84L6.23.01C5.5-.33 4.92.11 4.92.91c0 .52.09 1.19.22 1.86c.2 1.11.52 2.8.92 4.38c.5 1.94 1.15 3.9 2.06 5.16c.3.41.64.71 1 .87c.29.13.6.19.92.19c.52 0 1.03-.15 1.49-.45c1.55-.97 2.85-2.76 3.45-4.35Z"/></svg>`,
                tagline: 'Just Do It®',
                textColor: 'white'
            },
            'Carhartt': {
                background: 'linear-gradient(135deg, #8b6f47, #6d5943)',
                icon: '<span style="font-size: 48px; font-weight: bold; color: white;">C</span>',
                tagline: 'Outworking Since 1889',
                textColor: 'white'
            },
            'Eddie Bauer': {
                background: 'linear-gradient(135deg, #1a3a52, #2d5016)',
                icon: '<span style="font-size: 36px; font-weight: bold; color: white;">EB</span>',
                tagline: 'First Ascent',
                textColor: 'white'
            },
            'New Era': {
                background: 'linear-gradient(135deg, #000000, #1a1a1a)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">NEW ERA</span>',
                tagline: 'Authentic Performance',
                textColor: 'white'
            },
            'TravisMathew': {
                background: 'linear-gradient(135deg, #2c5aa0, #1e3a6f)',
                icon: '<span style="font-size: 28px; font-weight: 300; color: white;">TM</span>',
                tagline: 'Life on Tour',
                textColor: 'white'
            },
            'Gildan': {
                background: 'linear-gradient(135deg, #0066cc, #003d7a)',
                icon: '<span style="font-size: 36px; font-weight: bold; color: white;">G</span>',
                tagline: 'Quality Basics',
                textColor: 'white'
            },
            'BellaCanvas': {
                background: 'linear-gradient(135deg, #e91e63, #c2185b)',
                icon: '<span style="font-size: 28px; font-weight: 300; color: white;">BELLA</span>',
                tagline: 'Retail Inspired',
                textColor: 'white'
            },
            'Jerzees': {
                background: 'linear-gradient(135deg, #ff6b35, #f44336)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">J</span>',
                tagline: 'Quality Essentials',
                textColor: 'white'
            },
            'Hanes': {
                background: 'linear-gradient(135deg, #b71c1c, #d32f2f)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">H</span>',
                tagline: 'Comfort Made Better',
                textColor: 'white'
            },
            'Richardson': {
                background: 'linear-gradient(135deg, #37474f, #263238)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">R</span>',
                tagline: 'The Hat of Choice',
                textColor: 'white'
            },
            'District': {
                background: 'linear-gradient(135deg, #9c27b0, #7b1fa2)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">D</span>',
                tagline: 'Everyday Tees',
                textColor: 'white'
            },
            'CornerStone': {
                background: 'linear-gradient(135deg, #ff9800, #f57c00)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">CS</span>',
                tagline: 'Work Tough',
                textColor: 'white'
            },
            'Sport-Tek': {
                background: 'linear-gradient(135deg, #2e7d32, #388e3c)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">ST</span>',
                tagline: 'Sport Performance',
                textColor: 'white'
            },
            'Port Authority': {
                background: 'linear-gradient(135deg, #1565c0, #1976d2)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">PA</span>',
                tagline: 'Professional Apparel',
                textColor: 'white'
            },
            'Port & Company': {
                background: 'linear-gradient(135deg, #5e35b1, #673ab7)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">PC</span>',
                tagline: 'Essential Basics',
                textColor: 'white'
            },
            'Generic': {
                background: 'linear-gradient(135deg, #757575, #9e9e9e)',
                icon: '<i class="fas fa-tshirt" style="font-size: 48px; color: white;"></i>',
                tagline: 'Quality Apparel',
                textColor: 'white'
            }
        };

        // Product cache
        const productCache = {};
        let currentFilter = 'all';
        let allProducts = [];
        let searchTerm = '';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts('all');
            setupEventListeners();
            initializeSearch();
        });

        // Initialize search functionality
        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchClear = document.getElementById('searchClear');
            
            searchInput.addEventListener('input', (e) => {
                searchTerm = e.target.value.toLowerCase();
                searchClear.classList.toggle('active', searchTerm.length > 0);
                performSearch();
            });
        }
        
        // Clear search
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchClear').classList.remove('active');
            searchTerm = '';
            performSearch();
        }
        
        // Perform search and filter
        function performSearch() {
            const searchResults = document.getElementById('searchResults');
            const productsGrid = document.getElementById('productsGrid');
            const resultsCount = document.getElementById('resultsCount');
            let matchCount = 0;
            
            productsGrid.innerHTML = '';
            
            for (const product of allProducts) {
                // Build searchable text using both possible property names
                const name = product.name || product.description || '';
                const style = product.styleNumber || product.style || '';
                const brand = product.brand || detectBrand(name) || '';
                const searchableText = `${name} ${style} ${brand} ${product.type || ''}`.toLowerCase();
                
                // Check if matches search
                if (!searchTerm || searchableText.includes(searchTerm)) {
                    matchCount++;
                    const card = createProductCard(product);
                    if (card) {
                        productsGrid.appendChild(card);
                    }
                }
            }
            
            // Update results display
            if (searchTerm) {
                searchResults.style.display = 'block';
                document.getElementById('resultCount').textContent = matchCount;
            } else {
                searchResults.style.display = 'none';
            }
            
            resultsCount.textContent = `Showing ${matchCount} products`;
            
            // Show no results message if needed
            if (matchCount === 0 && searchTerm) {
                productsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1;">
                        <div class="no-results">
                            <i class="fas fa-search"></i>
                            <h3>No products found</h3>
                            <p>Try adjusting your search terms</p>
                            <button class="reset-search" onclick="clearSearch()">Clear Search</button>
                        </div>
                    </div>
                `;
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.type;
                    loadProducts(currentFilter);
                });
            });

            // Modal close on outside click
            document.getElementById('quickViewModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        // Load products based on filter
        async function loadProducts(type) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const productsGrid = document.getElementById('productsGrid');
            const noProducts = document.getElementById('noProducts');
            
            loadingIndicator.style.display = 'block';
            productsGrid.style.display = 'none';
            noProducts.style.display = 'none';
            
            allProducts = [];
            
            if (type === 'all') {
                // Load all categories - ALL 60 products
                for (const [category, products] of Object.entries(completeTopSellers)) {
                    for (const product of products) {
                        allProducts.push({...product, type: category});
                    }
                }
            } else {
                // Load specific category
                if (completeTopSellers[type]) {
                    for (const product of completeTopSellers[type]) {
                        allProducts.push({...product, type});
                    }
                }
            }

            // Fetch product details from API for all products
            const productsWithDetails = await Promise.all(
                allProducts.map(async (product) => {
                    // Skip service items
                    if (product.brand === 'Service') {
                        return {
                            ...product,
                            details: null,
                            isService: true
                        };
                    }
                    
                    if (!productCache[product.style]) {
                        try {
                            const response = await fetch(`https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/product-details?styleNumber=${product.style}`);
                            if (response.ok) {
                                const details = await response.json();
                                if (details && details.length > 0) {
                                    productCache[product.style] = details;
                                }
                            }
                        } catch (error) {
                            console.error(`Error fetching ${product.style}:`, error);
                        }
                    }
                    return {
                        ...product,
                        details: productCache[product.style] || null
                    };
                })
            );

            // Store products for search
            allProducts = productsWithDetails;
            
            // Display products (or perform search if there's a search term)
            if (searchTerm) {
                performSearch();
            } else {
                displayProducts(productsWithDetails);
                document.getElementById('resultsCount').textContent = `Showing ${productsWithDetails.length} products`;
            }
            
            loadingIndicator.style.display = 'none';
            productsGrid.style.display = 'grid';
        }

        // Create product card
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            
            // Add data attributes for search
            card.dataset.productName = product.name || product.description || '';
            card.dataset.styleNumber = product.styleNumber || product.style || '';
            card.dataset.brand = product.brand || detectBrand(product.name || product.description) || '';
            card.dataset.category = product.type || '';
            
            const decorationType = getDecorationType(product.type);
            
            // Check if this is a service item
            if (product.isService) {
                // Don't show service items in catalog
                return null;
            }
            
            // Check if we have API data
                if (product.details && product.details.length > 0) {
                    // Product with real images from API
                    const firstProduct = product.details[0];
                    
                    // Get unique colors only
                    const uniqueColors = [];
                    const seenColors = new Set();
                    
                    for (const item of product.details) {
                        if (item.COLOR_NAME && !seenColors.has(item.COLOR_NAME)) {
                            seenColors.add(item.COLOR_NAME);
                            uniqueColors.push(item);
                        }
                    }
                    
                    const colorsToShow = uniqueColors.slice(0, 5);
                    
                    card.onclick = () => navigateToProduct(product);
                    
                    card.innerHTML = `
                        <div class="product-image">
                            <div class="product-badge">${decorationType}</div>
                            <img src="${firstProduct.FRONT_MODEL || firstProduct.FRONT_FLAT || firstProduct.PRODUCT_IMAGE}" 
                                 alt="${product.description}"
                                 onerror="this.src='${firstProduct.PRODUCT_IMAGE || ''}'">
                        </div>
                        <div class="product-info">
                            <div class="product-style">Style #${product.style}</div>
                            <div class="product-name">${product.description}</div>
                            <div class="color-swatches">
                                ${colorsToShow.map(c => `
                                    <div class="color-swatch" title="${c.COLOR_NAME}">
                                        <img src="${c.COLOR_SQUARE_IMAGE}" alt="${c.COLOR_NAME}">
                                    </div>
                                `).join('')}
                                ${uniqueColors.length > 5 ? `
                                    <div class="more-colors">+${uniqueColors.length - 5}</div>
                                ` : ''}
                            </div>
                            <div class="product-actions">
                                <button class="btn-sample" data-style="${product.style}" data-eligible="pending" onclick="event.stopPropagation(); handleSampleRequest('${product.style}', '${product.description.replace(/'/g, "\\'")}', '${firstProduct.FRONT_MODEL || firstProduct.PRODUCT_IMAGE || ''}')">
                                    <i class="fas fa-box-open"></i> Request Sample
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    // Product without API data - use placeholder
                    const brandStyle = brandPlaceholders[product.brand] || brandPlaceholders['Generic'];
                    
                    card.onclick = () => navigateToProduct(product);
                    
                    card.innerHTML = `
                        <div class="product-image" style="background: ${brandStyle ? brandStyle.background : 'linear-gradient(135deg, #e0e0e0, #bdbdbd)'}; display: flex; flex-direction: column; justify-content: center; align-items: center; color: ${brandStyle ? brandStyle.textColor : '#666'}; position: relative;">
                            <div class="product-badge">${decorationType}</div>
                            ${brandStyle ? brandStyle.icon : '<i class="fas fa-tshirt" style="font-size: 48px;"></i>'}
                            <div style="margin-top: 1rem; font-size: 0.875rem; font-weight: 600;">${product.brand}</div>
                            ${brandStyle && brandStyle.tagline ? `<div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;">${brandStyle.tagline}</div>` : ''}
                        </div>
                        <div class="product-info">
                            <div class="product-style">Style #${product.style}</div>
                            <div class="product-name">${product.description}</div>
                            <div style="padding: 0.75rem 0; text-align: center; color: var(--text-secondary); font-size: 0.875rem;">
                                <i class="fas fa-award" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                                Premium ${product.brand} Product
                            </div>
                            <div class="product-actions">
                                <button class="btn-sample" data-style="${product.style}" data-eligible="pending" onclick="event.stopPropagation(); handleSampleRequest('${product.style}', '${product.description.replace(/'/g, "\\'")}', '')">
                                    <i class="fas fa-box-open"></i> Request Sample
                                </button>
                            </div>
                        </div>
                    `;
            }
            
            return card;
        }
        
        // Display products in grid
        function displayProducts(products) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            
            products.forEach(product => {
                const card = createProductCard(product);
                if (card) {
                    grid.appendChild(card);
                }
            });
            
            // Check eligibility and update buttons after products are displayed
            setTimeout(() => {
                if (window.sampleCart && typeof window.sampleCart.checkAllProductEligibility === 'function') {
                    console.log('Checking sample eligibility for all products...');
                    window.sampleCart.checkAllProductEligibility();
                } else {
                    console.log('Sample cart not ready, retrying...');
                    setTimeout(() => {
                        if (window.sampleCart) {
                            window.sampleCart.checkAllProductEligibility();
                        }
                    }, 500);
                }
            }, 100);
        }
        
        // Detect brand from product name
        function detectBrand(name) {
            if (!name) return '';
            const nameLower = name.toLowerCase();
            if (nameLower.includes('nike')) return 'Nike';
            if (nameLower.includes('carhartt')) return 'Carhartt';
            if (nameLower.includes('eddie bauer')) return 'Eddie Bauer';
            if (nameLower.includes('new era')) return 'New Era';
            if (nameLower.includes('port & company')) return 'Port & Company';
            if (nameLower.includes('port authority')) return 'Port Authority';
            if (nameLower.includes('sport-tek')) return 'Sport-Tek';
            if (nameLower.includes('gildan')) return 'Gildan';
            if (nameLower.includes('jerzees')) return 'Jerzees';
            if (nameLower.includes('bella')) return 'Bella+Canvas';
            if (nameLower.includes('district')) return 'District';
            if (nameLower.includes('cornerstone')) return 'CornerStone';
            if (nameLower.includes('richardson')) return 'Richardson';
            return '';
        }

        // Navigate to product detail page
        function navigateToProduct(product) {
            const params = new URLSearchParams({
                style: product.style,
                name: product.description,
                type: product.type,
                brand: product.brand,
                ref: 'showcase'
            });
            window.location.href = `/top-sellers-product.html?${params}`;
        }

        // Get decoration type display name
        function getDecorationType(type) {
            const types = {
                'dtg': 'Best for DTG',
                'screenprint': 'Best for Screen Print',
                'embroidery': 'Best for Embroidery',
                'caps': 'Top Selling Cap'
            };
            return types[type] || 'Top Seller';
        }

        // Show quick view modal
        function showQuickView(product) {
            const modal = document.getElementById('quickViewModal');
            const modalBody = document.getElementById('modalBody');
            const modalTitle = document.getElementById('modalTitle');
            
            modalTitle.textContent = product.description;
            
            const firstProduct = product.details[0];
            const images = [];
            
            // Collect unique images
            if (firstProduct.FRONT_MODEL) images.push(firstProduct.FRONT_MODEL);
            if (firstProduct.BACK_MODEL) images.push(firstProduct.BACK_MODEL);
            if (firstProduct.FRONT_FLAT) images.push(firstProduct.FRONT_FLAT);
            if (firstProduct.BACK_FLAT) images.push(firstProduct.BACK_FLAT);
            
            // Parse description for features
            const features = firstProduct.PRODUCT_DESCRIPTION ? 
                firstProduct.PRODUCT_DESCRIPTION.split('     ').filter(f => f.trim()) : [];
            
            modalBody.innerHTML = `
                <div class="modal-images">
                    <div class="modal-main-image">
                        <img src="${images[0] || firstProduct.PRODUCT_IMAGE}" alt="${product.description}" id="mainModalImage">
                    </div>
                    ${images.length > 1 ? `
                        <div class="modal-thumbnails">
                            ${images.map((img, index) => `
                                <div class="modal-thumbnail ${index === 0 ? 'active' : ''}" onclick="changeModalImage('${img}', this)">
                                    <img src="${img}" alt="View ${index + 1}">
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
                <div class="modal-info">
                    <h3>${product.description}</h3>
                    <div class="modal-style">Style #${product.style}</div>
                    <div class="modal-description">
                        ${features[0] || 'Premium quality apparel perfect for custom decoration.'}
                    </div>
                    ${features.length > 1 ? `
                        <div class="modal-features">
                            <h4>Product Features</h4>
                            <ul>
                                ${features.slice(1).map(f => `<li>${f.trim()}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    <div class="modal-cta">
                        <button class="btn-quote" onclick="requestQuote('${product.style}', '${product.description.replace(/'/g, "\\'")}'); closeModal();">
                            <i class="fas fa-calculator"></i>
                            Request Custom Quote
                        </button>
                        <button class="btn-contact" onclick="window.location.href='mailto:sales@nwcustomapparel.com'">
                            <i class="fas fa-envelope"></i>
                            Contact Sales
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        // Change modal image
        function changeModalImage(src, thumbnail) {
            document.getElementById('mainModalImage').src = src;
            document.querySelectorAll('.modal-thumbnail').forEach(t => t.classList.remove('active'));
            thumbnail.classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('quickViewModal').classList.remove('active');
        }

        // Request quote
        function requestQuote(style, name) {
            const subject = `Quote Request: ${name} (Style #${style})`;
            const body = `Hello,\n\nI'm interested in getting a custom quote for:\n\nProduct: ${name}\nStyle: #${style}\n\nPlease provide pricing for custom decoration.\n\nThank you!`;
            
            window.location.href = `mailto:sales@nwcustomapparel.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }
        
        // Sample Request System Integration
        let sampleRequestService = null;
        
        // Initialize sample request system
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize service if available
            if (typeof SampleRequestService !== 'undefined') {
                sampleRequestService = new SampleRequestService();
            }
            
            // Listen for sample modal events
            window.addEventListener('openSampleModal', (e) => {
                openSampleModal(e.detail.samples);
            });
            
            // Handle form submission
            document.getElementById('sampleRequestForm').addEventListener('submit', handleSampleFormSubmit);
        });
        
        // Handle sample request button click
        function handleSampleRequest(styleNumber, productName, imageUrl) {
            if (!window.sampleCart) return;
            
            // Get the button to retrieve pricing info
            const button = event.target.closest('.btn-sample');
            const samplePrice = parseFloat(button.dataset.samplePrice) || 0;
            const sampleType = button.dataset.sampleType || 'free';
            
            // Check if already in cart
            const cartSummary = window.sampleCart.getCartSummary();
            const existingItem = cartSummary.items.find(item => item.style === styleNumber);
            
            if (existingItem) {
                // Remove from cart
                window.sampleCart.removeSample(styleNumber);
                return;
            }
            
            // Get cached eligibility data with colors/sizes
            const eligibilityData = window.sampleCart.eligibilityCache[styleNumber];
            if (!eligibilityData || !eligibilityData.colors || eligibilityData.colors.length === 0 || 
                !eligibilityData.sizes || eligibilityData.sizes.length === 0) {
                // Try to fetch the data if not available
                console.log('No color/size data cached for', styleNumber, '- fetching...');
                
                // Show loading indicator
                const button = event.target.closest('.btn-sample');
                if (button) {
                    button.disabled = true;
                    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                }
                
                // Fetch the eligibility data
                window.sampleCart.checkEligibility(styleNumber).then(data => {
                    // Re-enable button
                    if (button) {
                        button.disabled = false;
                        button.innerHTML = '<i class="fas fa-box-open"></i> Request Sample';
                    }
                    
                    if (data.eligible && data.colors && data.colors.length > 0 && 
                        data.sizes && data.sizes.length > 0) {
                        // Update button with pricing info
                        if (button) {
                            button.dataset.samplePrice = data.price || 0;
                            button.dataset.sampleType = data.type || 'free';
                        }
                        // Now show the modal with the fetched data
                        showSampleSelectionModal(styleNumber, productName, imageUrl, 
                                                data.price, data.type, data);
                    } else {
                        // Can't get data - show error
                        console.error('Unable to get color/size options for', styleNumber, data);
                        alert('Unable to load color/size options for this product. Please try again or contact customer service.');
                    }
                }).catch(error => {
                    console.error('Error fetching eligibility data:', error);
                    if (button) {
                        button.disabled = false;
                        button.innerHTML = '<i class="fas fa-box-open"></i> Request Sample';
                    }
                    alert('Error loading product options. Please try again.');
                });
                return;
            }
            
            // Show color/size selection modal
            showSampleSelectionModal(styleNumber, productName, imageUrl, samplePrice, sampleType, eligibilityData);
        }
        
        // Show modal for color/size selection
        function showSampleSelectionModal(styleNumber, productName, imageUrl, price, type, eligibilityData) {
            // Validate we have colors and sizes
            if (!eligibilityData.colors || eligibilityData.colors.length === 0) {
                console.error('No colors available for', styleNumber);
                alert('Unable to load color options for this product. Please try again or contact customer service.');
                return;
            }
            
            if (!eligibilityData.sizes || eligibilityData.sizes.length === 0) {
                console.error('No sizes available for', styleNumber);
                alert('Unable to load size options for this product. Please try again or contact customer service.');
                return;
            }
            
            // Create a simple selection modal
            const modal = document.createElement('div');
            modal.className = 'sample-selection-modal';
            modal.innerHTML = `
                <div class="sample-selection-content">
                    <h3>Select Options for ${productName}</h3>
                    <p>Style #${styleNumber}</p>
                    ${price > 0 ? `<p style="color: #dc2626; font-weight: 500;">Sample Price: $${price.toFixed(2)}</p>` : '<p style="color: #10b981; font-weight: 500;">FREE Sample</p>'}
                    
                    <div class="selection-group">
                        <label>Color: <span style="color: red;">*</span></label>
                        <select id="sampleColorSelect" required>
                            <option value="">Choose color...</option>
                            ${eligibilityData.colors.map(c => 
                                `<option value="${c.code || c.name}">${c.name}</option>`
                            ).join('')}
                        </select>
                    </div>
                    
                    <div class="selection-group">
                        <label>Size: <span style="color: red;">*</span></label>
                        <select id="sampleSizeSelect" required>
                            <option value="">Choose size...</option>
                            ${eligibilityData.sizes.map(s => 
                                `<option value="${s}">${s}</option>`
                            ).join('')}
                        </select>
                    </div>
                    
                    <div class="selection-actions">
                        <button onclick="cancelSampleSelection()" class="btn-cancel">Cancel</button>
                        <button onclick="confirmSampleSelection('${styleNumber}', '${productName.replace(/'/g, "\\'")}', '${imageUrl}', ${price}, '${type}')" class="btn-confirm">
                            Add to Samples
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            setTimeout(() => modal.classList.add('active'), 10);
        }
        
        // Cancel selection
        function cancelSampleSelection() {
            const modal = document.querySelector('.sample-selection-modal');
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => modal.remove(), 300);
            }
        }
        
        // Confirm selection and add to cart
        function confirmSampleSelection(styleNumber, productName, imageUrl, price, type) {
            const colorSelect = document.getElementById('sampleColorSelect');
            const sizeSelect = document.getElementById('sampleSizeSelect');
            
            if (!colorSelect.value || !sizeSelect.value) {
                alert('Please select both color and size');
                return;
            }
            
            const selectedColor = colorSelect.options[colorSelect.selectedIndex].text;
            const selectedSize = sizeSelect.value;
            
            // Add to cart with selections
            window.sampleCart.addSample({
                style: styleNumber,
                name: productName,
                description: productName,
                imageUrl: imageUrl,
                price: price,
                type: type,
                color: selectedColor,
                colorCode: colorSelect.value,
                size: selectedSize
            });
            
            // Close modal
            cancelSampleSelection();
        }
        
        // Open sample modal
        function openSampleModal(samples) {
            const modal = document.getElementById('sampleRequestModal');
            const samplesList = document.getElementById('selectedSamplesList');
            const sampleCount = document.getElementById('sampleCount');
            
            // Update sample count
            sampleCount.textContent = samples.length;
            
            // Clear and populate samples list
            samplesList.innerHTML = '';
            let totalSamplesCost = 0;
            
            samples.forEach(sample => {
                // Add to total if it's a paid sample
                if (sample.price > 0) {
                    totalSamplesCost += sample.price;
                }
                
                const sampleItem = document.createElement('div');
                sampleItem.className = 'sample-item';
                sampleItem.innerHTML = `
                    <div class="sample-item-image">
                        ${sample.imageUrl ? 
                            `<img src="${sample.imageUrl}" alt="${sample.name}">` :
                            `<i class="fas fa-tshirt" style="font-size: 2rem; color: var(--text-secondary);"></i>`
                        }
                    </div>
                    <div class="sample-item-info">
                        <div class="sample-item-name">${sample.name}</div>
                        <div class="sample-item-style">Style #${sample.style}</div>
                        <div class="sample-item-details">
                            ${sample.color ? `Color: ${sample.color}` : '<span style="color: #dc2626;">⚠️ No color selected</span>'} 
                            ${sample.size ? `| Size: ${sample.size}` : '| <span style="color: #dc2626;">⚠️ No size selected</span>'}
                            ${sample.price > 0 ? `| $${sample.price.toFixed(2)}` : '| FREE'}
                        </div>
                    </div>
                    <button class="sample-item-remove" onclick="removeSampleFromModal('${sample.style}')" title="Remove">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                samplesList.appendChild(sampleItem);
            });
            
            // Update order total display
            updateOrderTotal(totalSamplesCost);
            
            // Show modal
            modal.classList.add('active');
        }
        
        // Close sample modal
        function closeSampleModal() {
            document.getElementById('sampleRequestModal').classList.remove('active');
        }
        
        // Toggle shipping fields based on delivery method
        function toggleShippingFields() {
            const deliveryMethod = document.querySelector('input[name="deliveryMethod"]:checked').value;
            const shippingFields = document.getElementById('shippingFields');
            const shippingLine = document.getElementById('shippingLine');
            
            if (deliveryMethod === 'ship') {
                shippingFields.style.display = 'block';
                shippingLine.style.display = 'flex';
                // Make shipping fields required
                document.getElementById('shippingAddress').required = true;
                document.getElementById('shippingCity').required = true;
                document.getElementById('shippingState').required = true;
                document.getElementById('shippingZip').required = true;
            } else {
                shippingFields.style.display = 'none';
                shippingLine.style.display = 'none';
                // Remove required from shipping fields
                document.getElementById('shippingAddress').required = false;
                document.getElementById('shippingCity').required = false;
                document.getElementById('shippingState').required = false;
                document.getElementById('shippingZip').required = false;
            }
            
            // Recalculate total
            const currentSamplesTotal = parseFloat(document.getElementById('samplesSubtotal').textContent.replace('$', '')) || 0;
            updateOrderTotal(currentSamplesTotal);
        }
        
        // Update order total display
        function updateOrderTotal(samplesCost) {
            const orderTotalDisplay = document.getElementById('orderTotalDisplay');
            const samplesSubtotal = document.getElementById('samplesSubtotal');
            const finalTotal = document.getElementById('finalTotal');
            const submitButtonText = document.getElementById('submitButtonText');
            const shippingLine = document.getElementById('shippingLine');
            
            // Get delivery method
            const deliveryMethod = document.querySelector('input[name="deliveryMethod"]:checked').value;
            const shippingCost = deliveryMethod === 'ship' ? 10.00 : 0;
            
            // Calculate tax (10.1% Milton sales tax on taxable items)
            const taxRate = 0.101;
            const taxableAmount = samplesCost + shippingCost;
            const salesTax = taxableAmount > 0 ? taxableAmount * taxRate : 0;
            const total = taxableAmount + salesTax;
            
            // Update display
            samplesSubtotal.textContent = `$${samplesCost.toFixed(2)}`;
            
            // Add or update tax line if needed
            let taxLine = document.getElementById('taxLine');
            if (salesTax > 0) {
                if (!taxLine) {
                    taxLine = document.createElement('div');
                    taxLine.id = 'taxLine';
                    taxLine.className = 'total-line';
                    taxLine.innerHTML = `<span>Tax (10.1%):</span> <span id="taxAmount">$${salesTax.toFixed(2)}</span>`;
                    // Insert before final total
                    const finalTotalLine = document.querySelector('.total-line.total-final');
                    finalTotalLine.parentNode.insertBefore(taxLine, finalTotalLine);
                } else {
                    document.getElementById('taxAmount').textContent = `$${salesTax.toFixed(2)}`;
                }
                taxLine.style.display = 'flex';
            } else if (taxLine) {
                taxLine.style.display = 'none';
            }
            
            finalTotal.textContent = `$${total.toFixed(2)}`;
            
            // Show/hide order total display and update button text
            if (total > 0) {
                orderTotalDisplay.style.display = 'block';
                submitButtonText.textContent = `Submit Sample Order ($${total.toFixed(2)})`;
            } else {
                if (window.sampleCart && window.sampleCart.samples.length > 0) {
                    // Has free samples
                    orderTotalDisplay.style.display = 'none';
                    submitButtonText.textContent = 'Request Free Samples';
                } else {
                    orderTotalDisplay.style.display = 'none';
                    submitButtonText.textContent = 'Request Samples';
                }
            }
        }
        
        // Remove sample from modal
        function removeSampleFromModal(styleNumber) {
            if (window.sampleCart) {
                window.sampleCart.removeSample(styleNumber);
                // Refresh modal
                const cartSummary = window.sampleCart.getCartSummary();
                if (cartSummary.items.length > 0) {
                    openSampleModal(cartSummary.items);
                } else {
                    closeSampleModal();
                }
            }
        }
        
        // Handle sample form submission
        async function handleSampleFormSubmit(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitSampleRequest');
            const originalButtonText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            
            try {
                // Get delivery method
                const deliveryMethod = document.querySelector('input[name="deliveryMethod"]:checked').value;
                
                // Get form data
                const formData = {
                    name: document.getElementById('sampleName').value,
                    email: document.getElementById('sampleEmail').value,
                    phone: document.getElementById('samplePhone').value,
                    company: document.getElementById('sampleCompany').value,
                    projectType: document.getElementById('projectType').value,
                    estimatedQuantity: document.getElementById('estimatedQuantity').value,
                    timeline: document.getElementById('timeline').value,
                    notes: document.getElementById('sampleNotes').value,
                    deliveryMethod: deliveryMethod
                };
                
                // Add shipping address if needed
                if (deliveryMethod === 'ship') {
                    formData.shippingAddress = document.getElementById('shippingAddress').value;
                    formData.shippingCity = document.getElementById('shippingCity').value;
                    formData.shippingState = document.getElementById('shippingState').value;
                    formData.shippingZip = document.getElementById('shippingZip').value;
                    formData.shippingCost = 10.00;
                } else {
                    formData.shippingCost = 0;
                }
                
                // Get samples from cart
                const cartSummary = window.sampleCart.getCartSummary();
                
                // Calculate totals
                let samplesCost = 0;
                cartSummary.items.forEach(item => {
                    if (item.price > 0) {
                        samplesCost += item.price;
                    }
                });
                formData.samplesCost = samplesCost;
                formData.totalAmount = samplesCost + formData.shippingCost;
                
                // Check for duplicate requests
                const isDuplicate = await sampleRequestService.checkDuplicateRequest(formData.email);
                if (isDuplicate) {
                    alert('You have already requested samples within the last 30 days. Please contact us directly if you need additional samples.');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalButtonText;
                    return;
                }
                
                // Calculate tax (10.1% Milton sales tax on taxable items)
                const taxRate = 0.101;
                const taxableAmount = samplesCost + formData.shippingCost;
                const salesTax = taxableAmount > 0 ? taxableAmount * taxRate : 0;
                const finalTotal = taxableAmount + salesTax;
                
                // Update form data with tax
                formData.salesTax = salesTax;
                formData.totalAmount = finalTotal;
                
                // Store original notes - comprehensive notes will be built in saveSampleRequest
                // Don't override formData.notes here
                
                // Store detailed order info for the AE
                formData.orderDetails = {
                    samples: cartSummary.items.map(item => ({
                        style: item.style || '',
                        name: item.name || '',
                        color: item.color || 'TBD',
                        size: item.size || 'TBD',
                        price: item.price || 0
                    })),
                    delivery: deliveryMethod,
                    shipping: deliveryMethod === 'ship' ? {
                        address: formData.shippingAddress || '',
                        city: formData.shippingCity || '',
                        state: formData.shippingState || '',
                        zip: formData.shippingZip || ''
                    } : null,
                    totals: {
                        samples: samplesCost || 0,
                        shipping: formData.shippingCost || 0,
                        tax: salesTax || 0,
                        total: finalTotal || 0
                    }
                };
                
                // Save to database
                const result = await sampleRequestService.saveSampleRequest(formData, cartSummary.items);
                
                if (result.success) {
                    // Show success message
                    let message;
                    if (formData.totalAmount > 0) {
                        let breakdown = `Samples: $${samplesCost.toFixed(2)}`;
                        if (formData.shippingCost > 0) {
                            breakdown += `\nShipping: $${formData.shippingCost.toFixed(2)}`;
                        }
                        if (formData.salesTax > 0) {
                            breakdown += `\nTax (10.1%): $${formData.salesTax.toFixed(2)}`;
                        }
                        breakdown += `\n────────────────`;
                        breakdown += `\nTotal: $${formData.totalAmount.toFixed(2)}`;
                        
                        message = `Success! Your sample request ${result.requestID} has been submitted.\n\n${breakdown}\n\n${deliveryMethod === 'ship' ? 'We\'ll ship your samples within 2 business days.' : 'Your samples will be ready for pickup within 2 business days.'}\n\nAn account executive will contact you to process payment.`;
                    } else {
                        message = `Success! Your free sample request ${result.requestID} has been submitted.\n\n${deliveryMethod === 'ship' ? 'We\'ll ship your samples within 2 business days.' : 'Your samples will be ready for pickup within 2 business days.'}`;
                    }
                    
                    alert(message);
                    
                    // Clear cart
                    window.sampleCart.clearCart();
                    
                    // Close modal
                    closeSampleModal();
                    
                    // Reset form
                    document.getElementById('sampleRequestForm').reset();
                } else {
                    throw new Error(result.error || 'Failed to submit request');
                }
                
            } catch (error) {
                console.error('Sample request error:', error);
                alert('There was an error submitting your request. Please try again or contact us directly.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalButtonText;
            }
        }
        
        // Modal close on outside click
        document.getElementById('sampleRequestModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSampleModal();
            }
        });
    </script>
</body>
</html>