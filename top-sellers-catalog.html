<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Top Sellers 2025 - Northwest Custom Apparel</title>
    <link rel="icon" href="https://cdn.caspio.com/A0E15000/Safety%20Stripes/NWCA%20Favicon%20for%20TEAMNWCA.com.png?ver=1" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --wsu-crimson: #981e32;
            --wsu-grey: #5e6a71;
            --primary-color: #4cb354;
            --primary-dark: #409a47;
            --primary-light: #5bc85f;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.15);
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: var(--wsu-crimson);
            color: white;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .breadcrumb {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .breadcrumb a {
            color: white;
            text-decoration: none;
            opacity: 0.8;
        }

        .breadcrumb a:hover {
            opacity: 1;
        }

        /* Search and Filter Bar */
        .controls-bar {
            background: white;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
            position: sticky;
            top: 80px;
            z-index: 90;
        }

        .controls-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 1.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9375rem;
            transition: all 0.2s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--wsu-crimson);
            box-shadow: 0 0 0 3px rgba(152, 30, 50, 0.1);
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .category-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.625rem 1rem;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .filter-btn:hover {
            border-color: var(--wsu-crimson);
            color: var(--wsu-crimson);
            background: rgba(152, 30, 50, 0.05);
        }

        .filter-btn.active {
            background: var(--wsu-crimson);
            color: white;
            border-color: var(--wsu-crimson);
        }

        /* Embellishment Type Filters */
        .embellishment-filters {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 1rem;
        }

        .embellishment-btn {
            padding: 0.75rem 1.25rem;
            border: 2px solid var(--border-color);
            background: white;
            border-radius: 8px;
            font-size: 0.9375rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .embellishment-btn i {
            font-size: 1.1rem;
        }

        .embellishment-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .embellishment-btn.active {
            color: white;
            border-color: transparent;
        }

        .embellishment-btn[data-type="all"] {
            background: var(--wsu-crimson) !important;
        }

        .embellishment-btn[data-type="all"]:not(.active) {
            background: white !important;
            color: var(--wsu-crimson);
            border-color: var(--wsu-crimson);
        }

        .embellishment-btn[data-type="dtg"].active {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .embellishment-btn[data-type="dtg"]:not(.active):hover {
            border-color: #3b82f6;
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .embellishment-btn[data-type="screenprint"].active {
            background: #22c55e;
            border-color: #22c55e;
        }

        .embellishment-btn[data-type="screenprint"]:not(.active):hover {
            border-color: #22c55e;
            color: #22c55e;
            background: rgba(34, 197, 94, 0.05);
        }

        .embellishment-btn[data-type="embroidery"].active {
            background: #a855f7;
            border-color: #a855f7;
        }

        .embellishment-btn[data-type="embroidery"]:not(.active):hover {
            border-color: #a855f7;
            color: #a855f7;
            background: rgba(168, 85, 247, 0.05);
        }

        .embellishment-btn[data-type="caps"].active {
            background: #f97316;
            border-color: #f97316;
        }

        .embellishment-btn[data-type="caps"]:not(.active):hover {
            border-color: #f97316;
            color: #f97316;
            background: rgba(249, 115, 22, 0.05);
        }

        /* Embellishment Badge - Repositioned below image */
        .embellishment-badge {
            position: relative;
            padding: 0.5rem 0.75rem;
            margin: -0.5rem -1.25rem 0.75rem -1.25rem;
            border-radius: 0;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.375rem;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 1;
        }

        .embellishment-badge.dtg {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .embellishment-badge.screenprint {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .embellishment-badge.embroidery {
            background: linear-gradient(135deg, #a855f7, #9333ea);
        }

        .embellishment-badge.caps {
            background: linear-gradient(135deg, #f97316, #ea580c);
        }

        /* Brand Placeholder Styles */
        .product-image-placeholder.brand-placeholder {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            position: relative;
        }

        .product-image-placeholder .brand-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-primary);
            margin: 0.25rem 0;
        }

        .product-image-placeholder .coming-soon {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .product-image-placeholder[data-brand="Nike"] {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .product-image-placeholder[data-brand="Carhartt"] {
            background: linear-gradient(135deg, #8b7355, #6d5a45);
            color: white;
        }

        .product-image-placeholder[data-brand="Carhartt"] .brand-name,
        .product-image-placeholder[data-brand="Carhartt"] .coming-soon {
            color: white;
        }

        .product-image-placeholder[data-brand="Eddie Bauer"] {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            color: white;
        }

        .product-image-placeholder[data-brand="Eddie Bauer"] .brand-name,
        .product-image-placeholder[data-brand="Eddie Bauer"] .coming-soon {
            color: white;
        }

        /* Embellishment Stats Cards */
        .embellishment-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .embellishment-stat-card {
            text-align: center;
            padding: 1rem;
            border-radius: 8px;
            background: var(--bg-color);
        }

        .embellishment-stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .embellishment-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .embellishment-stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Stats Summary */
        .stats-bar {
            background: linear-gradient(135deg, var(--wsu-crimson), var(--wsu-grey));
            color: white !important;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .stats-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
        }

        .stat-card {
            text-align: center;
            color: white !important;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: white !important;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
            color: rgba(255, 255, 255, 0.95) !important;
        }

        /* Product Grid */
        .content-area {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .category-section {
            margin-bottom: 3rem;
        }

        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 3px solid var(--wsu-crimson);
        }

        .category-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .category-revenue {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        /* Product Card */
        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .product-badge {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .badge {
            padding: 0.25rem 0.625rem;
            border-radius: 20px;
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-bestseller {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            color: white;
        }

        .badge-top-revenue {
            background: linear-gradient(135deg, #22c55e, #10b981);
            color: white;
        }

        .product-image {
            position: relative;
            height: 200px;
            background: #f9fafb;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .product-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-image-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            text-align: center;
            padding: 1rem;
        }

        .product-image-placeholder i {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            opacity: 0.3;
        }

        .product-content {
            padding: 1.25rem;
        }

        .product-header {
            margin-bottom: 0.75rem;
        }

        .product-style {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0.25rem 0;
            line-height: 1.4;
            min-height: 2.8em;
        }

        .product-description {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.5;
            min-height: 2.5em;
        }

        .product-colors {
            display: flex;
            gap: 0.25rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .color-swatch {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .color-swatch:hover {
            transform: scale(1.2);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .color-swatch img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .color-count {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
        }

        .product-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 0.6875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Loading State */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top-color: var(--wsu-crimson);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            color: var(--text-secondary);
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .no-results i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .controls-container {
                flex-direction: column;
            }

            .search-box {
                width: 100%;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1rem;
            }

            .product-image {
                height: 150px;
            }

            .product-content {
                padding: 0.875rem;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .modal-body {
            padding: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <h1>🔥 Top Sellers 2025</h1>
                <nav class="breadcrumb">
                    <a href="/staff-dashboard.html">Dashboard</a> / <span>Top Sellers Catalog</span>
                </nav>
            </div>
            <div class="header-right">
                <span style="font-size: 0.875rem; opacity: 0.9;">Quick Reference for Sales Staff</span>
            </div>
        </div>
    </header>

    <!-- Search and Filter Controls -->
    <div class="controls-bar">
        <div class="controls-container">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search by product name or style number...">
            </div>
            
            <!-- Embellishment Type Filters -->
            <div class="embellishment-filters">
                <button class="embellishment-btn active" data-type="all">
                    <i class="fas fa-globe"></i>
                    <span>All Types</span>
                </button>
                <button class="embellishment-btn" data-type="dtg">
                    <i class="fas fa-print"></i>
                    <span>DTG</span>
                </button>
                <button class="embellishment-btn" data-type="screenprint">
                    <i class="fas fa-palette"></i>
                    <span>Screen Print</span>
                </button>
                <button class="embellishment-btn" data-type="embroidery">
                    <i class="fas fa-sewing-needle"></i>
                    <span>Embroidery</span>
                </button>
                <button class="embellishment-btn" data-type="caps">
                    <i class="fas fa-hat-cowboy"></i>
                    <span>Caps</span>
                </button>
            </div>
            
            <!-- Product Category Filters -->
            <div class="category-filters">
                <button class="filter-btn active" data-category="all">All Products</button>
                <button class="filter-btn" data-category="polos">Polos/Knits</button>
                <button class="filter-btn" data-category="sweatshirts">Sweatshirts</button>
                <button class="filter-btn" data-category="caps">Caps</button>
                <button class="filter-btn" data-category="outerwear">Outerwear</button>
                <button class="filter-btn" data-category="tshirts">T-Shirts</button>
                <button class="filter-btn" data-category="ladies">Ladies</button>
                <button class="filter-btn" data-category="accessories">Accessories</button>
            </div>
        </div>
    </div>

    <!-- Statistics Bar -->
    <div class="stats-bar" id="mainStats">
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value" id="totalRevenue">$0</div>
                <div class="stat-label">Total Revenue</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalUnits">0</div>
                <div class="stat-label">Total Units Sold</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="uniqueProducts">0</div>
                <div class="stat-label">Unique Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgPrice">$0</div>
                <div class="stat-label">Average Price</div>
            </div>
        </div>
    </div>
    
    <!-- Embellishment Type Statistics -->
    <div class="embellishment-stats" id="embellishmentStats" style="display: none;">
        <!-- Stats will be populated dynamically -->
    </div>

    <!-- Main Content Area -->
    <div class="content-area" id="contentArea">
        <!-- Products will be loaded here dynamically -->
    </div>

    <!-- Product Detail Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalProductTitle">Product Details</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Product details will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Comprehensive top sellers data by embellishment type
        const topSellersByEmbellishment = {
            dtg: [
                { rank: 1, style: 'PC54', description: 'Port & Company - Core Cotton Tee', totalUnits: 6141, totalRevenue: 75238.12, orderCount: 81, avgRevenue: 928.87 },
                { rank: 2, style: 'PC450', description: 'Port & Company Fan Favorite Tee', totalUnits: 2140, totalRevenue: 31176.44, orderCount: 54, avgRevenue: 577.34 },
                { rank: 3, style: 'PC61', description: 'Port & Company - Essential Tee', totalUnits: 903, totalRevenue: 15615.57, orderCount: 43, avgRevenue: 363.15 },
                { rank: 4, style: 'PC54', description: 'Port & Company - Core Cotton Tee', totalUnits: 808, totalRevenue: 12649.20, orderCount: 12, avgRevenue: 1054.10 },
                { rank: 5, style: 'PC78H', description: 'Port & Company - Core Fleece Pullover Hooded Sweatshirt', totalUnits: 470, totalRevenue: 10781.80, orderCount: 28, avgRevenue: 385.06 },
                { rank: 6, style: 'PC55', description: 'Port & Company - Core Blend Tee', totalUnits: 821, totalRevenue: 10081.50, orderCount: 22, avgRevenue: 458.25 },
                { rank: 7, style: 'PC61LS', description: 'Port & Company - Long Sleeve Essential Tee', totalUnits: 559, totalRevenue: 8901.80, orderCount: 8, avgRevenue: 1112.73 },
                { rank: 8, style: 'PC600', description: 'Port & Company Bouncer Tee', totalUnits: 679, totalRevenue: 8560.75, orderCount: 15, avgRevenue: 570.72 },
                { rank: 9, style: 'PC90H', description: 'Port & Company - Essential Fleece Pullover Hooded Sweatshirt', totalUnits: 215, totalRevenue: 7872.15, orderCount: 15, avgRevenue: 524.81 },
                { rank: 10, style: 'PC90H', description: 'Port & Company - Essential Fleece Pullover Hooded Sweatshirt', totalUnits: 221, totalRevenue: 7629.00, orderCount: 13, avgRevenue: 586.85 },
                { rank: 11, style: 'PC450', description: 'Port & Company Fan Favorite Tee', totalUnits: 483, totalRevenue: 7545.85, orderCount: 9, avgRevenue: 838.43 },
                { rank: 12, style: 'BC3001', description: 'BellaCanvas Unisex Jersey Short Sleeve Tee', totalUnits: 379, totalRevenue: 7213.90, orderCount: 7, avgRevenue: 1030.56 },
                { rank: 13, style: 'GRT-50', description: 'Logo Mockup & Print Review Service', totalUnits: 137.5, totalRevenue: 6875.00, orderCount: 143, avgRevenue: 48.08 },
                { rank: 14, style: 'PC54LS', description: 'Port & Company - Long Sleeve Core Cotton Tee', totalUnits: 391, totalRevenue: 6870.50, orderCount: 11, avgRevenue: 624.59 },
                { rank: 15, style: 'CTK87', description: 'Carhartt Workwear Pocket Short Sleeve T-Shirt', totalUnits: 249, totalRevenue: 6790.70, orderCount: 2, avgRevenue: 3395.35 }
            ],
            caps: [
                { rank: 1, style: 'C112', description: 'Port Authority Snapback Trucker Cap', totalUnits: 4008, totalRevenue: 48539.90, orderCount: 49, avgRevenue: 990.61 },
                { rank: 2, style: '112', description: 'Richardson Trucker Cap with Mesh Snap Back', totalUnits: 2304, totalRevenue: 35993.39, orderCount: 42, avgRevenue: 856.99 },
                { rank: 3, style: 'NE1000', description: 'New Era - Structured Stretch Cotton Cap', totalUnits: 705, totalRevenue: 14885.20, orderCount: 11, avgRevenue: 1353.20, brand: 'New Era' },
                { rank: 4, style: 'C110', description: 'Port Authority Flexfit 110 Mesh Cap', totalUnits: 628, totalRevenue: 12720.00, orderCount: 14, avgRevenue: 908.57 },
                { rank: 5, style: 'C112', description: 'Port Authority Snapback Trucker Cap', totalUnits: 747, totalRevenue: 11145.80, orderCount: 12, avgRevenue: 928.82 },
                { rank: 6, style: 'CP90', description: 'Port & Company Knit Cap', totalUnits: 1118, totalRevenue: 10857.54, orderCount: 12, avgRevenue: 904.80 },
                { rank: 7, style: 'C826', description: 'Port Authority Pique Mesh Cap L/XL', totalUnits: 444, totalRevenue: 7260.00, orderCount: 2, avgRevenue: 3630.00 },
                { rank: 8, style: 'C114', description: 'Port Authority Digi Camo Snapback Trucker Cap', totalUnits: 550, totalRevenue: 4991.00, orderCount: 4, avgRevenue: 1247.75 },
                { rank: 9, style: 'C912', description: 'Port Authority Camouflage Cap With Air Mesh Back', totalUnits: 282, totalRevenue: 4773.00, orderCount: 3, avgRevenue: 1591.00 },
                { rank: 10, style: 'TM1MU423', description: 'Travismathew Cruz Trucker Cap', totalUnits: 119, totalRevenue: 4171.00, orderCount: 4, avgRevenue: 1042.75, brand: 'TravisMathew' },
                { rank: 11, style: 'CP85', description: 'Port & Company Sandwich Bill Cap', totalUnits: 336, totalRevenue: 4032.00, orderCount: 2, avgRevenue: 2016.00 },
                { rank: 12, style: 'C865', description: 'Port Authority Flexfit Cap', totalUnits: 163, totalRevenue: 3982.00, orderCount: 8, avgRevenue: 497.75 },
                { rank: 13, style: 'CP82', description: 'Port & Company Brushed Twill Cap', totalUnits: 330, totalRevenue: 3810.00, orderCount: 2, avgRevenue: 1905.00 },
                { rank: 14, style: 'OC771', description: 'Trucker Cap', totalUnits: 224, totalRevenue: 3456.00, orderCount: 2, avgRevenue: 1728.00 },
                { rank: 15, style: 'HDP-605', description: 'Weathered Cotton Twill', totalUnits: 200, totalRevenue: 3335.00, orderCount: 2, avgRevenue: 1667.50 }
            ],
            embroidery: [
                { rank: 1, style: 'NKDC1963', description: 'Nike Dri-Fit Micro Pique 2.0 Polo', totalUnits: 728, totalRevenue: 29528.90, orderCount: 39, avgRevenue: 757.15, brand: 'Nike' },
                { rank: 2, style: 'CT104670', description: 'Carhartt Storm Defender Shoreline Jacket', totalUnits: 168, totalRevenue: 26167.50, orderCount: 28, avgRevenue: 934.55, brand: 'Carhartt' },
                { rank: 3, style: 'EB532', description: 'Eddie Bauer Shaded Crosshatch Soft Shell Jacket', totalUnits: 268, totalRevenue: 20919.00, orderCount: 7, avgRevenue: 2988.43, brand: 'Eddie Bauer' },
                { rank: 4, style: '267020', description: 'Nike Dri-Fit Classic Polo', totalUnits: 286, totalRevenue: 15156.80, orderCount: 6, avgRevenue: 2526.13, brand: 'Nike' },
                { rank: 5, style: 'CT100617', description: 'Carhartt Rain Defender Paxton Heavyweight Hooded Zip Mock Sweatshirt', totalUnits: 268, totalRevenue: 14510.00, orderCount: 14, avgRevenue: 1036.43, brand: 'Carhartt' },
                { rank: 6, style: 'ST253', description: 'Sport-Tek 1/4-Zip Sweatshirt', totalUnits: 364, totalRevenue: 14242.40, orderCount: 11, avgRevenue: 1294.76 },
                { rank: 7, style: 'C112', description: 'Port Authority Snapback Trucker Cap', totalUnits: 914, totalRevenue: 13252.44, orderCount: 30, avgRevenue: 441.75 },
                { rank: 8, style: 'CTK121', description: 'Carhartt Midweight Hooded Sweatshirt', totalUnits: 167, totalRevenue: 10894.00, orderCount: 15, avgRevenue: 726.27, brand: 'Carhartt' },
                { rank: 9, style: 'CT103828', description: 'Carhartt Duck Detroit Jacket', totalUnits: 70, totalRevenue: 8932.00, orderCount: 10, avgRevenue: 893.20, brand: 'Carhartt' },
                { rank: 10, style: 'CT89176508', description: 'Carhartt Foundry Series Pro Backpack', totalUnits: 71, totalRevenue: 8710.00, orderCount: 2, avgRevenue: 4355.00, brand: 'Carhartt' },
                { rank: 11, style: 'ST650', description: 'Sport-Tek Micropique Sport-Wick Polo', totalUnits: 284, totalRevenue: 8710.00, orderCount: 25, avgRevenue: 348.40 },
                { rank: 12, style: 'CT104597', description: 'Carhartt Watch Cap 2.0', totalUnits: 251, totalRevenue: 8048.00, orderCount: 6, avgRevenue: 1341.33, brand: 'Carhartt' },
                { rank: 13, style: 'EB550', description: 'Eddie Bauer - Rain Jacket', totalUnits: 49, totalRevenue: 7840.00, orderCount: 6, avgRevenue: 1306.67, brand: 'Eddie Bauer' },
                { rank: 14, style: 'CT102286', description: 'Carhartt Gilliam Vest', totalUnits: 149, totalRevenue: 7732.00, orderCount: 20, avgRevenue: 386.60, brand: 'Carhartt' },
                { rank: 15, style: 'ST850', description: 'Sport-Tek Sport-Wick Stretch 1/4-Zip Pullover', totalUnits: 192, totalRevenue: 7719.87, orderCount: 12, avgRevenue: 643.32 }
            ],
            screenprint: [
                { rank: 1, style: 'PC90H', description: 'Port & Company - Essential Fleece Pullover Hooded Sweatshirt', totalUnits: 312, totalRevenue: 11924.75, orderCount: 8, avgRevenue: 1490.59 },
                { rank: 2, style: 'PC55', description: 'Port & Company - Core Blend Tee', totalUnits: 495, totalRevenue: 8821.25, orderCount: 2, avgRevenue: 4410.63 },
                { rank: 3, style: '18500', description: 'Gildan - Heavy Blend Hooded Sweatshirt', totalUnits: 259, totalRevenue: 8112.00, orderCount: 4, avgRevenue: 2028.00, brand: 'Gildan' },
                { rank: 4, style: 'PC78H', description: 'Port & Company - Core Fleece Pullover Hooded Sweatshirt', totalUnits: 244, totalRevenue: 7417.40, orderCount: 3, avgRevenue: 2472.47 },
                { rank: 5, style: 'PC600', description: 'Port & Company Bouncer Tee', totalUnits: 440, totalRevenue: 6385.00, orderCount: 4, avgRevenue: 1596.25 },
                { rank: 6, style: '996M', description: 'Jerzees - Nublend Pullover Hooded Sweatshirt', totalUnits: 259, totalRevenue: 5402.00, orderCount: 3, avgRevenue: 1800.67, brand: 'Jerzees' },
                { rank: 7, style: 'BC3001', description: 'BellaCanvas Unisex Jersey Short Sleeve Tee', totalUnits: 252, totalRevenue: 4611.60, orderCount: 10, avgRevenue: 461.16, brand: 'BellaCanvas' },
                { rank: 8, style: '5186', description: 'Hanes Adult Long-Sleeve Beefy-T', totalUnits: 172, totalRevenue: 2994.00, orderCount: 2, avgRevenue: 1497.00, brand: 'Hanes' },
                { rank: 9, style: 'PC55P', description: 'Port & Company - Core Blend Pocket Tee', totalUnits: 144, totalRevenue: 2911.25, orderCount: 2, avgRevenue: 1455.63 },
                { rank: 10, style: 'PC54', description: 'Port & Company - Core Cotton Tee', totalUnits: 217, totalRevenue: 2727.00, orderCount: 2, avgRevenue: 1363.50 },
                { rank: 11, style: 'CS204', description: 'CornerStone ANSI 107 Class 2 Segmented Tape Tee', totalUnits: 70, totalRevenue: 2170.00, orderCount: 2, avgRevenue: 1085.00, brand: 'CornerStone' },
                { rank: 12, style: '5180', description: 'Hanes Beefy-T - 100 Cotton T-Shirt', totalUnits: 173, totalRevenue: 2145.50, orderCount: 2, avgRevenue: 1072.75, brand: 'Hanes' },
                { rank: 13, style: 'DT6100', description: 'District V.I.T. Fleece Hoodie', totalUnits: 68, totalRevenue: 1971.50, orderCount: 2, avgRevenue: 985.75, brand: 'District' },
                { rank: 14, style: 'PC600', description: 'Port & Company Bouncer Tee (2X)', totalUnits: 120, totalRevenue: 1920.00, orderCount: 2, avgRevenue: 960.00 },
                { rank: 15, style: 'SPRESET', description: 'Screen Reset Charge', totalUnits: 71, totalRevenue: 1787.50, orderCount: 14, avgRevenue: 127.68 }
            ]
        };

        // Custom product images database (for future use)
        const customProductImages = {};

        // Brand detection patterns
        const brandPatterns = {
            'Nike': ['NK', '267020', 'NIKE'],
            'Carhartt': ['CT', 'CTK'],
            'Eddie Bauer': ['EB'],
            'Richardson': ['112', '115'],
            'New Era': ['NE'],
            'Under Armour': ['137', 'UA'],
            'Gildan': ['18', 'G'],
            'BellaCanvas': ['BC', 'BELLA'],
            'Jerzees': ['996', 'JZ'],
            'Hanes': ['518', '5180', '5186'],
            'District': ['DT'],
            'CornerStone': ['CS'],
            'TravisMathew': ['TM'],
            'Sport-Tek': ['ST', 'TST']
        };

        // Product data from the PDF analysis (keeping for backward compatibility)
        const topSellingProducts = {
            'polos': [
                {
                    style: 'ST650',
                    name: 'Sport-Tek Micropique Sport-Wick Polo',
                    quantity: 333,
                    revenue: 9514.00,
                    avgPrice: 28.57,
                    rank: 4,
                    isBestseller: true,
                    isTopRevenue: true
                },
                {
                    style: 'K524',
                    name: 'Port Authority Dry Zone Colorblock Ottoman Polo',
                    quantity: 197,
                    revenue: 6305.33,
                    avgPrice: 32.01
                },
                {
                    style: 'K682',
                    name: 'Port Authority City Stretch Polo',
                    quantity: 145,
                    revenue: 4250.00,
                    avgPrice: 29.31
                },
                {
                    style: '267020',
                    name: 'Nike Dri-Fit Classic Polo',
                    quantity: 132,
                    revenue: 7011.00,
                    avgPrice: 53.11,
                    isTopRevenue: true
                }
            ],
            'sweatshirts': [
                {
                    style: 'ST850',
                    name: 'Sport-Tek Sport-Wick Stretch 1/4-Zip Pullover',
                    quantity: 180,
                    revenue: 5200.00,
                    avgPrice: 28.89
                },
                {
                    style: '1379757',
                    name: 'Under Armour Men\'s Rival Fleece',
                    quantity: 110,
                    revenue: 7535.00,
                    avgPrice: 68.50,
                    isTopRevenue: true
                },
                {
                    style: 'NF0A7V63',
                    name: 'The North Face Skyline 1/2-Zip Fleece',
                    quantity: 95,
                    revenue: 6800.00,
                    avgPrice: 71.58
                }
            ],
            'caps': [
                {
                    style: 'CP90',
                    name: 'Port Company Knit Cap',
                    quantity: 561,
                    revenue: 7165.00,
                    avgPrice: 12.77,
                    rank: 2,
                    isBestseller: true,
                    isTopRevenue: true
                },
                {
                    style: 'C112',
                    name: 'Port Authority Snapback Trucker Cap',
                    quantity: 392,
                    revenue: 5973.29,
                    avgPrice: 15.24,
                    rank: 3,
                    isBestseller: true
                },
                {
                    style: 'STC43',
                    name: 'Sport-Tek YP Classics Curve Bill Snapback Cap',
                    quantity: 201,
                    revenue: 3400.00,
                    avgPrice: 16.92,
                    rank: 6
                },
                {
                    style: '112',
                    name: 'Richardson Trucker Cap with Mesh Snap Back',
                    quantity: 670,
                    revenue: 12705.55,
                    avgPrice: 18.97,
                    isTopRevenue: true
                }
            ],
            'outerwear': [
                {
                    style: 'NKFQ4761',
                    name: 'Nike Pro Hooded Jacket',
                    quantity: 103,
                    revenue: 10608.00,
                    avgPrice: 103.00,
                    isTopRevenue: true
                },
                {
                    style: 'EB550',
                    name: 'Eddie Bauer Rain Jacket',
                    quantity: 62,
                    revenue: 9718.00,
                    avgPrice: 156.77,
                    isTopRevenue: true
                },
                {
                    style: 'EB532',
                    name: 'Eddie Bauer Soft Shell Jacket',
                    quantity: 91,
                    revenue: 7105.00,
                    avgPrice: 78.08,
                    isTopRevenue: true
                }
            ],
            'tshirts': [
                {
                    style: 'PC55',
                    name: 'Port & Company Core Cotton Tee',
                    quantity: 420,
                    revenue: 3150.00,
                    avgPrice: 7.50
                },
                {
                    style: 'PC54',
                    name: 'Port & Company Core Cotton Tee',
                    quantity: 380,
                    revenue: 2850.00,
                    avgPrice: 7.50
                },
                {
                    style: 'K468',
                    name: 'Port Authority Dry Zone Short Sleeve Raglan Sport Shirt',
                    quantity: 120,
                    revenue: 3600.00,
                    avgPrice: 30.00
                },
                {
                    style: 'PC450',
                    name: 'Port & Company Fan Favorite Tee',
                    quantity: 280,
                    revenue: 2520.00,
                    avgPrice: 9.00
                }
            ],
            'ladies': [
                {
                    style: 'L608',
                    name: 'Port Authority Ladies Long Sleeve Easy Care Shirt',
                    quantity: 145,
                    revenue: 5800.00,
                    avgPrice: 40.00
                },
                {
                    style: 'L500',
                    name: 'Port Authority Women\'s Silk Touch Polo',
                    quantity: 120,
                    revenue: 3600.00,
                    avgPrice: 30.00
                },
                {
                    style: 'BB18203',
                    name: 'Brooks Brothers Women\'s Mid-Layer Stretch',
                    quantity: 45,
                    revenue: 3150.00,
                    avgPrice: 70.00
                }
            ],
            'accessories': [
                {
                    style: 'PT400',
                    name: 'Port Authority Grommeted Hemmed Towel',
                    quantity: 650,
                    revenue: 6650.00,
                    avgPrice: 10.23,
                    rank: 1,
                    isBestseller: true
                },
                {
                    style: 'BP60',
                    name: 'Port Authority Value Fleece Blanket',
                    quantity: 45,
                    revenue: 450.00,
                    avgPrice: 10.00
                },
                {
                    style: 'TB850',
                    name: 'Port Authority Fleece & Polyester Travel Blanket',
                    quantity: 44,
                    revenue: 108.00,
                    avgPrice: 2.45
                },
                {
                    style: 'BG265',
                    name: 'Port Authority Backpack',
                    quantity: 85,
                    revenue: 5525.00,
                    avgPrice: 65.00
                },
                {
                    style: 'BG300',
                    name: 'Port Authority Cotton Canvas Tote',
                    quantity: 60,
                    revenue: 3600.00,
                    avgPrice: 60.00
                },
                {
                    style: 'BG505',
                    name: 'Port Authority Small Duffel',
                    quantity: 29,
                    revenue: 1752.84,
                    avgPrice: 60.44
                }
            ]
        };

        // Cache for API responses
        const productCache = {};
        
        // Current filters
        let currentEmbellishmentFilter = 'all';
        let currentCategoryFilter = 'all';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadProductsByEmbellishment('all');
            setupEventListeners();
            updateMainStatistics();
        });

        function setupEventListeners() {
            // Search functionality
            document.getElementById('searchInput').addEventListener('input', function(e) {
                filterProducts(e.target.value);
            });

            // Embellishment type filter buttons
            document.querySelectorAll('.embellishment-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.embellishment-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentEmbellishmentFilter = this.dataset.type;
                    loadProductsByEmbellishment(currentEmbellishmentFilter);
                });
            });

            // Category filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentCategoryFilter = this.dataset.category;
                    applyFilters();
                });
            });
        }

        // Detect brand from style number
        function detectBrand(style, description) {
            // Check if brand is in description first
            const descUpper = (description || '').toUpperCase();
            for (const [brand, patterns] of Object.entries(brandPatterns)) {
                if (descUpper.includes(brand.toUpperCase())) {
                    return brand;
                }
            }
            
            // Then check style patterns
            const styleUpper = (style || '').toUpperCase();
            for (const [brand, patterns] of Object.entries(brandPatterns)) {
                if (patterns.some(pattern => styleUpper.includes(pattern))) {
                    return brand;
                }
            }
            
            return 'Generic';
        }

        // Clean style number for API calls
        function cleanStyleNumber(style) {
            // Remove size suffixes and special characters
            return style.replace(/_.*$/, '').replace(/\s.*$/, '').trim();
        }

        // Get product image with fallback handling
        async function getProductImage(product) {
            const cleanedStyle = cleanStyleNumber(product.style);
            
            // Check custom images first (future enhancement)
            if (customProductImages[product.style]) {
                return {
                    type: 'custom',
                    url: customProductImages[product.style]
                };
            }
            
            // Check cache
            if (productCache[cleanedStyle]) {
                const cached = productCache[cleanedStyle];
                if (cached.imageUrl) {
                    return {
                        type: 'sanmar',
                        url: cached.imageUrl,
                        colors: cached.colors
                    };
                }
            }
            
            // Try Sanmar API
            try {
                const response = await fetch(
                    `https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/product-colors?styleNumber=${cleanedStyle}`
                );
                
                if (response.ok) {
                    const data = await response.json();
                    productCache[cleanedStyle] = {
                        imageUrl: data.colors?.[0]?.MAIN_IMAGE_URL || null,
                        colors: data.colors || [],
                        description: data.PRODUCT_DESCRIPTION
                    };
                    
                    if (data.colors?.[0]?.MAIN_IMAGE_URL) {
                        return {
                            type: 'sanmar',
                            url: data.colors[0].MAIN_IMAGE_URL,
                            colors: data.colors
                        };
                    }
                }
            } catch (error) {
                console.log(`Product ${cleanedStyle} not in Sanmar API`);
            }
            
            // Return placeholder
            const brand = product.brand || detectBrand(product.style, product.description);
            return {
                type: 'placeholder',
                brand: brand
            };
        }

        // Update main statistics
        function updateMainStatistics(embellishmentType = 'all') {
            let totalRevenue = 0;
            let totalUnits = 0;
            let uniqueProducts = 0;
            
            if (embellishmentType === 'all') {
                // Calculate across all embellishment types
                Object.values(topSellersByEmbellishment).forEach(products => {
                    products.forEach(product => {
                        totalRevenue += product.totalRevenue;
                        totalUnits += product.totalUnits;
                    });
                    uniqueProducts += products.length;
                });
            } else if (topSellersByEmbellishment[embellishmentType]) {
                // Calculate for specific embellishment type
                const products = topSellersByEmbellishment[embellishmentType];
                products.forEach(product => {
                    totalRevenue += product.totalRevenue;
                    totalUnits += product.totalUnits;
                });
                uniqueProducts = products.length;
            }
            
            const avgPrice = totalUnits > 0 ? totalRevenue / totalUnits : 0;
            
            // Update display
            document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
            document.getElementById('totalUnits').textContent = totalUnits.toLocaleString();
            document.getElementById('uniqueProducts').textContent = uniqueProducts;
            document.getElementById('avgPrice').textContent = `$${avgPrice.toFixed(2)}`;
            
            // Show/hide embellishment-specific stats
            const embStats = document.getElementById('embellishmentStats');
            if (embellishmentType !== 'all') {
                showEmbellishmentStats(embellishmentType);
                embStats.style.display = 'grid';
            } else {
                embStats.style.display = 'none';
            }
        }

        // Show embellishment-specific statistics
        function showEmbellishmentStats(embellishmentType) {
            const products = topSellersByEmbellishment[embellishmentType];
            if (!products) return;
            
            const topSeller = products[0];
            const totalOrders = products.reduce((sum, p) => sum + p.orderCount, 0);
            const avgOrderValue = products.reduce((sum, p) => sum + p.totalRevenue, 0) / totalOrders;
            
            const statsHTML = `
                <div class="embellishment-stat-card">
                    <div class="embellishment-stat-icon">${getEmbellishmentIcon(embellishmentType)}</div>
                    <div class="embellishment-stat-value">#1</div>
                    <div class="embellishment-stat-label">Top Seller</div>
                    <div style="font-size: 0.875rem; margin-top: 0.5rem;">${topSeller.description}</div>
                </div>
                <div class="embellishment-stat-card">
                    <div class="embellishment-stat-icon">📦</div>
                    <div class="embellishment-stat-value">${totalOrders}</div>
                    <div class="embellishment-stat-label">Total Orders</div>
                </div>
                <div class="embellishment-stat-card">
                    <div class="embellishment-stat-icon">💰</div>
                    <div class="embellishment-stat-value">$${avgOrderValue.toFixed(0)}</div>
                    <div class="embellishment-stat-label">Avg Order Value</div>
                </div>
                <div class="embellishment-stat-card">
                    <div class="embellishment-stat-icon">📈</div>
                    <div class="embellishment-stat-value">$${topSeller.totalRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</div>
                    <div class="embellishment-stat-label">Top Product Revenue</div>
                </div>
            `;
            
            document.getElementById('embellishmentStats').innerHTML = statsHTML;
        }

        // Get embellishment icon
        function getEmbellishmentIcon(type) {
            const icons = {
                dtg: '🖨️',
                screenprint: '🎨',
                embroidery: '🪡',
                caps: '🧢'
            };
            return icons[type] || '📦';
        }

        // Get embellishment display name
        function getEmbellishmentName(type) {
            const names = {
                dtg: 'DTG',
                screenprint: 'Screen Print',
                embroidery: 'Embroidery',
                caps: 'Caps'
            };
            return names[type] || type;
        }

        async function loadProductsByEmbellishment(embellishmentType = 'all') {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = '<div class="loading-card"><div class="loading-spinner"></div><p>Loading top sellers...</p></div>';
            
            let allProductsHTML = '';
            
            if (embellishmentType === 'all') {
                // Show all embellishment types
                for (const [type, products] of Object.entries(topSellersByEmbellishment)) {
                    const typeTitle = getEmbellishmentName(type);
                    const typeRevenue = products.reduce((sum, p) => sum + p.totalRevenue, 0);
                    
                    let sectionHTML = `
                        <div class="category-section" data-embellishment="${type}">
                            <div class="category-header">
                                <h2 class="category-title">
                                    ${getEmbellishmentIcon(type)} ${typeTitle} Top Sellers
                                </h2>
                                <span class="category-revenue">Total Revenue: $${typeRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</span>
                            </div>
                            <div class="products-grid">
                    `;
                    
                    // Show top 5 from each category when showing all
                    const topProducts = products.slice(0, 5);
                    for (const product of topProducts) {
                        sectionHTML += await createEmbellishmentProductCard(product, type);
                    }
                    
                    sectionHTML += `
                            </div>
                        </div>
                    `;
                    
                    allProductsHTML += sectionHTML;
                }
            } else {
                // Show specific embellishment type
                const products = topSellersByEmbellishment[embellishmentType];
                if (products) {
                    const typeTitle = getEmbellishmentName(embellishmentType);
                    const typeRevenue = products.reduce((sum, p) => sum + p.totalRevenue, 0);
                    
                    let sectionHTML = `
                        <div class="category-section" data-embellishment="${embellishmentType}">
                            <div class="category-header">
                                <h2 class="category-title">
                                    ${getEmbellishmentIcon(embellishmentType)} ${typeTitle} Top Sellers
                                </h2>
                                <span class="category-revenue">Total Revenue: $${typeRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</span>
                            </div>
                            <div class="products-grid">
                    `;
                    
                    for (const product of products) {
                        sectionHTML += await createEmbellishmentProductCard(product, embellishmentType);
                    }
                    
                    sectionHTML += `
                            </div>
                        </div>
                    `;
                    
                    allProductsHTML = sectionHTML;
                }
            }
            
            contentArea.innerHTML = allProductsHTML;
            updateMainStatistics(embellishmentType);
            currentCategoryFilter = 'all';
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.filter-btn[data-category="all"]').classList.add('active');
        }

        async function createEmbellishmentProductCard(product, embellishmentType) {
            const imageData = await getProductImage(product);
            
            // Create image HTML based on type
            let imageHTML = '';
            if (imageData.type === 'sanmar' || imageData.type === 'custom') {
                imageHTML = `<img src="${imageData.url}" alt="${product.description}" onerror="this.parentElement.innerHTML='<div class=\\'product-image-placeholder brand-placeholder\\' data-brand=\\'${product.brand || 'Generic'}\\'><i class=\\'fas fa-tshirt\\'></i><span class=\\'brand-name\\'>${product.brand || 'Product'}</span><span class=\\'coming-soon\\'>Image Coming Soon</span></div>'">`;
            } else {
                imageHTML = `
                    <div class="product-image-placeholder brand-placeholder" data-brand="${imageData.brand}">
                        <i class="fas fa-tshirt"></i>
                        <span class="brand-name">${imageData.brand}</span>
                        <span class="coming-soon">Image Coming Soon</span>
                    </div>
                `;
            }
            
            // Create color swatches if available
            let colorSwatches = '';
            if (imageData.colors && imageData.colors.length > 0) {
                const displayColors = imageData.colors.slice(0, 5);
                displayColors.forEach(color => {
                    if (color.COLOR_SQUARE_IMAGE) {
                        colorSwatches += `<div class="color-swatch" title="${color.COLOR_NAME}">
                            <img src="${color.COLOR_SQUARE_IMAGE}" alt="${color.COLOR_NAME}">
                        </div>`;
                    }
                });
                if (imageData.colors.length > 5) {
                    colorSwatches += `<div class="color-count">+${imageData.colors.length - 5} more</div>`;
                }
            }
            
            // Embellishment badge
            const embellishmentBadge = `
                <div class="embellishment-badge ${embellishmentType}">
                    <span>${getEmbellishmentName(embellishmentType)} #${product.rank}</span>
                </div>
            `;
            
            // Create product card
            return `
                <div class="product-card" onclick="showProductDetails('${product.style}')" 
                     data-product="${product.style}" 
                     data-name="${product.description.toLowerCase()}" 
                     data-embellishment="${embellishmentType}"
                     data-category="${categorizeProduct(product.description)}">
                    <div class="product-image">
                        ${imageHTML}
                    </div>
                    <div class="product-content">
                        ${embellishmentBadge}
                        <div class="product-header">
                            <div class="product-style">STYLE #${product.style}</div>
                            <h3 class="product-title">${product.description}</h3>
                        </div>
                        ${colorSwatches ? `<div class="product-colors">${colorSwatches}</div>` : ''}
                        <div class="product-stats">
                            <div class="stat-item">
                                <div class="stat-label">Units Sold</div>
                                <div class="stat-value">${product.totalUnits.toLocaleString()}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Revenue</div>
                                <div class="stat-value">$${product.totalRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Orders</div>
                                <div class="stat-value">${product.orderCount}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Categorize product based on description
        function categorizeProduct(description) {
            const desc = description.toLowerCase();
            if (desc.includes('polo')) return 'polos';
            if (desc.includes('sweat') || desc.includes('hood') || desc.includes('fleece')) return 'sweatshirts';
            if (desc.includes('cap') || desc.includes('hat') || desc.includes('knit cap')) return 'caps';
            if (desc.includes('jacket') || desc.includes('vest') || desc.includes('rain')) return 'outerwear';
            if (desc.includes('tee') || desc.includes('t-shirt')) return 'tshirts';
            if (desc.includes('ladies') || desc.includes('women')) return 'ladies';
            if (desc.includes('bag') || desc.includes('backpack') || desc.includes('towel')) return 'accessories';
            return 'other';
        }

        async function createProductCard(product, category) {
            let productData = productCache[product.style];

            if (!productData) {
                try {
                    const response = await fetch(`https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/product-colors?styleNumber=${product.style}`);
                    if (response.ok) {
                        productData = await response.json();
                        productCache[product.style] = productData;
                    }
                } catch (error) {
                    console.error(`Error fetching product ${product.style}:`, error);
                }
            }

            const imageUrl = productData?.colors?.[0]?.MAIN_IMAGE_URL || '';
            const description = productData?.PRODUCT_DESCRIPTION || '';
            const colors = productData?.colors || [];

            // Create badges
            let badges = '';
            if (product.rank) {
                badges += `<span class="badge badge-bestseller">#${product.rank} Best Seller</span>`;
            }
            if (product.isTopRevenue) {
                badges += `<span class="badge badge-top-revenue">Top Revenue</span>`;
            }

            // Create color swatches
            let colorSwatches = '';
            if (colors.length > 0) {
                const displayColors = colors.slice(0, 5);
                displayColors.forEach(color => {
                    if (color.COLOR_SQUARE_IMAGE) {
                        colorSwatches += `<div class="color-swatch" title="${color.COLOR_NAME}">
                            <img src="${color.COLOR_SQUARE_IMAGE}" alt="${color.COLOR_NAME}">
                        </div>`;
                    }
                });
                if (colors.length > 5) {
                    colorSwatches += `<div class="color-count">+${colors.length - 5} more</div>`;
                }
            }

            return `
                <div class="product-card" onclick="showProductDetails('${product.style}')" data-product="${product.style}" data-name="${product.name.toLowerCase()}" data-category="${category}">
                    ${badges ? `<div class="product-badge">${badges}</div>` : ''}
                    <div class="product-image">
                        ${imageUrl ? 
                            `<img src="${imageUrl}" alt="${product.name}" onerror="this.parentElement.innerHTML='<div class=\\'product-image-placeholder\\'><i class=\\'fas fa-tshirt\\'></i><span>Image not available</span></div>'">` : 
                            `<div class="product-image-placeholder">
                                <i class="fas fa-tshirt"></i>
                                <span>Image not available</span>
                            </div>`
                        }
                    </div>
                    <div class="product-content">
                        <div class="product-header">
                            <div class="product-style">STYLE #${product.style}</div>
                            <h3 class="product-title">${product.name}</h3>
                        </div>
                        <p class="product-description">${cleanDescription(description)}</p>
                        ${colorSwatches ? `<div class="product-colors">${colorSwatches}</div>` : ''}
                        <div class="product-stats">
                            <div class="stat-item">
                                <div class="stat-label">Units Sold</div>
                                <div class="stat-value">${product.quantity}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Revenue</div>
                                <div class="stat-value">$${product.revenue.toFixed(0).toLocaleString()}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Avg Price</div>
                                <div class="stat-value">$${product.avgPrice.toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getCategoryTitle(category) {
            const titles = {
                'polos': 'Polos & Knits',
                'sweatshirts': 'Sweatshirts & Fleece',
                'caps': 'Caps & Headwear',
                'outerwear': 'Outerwear & Jackets',
                'tshirts': 'T-Shirts',
                'ladies': 'Ladies Apparel',
                'accessories': 'Accessories & Bags'
            };
            return titles[category] || category;
        }

        function cleanDescription(description) {
            // Remove HTML entities and clean up description
            const div = document.createElement('div');
            div.innerHTML = description;
            let text = div.textContent || div.innerText || '';
            // Limit to first sentence or 100 characters
            const firstSentence = text.split('.')[0];
            return firstSentence.length > 100 ? firstSentence.substring(0, 100) + '...' : firstSentence + '.';
        }

        function filterProducts(searchTerm) {
            const term = searchTerm.toLowerCase();
            const cards = document.querySelectorAll('.product-card');

            cards.forEach(card => {
                const productName = card.dataset.name || '';
                const productStyle = (card.dataset.product || '').toLowerCase();
                const matches = productName.includes(term) || productStyle.includes(term);
                
                // Check if card also matches current category filter
                if (matches && currentCategoryFilter !== 'all') {
                    const cardCategory = card.dataset.category;
                    if (cardCategory !== currentCategoryFilter) {
                        card.style.display = 'none';
                    } else {
                        card.style.display = 'block';
                    }
                } else {
                    card.style.display = matches ? 'block' : 'none';
                }
            });

            // Hide empty sections
            document.querySelectorAll('.category-section').forEach(section => {
                const visibleCards = section.querySelectorAll('.product-card:not([style*="display: none"])');
                section.style.display = visibleCards.length > 0 ? 'block' : 'none';
            });
        }

        function applyFilters() {
            const cards = document.querySelectorAll('.product-card');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            cards.forEach(card => {
                let show = true;
                
                // Check category filter
                if (currentCategoryFilter !== 'all') {
                    const cardCategory = card.dataset.category;
                    if (cardCategory !== currentCategoryFilter) {
                        show = false;
                    }
                }
                
                // Check search term
                if (show && searchTerm) {
                    const productName = (card.dataset.name || '').toLowerCase();
                    const productStyle = (card.dataset.product || '').toLowerCase();
                    if (!productName.includes(searchTerm) && !productStyle.includes(searchTerm)) {
                        show = false;
                    }
                }
                
                card.style.display = show ? 'block' : 'none';
            });
            
            // Hide empty sections
            document.querySelectorAll('.category-section').forEach(section => {
                const visibleCards = section.querySelectorAll('.product-card:not([style*="display: none"])');
                section.style.display = visibleCards.length > 0 ? 'block' : 'none';
            });
        }

        async function showProductDetails(styleNumber) {
            const modal = document.getElementById('productModal');
            const modalBody = document.getElementById('modalBody');
            const modalTitle = document.getElementById('modalProductTitle');
            
            // Clean the style number for API call
            const cleanedStyle = cleanStyleNumber(styleNumber);

            let productData = productCache[cleanedStyle];
            if (!productData) {
                modalBody.innerHTML = '<div class="loading-spinner"></div> Loading product details...';
                modal.classList.add('active');

                try {
                    const response = await fetch(`https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/product-colors?styleNumber=${cleanedStyle}`);
                    if (response.ok) {
                        const data = await response.json();
                        productCache[cleanedStyle] = {
                            productTitle: data.productTitle,
                            PRODUCT_DESCRIPTION: data.PRODUCT_DESCRIPTION,
                            colors: data.colors,
                            imageUrl: data.colors?.[0]?.MAIN_IMAGE_URL
                        };
                        productData = productCache[cleanedStyle];
                    }
                } catch (error) {
                    console.log(`Product ${cleanedStyle} not found in API`);
                }
            }

            // Find product in our data for additional info
            let productInfo = null;
            for (const [type, products] of Object.entries(topSellersByEmbellishment)) {
                const found = products.find(p => p.style === styleNumber);
                if (found) {
                    productInfo = { ...found, embellishmentType: type };
                    break;
                }
            }

            if (productData && productData.colors) {
                modalTitle.textContent = productData.productTitle || productInfo?.description || `Style #${styleNumber}`;

                let colorGallery = '';
                if (productData.colors && productData.colors.length > 0) {
                    colorGallery = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem;">';
                    productData.colors.forEach(color => {
                        colorGallery += `
                            <div style="text-align: center;">
                                <img src="${color.FRONT_MODEL || color.FRONT_FLAT || color.MAIN_IMAGE_URL}" alt="${color.COLOR_NAME}" 
                                     style="width: 100%; border-radius: 8px; margin-bottom: 0.5rem;">
                                <p style="font-size: 0.875rem; font-weight: 500;">${color.COLOR_NAME}</p>
                            </div>
                        `;
                    });
                    colorGallery += '</div>';
                }

                modalBody.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div>
                            <img src="${productData.imageUrl || ''}" alt="${productData.productTitle}" 
                                 style="width: 100%; border-radius: 8px;">
                        </div>
                        <div>
                            <h4 style="margin-bottom: 1rem; color: var(--text-primary);">Product Details</h4>
                            <p style="line-height: 1.6; color: var(--text-secondary); margin-bottom: 1rem;">
                                ${productData.PRODUCT_DESCRIPTION || 'No description available'}
                            </p>
                            <p style="font-weight: 600; margin-bottom: 0.5rem;">Available Colors (${productData.colors?.length || 0})</p>
                        </div>
                    </div>
                    ${colorGallery}
                `;
            } else if (productInfo) {
                // Show product info even without API data
                modalTitle.textContent = productInfo.description;
                modalBody.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div class="product-image-placeholder brand-placeholder" style="width: 200px; height: 200px; margin: 0 auto 1.5rem;">
                            <i class="fas fa-tshirt" style="font-size: 3rem;"></i>
                            <span class="brand-name">${productInfo.brand || detectBrand(productInfo.style, productInfo.description)}</span>
                            <span class="coming-soon">Image Coming Soon</span>
                        </div>
                        <h4 style="margin-bottom: 1rem;">Style #${productInfo.style}</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; max-width: 400px; margin: 0 auto;">
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">${productInfo.totalUnits.toLocaleString()}</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Units Sold</div>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">$${productInfo.totalRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Total Revenue</div>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">${productInfo.orderCount}</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Orders</div>
                            </div>
                        </div>
                        <div style="margin-top: 1rem; padding: 0.5rem 1rem; background: var(--bg-color); border-radius: 8px; display: inline-block;">
                            <span style="font-weight: 600;">${getEmbellishmentName(productInfo.embellishmentType)} #${productInfo.rank}</span>
                        </div>
                    </div>
                `;
            } else {
                modalBody.innerHTML = '<p>Product details not available.</p>';
            }

            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('productModal').classList.remove('active');
        }

        // Close modal when clicking outside
        document.getElementById('productModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>