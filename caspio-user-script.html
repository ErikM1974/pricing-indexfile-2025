<!-- Caspio-Safe User Data Script -->
<!-- Add this to your Caspio DataPage HTML Block or Footer -->

<div id="user-data-sender" style="display:none;">
<span id="fname">[@authfield:First_Name]</span>
<span id="lname">[@authfield:Last_Name]</span>
<span id="email">[@authfield:Email]</span>
<span id="role">[@authfield:Role]</span>
<span id="lastlogin">[@authfield:Last_Login]</span>
</div>

<script>
// Simple version that works with Caspio
setTimeout(function() {
try {
    // Get the values from the hidden spans
    var firstName = document.getElementById('fname').textContent;
    var lastName = document.getElementById('lname').textContent;
    var email = document.getElementById('email').textContent;
    var role = document.getElementById('role').textContent;
    var lastLogin = document.getElementById('lastlogin').textContent;
    
    // Create user data object
    var userData = {
        firstName: firstName,
        lastName: lastName,
        email: email,
        role: role,
        lastLogin: lastLogin
    };
    
    // Send to parent window
    if (window.parent) {
        window.parent.postMessage({
            type: 'caspioUserData',
            data: userData
        }, '*');
    }
} catch (e) {
    console.log('Error sending user data:', e);
}
}, 500);
</script>