<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Staff Tools Portal - Northwest Custom Apparel</title>
    <link rel="icon" href="https://cdn.caspio.com/A0E15000/Safety%20Stripes/NWCA%20Favicon%20for%20TEAMNWCA.com.png?ver=1" type="image/png">

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Dashboard Styles -->
    <link href="/shared_components/css/dashboard-styles.css" rel="stylesheet">
    <link href="/shared_components/css/staff-dashboard-layout.css" rel="stylesheet">
    <link href="/shared_components/css/staff-dashboard-widgets.css" rel="stylesheet">
    <!-- Caspio Authentication Styles -->
    <style>
        /* Loading State */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }
        .loading-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e5e7eb;
            border-top-color: #981e32;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loading-text {
            color: #6b7280;
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Hidden Caspio Container */
        .caspio-hidden-container {
            position: absolute;
            left: -9999px;
            top: -9999px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        /* Sign Out Link */
        .sign-out-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .sign-out-link:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.5);
        }
        /* User Welcome */
        .user-welcome {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 1px solid #86efac;
            border-radius: 8px;
            color: #166534;
            font-size: 0.875rem;
        }
        .welcome-text {
            font-weight: 400;
        }
        .user-name {
            font-weight: 600;
        }
        /* Price Alert Banner */
        .price-alert-banner {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: #ffffff !important;
            font-size: 0.9rem;
            position: relative;
            z-index: 100;
            text-align: center;
        }
        .price-alert-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            color: #ffffff !important;
            max-width: calc(100% - 80px);
            margin: 0 auto;
        }
        .price-alert-content span,
        .price-alert-content strong {
            color: #ffffff !important;
        }
        .price-alert-content i {
            font-size: 1.2rem;
            color: #ffffff !important;
        }
        .price-alert-close {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: #ffffff !important;
            cursor: pointer;
            padding: 4px 8px;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        .price-alert-close:hover {
            opacity: 1;
        }
        .price-alert-close i {
            color: #ffffff !important;
        }
        .price-alert-banner.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Verifying authentication...</div>
    </div>

    <!-- Hidden Caspio Authentication Container -->
    <div class="caspio-auth" style="display: none;">
        <div id="auth-firstname">[@authfield:First_Name]</div>
        <div id="auth-lastname">[@authfield:Last_Name]</div>
        <div id="auth-email">[@authfield:Email]</div>
        <div id="auth-role">[@authfield:Role]</div>
        <script type="text/javascript" src="https://c3eku948.caspio.com/dp/a0e15000a0bb470ed2be4ec5943e/emb"></script>
    </div>

    <!-- 2026 Price Increase Alert Banner -->
    <div class="price-alert-banner" id="priceAlertBanner">
        <div class="price-alert-content">
            <i class="fas fa-info-circle"></i>
            <span><strong>2026 Pricing Update:</strong> Due to SanMar cost increases, all decoration services have been adjusted 5-7% effective January 5, 2026. Quote builders reflect current pricing.</span>
        </div>
        <button class="price-alert-close" onclick="dismissPriceAlert()" aria-label="Dismiss">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div class="dashboard-container">
        <!-- =====================================================
             SIDEBAR NAVIGATION (Preserved from original)
             ===================================================== -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="/" class="logo-link" title="Go to main site">
                    <img src="https://cdn.caspio.com/A0E15000/Safety%20Stripes/web%20northwest%20custom%20apparel%20logo.png?ver=1"
                         alt="Northwest Custom Apparel" class="company-logo">
                </a>
                <div class="company-name">Staff Portal</div>
                <div class="company-year">2026</div>
            </div>

            <nav class="sidebar-nav">
                <div class="sidebar-content">
                    <!-- Company Policies -->
                    <div class="nav-section" data-section="policies">
                        <a href="/pages/policies-hub.html" class="nav-section-header-link">
                            <div class="nav-section-header">
                                <div class="nav-section-title">
                                    <span>üìã</span>
                                    <span>Company Policies</span>
                                </div>
                                <span>‚Üí</span>
                            </div>
                        </a>
                    </div>

                    <!-- Training -->
                    <div class="nav-section collapsed" data-section="training">
                        <div class="nav-section-header" onclick="toggleSidebarSection(this.parentElement)">
                            <div class="nav-section-title">
                                <span>üìñ</span>
                                <span>Training</span>
                            </div>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="nav-section-content">
                            <a href="/training/customer-service.html" class="nav-link"><span>Customer Service Manual</span></a>
                            <a href="/training/sales-coordinator-manual.html" class="nav-link"><span>Sales Coordinator Manual</span></a>
                            <a href="/training/quick-reference-tips.html" class="nav-link"><span>Quick Hitter Tips Archive</span></a>
                            <a href="/training/training-games-hub.html" class="nav-link"><span>üéÆ Training Games Hub</span></a>
                        </div>
                    </div>

                    <!-- Office Assistant -->
                    <div class="nav-section collapsed" data-section="office-assistant">
                        <div class="nav-section-header" onclick="toggleSidebarSection(this.parentElement)">
                            <div class="nav-section-title">
                                <span>üë©‚Äçüíº</span>
                                <span>Office Assistant</span>
                            </div>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="nav-section-content">
                            <a href="/training/adriyella-daily-report.html" class="nav-link"><span>Adriyella's Bonus Tracker</span></a>
                            <a href="/training/thank-you-card-guide.html" class="nav-link"><span>Thank You Card Guide</span></a>
                            <a href="/training/google-review-guide.html" class="nav-link"><span>Google Review Guide</span></a>
                            <a href="/training/lead-sheet-guide.html" class="nav-link"><span>Lead Sheet Guide</span></a>
                            <a href="/training/art-approval-guide.html" class="nav-link"><span>Art Approval Guide</span></a>
                            <a href="/training/bonus-policy.html" class="nav-link"><span>Erik's Bonus Policy</span></a>
                        </div>
                    </div>

                    <!-- Employee Bundles -->
                    <div class="nav-section collapsed" data-section="employee-bundles">
                        <div class="nav-section-header" onclick="toggleSidebarSection(this.parentElement)">
                            <div class="nav-section-title">
                                <span>üè∑Ô∏è</span>
                                <span>Employee Bundles</span>
                            </div>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="nav-section-content">
                            <a href="/DrainPro-Bundle.html" class="nav-link"><span>Drain-Pro</span></a>
                            <a href="/streich-bros-bundle.html" class="nav-link"><span>Streich Bros</span></a>
                            <a href="/wcttr-bundle.html" class="nav-link"><span>WCTTR</span></a>
                            <a href="/christmas-bundles.html" class="nav-link"><span>Christmas Bundles</span></a>
                        </div>
                    </div>

                    <!-- Inksoft Transform Tool -->
                    <div class="nav-section" data-section="inksoft-trans">
                        <a href="https://inksoft-transform-8a3dc4e38097.herokuapp.com/" target="_blank" class="nav-section-header-link">
                            <div class="nav-section-header">
                                <div class="nav-section-title">
                                    <span>üîÑ</span>
                                    <span>Inksoft Transform</span>
                                </div>
                                <span>‚Üí</span>
                            </div>
                        </a>
                    </div>

                    <!-- Administration -->
                    <div class="nav-section collapsed" data-section="admin">
                        <div class="nav-section-header" onclick="toggleSidebarSection(this.parentElement)">
                            <div class="nav-section-title">
                                <span>‚öôÔ∏è</span>
                                <span>Administration</span>
                            </div>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="nav-section-content">
                            <a href="/sanmar-vendor-portal.html" class="nav-link"><span>Sanmar Vendor Portal</span></a>
                            <a href="/admin/announcements-create.html" class="nav-link"><span>Create Announcements</span></a>
                            <a href="/admin/announcements-manage.html" class="nav-link"><span>Manage Announcements</span></a>
                            <a href="/universal-records-admin.html" class="nav-link"><span>Universal Records Admin</span></a>
                            <a href="/training/adriyella-admin.html" class="nav-link"><span>Adriyella Task Admin</span></a>
                        </div>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- =====================================================
             MAIN CONTENT AREA
             ===================================================== -->
        <main class="main-content">
            <!-- Top Header -->
            <header class="top-header" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; background: white; border-bottom: 1px solid var(--border-color);">
                <div class="header-left">
                    <h1 style="font-size: 1.25rem; font-weight: 600; color: var(--text-primary); margin: 0;">Staff Dashboard</h1>
                </div>
                <div class="header-right" style="display: flex; align-items: center; gap: 1rem;">
                    <!-- Celebrations Widget -->
                    <div class="celebrations-widget">
                        <div class="celebration-item" onclick="toggleCelebrationDropdown('birthday', event)" title="View upcoming birthdays">
                            <span class="celebration-icon">üéÇ</span>
                            <span class="celebration-count" id="birthdayCount">0</span>
                            <span class="celebration-label">Birthdays</span>
                            <div class="celebration-dropdown" id="birthdayDropdown">
                                <div class="celebration-dropdown-header">
                                    <i class="fas fa-birthday-cake"></i> Upcoming Birthdays
                                </div>
                                <div class="celebration-list" id="birthdayList"></div>
                                <div class="celebration-view-all" onclick="showStaffDirectory('birthdays')">
                                    <i class="fas fa-users"></i> View All Staff Birthdays
                                </div>
                            </div>
                        </div>
                        <div class="celebration-item" onclick="toggleCelebrationDropdown('anniversary', event)" title="View work anniversaries">
                            <span class="celebration-icon">üèÜ</span>
                            <span class="celebration-count" id="anniversaryCount">0</span>
                            <span class="celebration-label">Anniversaries</span>
                            <div class="celebration-dropdown" id="anniversaryDropdown">
                                <div class="celebration-dropdown-header">
                                    <i class="fas fa-trophy"></i> Work Anniversaries
                                </div>
                                <div class="celebration-list" id="anniversaryList"></div>
                                <div class="celebration-view-all" onclick="showStaffDirectory('anniversaries')">
                                    <i class="fas fa-users"></i> View All Staff Anniversaries
                                </div>
                            </div>
                        </div>
                        <div class="celebration-item staff-directory-btn" onclick="showStaffDirectory('all')" title="View staff directory">
                            <span class="celebration-icon">üë•</span>
                            <span class="celebration-label">Staff</span>
                        </div>
                    </div>

                    <div class="user-welcome" id="userWelcome" style="display: none;">
                        <span class="welcome-text">Welcome,</span>
                        <span class="user-name" id="userName"></span>
                    </div>

                    <a href="https://c3eku948.caspio.com/folderlogout" class="sign-out-link" title="Sign Out">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Sign Out</span>
                    </a>
                </div>
            </header>

            <!-- Partial Data Warning (shown when API returns incomplete data) -->
            <div id="partialDataWarning" style="display: none; padding: 0 1.5rem;"></div>

            <!-- 2026 Sales Goal Banner -->
            <div class="sales-goal-banner">
                <div class="sales-goal-content">
                    <div class="sales-goal-icon">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <div class="sales-goal-info">
                        <div class="sales-goal-title">2026 Annual Sales Goal</div>
                        <div class="sales-goal-amount">$3,000,000</div>
                    </div>
                    <div class="sales-goal-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="goalProgress" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">
                            <span id="goalCurrent">$0</span> <span class="goal-percent">(<span id="goalPercent">0</span>%)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Zones Container -->
            <div class="dashboard-zones">

                <!-- =====================================================
                     ZONE 1: ANNOUNCEMENTS HERO
                     Training/Process updates with visual prominence
                     ===================================================== -->
                <section class="zone-announcements">
                    <div class="announcements-hero" id="announcementsHero">
                        <!-- Populated by JavaScript -->
                    </div>
                    <div class="announcements-list" id="announcementsList">
                        <!-- Populated by JavaScript -->
                    </div>
                </section>

                <!-- =====================================================
                     ZONE 2: QUICK ACCESS TOOLS
                     Primary action area - Quote builders, calculators
                     ===================================================== -->
                <section class="zone-quick-access">
                    <div class="zone-header">
                        <h2 class="zone-title">
                            <i class="fas fa-bolt"></i>
                            Quick Access Tools
                        </h2>
                    </div>

                    <div class="quick-access-grid">
                        <!-- Excel Quote Grid -->
                        <div class="tool-category">
                            <div class="tool-category-header">
                                <div class="tool-category-icon">
                                    <i class="fas fa-file-excel"></i>
                                </div>
                                <span class="tool-category-title">Excel Quote Grid</span>
                            </div>
                            <div class="tool-buttons">
                                <a href="/quote-builders/embroidery-quote-builder.html" class="tool-btn tool-btn-wide">Garm/Cap Emb - Cap-Laser Patch Cap-3D-Puff</a>
                                <a href="/quote-builders/dtg-quote-builder.html" class="tool-btn">DTG 2026</a>
                                <a href="/quote-builders/screenprint-quote-builder.html" class="tool-btn">Screen Print 2026</a>
                                <a href="/quote-builders/dtf-quote-builder.html" class="tool-btn">DTF 2026</a>
                                <a href="/dashboards/quote-management.html" class="tool-btn" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; border-color: #7c3aed;">
                                    <i class="fas fa-list-alt"></i> Quote Management
                                </a>
                            </div>
                        </div>

                        <!-- Manual Pricing -->
                        <div class="tool-category">
                            <div class="tool-category-header">
                                <div class="tool-category-icon">
                                    <i class="fas fa-calculator"></i>
                                </div>
                                <span class="tool-category-title">Manual Pricing</span>
                            </div>
                            <div class="tool-buttons">
                                <div class="tool-dropdown">
                                    <button class="tool-dropdown-btn">
                                        <span>Select Calculator</span>
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                    <div class="tool-dropdown-menu">
                                        <a href="javascript:void(0)" onclick="openManualPricingModal('dtg')" class="tool-dropdown-item">DTG</a>
                                        <a href="javascript:void(0)" onclick="openManualPricingModal('dtf')" class="tool-dropdown-item">DTF</a>
                                        <a href="javascript:void(0)" onclick="openManualPricingModal('embroidery')" class="tool-dropdown-item">Embroidery</a>
                                        <a href="javascript:void(0)" onclick="openManualPricingModal('cap-embroidery')" class="tool-dropdown-item">Cap Embroidery</a>
                                        <a href="javascript:void(0)" onclick="openManualPricingModal('screen-print')" class="tool-dropdown-item">Screen Print</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contract -->
                        <div class="tool-category">
                            <div class="tool-category-header">
                                <div class="tool-category-icon">
                                    <i class="fas fa-handshake"></i>
                                </div>
                                <span class="tool-category-title">Contract</span>
                            </div>
                            <div class="tool-buttons">
                                <a href="/calculators/dtg-contract/" class="tool-btn">Contract DTG</a>
                                <a href="/calculators/embroidery-contract/" class="tool-btn">Contract Emb</a>
                                <a href="/calculators/embroidery-customer/" class="tool-btn">Corp Supplied Emb</a>
                                <a href="/calculators/screenprint-customer/" class="tool-btn">Corp Supplied SP</a>
                            </div>
                        </div>

                        <!-- Specialty -->
                        <div class="tool-category">
                            <div class="tool-category-header">
                                <div class="tool-category-icon">
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="tool-category-title">Specialty</span>
                            </div>
                            <div class="tool-buttons">
                                <a href="/calculators/embroidered-emblem/" class="tool-btn">Emblems</a>
                                <a href="/calculators/laser-tumbler-polarcamel.html" class="tool-btn">Laser Tumbler</a>
                                <a href="/calculators/sticker-manual-pricing.html" class="tool-btn">Stickers</a>
                                <a href="/calculators/webstores.html" class="tool-btn">Webstore</a>
                                <a href="/calculators/richardson-2025.html" class="tool-btn">Richardson Non-Sanmar</a>
                            </div>
                        </div>

                        <!-- Artwork -->
                        <div class="tool-category">
                            <div class="tool-category-header">
                                <div class="tool-category-icon">
                                    <i class="fas fa-palette"></i>
                                </div>
                                <span class="tool-category-title">Artwork</span>
                            </div>
                            <div class="tool-buttons">
                                <a href="/art-tools/ae-art-dashboard.html" class="tool-btn">AE Portal</a>
                                <a href="/dashboards/art-hub-steve.html" class="tool-btn">Steve Portal</a>
                                <a href="/dashboards/art-hub-ruth.html" class="tool-btn">Ruth Portal</a>
                                <a href="/art-invoices-dashboard.html" class="tool-btn">Art Dashboard</a>
                            </div>
                        </div>

                        <!-- Forms -->
                        <div class="tool-category">
                            <div class="tool-category-header">
                                <div class="tool-category-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <span class="tool-category-title">Forms</span>
                            </div>
                            <div class="tool-buttons">
                                <a href="/calculators/digitizingform.html" class="tool-btn">Digitizing</a>
                                <a href="/calculators/purchasingform.html" class="tool-btn">Purchasing</a>
                                <a href="/dashboards/monogram-dashboard.html" class="tool-btn" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; border-color: #7c3aed;">
                                    <i class="fas fa-th-list"></i> Monogram Dashboard
                                </a>
                            </div>
                        </div>

                        <!-- Quick Links -->
                        <div class="tool-category">
                            <div class="tool-category-header">
                                <div class="tool-category-icon">
                                    <i class="fas fa-link"></i>
                                </div>
                                <span class="tool-category-title">Quick Links</span>
                            </div>
                            <div class="tool-buttons">
                                <a href="/pages/3-day-tees.html" class="tool-btn" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border-color: #059669;">
                                    <i class="fas fa-clock"></i> 3-Day Tees
                                </a>
                                <a href="/pages/top-sellers-showcase.html" class="tool-btn">
                                    <i class="fas fa-star"></i> Top Sellers
                                </a>
                            </div>
                        </div>

                        <!-- Recent Policies (collapsed by default) -->
                        <div class="tool-category policies-category">
                            <div class="tool-category-header collapsible-header" data-toggle="policies">
                                <div class="tool-category-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <span class="tool-category-title">Recent Policies</span>
                                <i class="fas fa-chevron-down toggle-icon"></i>
                            </div>
                            <div class="tool-buttons policies-content collapsed" id="policies-content">
                                <div class="policy-mini-list">
                                    <a href="/pages/policies-hub.html#sales-office" class="policy-mini-card">
                                        <div class="policy-mini-icon">
                                            <i class="fas fa-file-alt"></i>
                                        </div>
                                        <div class="policy-mini-content">
                                            <div class="policy-mini-title">Sales & Office Procedures</div>
                                            <div class="policy-mini-date">Updated Oct 31, 2025</div>
                                        </div>
                                        <span class="policy-mini-badge">NEW</span>
                                    </a>
                                    <a href="/pages/policies-hub.html#customer-notification" class="policy-mini-card">
                                        <div class="policy-mini-icon">
                                            <i class="fas fa-bell"></i>
                                        </div>
                                        <div class="policy-mini-content">
                                            <div class="policy-mini-title">Customer Notification SOP</div>
                                            <div class="policy-mini-date">Updated Sep 16, 2025</div>
                                        </div>
                                    </a>
                                    <a href="/pages/policies-hub.html#ltm-decision" class="policy-mini-card">
                                        <div class="policy-mini-icon">
                                            <i class="fas fa-balance-scale"></i>
                                        </div>
                                        <div class="policy-mini-content">
                                            <div class="policy-mini-title">LTM Order Decision Algorithm</div>
                                            <div class="policy-mini-date">Updated Sep 09, 2025</div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- =====================================================
                     ZONE 3: SALES METRICS
                     ShopWorks API - Revenue, Team Performance
                     ===================================================== -->
                <section class="zone-metrics">
                    <!-- Revenue Card -->
                    <div class="metrics-revenue-card">
                        <div class="metrics-revenue-header">
                            <span class="metrics-revenue-title" id="revenueTitle">Revenue: Last 7 Days</span>
                            <div class="date-range-toggle">
                                <button class="date-range-btn active" data-days="7">7D</button>
                                <button class="date-range-btn" data-days="30">30D</button>
                                <button class="date-range-btn" data-days="60">60D</button>
                            </div>
                        </div>
                        <div class="metrics-revenue-value" id="ytdRevenue">
                            <span class="skeleton skeleton-value"></span>
                        </div>
                        <div class="metrics-date-range" id="dateRangeDisplay">
                            <!-- Populated by JS: "Dec 1, 2025 - Dec 31, 2025" -->
                        </div>
                        <div class="metrics-revenue-comparison">
                            <span class="metrics-comparison-badge positive" id="ytdGrowth">
                                <i class="fas fa-arrow-up"></i> --
                            </span>
                            <span class="metrics-comparison-label" id="comparisonLabel">vs. last year</span>
                        </div>
                    </div>

                    <!-- Team Performance Card - 2026 YTD -->
                    <div class="metrics-team-card">
                        <div class="metrics-team-header">
                            <div class="metrics-team-title-group">
                                <h3 class="metrics-team-title" id="teamPerformanceTitle">
                                    <i class="fas fa-users"></i>
                                    Team Performance: 2026 YTD
                                </h3>
                                <div class="metrics-date-range" id="teamDateRange"></div>
                            </div>
                            <div class="refresh-control">
                                <button class="refresh-btn" onclick="StaffDashboardInit.loadMetrics(true)" title="Refresh">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="rep-list" id="salesTeamList">
                            <!-- Populated by JavaScript -->
                            <div class="metrics-loading">
                                <div class="loading"></div>
                                <span>Loading from ShopWorks...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Production Schedule Predictor Widget -->
                    <div class="widget-collapsible production-widget-card" data-widget="production">
                        <div class="widget-header">
                            <h3 class="widget-title">
                                <i class="fas fa-chart-line"></i>
                                Production Turnaround
                            </h3>
                            <span id="production-season-badge" class="season-badge"></span>
                            <i class="fas fa-chevron-down widget-toggle"></i>
                        </div>
                        <div class="widget-content">
                            <div id="production-predictor-grid" class="production-predictor-grid">
                                <!-- Dynamic content rendered by renderProductionSchedule() -->
                                <div class="production-loading">Loading predictions...</div>
                            </div>
                            <div class="production-footer">
                                <span class="production-meta">
                                    <i class="fas fa-database"></i>
                                    Based on <span id="production-record-count">4,631</span> historical completions
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Garment Tracker Card (spans full width below Revenue and Team Performance) -->
                    <div class="garment-tracker-card">
                        <div class="garment-tracker-header">
                            <div class="garment-tracker-title-group">
                                <h3 class="garment-tracker-title">
                                    <i class="fas fa-tshirt"></i>
                                    Garment Tracker
                                </h3>
                                <div class="garment-tracker-date" id="garmentTrackerDateRange">
                                    Jan 1, 2026 - Today
                                </div>
                            </div>
                            <div class="refresh-control">
                                <span class="sync-status" id="garmentSyncStatus"></span>
                                <button class="sync-btn" onclick="StaffDashboardInit.syncGarmentTracker()" title="Sync from Orders">
                                    <i class="fas fa-cloud-download-alt"></i>
                                </button>
                                <button class="refresh-btn" onclick="StaffDashboardInit.refreshGarmentTracker()" title="Refresh from Table">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="garment-tracker-content" id="garmentTrackerContent">
                            <div class="metrics-loading">
                                <div class="loading"></div>
                                <span>Loading garment data...</span>
                            </div>
                        </div>
                    </div>
                </section>

            </div><!-- End dashboard-zones -->
        </main>
    </div><!-- End dashboard-container -->

    <!-- =====================================================
         SAMPLE ANNOUNCEMENTS DATA
         (Replace with API call in production)
         ===================================================== -->
    <script>
        // Sample announcements data - replace with API call
        var staffAnnouncementsData = [
            {
                id: 'ann-001',
                type: 'training',
                title: 'New LTM Order Policy Update',
                preview: 'Framework for handling Less-Than-Minimum orders: existing vs. new customers, upselling, and referrals.',
                content: 'Full policy details available in the policies hub.',
                date: '2025-09-09'
            },
            {
                id: 'ann-002',
                type: 'process',
                title: 'Customer Notification SOP Updated',
                preview: 'Standard procedure for notifying customers when orders are ready for pickup, including ShopWorks logging.',
                date: '2025-09-16'
            },
            {
                id: 'ann-003',
                type: 'general',
                title: 'Welcome to the New Dashboard!',
                preview: 'We\'ve redesigned the staff dashboard for better usability. Quick access tools are now front and center.',
                date: '2025-12-31'
            }
        ];
    </script>

    <!-- =====================================================
         STAFF DIRECTORY MODAL
         ===================================================== -->
    <div class="staff-modal-overlay" id="staffDirectoryModal" onclick="closeStaffDirectory(event)">
        <div class="staff-modal" onclick="event.stopPropagation()">
            <div class="staff-modal-header">
                <h2><i class="fas fa-users"></i> Staff Directory</h2>
                <button class="staff-modal-close" onclick="closeStaffDirectory()">&times;</button>
            </div>
            <div class="staff-modal-filters">
                <button class="staff-filter-btn active" onclick="filterStaffDirectory('all')">All Staff</button>
                <button class="staff-filter-btn" onclick="filterStaffDirectory('active')">Active</button>
                <button class="staff-filter-btn" onclick="filterStaffDirectory('birthdays')">Upcoming Birthdays</button>
                <button class="staff-filter-btn" onclick="filterStaffDirectory('anniversaries')">Anniversaries</button>
            </div>
            <div class="staff-modal-content">
                <table class="staff-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Start Date</th>
                            <th>Years</th>
                            <th>Birthday</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="staffTableBody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- =====================================================
         MANUAL PRICING COST INPUT MODAL
         ===================================================== -->
    <div id="manualPricingModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-content">
                    <i class="fas fa-calculator"></i>
                    <div class="modal-header-text">
                        <h3>Manual Pricing</h3>
                        <span class="modal-subtitle" id="modalCalculatorName">DTG (Direct-to-Garment)</span>
                    </div>
                </div>
                <button class="modal-close" onclick="closeManualPricingModal()" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-description">Enter the base garment cost to calculate manual pricing.</p>

                <div class="modal-input-group">
                    <label for="manualCostInput" class="modal-label">
                        Base Garment Cost ($)
                    </label>
                    <input
                        type="number"
                        id="manualCostInput"
                        step="0.01"
                        min="0.01"
                        placeholder="Example: 6.25"
                        class="modal-input"
                        onkeypress="if(event.key === 'Enter') openManualPricingWithCost()"
                    />
                    <div id="manualCostError" class="modal-error" style="display: none;">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="manualCostErrorText">Please enter a valid cost</span>
                    </div>
                </div>

                <div class="modal-actions">
                    <button onclick="closeManualPricingModal()" class="modal-btn modal-btn-cancel">
                        Cancel
                    </button>
                    <button onclick="openManualPricingWithCost()" class="modal-btn modal-btn-primary">
                        <i class="fas fa-arrow-right"></i> Calculate Pricing
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Pricing Modal Styles -->
    <style>
        #manualPricingModal.modal {
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.2s ease-out;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        #manualPricingModal .modal-content {
            background-color: #ffffff;
            padding: 0;
            border: none;
            width: 90%;
            max-width: 560px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            animation: modalSlideIn 0.3s ease-out;
            overflow: hidden;
        }
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #manualPricingModal .modal-header {
            padding: 28px 32px;
            background-color: #4cb354;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        #manualPricingModal .modal-header-content {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }
        #manualPricingModal .modal-header-content > i {
            font-size: 28px;
            margin-top: 2px;
        }
        #manualPricingModal .modal-header-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        #manualPricingModal .modal-header h3 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
            line-height: 1.2;
        }
        #manualPricingModal .modal-subtitle {
            font-size: 16px;
            font-weight: 400;
            opacity: 0.95;
        }
        #manualPricingModal .modal-close {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            transition: opacity 0.2s;
        }
        #manualPricingModal .modal-close:hover {
            opacity: 0.8;
        }
        #manualPricingModal .modal-body {
            padding: 36px 32px;
        }
        #manualPricingModal .modal-description {
            margin: 0 0 28px 0;
            color: #4b5563;
            font-size: 15px;
        }
        #manualPricingModal .modal-input-group {
            margin-bottom: 32px;
        }
        #manualPricingModal .modal-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #1f2937;
            font-size: 15px;
        }
        #manualPricingModal .modal-input {
            width: 100%;
            padding: 14px 16px;
            font-size: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            box-sizing: border-box;
            transition: all 0.2s;
        }
        #manualPricingModal .modal-input:focus {
            outline: none;
            border-color: #4cb354;
            box-shadow: 0 0 0 3px rgba(76, 179, 84, 0.1);
        }
        #manualPricingModal .modal-error {
            margin-top: 10px;
            padding: 10px 12px;
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 6px;
            color: #dc2626;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        #manualPricingModal .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        #manualPricingModal .modal-btn {
            padding: 14px 28px;
            font-size: 15px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        #manualPricingModal .modal-btn-cancel {
            background: #f3f4f6;
            color: #6b7280;
        }
        #manualPricingModal .modal-btn-cancel:hover {
            background: #e5e7eb;
        }
        #manualPricingModal .modal-btn-primary {
            background: #4cb354;
            color: white;
        }
        #manualPricingModal .modal-btn-primary:hover {
            background: #3d9943;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(76, 179, 84, 0.3);
        }
        @media (max-width: 768px) {
            #manualPricingModal .modal-content {
                width: 95%;
                margin: 20px;
            }
            #manualPricingModal .modal-header,
            #manualPricingModal .modal-body {
                padding: 24px 20px;
            }
            #manualPricingModal .modal-actions {
                flex-direction: column;
            }
            #manualPricingModal .modal-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>

    <!-- =====================================================
         EXTERNAL JAVASCRIPT
         ===================================================== -->
    <!-- Dashboard Services -->
    <script src="/shared_components/js/staff-dashboard-employees.js"></script>
    <script src="/shared_components/js/staff-dashboard-service.js"></script>
    <script src="/shared_components/js/staff-dashboard-announcements.js"></script>
    <!-- Production Schedule Predictor -->
    <script src="/shared_components/js/production-schedule-stats.js"></script>
    <script src="/shared_components/js/production-schedule-predictor.js"></script>
    <script src="/shared_components/js/staff-dashboard-init.js"></script>

    <!-- Caspio Authentication Script -->
    <script>
        // =====================================================
        // CASPIO AUTHENTICATION CHECK
        // =====================================================
        const LOGIN_URL = '/dashboards/staff-login.html';
        const AUTH_TIMEOUT = 8000; // 8 seconds to wait for Caspio
        let authCheckComplete = false;
        let portalInitialized = false;

        function checkCaspioAuth() {
            // Look for authenticated user data from Caspio
            const firstName = document.getElementById('auth-firstname')?.textContent?.trim();
            const email = document.getElementById('auth-email')?.textContent?.trim();

            // Check if we have valid auth data (Caspio populates these fields when logged in)
            // Skip if tokens are still present (not yet processed by Caspio)
            if (firstName && firstName !== '' && !firstName.includes('[@authfield') && !firstName.includes('@authfield')) {
                // User is authenticated
                authCheckComplete = true;
                initializePortal();
                return true;
            }

            // Also check window.caspioUser (set by some Caspio DataPages)
            if (window.caspioUser && window.caspioUser.firstName) {
                authCheckComplete = true;
                initializePortal();
                return true;
            }

            return false;
        }

        function initializePortal() {
            // Prevent double initialization
            if (portalInitialized) return;
            portalInitialized = true;

            // Get user info from DOM or caspioUser object
            let firstName, lastName, email, role;

            if (window.caspioUser && window.caspioUser.firstName) {
                firstName = window.caspioUser.firstName;
                lastName = window.caspioUser.lastName || '';
                email = window.caspioUser.email || '';
                role = window.caspioUser.role || 'Staff';
            } else {
                firstName = document.getElementById('auth-firstname')?.textContent?.trim() || '';
                lastName = document.getElementById('auth-lastname')?.textContent?.trim() || '';
                email = document.getElementById('auth-email')?.textContent?.trim() || '';
                role = document.getElementById('auth-role')?.textContent?.trim() || 'Staff';
            }

            // Hide loading overlay
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.add('fade-out');
            }

            // Store user info for use elsewhere
            const fullName = firstName + (lastName ? ' ' + lastName : '');
            sessionStorage.setItem('nwca_user_name', fullName);
            sessionStorage.setItem('nwca_user_email', email);
            sessionStorage.setItem('nwca_user_role', role);

            // Show welcome message with user name
            if (firstName && firstName !== '') {
                const userNameEl = document.getElementById('userName');
                const userWelcomeEl = document.getElementById('userWelcome');
                if (userNameEl && userWelcomeEl) {
                    userNameEl.textContent = firstName;
                    userWelcomeEl.style.display = 'flex';
                }
            }

            console.log('[Auth] Dashboard loaded for:', firstName);
        }

        function redirectToLogin() {
            if (!authCheckComplete) {
                console.log('[Auth] Not authenticated, redirecting to login');
                window.location.href = LOGIN_URL;
            }
        }

        // Caspio DataPageReady Event Listener
        document.addEventListener('DataPageReady', function(event) {
            console.log('[Auth] Caspio DataPage Ready');
            // Check auth when DataPage loads
            setTimeout(checkCaspioAuth, 100);
        });

        // Listen for the custom caspioUserReady event
        window.addEventListener('caspioUserReady', function(event) {
            console.log('[Auth] Caspio user ready event received:', event.detail);
            if (!authCheckComplete) {
                checkCaspioAuth();
            }
        });

        // Wait for page load then check auth with retry mechanism
        window.addEventListener('load', function() {
            let retryCount = 0;
            const maxRetries = 10;

            function attemptInitialization() {
                // Check if Caspio has set the user data
                if (checkCaspioAuth()) {
                    console.log('[Auth] Caspio user data found, portal initialized');
                } else if (retryCount < maxRetries) {
                    retryCount++;
                    console.log(`[Auth] Waiting for Caspio user data... attempt ${retryCount}/${maxRetries}`);
                    setTimeout(attemptInitialization, 500);
                } else {
                    // Fallback: show dashboard anyway (matches old behavior)
                    console.log('[Auth] Max retries reached, initializing with fallback');
                    authCheckComplete = true;
                    initializePortal();
                }
            }

            // Start checking after initial delay
            setTimeout(attemptInitialization, 1000);
        });

        // Fallback timeout - if no auth after timeout, show dashboard anyway
        setTimeout(function() {
            if (!authCheckComplete) {
                console.log('[Auth] Timeout reached, initializing with fallback');
                authCheckComplete = true;
                initializePortal();
            }
        }, AUTH_TIMEOUT);
    </script>

    <!-- Sidebar Toggle Function (minimal inline for critical functionality) -->
    <script>
        function toggleSidebarSection(section) {
            section.classList.toggle('collapsed');
            // Save state
            const states = {};
            document.querySelectorAll('.nav-section').forEach(s => {
                const id = s.dataset.section;
                if (id) states[id] = s.classList.contains('collapsed');
            });
            localStorage.setItem('staffDashboard_sidebarStates', JSON.stringify(states));
        }

        // Restore sidebar states on load
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const states = JSON.parse(localStorage.getItem('staffDashboard_sidebarStates') || '{}');
                Object.entries(states).forEach(([id, collapsed]) => {
                    const section = document.querySelector(`[data-section="${id}"]`);
                    if (section) section.classList.toggle('collapsed', collapsed);
                });
            } catch (e) {}

            // Initialize celebrations
            if (window.StaffDashboardEmployees) {
                StaffDashboardEmployees.initCelebrations();
                StaffDashboardEmployees.renderBirthdayList('birthdayList');
                StaffDashboardEmployees.renderAnniversaryList('anniversaryList');
            }

            // Check if price alert was dismissed this session
            if (sessionStorage.getItem('priceAlertDismissed_2026') === 'true') {
                const banner = document.getElementById('priceAlertBanner');
                if (banner) banner.classList.add('hidden');
            }
        });

        // Price Alert Banner - Dismiss functionality
        function dismissPriceAlert() {
            const banner = document.getElementById('priceAlertBanner');
            if (banner) {
                banner.classList.add('hidden');
                sessionStorage.setItem('priceAlertDismissed_2026', 'true');
            }
        }

        // =====================================================
        // MANUAL PRICING MODAL FUNCTIONS
        // =====================================================

        let currentManualCalculatorType = '';
        let currentManualCalculatorUrl = '';

        const MANUAL_PRICING_CALCULATORS = {
            'dtg': {
                name: 'DTG (Direct-to-Garment)',
                url: '/calculators/dtg-pricing.html',
                available: true
            },
            'dtf': {
                name: 'DTF (Direct-to-Film)',
                url: '/calculators/dtf-pricing.html',
                available: true
            },
            'embroidery': {
                name: 'Embroidery',
                url: '/calculators/embroidery-pricing.html',
                available: true
            },
            'cap-embroidery': {
                name: 'Cap Embroidery',
                url: '/calculators/cap-embroidery-manual-pricing.html',
                available: true
            },
            'screen-print': {
                name: 'Screen Print',
                url: '/calculators/screen-print-pricing.html',
                available: true
            }
        };

        function openManualPricingModal(calculatorType) {
            const calculator = MANUAL_PRICING_CALCULATORS[calculatorType];

            if (!calculator) {
                console.error('Unknown calculator type:', calculatorType);
                return;
            }

            if (!calculator.available) {
                alert(`${calculator.name} manual pricing is coming soon!`);
                return;
            }

            currentManualCalculatorType = calculatorType;
            currentManualCalculatorUrl = calculator.url;

            document.getElementById('modalCalculatorName').textContent = calculator.name;
            document.getElementById('manualCostInput').value = '';
            document.getElementById('manualCostError').style.display = 'none';
            document.getElementById('manualPricingModal').style.display = 'flex';

            setTimeout(() => {
                document.getElementById('manualCostInput').focus();
            }, 100);
        }

        function closeManualPricingModal() {
            document.getElementById('manualPricingModal').style.display = 'none';
            currentManualCalculatorType = '';
            currentManualCalculatorUrl = '';
        }

        function openManualPricingWithCost() {
            const costInput = document.getElementById('manualCostInput');
            const cost = parseFloat(costInput.value);
            const errorDiv = document.getElementById('manualCostError');
            const errorText = document.getElementById('manualCostErrorText');

            if (isNaN(cost) || cost <= 0) {
                errorText.textContent = 'Please enter a valid cost greater than $0';
                errorDiv.style.display = 'block';
                costInput.focus();
                return;
            }

            if (cost > 1000) {
                errorText.textContent = 'Cost seems unusually high. Please verify the amount.';
                errorDiv.style.display = 'block';
                costInput.focus();
                return;
            }

            const url = `${currentManualCalculatorUrl}?manualCost=${cost.toFixed(2)}`;
            window.location.href = url;
            closeManualPricingModal();
        }

        // Close manual pricing modal when clicking outside
        document.getElementById('manualPricingModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeManualPricingModal();
            }
        });

        // =====================================================
        // CELEBRATION DROPDOWN FUNCTIONS
        // =====================================================

        function toggleCelebrationDropdown(type, event) {
            event.stopPropagation();
            const dropdown = document.getElementById(type + 'Dropdown');
            const allDropdowns = document.querySelectorAll('.celebration-dropdown');

            // Close all other dropdowns
            allDropdowns.forEach(dd => {
                if (dd.id !== type + 'Dropdown') {
                    dd.classList.remove('open');
                }
            });

            // Toggle the clicked dropdown
            if (dropdown) {
                dropdown.classList.toggle('open');
            }
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.celebration-item')) {
                document.querySelectorAll('.celebration-dropdown').forEach(dd => {
                    dd.classList.remove('open');
                });
            }
        });

        // =====================================================
        // STAFF DIRECTORY FUNCTIONS
        // =====================================================

        let currentStaffFilter = 'all';

        function showStaffDirectory(filter = 'all') {
            currentStaffFilter = filter;
            const modal = document.getElementById('staffDirectoryModal');
            if (modal) {
                modal.classList.add('open');
                document.body.style.overflow = 'hidden';
                filterStaffDirectory(filter);

                // Update active filter button
                document.querySelectorAll('.staff-filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.textContent.toLowerCase().includes(filter) ||
                        (filter === 'all' && btn.textContent === 'All Staff')) {
                        btn.classList.add('active');
                    }
                });
            }

            // Close celebration dropdowns
            document.querySelectorAll('.celebration-dropdown').forEach(dd => {
                dd.classList.remove('open');
            });
        }

        function closeStaffDirectory(event) {
            if (event && event.target !== event.currentTarget) return;
            const modal = document.getElementById('staffDirectoryModal');
            if (modal) {
                modal.classList.remove('open');
                document.body.style.overflow = '';
            }
        }

        function filterStaffDirectory(filter) {
            currentStaffFilter = filter;
            const tbody = document.getElementById('staffTableBody');
            if (!tbody || !window.StaffDashboardEmployees) return;

            // Update filter buttons
            document.querySelectorAll('.staff-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target?.classList.add('active');

            let employees = StaffDashboardEmployees.getAllEmployeesForDirectory();

            // Apply filter
            if (filter === 'active') {
                employees = employees.filter(emp => emp.status.type === 'active');
            } else if (filter === 'birthdays') {
                const upcoming = StaffDashboardEmployees.getUpcomingBirthdays(30);
                const upcomingNames = upcoming.map(e => e.firstName + ' ' + e.lastName);
                employees = employees.filter(emp => upcomingNames.includes(emp.fullName));
            } else if (filter === 'anniversaries') {
                const upcoming = StaffDashboardEmployees.getUpcomingAnniversaries(30);
                const upcomingNames = upcoming.map(e => e.firstName + ' ' + e.lastName);
                employees = employees.filter(emp => upcomingNames.includes(emp.fullName));
            }

            // Render table
            tbody.innerHTML = employees.map(emp => {
                const statusClass = emp.status.type === 'active' ? 'status-active' :
                    emp.status.type === 'leaving' ? 'status-leaving' : 'status-former';
                return `
                    <tr class="${emp.status.type === 'former' ? 'row-former' : ''}">
                        <td><strong>${emp.fullName}</strong></td>
                        <td>${emp.position}</td>
                        <td>${emp.formattedStartDate}</td>
                        <td>${emp.yearsOfService}</td>
                        <td>${emp.formattedBirthday}</td>
                        <td><span class="status-badge ${statusClass}">${emp.status.label}</span></td>
                    </tr>
                `;
            }).join('');

            if (employees.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-message">No employees match the current filter.</td></tr>';
            }
        }

        // Close modals on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeStaffDirectory();
                const manualModal = document.getElementById('manualPricingModal');
                if (manualModal && manualModal.style.display === 'flex') {
                    closeManualPricingModal();
                }
            }
        });
    </script>
</body>
</html>
