<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Bundle Size Upcharge Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #dc2626;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        button {
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #059669;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f3f4f6;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { color: #16a34a; }
        .error { color: #dc2626; }
        .info { color: #2563eb; }
        .upcharge {
            color: #f59e0b;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 8px 12px;
            text-align: left;
            border: 1px solid #e5e7eb;
        }
        th {
            background: #f9fafb;
            font-weight: bold;
        }
        .price-increase {
            background: #fef3c7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ„ Christmas Bundle Size Upcharge Tester</h1>

        <div class="test-section">
            <h2>Test Size Upcharges</h2>
            <p>Click to fetch and display size upcharges for all Christmas bundle products:</p>
            <button onclick="testSizeUpcharges()">Test Size Upcharges</button>
            <div id="upchargeResults" class="results"></div>
        </div>

        <div class="test-section">
            <h2>Value Calculation Test</h2>
            <p>Test retail value calculations with size upcharges:</p>
            <button onclick="testValueCalculations()">Test Value Calculations</button>
            <div id="valueResults" class="results"></div>
        </div>

        <div class="test-section">
            <h2>Live Page Test</h2>
            <p>Open the Christmas bundle page and test selecting different sizes:</p>
            <button onclick="window.open('/christmas-bundles.html', '_blank')">Open Christmas Bundle Page</button>
            <p style="margin-top: 10px; color: #6b7280;">
                Instructions: Select different sizes (2XL, 3XL, 4XL) and watch the value displays update.
                Open browser console to see detailed logging.
            </p>
        </div>
    </div>

    <script>
        const API_BASE = 'https://caspio-pricing-proxy-ab30a049961a.herokuapp.com';

        // Product styles to test
        const PRODUCTS = {
            jackets: [
                { style: 'CT104670', name: 'Storm Defender', basePrice: 174 },
                { style: 'CT100617', name: 'Rain Defender', basePrice: 92 },
                { style: 'CT103828', name: 'Detroit', basePrice: 137 }
            ],
            hoodies: [
                { style: 'F281', name: 'Hoodie', basePrice: 58 }
            ]
        };

        async function fetchSizeUpcharges(styleNumber) {
            try {
                const response = await fetch(`${API_BASE}/api/size-pricing?styleNumber=${styleNumber}`);
                if (!response.ok) return null;

                const data = await response.json();
                if (data && data.length > 0) {
                    return data[0].sizeUpcharges || {};
                }
                return null;
            } catch (error) {
                console.error(`Error fetching ${styleNumber}:`, error);
                return null;
            }
        }

        async function testSizeUpcharges() {
            const resultsDiv = document.getElementById('upchargeResults');
            resultsDiv.innerHTML = '<span class="info">Fetching size upcharges...</span>\n\n';

            for (const [category, products] of Object.entries(PRODUCTS)) {
                resultsDiv.innerHTML += `<strong>${category.toUpperCase()}:</strong>\n`;

                for (const product of products) {
                    const upcharges = await fetchSizeUpcharges(product.style);

                    if (upcharges) {
                        resultsDiv.innerHTML += `\n<span class="success">âœ“ ${product.style} - ${product.name}:</span>\n`;

                        // Create a table for this product
                        let tableHTML = '<table><tr><th>Size</th><th>Upcharge</th><th>Total Value</th></tr>';

                        // Standard sizes
                        ['S', 'M', 'L', 'XL'].forEach(size => {
                            const upcharge = upcharges[size] || 0;
                            tableHTML += `<tr>
                                <td>${size}</td>
                                <td>$${upcharge}</td>
                                <td>$${product.basePrice + upcharge}</td>
                            </tr>`;
                        });

                        // Larger sizes with upcharges
                        ['2XL', '3XL', '4XL', '5XL'].forEach(size => {
                            const upcharge = upcharges[size];
                            if (upcharge !== undefined) {
                                tableHTML += `<tr class="price-increase">
                                    <td>${size}</td>
                                    <td class="upcharge">+$${upcharge}</td>
                                    <td><strong>$${product.basePrice + upcharge}</strong></td>
                                </tr>`;
                            }
                        });

                        tableHTML += '</table>';
                        resultsDiv.innerHTML += tableHTML;
                    } else {
                        resultsDiv.innerHTML += `\n<span class="error">âœ— ${product.style} - Failed to fetch upcharges</span>\n`;
                    }
                }
                resultsDiv.innerHTML += '\n';
            }
        }

        async function testValueCalculations() {
            const resultsDiv = document.getElementById('valueResults');
            resultsDiv.innerHTML = '<span class="info">Testing value calculations...</span>\n\n';

            // Test scenarios
            const scenarios = [
                {
                    name: 'Rain Defender Bundle - Size 2XL',
                    items: [
                        { type: 'jacket', style: 'CT100617', size: '2XL', basePrice: 92 },
                        { type: 'hoodie', style: 'F281', size: '2XL', basePrice: 58 },
                        { type: 'beanie', style: 'CT104597', size: 'OSFA', basePrice: 35 },
                        { type: 'gloves', style: 'CTGD0794', size: 'L', basePrice: 19 }
                    ],
                    giftBox: 9,
                    shipping: 25
                },
                {
                    name: 'Storm Defender Bundle - Size 4XL',
                    items: [
                        { type: 'jacket', style: 'CT104670', size: '4XL', basePrice: 174 },
                        { type: 'hoodie', style: 'F281', size: '4XL', basePrice: 58 },
                        { type: 'beanie', style: 'CT104597', size: 'OSFA', basePrice: 35 },
                        { type: 'gloves', style: 'CTGD0794', size: 'XL', basePrice: 19 }
                    ],
                    giftBox: 9,
                    shipping: 25
                }
            ];

            for (const scenario of scenarios) {
                resultsDiv.innerHTML += `<strong>${scenario.name}:</strong>\n\n`;

                let totalValue = 0;

                for (const item of scenario.items) {
                    const upcharges = await fetchSizeUpcharges(item.style);
                    const upcharge = upcharges ? (upcharges[item.size] || 0) : 0;
                    const itemValue = item.basePrice + upcharge;
                    totalValue += itemValue;

                    resultsDiv.innerHTML += `  ${item.type}: $${item.basePrice}`;
                    if (upcharge > 0) {
                        resultsDiv.innerHTML += ` <span class="upcharge">+ $${upcharge} (${item.size})</span>`;
                    }
                    resultsDiv.innerHTML += ` = $${itemValue}\n`;
                }

                totalValue += scenario.giftBox;
                totalValue += scenario.shipping;

                resultsDiv.innerHTML += `  Gift Box: $${scenario.giftBox}\n`;
                resultsDiv.innerHTML += `  Shipping: $${scenario.shipping}\n`;
                resultsDiv.innerHTML += `  <strong>Total Value: $${totalValue}</strong>\n\n`;
            }

            resultsDiv.innerHTML += '<span class="success">âœ“ All calculations complete!</span>';
        }
    </script>
</body>
</html>