# ShopWorks EDP Integration & Pricing Synchronization Guide

**Last Updated:** 2025-10-25
**Purpose:** Complete guide for maintaining pricing synchronization across Quote Builder, ShopWorks Guide, and EDP import
**Applies To:** Screen Print, DTG, Embroidery, and Cap Embroidery quote builders

---

## 📋 Table of Contents

1. [Overview & Purpose](#overview--purpose)
2. [Three-System Architecture](#three-system-architecture)
3. [Key Components](#key-components)
4. [The SizesPricing Pattern](#the-sizespricing-pattern)
5. [Problems & Solutions](#problems--solutions)
6. [Implementation Details](#implementation-details)
7. [Verification Checklist](#verification-checklist)
8. [Applying to Other Quote Builders](#applying-to-other-quote-builders)
9. [Testing & Debugging](#testing--debugging)
10. [Reference Implementation](#reference-implementation)
11. [CATALOG_COLOR Implementation](#catalog_color-implementation)

---

## Overview & Purpose

### What is ShopWorks EDP Integration?

ShopWorks is a production management system used by NWCA for order processing. The **EDP (Electronic Data Processing)** format is a text-based import format that allows quotes to be imported directly into ShopWorks from our quote builders.

### Why Pricing Synchronization is Critical

When a customer quote is generated, the pricing MUST match exactly across three systems:

1. **Quote Builder Order Summary** - What the customer sees
2. **ShopWorks Data Entry Guide** - PDF given to production team
3. **ShopWorks EDP Import** - Data imported into production system

**If these don't match:**
- Production team enters wrong prices
- Customer gets billed incorrectly
- Margins are calculated wrong
- Trust is lost

### The "Source of Truth" Hierarchy

```
Quote Builder Order Summary (Size & Options Breakdown)
           ↓
    Source of Truth
           ↓
    ┌──────┴──────┐
    ↓             ↓
ShopWorks      EDP Import
Guide (PDF)    (Text File)
```

**The Order Summary breakdown is ALWAYS correct** - it shows exactly what pricing calculations produced. All other outputs must match this.

---

## Three-System Architecture

### System 1: Quote Builder Order Summary

**File:** `quote-builders/screenprint-quote-builder.html` (or dtg, embroidery, cap)

**Purpose:** User-facing quote generation with real-time pricing

**Key Features:**
- Displays per-size pricing breakdown
- Shows all price components (base + safety stripes + additional locations + LTM fee)
- Provides detailed transparency to customer

**Example Output:**
```
PC54 - Heather Royal
Size Distribution:
S/M/L/XL: (25 total)
$16.00 + $4.00 safety + $14.50 add'l locations + $0.89 Small Batch Fee = $35.39/pc
```

### System 2: ShopWorks Data Entry Guide

**Generated By:** `screenprint-shopworks-guide-generator.js`

**Purpose:** Printable PDF for production team data entry

**Key Features:**
- Line-by-line breakdown for ShopWorks
- Setup charge (SPSU) on line 1
- Standard sizes grouped on one line
- Oversizes get individual lines with suffix (_2X, _3X, etc.)

**Example Output:**
```
Line | Part Number | Manual Price | Sizes
-----|-------------|--------------|------------------
1    | SPSU        | $30.00       | 11 setups
2    | PC54        | $35.39       | S:3 M:12 L:3 XL:7
3    | PC54_2X     | $37.39       | 2XL:7
```

### System 3: ShopWorks EDP Import

**Generated By:** `shopworks-edp-generator.js`

**Purpose:** Text file that can be imported directly into ShopWorks

**Key Features:**
- Structured text format with field delimiters
- Each product is a separate `---- Start Product ----` block
- Prices stored in `cur_UnitPriceUserEntered` field
- Sizes mapped to ShopWorks size columns (Size01_Req, Size02_Req, etc.)

**Example Output:**
```
---- Start Product ----
PartNumber>> PC54
cur_UnitPriceUserEntered>> 35.39
Size01_Req>> 3
Size02_Req>> 12
Size03_Req>> 3
Size04_Req>> 7
---- End Product ----
```

### Data Flow Diagram

```
User Creates Quote
       ↓
calculateProductPricing()
       ↓
   sizesPricing object created
   {S: 35.39, M: 35.39, L: 35.39, XL: 35.39, 2XL: 37.39, ...}
       ↓
   ┌──────────────┴──────────────┐
   ↓                             ↓
Order Summary               Product data prepared
(Display to user)           with SizesPricing attached
   ↓                             ↓
                    ┌────────────┴────────────┐
                    ↓                         ↓
          ShopWorks Guide Generator    EDP Generator
                    ↓                         ↓
              Uses SizesPricing         Uses SizesPricing
              for manual prices         for unit prices
                    ↓                         ↓
                 PDF Export              Text Export
```

---

## Key Components

### Component 1: Quote Builder HTML

**File:** `quote-builders/screenprint-quote-builder.html`

**Key Functions:**

#### `calculateProductPricing(product, quantity)`
**Location:** Lines 3043-3158
**Purpose:** Calculate per-size pricing including all components

**What It Does:**
1. Gets base garment price for each size
2. Adds safety stripes surcharge per location ($2/location)
3. Creates `sizesPricing` object with per-size totals
4. Calculates additional locations cost separately
5. Returns complete pricing structure

**Critical Output:**
```javascript
{
  sizesPricing: {
    S: { quantity: 3, basePrice: 16.00, safetyStripesPerPiece: 4.00, unitPrice: 20.00, subtotal: 60.00 },
    M: { quantity: 12, basePrice: 16.00, safetyStripesPerPiece: 4.00, unitPrice: 20.00, subtotal: 240.00 },
    // ...
  },
  additionalCost: 14.50,  // Per-piece cost for back + left-sleeve
  perShirtTotal: 34.50    // Average across all sizes (base + safety + additional)
}
```

#### ShopWorks Guide Generation Section
**Location:** Lines 3490-3527
**Purpose:** Extract size-specific pricing for ShopWorks output

**Critical Code:**
```javascript
// IMPORTANT: Include additional locations cost + LTM impact for complete pricing
const sizesPricing = {};
const ltmImpact = this.currentPricing?.ltmImpactPerShirt || 0;
const additionalCostPerPiece = pricingMatch?.additionalCost || 0;

if (pricingMatch && pricingMatch.sizesPricing) {
    Object.entries(pricingMatch.sizesPricing).forEach(([size, priceData]) => {
        // Complete price = base + safety stripes + additional locations + LTM
        const completePrice = priceData.unitPrice + additionalCostPerPiece + ltmImpact;
        sizesPricing[size] = completePrice;
    });
}
```

**Why This Matters:**
- `priceData.unitPrice` = base garment + safety stripes ONLY
- Must add `additionalCostPerPiece` (back, sleeves, etc.)
- Must add `ltmImpact` (Small Batch Fee distributed per piece)
- Result: Complete final price matching Order Summary

#### Product Data Structure
**Location:** Lines 3508-3524
**Purpose:** Package all data for ShopWorks generators

**Key Fields:**
```javascript
const productForShopWorks = {
    StyleNumber: product.styleNumber,
    ProductName: product.productName,
    Color: product.color,
    SizeBreakdown: sizeBreakdown,        // {S: 3, M: 12, L: 3, XL: 7, ...}
    Quantity: totalQuantity,              // 33
    BaseUnitPrice: baseUnitPrice,         // 35.015 (average without LTM)
    FinalUnitPrice: finalUnitPrice,       // 35.908 (average WITH LTM)
    LineTotal: lineTotal,                 // 1184.96
    PrintLocations: printLocations,       // [{name: "back", colors: 3}, ...]
    SizesPricing: sizesPricing           // {S: 35.39, M: 35.39, ...} ← CRITICAL
};
```

**SizesPricing is the SOURCE OF TRUTH** - Contains already-correct final prices for each size.

### Component 2: Base Generator Class

**File:** `shared_components/js/shopworks-guide-generator.js`

**Purpose:** Base class that converts quote data into ShopWorks line items

#### `parseQuoteIntoLineItems(products)`
**Location:** Lines 94-185
**Purpose:** Main parsing logic for all product types

**Key Pattern:**
1. Separates standard sizes (S/M/L/XL) from oversizes (2XL+)
2. Groups standard sizes into one line
3. Creates separate lines for each oversize with suffix

**Standard Sizes Logic:**
```javascript
// Line 1: Standard sizes grouped together
if (Object.keys(standardSizes).length > 0) {
    const totalStandardQty = Object.values(standardSizes).reduce((a, b) => a + b, 0);

    items.push({
        lineQty: totalStandardQty,
        partNumber: product.StyleNumber,
        sizes: this.formatSizesForShopWorks(standardSizes),
        manualPrice: this.getStandardSizePrice(standardSizes, product),  // ← Uses SizesPricing
        calcPrice: 'Off',
        lineTotal: this.calculateLineTotal(standardSizes, product)
    });
}
```

**Oversize Logic:**
```javascript
// Lines 2+: Each oversize gets its own line
Object.entries(oversizes).forEach(([size, qty]) => {
    const suffix = this.partNumberSuffixMap[size] || `_${size}`;

    items.push({
        lineQty: qty,
        partNumber: `${basePartNumber}${suffix}`,
        sizes: this.formatSizesForShopWorks({ [size]: qty }),
        manualPrice: this.getPriceForSize(size, product),  // ← Uses SizesPricing
        calcPrice: 'Off',
        lineTotal: qty * this.getPriceForSize(size, product)
    });
});
```

#### `getStandardSizePrice(standardSizes, product)`
**Location:** Lines 279-292
**Purpose:** Get price for standard sizes from SizesPricing

**Implementation:**
```javascript
getStandardSizePrice(standardSizes, product) {
    // Find first available standard size to get the price
    const firstSize = Object.keys(standardSizes).find(size => standardSizes[size] > 0);

    if (firstSize) {
        const price = this.getPriceForSize(firstSize, product);
        console.log(`[ShopWorksGuide] Using standard size price from ${firstSize}: $${price.toFixed(2)}`);
        return price;
    }

    // Fallback to FinalUnitPrice if no sizes found (shouldn't happen)
    console.warn('[ShopWorksGuide] No standard sizes found, falling back to FinalUnitPrice');
    return parseFloat(product.FinalUnitPrice || product.BaseUnitPrice || 0);
}
```

**Why This Works:**
- All standard sizes (S/M/L/XL) have the SAME price
- Picks any one (typically first) and gets its price from `SizesPricing`
- Avoids using weighted average `FinalUnitPrice`

#### `getPriceForSize(size, product)`
**Location:** Lines 269-278
**Purpose:** Get size-specific price with fallback

**Implementation:**
```javascript
getPriceForSize(size, product) {
    // First, check if size-specific pricing is available
    if (product.SizesPricing && product.SizesPricing[size]) {
        const sizePrice = parseFloat(product.SizesPricing[size]);
        console.log(`[ShopWorksGuide] Using size-specific price for ${size}: $${sizePrice.toFixed(2)}`);
        return sizePrice;
    }

    // Fall back to final price (includes LTM) if size-specific pricing not available
    const finalPrice = parseFloat(product.FinalUnitPrice || product.BaseUnitPrice || 0);
    console.log(`[ShopWorksGuide] Using final price for ${size}: $${finalPrice.toFixed(2)}`);
    return finalPrice;
}
```

**Priority Order:**
1. Try `product.SizesPricing[size]` ← Preferred (already-correct price)
2. Fall back to `product.FinalUnitPrice` ← Only if SizesPricing missing
3. Last resort: `product.BaseUnitPrice`

#### `calculateLineTotal(sizes, product)`
**Location:** Lines 245-267
**Purpose:** Calculate accurate line total using size-specific pricing

**Implementation:**
```javascript
calculateLineTotal(sizes, product) {
    // If we have size-specific pricing, calculate total by summing each size
    if (product.SizesPricing) {
        let total = 0;
        Object.entries(sizes).forEach(([size, qty]) => {
            const price = this.getPriceForSize(size, product);
            total += qty * price;
            console.log(`[ShopWorksGuide] Line total calculation for ${size}: ${qty} × $${price.toFixed(2)} = $${(qty * price).toFixed(2)}`);
        });
        console.log(`[ShopWorksGuide] Total line total: $${total.toFixed(2)}`);
        return total;
    }

    // Fallback to using average price if size-specific pricing not available
    const totalQty = Object.values(sizes).reduce((a, b) => a + b, 0);
    const price = parseFloat(product.FinalUnitPrice || product.BaseUnitPrice || 0);
    console.log(`[ShopWorksGuide] Using average price: ${totalQty} × $${price.toFixed(2)} = $${(totalQty * price).toFixed(2)}`);
    return totalQty * price;
}
```

**Why This Is Critical:**
- Standard sizes can have mixed size distribution (e.g., 3 S, 12 M, 3 L, 7 XL)
- All share same price ($35.39) but different quantities
- Total = (3 × $35.39) + (12 × $35.39) + (3 × $35.39) + (7 × $35.39) = $884.82
- More accurate than: 25 × $35.908 (weighted average) = $897.70

### Component 3: Screen Print Specific Generator

**File:** `shared_components/js/screenprint-shopworks-guide-generator.js`

**Purpose:** Adds screen print specific features to base generator

**Key Additions:**
1. **SPSU Line Item** - Setup charge as first line
2. **Enhanced Descriptions** - Adds print location details to descriptions

#### SPSU Setup Line
**Location:** Lines 51-84
**Purpose:** Calculate and add setup charge

**Pattern:**
```javascript
if (quoteData.TotalColors && quoteData.TotalColors > 0) {
    const setupCount = quoteData.TotalColors;
    const setupTotal = setupCount * 30;  // $30 per screen

    items.unshift({  // Add as FIRST line
        lineQty: setupCount,
        partNumber: 'SPSU',
        colorRange: '',
        color: '',
        description: `New Screen Set Up Charge: ${setupCount} colors (...)`,
        sizes: { 'S': setupCount },  // Quantity shows in S column
        manualPrice: 30.00,
        calcPrice: 'Off',
        lineTotal: setupTotal
    });
}
```

#### Enhanced Descriptions
**Location:** Lines 103-117
**Purpose:** Add print location details to product descriptions

**Example Transformation:**
```
BEFORE: Port & Co Core Cotton Tee. PC54
AFTER:  Port & Co Core Cotton Tee. PC54 + Front (4c + Safety Stripes) + back (4c + Safety Stripes) + left-sleeve (3c)
```

### Component 4: EDP Generator

**File:** `shared_components/js/shopworks-edp-generator.js`

**Purpose:** Convert ShopWorks line items to EDP text format

**Key Features:**
- Uses same line items from ShopWorks guide generator
- Transforms to ShopWorks import format
- Maps sizes to ShopWorks size columns
- Preserves all pricing from `manualPrice` field

**Size Mapping:**
```javascript
const sizeColumnMap = {
    'S': 'Size01_Req',
    'M': 'Size02_Req',
    'L': 'Size03_Req',
    'XL': 'Size04_Req',
    '2XL': 'Size05_Req',
    'XXL': 'Size05_Req',
    '3XL': 'Size06_Req',
    'XXXL': 'Size06_Req'
};
```

---

## The SizesPricing Pattern

### What is SizesPricing?

`SizesPricing` is a JavaScript object that contains the **already-calculated final price** for each individual size, including all components.

**Structure:**
```javascript
{
  "S": 35.39,    // Final price for Small (base + safety + add'l locations + LTM)
  "M": 35.39,    // Final price for Medium
  "L": 35.39,    // Final price for Large
  "XL": 35.39,   // Final price for Extra Large
  "2XL": 37.39,  // Final price for 2XL (includes $2 upcharge)
  "3XL": 38.39   // Final price for 3XL (includes $3 upcharge)
}
```

### Why It's the Source of Truth

`SizesPricing` contains prices that have ALREADY been calculated with:

✅ **Base Garment Cost** - From API (e.g., PC54 = $16.00 for S/M/L/XL)
✅ **Safety Stripes Surcharge** - $2/location × 2 locations = $4.00
✅ **Additional Locations Cost** - $7.50/location × 2 locations = $14.50
✅ **Small Batch Fee (LTM)** - $50 ÷ 56 pieces = $0.89/piece
✅ **Size Upcharges** - 2XL +$2.00, 3XL +$3.00, etc.

**No recalculation needed** - Just read the value!

### Size-Specific vs Weighted Average

#### ❌ Weighted Average (WRONG for standard sizes line)

```javascript
// WRONG APPROACH:
const FinalUnitPrice = TotalCost ÷ TotalPieces

// Example with mixed sizes:
// 25 standard @ $35.39 = $884.75
// 11 oversizes @ $37.39-$43.39 = $814.25
// Total: $1699 ÷ 40 pieces = $42.475

manualPrice: product.FinalUnitPrice  // $42.48 ← WRONG for standard sizes!
```

**Problem:** Standard sizes (S/M/L/XL) all cost $35.39 each, but weighted average is $42.48 because it includes expensive oversizes.

#### ✅ Size-Specific Pricing (CORRECT)

```javascript
// CORRECT APPROACH:
const manualPrice = product.SizesPricing['M']  // $35.39 ← Read directly!

// Or use helper:
const manualPrice = this.getStandardSizePrice(standardSizes, product)
```

**Why This Works:** `SizesPricing` has individual prices for each size. Since all standard sizes cost the same ($35.39), we can use any one.

### How SizesPricing is Built

**In Quote Builder** (`screenprint-quote-builder.html` lines 3490-3505):

```javascript
// 1. Extract size-specific pricing from calculation results
const sizesPricing = {};
const ltmImpact = 0.89;  // $50 ÷ 56 = $0.89/piece
const additionalCostPerPiece = 14.50;  // Back + left-sleeve

// 2. Loop through each size from calculation
Object.entries(pricingMatch.sizesPricing).forEach(([size, priceData]) => {
    // priceData.unitPrice = base ($16) + safety stripes ($4) = $20
    const completePrice = priceData.unitPrice + additionalCostPerPiece + ltmImpact;
    // completePrice = $20 + $14.50 + $0.89 = $35.39

    sizesPricing[size] = completePrice;
});

// 3. Attach to product
product.SizesPricing = sizesPricing;  // {S: 35.39, M: 35.39, ...}
```

**Result:** Every downstream system can now read `product.SizesPricing[size]` to get the correct final price!

---

## Problems & Solutions

### Problem #1: Missing Additional Locations Cost

#### The Issue

**Discovered:** 2025-10-25
**Symptom:** ShopWorks showed $28.73/pc, but Order Summary showed $28.50/pc

**Root Cause:**

In `screenprint-quote-builder.html` lines 3499 and 3617, the code was:
```javascript
const priceWithLTM = priceData.unitPrice + ltmImpact;
sizesPricing[size] = priceWithLTM;
```

**What was included:**
- ✅ Base garment cost ($16.00)
- ✅ Safety stripes ($4.00)
- ✅ LTM fee ($0.89)

**What was missing:**
- ❌ Additional locations cost ($7.50)

**Calculation:**
```
$16.00 (base) + $4.00 (safety) + $0.89 (LTM) = $20.89  ← Missing $7.50!
Should be: $16.00 + $4.00 + $7.50 + $0.89 = $28.39
```

#### The Fix

**Git Commit:** `c96bff3`

**Changes:**
```javascript
// BEFORE:
const priceWithLTM = priceData.unitPrice + ltmImpact;

// AFTER:
const additionalCostPerPiece = pricingMatch?.additionalCost || 0;
const completePrice = priceData.unitPrice + additionalCostPerPiece + ltmImpact;
```

**Applied to two locations:**
1. ShopWorks Guide generation (lines 3490-3508)
2. EDP generation (lines 3612-3620)

**Result:** ✅ All prices now included all components

### Problem #2: Standard Sizes Using Weighted Average

#### The Issue

**Discovered:** 2025-10-25
**Symptom:** ShopWorks showed $42.48/pc for standard sizes, but Order Summary showed $41.75/pc

**Discrepancy:** $0.73/piece ($42.48 - $41.75 = $0.73)

**Root Cause:**

In `shopworks-guide-generator.js` line 150:
```javascript
manualPrice: parseFloat(product.FinalUnitPrice || product.BaseUnitPrice || 0)
```

**What `FinalUnitPrice` represents:**
```
Total order cost ÷ Total pieces = Weighted average of ALL sizes

Example:
27 standard @ $41.75 = $1,127.25
11 oversizes @ $43.75 = $481.25
1 oversize @ $44.75 = $44.75
1 oversize @ $45.75 = $45.75
─────────────────────────────────
40 pieces total = $1,699.00

$1,699 ÷ 40 = $42.475 average
```

**The Problem:** Standard sizes (S/M/L/XL) actually cost $41.75 each, but `FinalUnitPrice` is pulling the average UP because of expensive oversizes.

**Oversizes were correct** because they used `getPriceForSize(size, product)` which reads from `SizesPricing`.

#### The Fix

**Git Commit:** `c0f9286`

**Change 1: Added `getStandardSizePrice()` method**

**Location:** `shopworks-guide-generator.js` lines 272-292

```javascript
/**
 * Get the price for standard sizes (S/M/L/XL)
 * Since all standard sizes have the same price, we can use any of them
 */
getStandardSizePrice(standardSizes, product) {
    // Find first available standard size to get the price
    const firstSize = Object.keys(standardSizes).find(size => standardSizes[size] > 0);

    if (firstSize) {
        const price = this.getPriceForSize(firstSize, product);
        console.log(`[ShopWorksGuide] Using standard size price from ${firstSize}: $${price.toFixed(2)}`);
        return price;
    }

    // Fallback to FinalUnitPrice if no sizes found (shouldn't happen)
    console.warn('[ShopWorksGuide] No standard sizes found, falling back to FinalUnitPrice');
    return parseFloat(product.FinalUnitPrice || product.BaseUnitPrice || 0);
}
```

**How it works:**
1. Finds first standard size with quantity > 0 (e.g., "M")
2. Calls `getPriceForSize("M", product)` → reads `product.SizesPricing["M"]`
3. Returns $41.75 (the correct price from source of truth)

**Change 2: Updated standard sizes line**

**Location:** Line 150

```javascript
// BEFORE:
manualPrice: parseFloat(product.FinalUnitPrice || product.BaseUnitPrice || 0)

// AFTER:
manualPrice: this.getStandardSizePrice(standardSizes, product)
```

**Change 3: Enhanced `calculateLineTotal()` for accuracy**

**Location:** Lines 245-267

```javascript
calculateLineTotal(sizes, product) {
    // If we have size-specific pricing, calculate total by summing each size
    if (product.SizesPricing) {
        let total = 0;
        Object.entries(sizes).forEach(([size, qty]) => {
            const price = this.getPriceForSize(size, product);
            total += qty * price;
            console.log(`[ShopWorksGuide] Line total calculation for ${size}: ${qty} × $${price.toFixed(2)} = $${(qty * price).toFixed(2)}`);
        });
        console.log(`[ShopWorksGuide] Total line total: $${total.toFixed(2)}`);
        return total;
    }

    // Fallback to using average price if size-specific pricing not available
    const totalQty = Object.values(sizes).reduce((a, b) => a + b, 0);
    const price = parseFloat(product.FinalUnitPrice || product.BaseUnitPrice || 0);
    return totalQty * price;
}
```

**Why this matters:**
- Calculates total as sum of (quantity × price) for each size individually
- More accurate than (total quantity) × (average price)
- Handles mixed size distributions correctly

**Result:** ✅ Standard sizes now show $41.75/pc (matching Order Summary exactly)

---

## Implementation Details

### Complete Implementation Flow

#### Step 1: Quote Builder Calculates Pricing

**File:** `screenprint-quote-builder.html`

```javascript
// Calculate base pricing for each size
const productPricing = calculateProductPricing(product, totalQuantity);

// Result structure:
{
  sizesPricing: {
    S: { unitPrice: 20.00, quantity: 3 },  // base + safety stripes
    M: { unitPrice: 20.00, quantity: 12 },
    // ...
  },
  additionalCost: 14.50,  // per-piece cost for additional locations
  perShirtTotal: 34.50    // average
}
```

#### Step 2: Add LTM Fee and Complete Pricing

```javascript
// Calculate LTM impact
const ltmFee = 50.00;  // Standard fee
const totalPieces = 56;
const ltmImpact = ltmFee / totalPieces;  // $0.89 per piece

// Build complete SizesPricing
const sizesPricing = {};
Object.entries(productPricing.sizesPricing).forEach(([size, priceData]) => {
    const completePrice = priceData.unitPrice + additionalCostPerPiece + ltmImpact;
    sizesPricing[size] = completePrice;
});

// Result:
// {S: 35.39, M: 35.39, L: 35.39, XL: 35.39, 2XL: 37.39, 3XL: 38.39}
```

#### Step 3: Attach to Product Data

```javascript
const productForShopWorks = {
    StyleNumber: 'PC54',
    Color: 'Heather Royal',
    SizeBreakdown: {S: 3, M: 12, L: 3, XL: 7, '2XL': 7, '3XL': 1},
    Quantity: 33,
    BaseUnitPrice: 35.015,     // Average without LTM
    FinalUnitPrice: 35.908,    // Average WITH LTM
    SizesPricing: sizesPricing  // ← THE SOURCE OF TRUTH
};
```

#### Step 4: Generator Extracts Prices

```javascript
// In shopworks-guide-generator.js

// For standard sizes line:
const standardPrice = this.getStandardSizePrice(standardSizes, product);
// → Reads product.SizesPricing['M'] → $35.39

// For oversize lines:
const oversizePrice = this.getPriceForSize('2XL', product);
// → Reads product.SizesPricing['2XL'] → $37.39
```

#### Step 5: Generate Outputs

**ShopWorks Guide:**
```
Line | Part Number | Manual Price
-----|-------------|-------------
2    | PC54        | $35.39       ← From getStandardSizePrice()
3    | PC54_2X     | $37.39       ← From getPriceForSize('2XL')
```

**EDP Text:**
```
---- Start Product ----
PartNumber>> PC54
cur_UnitPriceUserEntered>> 35.39  ← From manualPrice field
---- End Product ----
```

### Console Log Pattern

When system is working correctly, you'll see:

```javascript
[ShopWorksGuide] Using standard size price from S: $35.39
[ShopWorksGuide] Line total calculation for S: 3 × $35.39 = $106.18
[ShopWorksGuide] Line total calculation for M: 12 × $35.39 = $424.71
[ShopWorksGuide] Line total calculation for L: 3 × $35.39 = $106.18
[ShopWorksGuide] Line total calculation for XL: 7 × $35.39 = $247.75
[ShopWorksGuide] Total line total: $884.82

[ShopWorksGuide] Using size-specific price for 2XL: $37.39
[ShopWorksGuide] Using size-specific price for 3XL: $38.39
```

**Key Indicators:**
- ✅ "Using standard size price from [SIZE]" - Shows it's reading from SizesPricing
- ✅ Individual line total calculations - Shows per-size multiplication
- ✅ Prices match Order Summary exactly

**Red Flags:**
- ❌ "Using final price for [SIZE]" - Falling back to average (SizesPricing missing)
- ❌ "Using average price" in line total - Using weighted average instead of sum
- ❌ Prices don't match Order Summary

---

## Verification Checklist

Use this checklist every time you generate a quote to ensure pricing synchronization:

### ✅ Order Summary Verification

**Location:** Quote Builder "Review & Export" section

**Check:**
1. Each size shows complete breakdown:
   - Base garment cost
   - Safety stripes (if applicable)
   - Additional locations (if applicable)
   - Small Batch Fee
   - **Final price per piece**

2. Prices make logical sense:
   - Standard sizes should all have same price
   - Oversizes should be higher (base garment upcharge)
   - Final price = sum of all components

**Example:**
```
S/M/L/XL: $16.00 + $4.00 + $14.50 + $0.89 = $35.39/pc ✓
2XL: $18.00 + $4.00 + $14.50 + $0.89 = $37.39/pc ✓
```

### ✅ ShopWorks Guide Verification

**Location:** PDF popup window

**Check:**
1. **SPSU Line (Line 1):**
   - Correct number of colors/screens
   - $30.00 per screen
   - Total = screens × $30

2. **Standard Sizes Line:**
   - Part Number = base style (e.g., PC54)
   - Manual Price matches Order Summary standard size price EXACTLY
   - Size distribution correct (S:3 M:12 L:3 XL:7)
   - Line Total = sum of (qty × price) for each size

3. **Oversize Lines:**
   - Part Number has suffix (PC54_2X, PC54_3X, etc.)
   - Manual Price matches Order Summary oversize price EXACTLY
   - Quantities correct
   - Line Total = qty × price

4. **Calc. Price Column:**
   - Should show "Off" for all lines (manual pricing mode)

**Example Verification:**
```
Order Summary shows: S/M/L/XL @ $35.39/pc
ShopWorks Guide Line 2: PC54 | $35.39 | S:3 M:12 L:3 XL:7
✓ MATCH

Order Summary shows: 2XL @ $37.39/pc
ShopWorks Guide Line 3: PC54_2X | $37.39 | 2XL:7
✓ MATCH
```

### ✅ EDP Import Verification

**Location:** Text file popup or console output

**Check:**
1. **Each Product Block:**
   - `PartNumber` matches ShopWorks Guide
   - `cur_UnitPriceUserEntered` matches ShopWorks Manual Price EXACTLY
   - Size columns (Size01_Req, etc.) match quantity distribution
   - `PartDescription` includes print location details

**Example Verification:**
```
ShopWorks Guide: PC54 | $35.39
EDP Text: cur_UnitPriceUserEntered>> 35.39
✓ MATCH

ShopWorks Guide: PC54_2X | $37.39
EDP Text: cur_UnitPriceUserEntered>> 37.39
✓ MATCH
```

### ✅ ShopWorks Import Verification

**Location:** ShopWorks application after importing EDP file

**Check:**
1. All line items imported correctly
2. Manual Price column matches EDP values
3. Size distribution matches
4. Calc. Price shows "Off"
5. **Subtotal matches Order Summary grand total** (within $0.20 due to penny rounding)

**Acceptable Rounding:**
- Individual line totals: Within $0.01-0.02 per line
- Grand total: Within $0.10-0.20 total

**Example:**
```
Order Summary Total: $2394.00
ShopWorks Import Subtotal: $2393.84
Difference: $0.16 ✓ ACCEPTABLE (penny rounding across 10 lines)
```

### ✅ Console Log Verification

**Location:** Browser Developer Tools (F12) → Console tab

**Check for these log patterns:**

```javascript
✓ [ShopWorksGuide] Using standard size price from S: $35.39
✓ [ShopWorksGuide] Using size-specific price for 2XL: $37.39
✓ [ShopWorksGuide] Line total calculation for S: 3 × $35.39 = $106.18
```

**Red flags:**
```javascript
✗ [ShopWorksGuide] Using final price for M: $42.48
✗ [ShopWorksGuide] Using average price: 25 × $42.48 = $1062.00
```

### 🚨 Common Discrepancies

| Issue | Order Summary | ShopWorks | Likely Cause |
|-------|---------------|-----------|--------------|
| Missing add'l locations | $41.75 | $27.25 | additionalCostPerPiece not included |
| Using weighted average | $41.75 | $42.48 | FinalUnitPrice instead of SizesPricing |
| Missing LTM fee | $41.75 | $40.86 | ltmImpact not added |
| Wrong oversize upcharge | $43.75 | $41.75 | Size-specific price not extracted |

---

## Applying to Other Quote Builders

The same pricing synchronization pattern can be applied to:
- DTG Quote Builder
- Embroidery Quote Builder
- Cap Embroidery Quote Builder

### Universal Pattern

All quote builders follow this structure:

#### 1. Build SizesPricing Object

**In Quote Builder HTML:**
```javascript
// Calculate pricing for each size
const sizesPricing = {};

Object.entries(calculatedPricing.sizesPricing).forEach(([size, priceData]) => {
    // Add all components
    let finalPrice = priceData.unitPrice;  // Base + primary decoration

    if (hasAdditionalLocations) {
        finalPrice += additionalCostPerPiece;
    }

    if (hasLTMFee) {
        finalPrice += ltmImpact;
    }

    sizesPricing[size] = finalPrice;
});

// Attach to product
product.SizesPricing = sizesPricing;
```

#### 2. Pass to ShopWorks Generator

```javascript
const productForShopWorks = {
    // ... other fields
    SizesPricing: sizesPricing  // Always include this
};

// Generate guide
const guide = new ShopWorksGuideGenerator();
const lineItems = guide.parseQuoteIntoLineItems([productForShopWorks]);
```

#### 3. Generator Uses SizesPricing

**Base generator (shopworks-guide-generator.js) already has:**
- `getStandardSizePrice()` - Reads from SizesPricing for standard sizes
- `getPriceForSize()` - Reads from SizesPricing for any size
- `calculateLineTotal()` - Sums individual (qty × price) when SizesPricing available

**No changes needed to generator classes!**

### DTG Quote Builder Adaptation

**File:** `quote-builders/dtg-quote-builder.html`

**Key Differences:**
- DTG uses single location pricing (not Front + additional)
- Combo locations (LC_FB, FF_FB) sum two locations
- Size upcharges applied to base garment cost

**Implementation:**
```javascript
// DTG pricing includes everything in one calculation
const sizesPricing = {};
const ltmImpact = ltmFee / totalQuantity;

Object.entries(dtgPricing.sizesPricing).forEach(([size, priceData]) => {
    // DTG priceData.unitPrice already includes:
    // - Base garment with margin
    // - Print cost for selected location
    // - Combo location costs if applicable

    const finalPrice = priceData.unitPrice + ltmImpact;
    sizesPricing[size] = finalPrice;
});

product.SizesPricing = sizesPricing;
```

**Verification:**
```
DTG Left Chest + Full Back (combo):
Base: $5.70 + Print LC: $6.00 + Print FB: $8.00 = $19.70
Add LTM: $19.70 + $2.08 = $21.78/pc

SizesPricing: {S: 21.78, M: 21.78, ...}
ShopWorks: Should show $21.78 for standard sizes line
```

### Embroidery Quote Builder Adaptation

**File:** `quote-builders/embroidery-quote-builder.html`

**Key Differences:**
- Embroidery uses stitch count tiers
- No safety stripes
- Setup based on stitch count, not colors

**Implementation:**
```javascript
const sizesPricing = {};
const ltmImpact = ltmFee / totalQuantity;

Object.entries(embPricing.sizesPricing).forEach(([size, priceData]) => {
    // Embroidery priceData.unitPrice includes:
    // - Base garment with margin
    // - Embroidery cost based on stitch count
    // - Additional location costs if multiple locations

    const finalPrice = priceData.unitPrice + ltmImpact;
    sizesPricing[size] = finalPrice;
});

product.SizesPricing = sizesPricing;
```

### Cap Embroidery Quote Builder Adaptation

**File:** `quote-builders/cap-embroidery-quote-builder.html`

**Key Differences:**
- Caps don't have size distribution (one size fits most)
- May have structured vs unstructured variants
- Can have 3D puff embroidery option

**Implementation:**
```javascript
// For caps, SizesPricing might have just one entry
const sizesPricing = {
    'OS': finalCapPrice  // One Size
};

// Or if tracking structured/unstructured:
const sizesPricing = {
    'STR': structuredPrice,   // Structured
    'UNS': unstructuredPrice  // Unstructured
};

product.SizesPricing = sizesPricing;
```

### Checklist for Adapting Other Builders

- [ ] Identify where pricing is calculated (usually `calculateProductPricing()` function)
- [ ] Ensure all cost components are included in calculation
- [ ] Build `SizesPricing` object with complete final prices
- [ ] Calculate LTM impact and add to each size
- [ ] Attach `SizesPricing` to product object before passing to generator
- [ ] Test with complex quote (multiple sizes, additional locations, LTM fee)
- [ ] Verify console logs show "Using size-specific price"
- [ ] Compare Order Summary vs ShopWorks Guide vs EDP import

---

## Testing & Debugging

### Browser Console Commands

Open Developer Tools (F12) and use these commands:

#### Check SizesPricing Object

```javascript
// View current pricing data
console.log(window.screenPrintQuoteBuilder.currentPricing);

// Check specific product's SizesPricing
const products = window.screenPrintQuoteBuilder.currentPricing.productPricing;
console.table(products[0].sizesPricing);
```

#### Test Generator Directly

```javascript
// Get generator instance
const generator = new ShopWorksGuideGenerator();

// Test with sample product
const testProduct = {
    StyleNumber: 'PC54',
    SizeBreakdown: {S: 3, M: 12, L: 3, XL: 7, '2XL': 7},
    SizesPricing: {S: 35.39, M: 35.39, L: 35.39, XL: 35.39, '2XL': 37.39}
};

const lineItems = generator.parseQuoteIntoLineItems([testProduct]);
console.table(lineItems);
```

#### Verify Price Extraction

```javascript
// Test getStandardSizePrice
const generator = new ShopWorksGuideGenerator();
const price = generator.getStandardSizePrice(
    {S: 3, M: 12},
    {SizesPricing: {S: 35.39, M: 35.39}}
);
console.log('Standard price:', price);  // Should be 35.39

// Test getPriceForSize
const oversizePrice = generator.getPriceForSize('2XL', {
    SizesPricing: {'2XL': 37.39}
});
console.log('2XL price:', oversizePrice);  // Should be 37.39
```

### Debugging Pricing Discrepancies

#### Step 1: Identify Which Component is Wrong

```javascript
// Check Order Summary calculation
console.log('Base:', basePrice);
console.log('Safety Stripes:', safetyStripesTotal);
console.log('Additional Locations:', additionalLocationsTotal);
console.log('LTM Fee:', ltmFee);
console.log('Expected Total:', basePrice + safetyStripesTotal + additionalLocationsTotal + ltmFee);
```

#### Step 2: Check SizesPricing Was Built

```javascript
// After quote generation
const product = screenPrintQuoteBuilder.currentPricing.productPricing[0];
console.log('Has SizesPricing?', !!product.SizesPricing);
console.log('SizesPricing:', product.SizesPricing);
```

#### Step 3: Verify Generator Reads SizesPricing

Look for console logs:
```
[ShopWorksGuide] Using standard size price from M: $35.39  ← Good
[ShopWorksGuide] Using final price for M: $42.48  ← Bad (falling back)
```

If seeing "Using final price", check:
1. Is `product.SizesPricing` defined?
2. Does it have the size key? (`product.SizesPricing['M']`)
3. Is the value a number? (not string or object)

#### Step 4: Compare Calculation Methods

```javascript
// Method 1: Weighted average (WRONG for standard sizes)
const totalCost = products.reduce((sum, p) => sum + p.lineTotal, 0);
const totalQty = products.reduce((sum, p) => sum + p.quantity, 0);
const averagePrice = totalCost / totalQty;
console.log('Average price:', averagePrice);

// Method 2: Size-specific (CORRECT)
const standardSizes = {S: 3, M: 12, L: 3, XL: 7};
const pricePerSize = 35.39;
const total = Object.values(standardSizes).reduce((sum, qty) => sum + (qty * pricePerSize), 0);
console.log('Size-specific total:', total);
console.log('Difference:', Math.abs(total - (25 * averagePrice)));
```

### Common Issues & Fixes

#### Issue: "SizesPricing is undefined"

**Cause:** Quote builder didn't attach SizesPricing to product

**Fix:**
```javascript
// In quote builder, after calculating pricing:
product.SizesPricing = sizesPricing;  // Make sure this line exists!
```

#### Issue: Prices in SizesPricing are objects, not numbers

**Cause:** Passing entire priceData object instead of just the price

**Bad:**
```javascript
sizesPricing[size] = priceData;  // Object: {unitPrice: 35.39, quantity: 3, ...}
```

**Good:**
```javascript
sizesPricing[size] = priceData.unitPrice + additionalCost + ltmImpact;  // Number: 35.39
```

#### Issue: Console shows "Using final price" instead of "Using size-specific price"

**Cause:** SizesPricing exists but doesn't have the specific size

**Debug:**
```javascript
console.log('Available sizes in SizesPricing:', Object.keys(product.SizesPricing));
console.log('Trying to get size:', size);
console.log('Size exists?', size in product.SizesPricing);
```

**Common cause:** Size naming mismatch (e.g., "XXL" vs "2XL")

#### Issue: Line totals don't sum to grand total

**Cause:** Penny rounding accumulation

**This is normal!** Each line rounds to 2 decimals, so:
```
Line 1: 3 × $35.39 = $106.17 (actually $106.17)
Line 2: 12 × $35.39 = $424.68 (actually $424.68)
Sum: $530.85
Actual: 15 × $35.39 = $530.85
Difference: $0.00 ← Perfect

BUT across 10+ lines, can accumulate to $0.10-0.20 difference.
This is ACCEPTABLE and EXPECTED.
```

---

## Reference Implementation

### Git Commits

#### Commit 1: c96bff3 - Include additional locations cost
**Date:** 2025-10-25
**Files Modified:** `screenprint-quote-builder.html`
**Lines Changed:** 3490-3508, 3612-3620

**What Changed:**
```javascript
// Added extraction of additional locations cost
const additionalCostPerPiece = pricingMatch?.additionalCost || 0;

// Updated calculation to include all components
const completePrice = priceData.unitPrice + additionalCostPerPiece + ltmImpact;
```

**Impact:** Fixed $7.50 discrepancy where additional locations were missing

#### Commit 2: c0f9286 - Use size-specific pricing for standard sizes
**Date:** 2025-10-25
**Files Modified:** `shopworks-guide-generator.js`
**Lines Changed:** 150, 245-267, 272-292

**What Changed:**
1. Added `getStandardSizePrice()` method
2. Updated line 150 to use new method instead of FinalUnitPrice
3. Enhanced `calculateLineTotal()` to sum individual (qty × price)

**Impact:** Fixed $0.73 discrepancy where standard sizes were using weighted average

### Before & After Examples

#### Example 1: Screen Print with Additional Locations

**Before Fix (c96bff3):**
```
Order Summary: $28.50/pc
ShopWorks: $28.73/pc
Discrepancy: $0.23
```

**After Fix:**
```
Order Summary: $28.50/pc
ShopWorks: $28.50/pc
Discrepancy: $0.00 ✓
```

#### Example 2: Mixed Size Order

**Before Fix (c0f9286):**
```
Order Summary S/M/L/XL: $41.75/pc
ShopWorks Standard Line: $42.48/pc
Discrepancy: $0.73
```

**After Fix:**
```
Order Summary S/M/L/XL: $41.75/pc
ShopWorks Standard Line: $41.75/pc
Discrepancy: $0.00 ✓
```

### Complete Working Example

#### Quote Parameters
- **Products:** PC54 Heather Royal, PC61 Cardinal
- **Total Quantity:** 56 pieces (triggers LTM fee)
- **Print Setup:**
  - Front: 3 colors + 1 underbase + Safety Stripes
  - Back: 3 colors + 1 underbase + Safety Stripes
  - Left Sleeve: 2 colors + 1 underbase

#### Order Summary Output
```
PC54 - Heather Royal (33 pieces)
S/M/L/XL (25 total): $16.00 + $4.00 safety + $14.50 add'l + $0.89 LTM = $35.39/pc
2XL (7 total): $18.00 + $4.00 safety + $14.50 add'l + $0.89 LTM = $37.39/pc
3XL (1 total): $19.00 + $4.00 safety + $14.50 add'l + $0.89 LTM = $38.39/pc

PC61 - Cardinal (23 pieces)
S/M/L/XL (11 total): $17.00 + $4.00 safety + $14.50 add'l + $0.89 LTM = $36.39/pc
2XL-6XL: $38.39, $39.39, $40.39, $42.39, $43.39/pc
```

#### ShopWorks Guide Output
```
Line | Qty | Part Number | Manual Price | Sizes              | Line Total
-----|-----|-------------|--------------|--------------------|-----------
1    | 11  | SPSU        | $30.00       | 11                 | $330.00
2    | 25  | PC54        | $35.39       | S:3 M:12 L:3 XL:7  | $884.75
3    | 7   | PC54_2X     | $37.39       | 2XL:7              | $261.73
4    | 1   | PC54_3X     | $38.39       | 3XL:1              | $38.39
5    | 11  | PC61        | $36.39       | S:3 M:3 L:3 XL:2   | $400.29
6    | 4   | PC61_2X     | $38.39       | 2XL:4              | $153.56
7    | 3   | PC61_3X     | $39.39       | 3XL:3              | $118.17
8    | 3   | PC61_4X     | $40.39       | 4XL:3              | $121.17
9    | 1   | PC61_5X     | $42.39       | 5XL:1              | $42.39
10   | 1   | PC61_6X     | $43.39       | 6XL:1              | $43.39
                                                     Subtotal: $2393.84
```

#### EDP Import Output
```
---- Start Product ----
PartNumber>> PC54
cur_UnitPriceUserEntered>> 35.39
Size01_Req>> 3
Size02_Req>> 12
Size03_Req>> 3
Size04_Req>> 7
---- End Product ----

---- Start Product ----
PartNumber>> PC54_2X
cur_UnitPriceUserEntered>> 37.39
Size05_Req>> 7
---- End Product ----
```

#### Verification Results
```
✅ All per-piece prices match exactly
✅ Setup fee correct ($330.00)
✅ Line totals within $0.02 (penny rounding)
✅ Grand total within $0.16 (acceptable)
✅ Console logs show "Using size-specific price"
✅ ShopWorks import successful
```

---

## CATALOG_COLOR Implementation

### Overview

**Problem:** ShopWorks EDP import requires product colors in **CATALOG_COLOR** format (e.g., "Hthr Dk Ch Brn") instead of **COLOR_NAME** format (e.g., "Heather Dark Chocolate Brown") for accurate product matching in their inventory system.

**Scope:** This implementation affects **only** the EDP text generation. The Quote Builder UI and ShopWorks Guide PDF continue to use COLOR_NAME for better readability.

**Implementation Date:** October 25, 2025
**Git Commits:** be2222b, 05b58ae, 7177fcf
**Files Modified:** 3 files, 9 total changes

---

### The Color Format Problem

When the Color Swatches API returns product color information, it provides **two formats**:

```json
{
  "COLOR_NAME": "Heather Dark Chocolate Brown",    // User-friendly display
  "CATALOG_COLOR": "Hthr Dk Ch Brn"               // ShopWorks catalog format
}
```

**Before Implementation:**
- Quote Builder used COLOR_NAME for everything
- EDP text output: `PartColor>> Heather Dark Chocolate Brown`
- ShopWorks couldn't match to inventory (expected catalog format)

**After Implementation:**
- Quote Builder uses COLOR_NAME for display
- EDP text output: `PartColor>> Hthr Dk Ch Brn`
- ShopWorks successfully matches to inventory ✅

---

### Three-Commit Implementation

#### Commit 1: Initial CATALOG_COLOR Infrastructure (be2222b)

**Purpose:** Add catalogColor field throughout the data flow chain

**Changes:**
1. Modified `selectColor()` to accept both `colorName` and `catalogColor` parameters
2. Added `catalogColor` field to `currentProduct` object
3. Updated color swatch click handlers to pass both formats
4. Added `CatalogColor` field to ShopWorks data structures
5. Modified EDP generator to prefer `catalogColor` with fallback to `color`

**Files Modified:**
- `quote-builders/screenprint-quote-builder.html` (3 changes)
- `shared_components/js/shopworks-guide-generator.js` (2 changes)
- `shared_components/js/shopworks-edp-generator.js` (1 change)

**Key Code Pattern:**
```javascript
// Color swatch click handler
swatchEl.onclick = () => this.selectColor(
    swatch.COLOR_NAME,      // For display
    swatch.CATALOG_COLOR,   // For ShopWorks
    swatchEl
);

// EDP generator fallback pattern
edp += `PartColor>> ${item.catalogColor || item.color || ''}\n`;
```

#### Commit 2: Auto-load CatalogColor Population (05b58ae)

**Purpose:** Handle auto-loaded products (exact match search) that bypass color swatch clicks

**Problem Discovered:**
- When user types exact style number (e.g., "PC54"), product auto-loads
- Auto-load bypassed color swatch click handler
- `catalogColor` field was undefined for auto-loaded products
- Console showed: `"CatalogColor": ""` (empty string)

**Solution:**
Created helper function to look up CATALOG_COLOR from the stored color swatches array:

```javascript
getCatalogColorFromSwatches(colorName) {
    if (!this.currentProduct || !this.currentProduct.colorSwatches) {
        console.warn('[CatalogColor] No color swatches data available');
        return '';
    }

    // Find the swatch that matches the COLOR_NAME
    const swatch = this.currentProduct.colorSwatches.find(s =>
        s.COLOR_NAME === colorName
    );

    if (swatch && swatch.CATALOG_COLOR) {
        console.log(`[CatalogColor] Found match: "${colorName}" → "${swatch.CATALOG_COLOR}"`);
        return swatch.CATALOG_COLOR;
    } else {
        console.warn(`[CatalogColor] No CATALOG_COLOR found for "${colorName}"`);
        return '';
    }
}
```

**Modified `loadProductDetails()`:**
```javascript
// Store color information (both formats)
this.currentProduct.color = color;  // COLOR_NAME for display

// CRITICAL FIX: Look up and store catalogColor even when auto-loading
const catalogColor = this.getCatalogColorFromSwatches(color);
this.currentProduct.catalogColor = catalogColor;

console.log(`[loadProductDetails] Stored colors - Display: "${color}", Catalog: "${catalogColor}"`);
```

**Files Modified:**
- `quote-builders/screenprint-quote-builder.html` (2 changes: helper function + loadProductDetails)

#### Commit 3: Complete Data Flow Chain (7177fcf)

**Purpose:** Fix the missing link where `catalogColor` wasn't being copied to product objects

**Problem Discovered:**
- Console logs showed successful catalogColor lookup: ✅
  ```
  [CatalogColor] Found match: "Dark Chocolate Brown" → "Dk Choc Brown"
  [loadProductDetails] Stored colors - Display: "Dark Chocolate Brown", Catalog: "Dk Choc Brown"
  ```
- But EDP text still showed COLOR_NAME: ❌
  ```
  PartColor>> Dark Chocolate Brown
  ```

**Root Cause:**
The `addProductToQuote()` function created product objects with only the `color` field, NOT the `catalogColor` field:

```javascript
// BEFORE (missing catalogColor):
const product = {
    styleNumber: this.currentProduct.styleNumber,
    productName: this.currentProduct.details.PRODUCT_TITLE || '',
    color: this.currentProduct.color,              // ✅ Has this
    colorSwatchImage: this.currentProduct.colorSwatchImage || '',
    sizeBreakdown: sizeBreakdown,
    quantity: totalQuantity
    // ❌ MISSING: catalogColor field
};
```

**Solution:**
Added one line to copy `catalogColor` from `currentProduct` to the product object:

```javascript
// AFTER (complete):
const product = {
    styleNumber: this.currentProduct.styleNumber,
    productName: this.currentProduct.details.PRODUCT_TITLE || '',
    color: this.currentProduct.color,
    catalogColor: this.currentProduct.catalogColor,  // ✅ ADDED THIS LINE
    colorSwatchImage: this.currentProduct.colorSwatchImage || '',
    sizeBreakdown: sizeBreakdown,
    quantity: totalQuantity
};
```

**Files Modified:**
- `quote-builders/screenprint-quote-builder.html` (1 change at line 2691)

---

### Complete Data Flow Chain

The catalogColor now flows through the entire system:

```
┌─────────────────────────────────────────────────────────┐
│ 1. Color Swatches API                                   │
│    Returns both COLOR_NAME and CATALOG_COLOR           │
└────────────────────┬────────────────────────────────────┘
                     ↓
┌─────────────────────────────────────────────────────────┐
│ 2. loadProductDetails() / selectColor()                 │
│    getCatalogColorFromSwatches("Dark Chocolate Brown")  │
│    → Returns "Dk Choc Brown"                            │
└────────────────────┬────────────────────────────────────┘
                     ↓
┌─────────────────────────────────────────────────────────┐
│ 3. currentProduct Object                                │
│    currentProduct.color = "Dark Chocolate Brown"        │
│    currentProduct.catalogColor = "Dk Choc Brown" ✅     │
└────────────────────┬────────────────────────────────────┘
                     ↓
┌─────────────────────────────────────────────────────────┐
│ 4. addProductToQuote()                                  │
│    product.color = currentProduct.color                 │
│    product.catalogColor = currentProduct.catalogColor ✅│
└────────────────────┬────────────────────────────────────┘
                     ↓
┌─────────────────────────────────────────────────────────┐
│ 5. this.products Array                                  │
│    Stores product objects with both color formats       │
└────────────────────┬────────────────────────────────────┘
                     ↓
┌─────────────────────────────────────────────────────────┐
│ 6. generateEDPText()                                    │
│    quoteData.products.push({                            │
│        CatalogColor: product.catalogColor || '' ✅      │
│    })                                                   │
└────────────────────┬────────────────────────────────────┘
                     ↓
┌─────────────────────────────────────────────────────────┐
│ 7. Guide Generator (shopworks-guide-generator.js)       │
│    lineItem.catalogColor = product.CatalogColor ✅      │
└────────────────────┬────────────────────────────────────┘
                     ↓
┌─────────────────────────────────────────────────────────┐
│ 8. EDP Generator (shopworks-edp-generator.js)           │
│    PartColor>> ${item.catalogColor || item.color}       │
│    → Outputs "Dk Choc Brown" ✅                         │
└─────────────────────────────────────────────────────────┘
```

---

### Testing & Verification

#### Console Log Verification

**Successful catalogColor lookup:**
```javascript
[CatalogColor] Found match: "Heather Dark Chocolate Brown" → "Hthr Dk Ch Brn"
[loadProductDetails] Stored colors - Display: "Heather Dark Chocolate Brown", Catalog: "Hthr Dk Ch Brn"
```

**Product object verification:**
```javascript
{
    styleNumber: "PC54",
    color: "Heather Dark Chocolate Brown",        // Display
    catalogColor: "Hthr Dk Ch Brn",              // ShopWorks ✅
    // ... other fields
}
```

#### EDP Text Verification

**Before Implementation:**
```
PartNumber>> PC54
PartColor>> Heather Dark Chocolate Brown    ❌ Wrong format
```

**After Implementation:**
```
PartNumber>> PC54
PartColor>> Hthr Dk Ch Brn                  ✅ Correct format
```

**Setup Charge (correctly remains empty):**
```
PartNumber>> SPSU
PartColor>>                                  ✅ Empty (as intended)
```

#### ShopWorks Import Verification

**Test Date:** October 25, 2025

**Import Results:**
- ✅ All product colors imported successfully
- ✅ Catalog colors matched to ShopWorks inventory
- ✅ All pricing calculations verified correct
- ✅ Setup charges imported without color (correct)

**Known Behavior: Visual Truncation**

ShopWorks grid view may **visually truncate** long catalog colors due to column width:

| Part Number | Color in Grid | Actual Stored Value |
|-------------|---------------|---------------------|
| PC54 | **Hthr Dk** | Hthr Dk Ch Brn ✅ |
| PC61 | **Ath.** | Ath. Maroon ✅ |

**This is display-only truncation** - the full catalog color is correctly stored in the ShopWorks database. You can verify by:
1. Double-clicking the product row to view details
2. Widening the Color column in the grid view
3. Checking the database record directly

---

### Setup Charge Behavior

Setup charges (part number SPSU) are **service line items**, not physical products, so they intentionally have **no color**.

**Setup Charge Creation:**
```javascript
// From screenprint-shopworks-guide-generator.js line 64-68
const spsuItem = {
    lineQty: '',
    partNumber: 'SPSU',
    colorRange: '',
    color: '',                    // Intentionally empty ✅
    catalogColor: '',             // Also empty ✅
    description: 'New Screen Set Up Charge: 8 colors...'
};
```

**EDP Output:**
```
---- Start Product ----
PartNumber>> SPSU
PartColorRange>>
PartColor>>                       ✅ Empty (correct for setup charges)
cur_UnitPriceUserEntered>> 30.00
```

**The fallback pattern handles this correctly:**
```javascript
edp += `PartColor>> ${item.catalogColor || item.color || ''}\n`;
//                   ↑ undefined        ↑ ''         ↑ fallback: ''
//                   Result: Empty string ✅
```

---

### Code Patterns for Future Use

#### Pattern 1: Helper Function for Catalog Color Lookup

```javascript
/**
 * Look up CATALOG_COLOR from color swatches array
 * Used for auto-loaded products that bypass swatch clicks
 */
getCatalogColorFromSwatches(colorName) {
    if (!this.currentProduct || !this.currentProduct.colorSwatches) {
        console.warn('[CatalogColor] No color swatches data available');
        return '';
    }

    const swatch = this.currentProduct.colorSwatches.find(s =>
        s.COLOR_NAME === colorName
    );

    if (swatch && swatch.CATALOG_COLOR) {
        console.log(`[CatalogColor] Found match: "${colorName}" → "${swatch.CATALOG_COLOR}"`);
        return swatch.CATALOG_COLOR;
    } else {
        console.warn(`[CatalogColor] No CATALOG_COLOR found for "${colorName}"`);
        return '';
    }
}
```

#### Pattern 2: Always Populate Both Color Formats

```javascript
// When loading product details
this.currentProduct.color = colorName;                              // Display
this.currentProduct.catalogColor = this.getCatalogColorFromSwatches(colorName); // ShopWorks
```

#### Pattern 3: Copy catalogColor to Product Objects

```javascript
// When adding product to quote
const product = {
    // ... other fields
    color: this.currentProduct.color,                    // Display format
    catalogColor: this.currentProduct.catalogColor,      // ShopWorks format
};
```

#### Pattern 4: EDP Generator Fallback

```javascript
// EDP generator always uses fallback pattern
edp += `PartColor>> ${item.catalogColor || item.color || ''}\n`;
//                   ↑ Prefer catalog  ↑ Fallback  ↑ Final fallback
```

---

### Applying to Other Quote Builders

This pattern can be applied to **any quote builder that generates EDP text**:

- ✅ Screen Print (implemented)
- ⏳ DTG Quote Builder (can apply same pattern)
- ⏳ Embroidery Quote Builder (can apply same pattern)
- ⏳ Cap Embroidery Quote Builder (can apply same pattern)

**Implementation Checklist for Other Quote Builders:**

1. **Add Helper Function:**
   - Copy `getCatalogColorFromSwatches()` to quote builder

2. **Modify Color Selection:**
   - Update `selectColor()` to accept catalogColor parameter
   - Update color swatch click handlers to pass both formats

3. **Modify loadProductDetails():**
   - Call `getCatalogColorFromSwatches()` to populate catalogColor
   - Store both `color` and `catalogColor` in `currentProduct`

4. **Modify addProductToQuote():**
   - Add `catalogColor` field to product object

5. **Update Guide Generator:**
   - Add `catalogColor` field to line item creation
   - Use same fallback pattern: `product.CatalogColor || product.catalogColor || ''`

6. **Update EDP Generator:**
   - Modify PartColor field to use: `item.catalogColor || item.color || ''`

7. **Test:**
   - Verify console logs show successful catalogColor lookup
   - Check EDP text shows CATALOG_COLOR format
   - Import test file into ShopWorks
   - Verify products match to inventory

---

### Troubleshooting

#### Issue: catalogColor is Empty in Console

**Symptoms:**
```javascript
console.log(product.catalogColor);  // ""
```

**Possible Causes:**
1. Color swatches API didn't return CATALOG_COLOR field
2. getCatalogColorFromSwatches() couldn't find matching swatch
3. catalogColor not copied in addProductToQuote()

**Solution:**
- Check console for `[CatalogColor]` log messages
- Verify colorSwatches array is populated
- Check exact spelling of COLOR_NAME (case-sensitive)

#### Issue: EDP Still Shows COLOR_NAME

**Symptoms:**
```
PartColor>> Dark Chocolate Brown    ❌ Should be "Dk Choc Brown"
```

**Possible Causes:**
1. catalogColor not in product object (check addProductToQuote)
2. catalogColor not passed to quoteData
3. catalogColor not passed to line items

**Solution:**
- Trace data flow: currentProduct → product → quoteData → lineItem
- Add console.log at each step to verify catalogColor is present
- Check for typos: `catalogColor` vs `CatalogColor` (case matters)

#### Issue: Setup Charges Have Unexpected Color

**Symptoms:**
```
PartNumber>> SPSU
PartColor>> Hthr Dk Ch Brn    ❌ Should be empty
```

**Solution:**
Setup charges should be created with empty color fields:
```javascript
const spsuItem = {
    color: '',
    catalogColor: ''
};
```

---

### Performance & Maintenance Notes

**API Calls:**
- No additional API calls required
- CATALOG_COLOR comes from existing Color Swatches API
- Color swatches are already fetched during product load

**Memory Impact:**
- Adds one string field (`catalogColor`) per product
- Negligible memory impact (< 50 bytes per product)

**Maintenance:**
- If Caspio changes CATALOG_COLOR format, only need to update color swatches API
- No code changes required (just data format in API response)

**Cache Considerations:**
- Color swatches are cached with product details
- catalogColor lookup uses cached data (no extra API calls)

---

## Section 12: Complete EDP Field Reference

### Overview

This section documents ALL available EDP fields from the ShopWorks EDP specification. Use this as a reference when considering adding new fields to your EDP implementation.

**Currently Implemented Blocks:**
- ✅ Order Block (12 of ~37 fields)
- ✅ Customer Block (1 of ~30 fields)
- ⚠️ Product Block (19 of 19 implemented fields - COMPLETE)
- ❌ Contact Block (0 fields - UNUSED)
- ❌ Design Block (0 fields - UNUSED, HIGH VALUE for screen print)
- ❌ Payment Block (0 fields - UNUSED)

### Order Block Fields

**Status: Partially Implemented (12 of ~37 fields)**

#### Currently Implemented (12 fields)
```javascript
ExtOrderID           // Quote ID from calculator
ExtSource            // "SP Quote"
date_OrderPlaced     // Today's date in MM/DD/YYYY format
id_OrderType         // 13 (Screen Print)
id_Customer          // 3739 (Northwest Custom Apparel)
Company              // "Northwest Custom Apparel"
TermsName            // "Pay On Pickup"
CustomerPurchaseOrder // "Screenprint"
CustomerServiceRep   // "N/A"
date_OrderRequestedToShip // Calculated 2 weeks ahead, avoids weekends
NotesToArt           // Comprehensive art instructions
NotesToProduction    // Production setup details
```

#### High Priority - Consider Adding (8 fields)
```javascript
// Shipping Information
ShipToCompany        // Customer's company name
ShipToAddress1       // Street address
ShipToAddress2       // Suite/unit number
ShipToCity           // City
ShipToState          // State abbreviation
ShipToZip            // ZIP code
ShipToCountry        // Country (default "USA")

// Customer Communication
CustomerEmail        // For order notifications
```

**Implementation Example:**
```javascript
// In convertToEDPFormat() Order Block section:
edp += `ShipToCompany>> ${quoteData.CompanyName || ''}\n`;
edp += `ShipToAddress1>> ${quoteData.ShippingAddress || ''}\n`;
edp += `ShipToCity>> ${quoteData.ShippingCity || ''}\n`;
edp += `ShipToState>> ${quoteData.ShippingState || ''}\n`;
edp += `ShipToZip>> ${quoteData.ShippingZip || ''}\n`;
edp += `CustomerEmail>> ${quoteData.CustomerEmail || ''}\n`;
```

#### Medium Priority - Optional Enhancement (9 fields)
```javascript
// Additional Order Details
OrderNotes           // General order notes
ShipMethod           // "UPS Ground", "FedEx", etc.
ShipAccountNumber    // Carrier account number
date_OrderDesired    // Customer's desired delivery date
DateIssued           // Order creation date (alternative to date_OrderPlaced)

// Tracking
ExtInventoryGroup    // External inventory group ID
ExtCustomerID        // External customer system ID
ExtContactID         // External contact system ID
ExtSource2           // Secondary source identifier
```

#### Low Priority - Advanced Features (8 fields)
```javascript
// Workflow
id_Workcenter        // ShopWorks workcenter assignment
IsWebOrder           // "Yes" or "No"
IsInternational      // "Yes" or "No"

// Financial
DiscountPercent      // Percentage discount
DiscountAmount       // Dollar amount discount
TaxExempt            // "Yes" or "No"

// System
id_OrderSource       // Order source type ID
OrderGroup           // Group/batch identifier
```

### Customer Block Fields

**Status: Minimal Implementation (1 of ~30 fields)**

#### Currently Implemented (1 field)
```javascript
id_Customer          // 3739 (Northwest Custom Apparel)
```

#### High Priority - Consider Adding (7 fields)
```javascript
// Primary Contact
Company              // Customer company name
ContactName          // Primary contact person
Email                // Primary email
Phone                // Primary phone
Address1             // Street address
City                 // City
State                // State abbreviation
Zip                  // ZIP code
```

**Implementation Example:**
```javascript
// Add to Customer Block:
edp += '---- Start Customer ----\n';
edp += `id_Customer>> ${this.config.customerId}\n`;
edp += `Company>> ${quoteData.CompanyName || ''}\n`;
edp += `ContactName>> ${quoteData.CustomerName || ''}\n`;
edp += `Email>> ${quoteData.CustomerEmail || ''}\n`;
edp += `Phone>> ${quoteData.Phone || ''}\n`;
edp += `Address1>> ${quoteData.ShippingAddress || ''}\n`;
edp += `City>> ${quoteData.ShippingCity || ''}\n`;
edp += `State>> ${quoteData.ShippingState || ''}\n`;
edp += `Zip>> ${quoteData.ShippingZip || ''}\n`;
edp += '---- End Customer ----\n\n';
```

#### Medium Priority - Optional Enhancement (12 fields)
```javascript
// Additional Contact
Address2             // Suite/unit
Country              // Country name
ContactTitle         // Job title
Fax                  // Fax number
Website              // Company website
TaxID                // Tax ID number

// Communication Preferences
EmailArt             // Art department email
EmailBilling         // Billing department email
EmailOrders          // Order notifications email
EmailShipping        // Shipping notifications email

// Account Settings
AccountNumber        // Customer account number
PriceLevel           // Price tier/level
```

#### Low Priority - Advanced Features (10 fields)
```javascript
// Sales Territory
SalesRep             // Sales representative name
Territory            // Sales territory
Channel              // Sales channel

// Account Status
CreditLimit          // Credit limit amount
CreditStatus         // Credit standing
Terms                // Payment terms

// System
ExtCustomerID        // External system customer ID
CustomerGroup        // Customer grouping
IsActive             // Active status
DateAdded            // Account creation date
```

### Contact Block Fields

**Status: NOT IMPLEMENTED - UNUSED BLOCK**

#### High Priority - Consider Adding (8 fields)
```javascript
// Contact Information
id_Customer          // Links to Customer block
ContactName          // Full name
ContactTitle         // Job title
Email                // Email address
Phone                // Phone number
PhoneExt             // Extension
Mobile               // Mobile number
Fax                  // Fax number
```

**Use Case:** Multiple contacts per customer (purchasing, receiving, accounts payable)

**Implementation Example:**
```javascript
// Add Contact Block after Customer Block:
edp += '---- Start Contact ----\n';
edp += `id_Customer>> ${this.config.customerId}\n`;
edp += `ContactName>> ${quoteData.ContactName || quoteData.CustomerName}\n`;
edp += `ContactTitle>> ${quoteData.ContactTitle || ''}\n`;
edp += `Email>> ${quoteData.CustomerEmail || ''}\n`;
edp += `Phone>> ${quoteData.Phone || ''}\n`;
edp += '---- End Contact ----\n\n';
```

### Design Block Fields

**Status: NOT IMPLEMENTED - UNUSED BLOCK (HIGH VALUE FOR SCREEN PRINT)**

#### High Priority - Screen Print Designs (10+ fields)
```javascript
// Design Identification
DesignNumber         // Unique design identifier
DesignName           // Design description
DesignNotes          // Design instructions

// Art Files
ArtworkFilename      // Primary artwork file
ArtworkLocation      // File path or URL
VectorFile           // Vector artwork file
ProofFile            // Proof image file

// Colors and Specs
Colors               // Number of colors
ColorList            // Comma-separated color names
StitchCount          // For embroidery (if applicable)

// Status
DesignStatus         // "Approved", "Pending", "Revision"
ArtProofSent         // Date proof was sent
ArtProofApproved     // Date proof was approved
```

**Use Case:** Track artwork and design approvals per order

**Implementation Example:**
```javascript
// Add Design Block after Customer/Contact Blocks:
edp += '---- Start Design ----\n';
edp += `DesignNumber>> SP-${quoteData.QuoteID}\n`;
edp += `DesignName>> ${quoteData.DesignName || 'Screen Print Design'}\n`;
edp += `Colors>> ${quoteData.TotalColors || 0}\n`;

// Build color list from setup breakdown
const colorList = [];
Object.entries(quoteData.SetupBreakdown || {}).forEach(([location, details]) => {
    const locationName = this.getLocationName(location);
    const inkColors = details.colors - (quoteData.isDarkGarment ? 1 : 0);
    colorList.push(`${locationName}: ${inkColors} colors`);
});
edp += `ColorList>> ${colorList.join(', ')}\n`;

edp += `DesignNotes>> ${this.generateArtNotes(quoteData)}\n`;
edp += `DesignStatus>> Pending\n`;
edp += '---- End Design ----\n\n';
```

#### Medium Priority - Advanced Design Features (5 fields)
```javascript
// Design Management
Designer             // Artist/designer name
DateDesigned         // Design creation date
RevisionNumber       // Design version
OriginalDesignID     // Links to original design for revisions
DesignCategory       // Design type/category
```

### Product Block Fields

**Status: FULLY IMPLEMENTED (19 of 19 fields)**

#### Currently Implemented - All Fields ✅
```javascript
// Product Identification
PartNumber           // Style number (e.g., "PC61")
PartColorRange       // (empty but required)
PartColor            // Catalog color (e.g., "Black")
PartDescription      // Product description

// Pricing
cur_UnitPriceUserEntered  // Final unit price
cur_UnitCost              // Cost (set to 0.00 for quotes)

// Instructions
OrderInstructions    // (empty but required)

// Size Matrix (ALL 6 REQUIRED)
Size01_Req           // S column
Size02_Req           // M column
Size03_Req           // LG column
Size04_Req           // XL column
Size05_Req           // XXL column (2XL)
Size06_Req           // XXXL column (3XL+)

// Settings
sts_Prod_Product_Override      // Product override flag
sts_EnableCommission           // Commission setting
id_ProductClass                // Product class ID
sts_Prod_SalesTax_Override     // Tax override
sts_EnableTax01                // Tax flags
sts_EnableTax02
sts_EnableTax03
sts_EnableTax04

// Secondary Units (all empty but required)
sts_Prod_SecondaryUnits_Override
sts_UseSecondaryUnits
Units_Qty
Units_Type
Units_Area1
Units_Area2
Units_UnitsPricing
Units_UnitsPurchasing
Units_UnitsPurchasingExtraPercent
Units_UnitsPurchasingExtraRound

// Behavior (all empty but required)
sts_Prod_Behavior_Override
sts_ProductSource_Supplied
sts_ProductSource_Purchase
sts_ProductSource_Inventory
sts_Production_Designs
sts_Production_Subcontract
sts_Production_Components
sts_Storage_Ship
sts_Storage_Inventory
sts_Invoicing_Invoice
```

**Note:** Product block is complete. No additional fields recommended unless ShopWorks adds new capabilities.

### Payment Block Fields

**Status: NOT IMPLEMENTED - UNUSED BLOCK**

#### High Priority - Payment Tracking (5 fields)
```javascript
// Payment Information
PaymentMethod        // "Credit Card", "Check", "Net 30", etc.
PaymentAmount        // Payment amount
PaymentDate          // Date payment received
PaymentReference     // Check number, transaction ID
PaymentStatus        // "Pending", "Received", "Cleared"
```

**Use Case:** Track deposit payments for large orders

**Implementation Example:**
```javascript
// Add Payment Block after Product blocks:
edp += '---- Start Payment ----\n';
edp += `PaymentMethod>> ${quoteData.PaymentMethod || 'Net 30'}\n`;
edp += `PaymentStatus>> Pending\n`;
edp += '---- End Payment ----\n\n';
```

#### Medium Priority - Payment Details (4 fields)
```javascript
// Payment Processing
PaymentProcessor     // "Stripe", "PayPal", etc.
AuthorizationCode    // CC authorization code
Last4Digits          // Last 4 of card (for reference)
TransactionID        // Processor transaction ID
```

### Implementation Priority Guide

#### Immediate Value (Implement Next)
1. **Shipping Address Fields** (Order Block) - Essential for production
2. **Customer Email** (Order/Customer Block) - Order notifications
3. **Design Block** - HIGH VALUE for screen print workflow, tracks artwork approvals

#### High Value (Plan for Future)
4. **Contact Block** - Multiple contacts per customer
5. **Payment Block** - Track deposits and payment status
6. **Extended Customer Info** - Complete customer profiles

#### Nice to Have (Lower Priority)
7. **Advanced Order Fields** - Workflow automation
8. **Financial Fields** - Discounts, tax exemptions
9. **System Integration Fields** - External system linking

### Adding New Fields - Code Template

```javascript
// 1. Add to Order Block (in convertToEDPFormat method):
edp += `NewFieldName>> ${quoteData.NewFieldSource || 'default value'}\n`;

// 2. Ensure quoteData includes the field (in quote builder):
const quoteData = {
    // ... existing fields
    NewFieldSource: document.getElementById('new-field-input')?.value || ''
};

// 3. Test the EDP output contains the field:
console.log('[EDP] Generated EDP:', edpText);
// Look for: "NewFieldName>> [expected value]"
```

### Field Naming Conventions

**ShopWorks EDP follows these patterns:**
- `id_` prefix = Numeric ID fields (e.g., `id_Customer`)
- `date_` prefix = Date fields in MM/DD/YYYY format
- `cur_` prefix = Currency fields (e.g., `cur_UnitPrice`)
- `sts_` prefix = Status/boolean fields (e.g., `sts_EnableTax01`)
- `_Req` suffix = Required field (e.g., `Size01_Req`)

### Testing New Fields

When adding new fields:

1. **Generate test EDP:**
   ```javascript
   // In browser console:
   const edpText = window.shopWorksEDPGenerator.generateEDP(testQuoteData);
   console.log(edpText);
   ```

2. **Verify field appears in output:**
   ```
   ---- Start Order ----
   NewFieldName>> expected value
   ```

3. **Test import in ShopWorks:**
   - Import EDP file into ShopWorks test environment
   - Verify field populates correct database column
   - Check field appears in order record

4. **Validate data format:**
   - Dates: MM/DD/YYYY (no time)
   - Currency: XX.XX (two decimals)
   - Yes/No fields: "Yes" or "No" (not 1/0)

### Field Documentation Template

When documenting new fields you implement:

```javascript
/**
 * [FieldName] - [Brief description]
 *
 * @block [Order/Customer/Contact/Design/Product/Payment]
 * @format [String/Number/Date/Boolean]
 * @required [Yes/No]
 * @default [Default value or ""]
 * @example "[Sample value]"
 *
 * Use Case: [When/why to use this field]
 * Implementation: [Code location and pattern]
 * ShopWorks Import: [Which field this populates in ShopWorks]
 */
```

### Complete Field Counts

| Block | Implemented | Available | Completion % |
|-------|-------------|-----------|--------------|
| Order | 12 | ~37 | 32% |
| Customer | 1 | ~30 | 3% |
| Contact | 0 | ~8 | 0% |
| Design | 0 | ~10 | 0% |
| Product | 19 | 19 | 100% ✅ |
| Payment | 0 | ~9 | 0% |
| **TOTAL** | **32** | **~113** | **28%** |

### Next Steps for Enhancement

Consider implementing fields in this order:

**Phase 1 (Immediate):**
- Shipping address (Order Block: 6 fields)
- Customer email (Order Block: 1 field)

**Phase 2 (High Value):**
- Design Block (10 fields) - Major workflow improvement for screen print
- Extended customer info (Customer Block: 7 fields)

**Phase 3 (Future):**
- Contact Block (8 fields)
- Payment Block (5 fields)
- Advanced order fields as needed

---

## Summary

### Key Takeaways

1. **SizesPricing is the source of truth** - Contains already-calculated final prices for each size
2. **Never use weighted average for standard sizes** - They all cost the same, use `getStandardSizePrice()`
3. **Always include all cost components** - Base + decorations + additional locations + LTM
4. **Verify across all three systems** - Order Summary, ShopWorks Guide, EDP import must match
5. **Penny rounding is acceptable** - $0.10-0.20 total difference due to rounding is normal
6. **Use CATALOG_COLOR in EDP text** - ShopWorks requires catalog format for product matching (Section 11)

### Universal Application

This pattern works for:
- ✅ Screen Print Quote Builder (implemented)
- ✅ DTG Quote Builder (can apply same pattern)
- ✅ Embroidery Quote Builder (can apply same pattern)
- ✅ Cap Embroidery Quote Builder (can apply same pattern)

### Maintenance

When adding new quote builders:
1. Calculate complete pricing for each size
2. Build SizesPricing object with final prices
3. Attach to product before passing to generator
4. Generators will automatically use size-specific pricing
5. Test with verification checklist

---

**For questions or issues, reference:**
- Git commits for pricing sync: c96bff3, c0f9286, 6c194ba
- Git commits for CATALOG_COLOR: be2222b, 05b58ae, 7177fcf
- Console log patterns in Testing section
- Verification checklist above
- Implementation details for your specific quote builder type

**Last Updated:** 2025-10-25
**Maintained By:** NWCA Development Team
**Related Documentation:** QUOTE_BUILDER_GUIDE.md, CLAUDE_ARCHITECTURE.md, DATABASE_PATTERNS.md
