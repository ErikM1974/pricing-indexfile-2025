<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Nika's Account CRM - Northwest Custom Apparel</title>
    <link rel="icon" href="https://cdn.caspio.com/A0E15000/Safety%20Stripes/NWCA%20Favicon%20for%20TEAMNWCA.com.png?ver=1" type="image/png">

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Page Styles -->
    <link href="/dashboards/css/rep-crm.css" rel="stylesheet">
</head>
<body>
    <div class="crm-page">
        <!-- Header -->
        <header class="crm-header">
            <div class="header-left">
                <a href="/staff-dashboard.html" title="Back to Staff Dashboard">
                    <img src="https://cdn.caspio.com/A0E15000/Safety%20Stripes/web%20northwest%20custom%20apparel%20logo.png?ver=1"
                         alt="Northwest Custom Apparel" class="header-logo">
                </a>
                <h1 class="header-title">Nika's Account CRM</h1>
            </div>
            <div class="header-right">
                <div class="view-toggle">
                    <a href="/dashboards/nika-crm.html" class="active">CRM List</a>
                    <a href="/dashboards/nika-calendar.html">Calendar</a>
                </div>
                <button class="quick-action-btn" id="quick-at-risk">
                    <i class="fas fa-exclamation-triangle"></i> At Risk
                </button>
                <button class="quick-action-btn" id="quick-overdue">
                    <i class="fas fa-clock"></i> Overdue
                </button>
                <button class="quick-action-btn" id="quick-call-month">
                    <i class="fas fa-calendar-check"></i> Call This Month
                </button>
                <a href="/crm-logout" class="back-btn" title="Logout">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
                <a href="/staff-dashboard.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                    Dashboard
                </a>
            </div>
        </header>

        <!-- Main Content -->
        <main class="crm-content">
            <!-- Error Banner -->
            <div class="error-banner" id="error-banner">
                <i class="fas fa-exclamation-circle"></i>
                <span class="error-banner-message" id="error-message"></span>
                <button class="error-banner-close" onclick="window.crmController.hideError()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-total">0</div>
                    <div class="stat-label">Total Accounts</div>
                </div>
                <div class="stat-card gold-tier">
                    <div class="stat-value" id="stat-gold">0</div>
                    <div class="stat-label">Gold Tier</div>
                </div>
                <div class="stat-card win-back">
                    <div class="stat-value" id="stat-win-back">0</div>
                    <div class="stat-label">Win Back</div>
                </div>
                <div class="stat-card at-risk">
                    <div class="stat-value" id="stat-at-risk">0</div>
                    <div class="stat-label">At Risk</div>
                </div>
                <div class="stat-card overdue">
                    <div class="stat-value" id="stat-overdue">0</div>
                    <div class="stat-label">Overdue</div>
                </div>
            </div>

            <!-- Sales Breakdown by Tier -->
            <div class="sales-breakdown-section">
                <h3 class="section-title"><i class="fas fa-chart-pie"></i> 2026 YTD Sales by Tier</h3>
                <div class="sales-total">
                    <span class="total-label">Total YTD</span>
                    <span class="total-value" id="ytd-total">$0</span>
                </div>
                <div class="tier-breakdown-grid">
                    <div class="tier-card gold">
                        <div class="tier-name">Gold</div>
                        <div class="tier-revenue" id="gold-revenue">$0</div>
                        <div class="tier-count" id="gold-count">0 accounts</div>
                    </div>
                    <div class="tier-card silver">
                        <div class="tier-name">Silver</div>
                        <div class="tier-revenue" id="silver-revenue">$0</div>
                        <div class="tier-count" id="silver-count">0 accounts</div>
                    </div>
                    <div class="tier-card bronze">
                        <div class="tier-name">Bronze</div>
                        <div class="tier-revenue" id="bronze-revenue">$0</div>
                        <div class="tier-count" id="bronze-count">0 accounts</div>
                    </div>
                    <div class="tier-card win-back">
                        <div class="tier-name">Win-Back</div>
                        <div class="tier-revenue" id="winback-revenue">$0</div>
                        <div class="tier-count" id="winback-count">0 accounts</div>
                        <div class="bonus-line">
                            <span>5% Bonus:</span>
                            <span class="bonus-value" id="winback-bonus">$0</span>
                        </div>
                    </div>
                    <div class="tier-card unclassified">
                        <div class="tier-name">Unclassified</div>
                        <div class="tier-revenue" id="unclassified-revenue">$0</div>
                        <div class="tier-count" id="unclassified-count">0 accounts</div>
                    </div>
                </div>
            </div>

            <!-- Main Layout -->
            <div class="crm-layout" style="grid-template-columns: 1fr;">
                <!-- Accounts Section -->
                <div class="accounts-main">
                    <!-- Filters -->
                    <div class="filters-section">
                        <div class="filter-group search-group">
                            <label>Search</label>
                            <input type="text" id="filter-search" placeholder="Search company name...">
                        </div>
                        <div class="filter-group">
                            <label>Account Tier</label>
                            <select id="filter-tier">
                                <option value="">All Tiers</option>
                                <option value="GOLD '26-NIKA">Gold</option>
                                <option value="SILVER '26-NIKA">Silver</option>
                                <option value="BRONZE '26-NIKA">Bronze</option>
                                <option value="Win Back '26 NIKA">Win Back</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Priority</label>
                            <select id="filter-priority">
                                <option value="">All Priorities</option>
                                <option value="A">A - Highest</option>
                                <option value="B">B - High</option>
                                <option value="C">C - Medium</option>
                                <option value="D">D - Low</option>
                                <option value="E">E - Lowest</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Best Month</label>
                            <select id="filter-month">
                                <option value="">All Months</option>
                                <option value="jan">January</option>
                                <option value="feb">February</option>
                                <option value="mar">March</option>
                                <option value="apr">April</option>
                                <option value="may">May</option>
                                <option value="jun">June</option>
                                <option value="jul">July</option>
                                <option value="aug">August</option>
                                <option value="sep">September</option>
                                <option value="oct">October</option>
                                <option value="nov">November</option>
                                <option value="dec">December</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Trend</label>
                            <select id="filter-trend">
                                <option value="">All Trends</option>
                                <option value="Active 2025">Active 2025</option>
                                <option value="Growing">Growing</option>
                                <option value="Declining">Declining</option>
                                <option value="Stable">Stable</option>
                                <option value="Dormant">Dormant</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Products</label>
                            <div class="product-toggles">
                                <button class="product-toggle" data-product="Carhartt">Carhartt</button>
                                <button class="product-toggle" data-product="Jackets">Jackets</button>
                                <button class="product-toggle" data-product="Caps">Caps</button>
                            </div>
                        </div>
                        <button class="clear-filters-btn" id="clear-filters-btn">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>

                    <!-- Accounts Grid -->
                    <div class="accounts-section">
                        <div class="accounts-header">
                            <h2><i class="fas fa-building"></i> Accounts</h2>
                            <div class="accounts-meta">
                                <span class="accounts-count" id="accounts-count">0 accounts</span>
                                <button class="reconcile-btn" id="reconcile-btn" title="Find missing customers from ManageOrders">
                                    <i class="fas fa-user-plus"></i> Reconcile
                                </button>
                                <button class="sync-btn" id="sync-btn" title="Sync sales from ManageOrders">
                                    <i class="fas fa-sync"></i> Sync Sales
                                </button>
                            </div>
                        </div>

                        <div class="loading-overlay" id="loading-overlay">
                            <div class="loading-spinner"></div>
                        </div>

                        <div class="empty-state" id="empty-state" style="display: none;">
                            <i class="fas fa-search"></i>
                            <h3>No accounts found</h3>
                            <p>Try adjusting your filters or search terms</p>
                        </div>

                        <div class="accounts-grid" id="accounts-grid">
                            <!-- Account cards will be rendered here -->
                        </div>
                    </div>

                    <div class="sync-status" id="sync-status" style="display: none;">
                        <span id="last-synced"></span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Reconcile Modal -->
        <div class="modal-overlay" id="reconcile-modal-overlay">
            <div class="reconcile-modal">
                <div class="modal-header">
                    <div class="modal-title">
                        <h2><i class="fas fa-user-plus"></i> Reconcile Accounts</h2>
                        <p class="modal-subtitle">Customers with orders not yet in your account list</p>
                    </div>
                    <button class="modal-close" id="reconcile-modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="reconcile-modal-body">
                    <div class="reconcile-loading" id="reconcile-loading">
                        <div class="loading-spinner"></div>
                        <p>Checking for missing customers...</p>
                    </div>
                    <div class="reconcile-results" id="reconcile-results" style="display: none;">
                        <div class="reconcile-summary" id="reconcile-summary"></div>
                        <div class="reconcile-table-wrapper">
                            <table class="reconcile-table" id="reconcile-table">
                                <thead>
                                    <tr>
                                        <th>Company Name</th>
                                        <th>Orders</th>
                                        <th>Total Sales</th>
                                        <th>Last Order</th>
                                    </tr>
                                </thead>
                                <tbody id="reconcile-table-body">
                                </tbody>
                            </table>
                        </div>
                        <div class="reconcile-empty" id="reconcile-empty" style="display: none;">
                            <i class="fas fa-check-circle"></i>
                            <h3>All Synced!</h3>
                            <p>All customers with orders are already in your account list.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="reconcile-footer" style="display: none;">
                    <button class="btn-cancel" id="reconcile-cancel">Close</button>
                    <button class="btn-save" id="reconcile-add-all">
                        <i class="fas fa-plus"></i> Add All Missing
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Config & Scripts -->
    <script src="/config/app.config.js"></script>
    <script>
        // Rep-specific configuration
        window.REP_CONFIG = {
            repName: 'Nika',
            apiEndpoint: '/api/nika-accounts',
            archiveEndpoint: '/api/nika/daily-sales-by-account'
        };
    </script>
    <script src="/dashboards/js/rep-crm.js"></script>
</body>
</html>
