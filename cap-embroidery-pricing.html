<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cap Embroidery Pricing | NWCA</title>
    <link rel="stylesheet" href="/shared_components/css/shared-pricing-styles.css">
    <link rel="stylesheet" href="/shared_components/css/modern-enhancements.css">
    <link rel="stylesheet" href="/shared_components/css/universal-pricing-layout.css">
    <link rel="stylesheet" href="/shared_components/css/universal-pricing-components.css">
    <link rel="stylesheet" href="/shared_components/css/universal-cart-ui.css">
    <link rel="stylesheet" href="/shared_components/css/cap-embroidery-specific.css">
<!-- jsPDF Libraries for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Cap Embroidery Pricing</h1>

        <!-- New Two-Column Layout Container -->
        <div class="product-page-columns-container">

            <!-- Left Column: Product Context (Potentially Sticky) -->
            <div class="product-context-column">
                <div class="product-header"> <!-- Re-using existing header for product title area -->
                    <div class="product-title-area">
                        <h2 id="product-title-context">Product Title</h2> <!-- New ID to avoid conflict if original #product-title is used elsewhere by JS -->
                        <div class="product-meta" style="padding-top: 8px; margin-bottom: 5px;"> <!-- Adjusted padding/margin -->
                            <span class="meta-item">Style: <strong id="product-style-context">Style Number</strong></span>
                            <!-- Selected Color display removed from here, will rely on the one in the right column -->
                        </div>
                    </div>
                    <div class="navigation-area">
                        <a id="back-to-product" href="#" class="back-to-product">
                            <span class="back-icon">‚Üê</span> Back to Product
                        </a>
                    </div>
                </div>
                <!-- Enhanced Product Image Gallery -->
                <div class="product-image-gallery" id="product-image-gallery">
                    <div class="main-image-container" id="main-image-container">
                        <img id="product-image-main" src="" alt="Product Image" class="product-image">
                        <div class="image-loading-spinner"></div>
                        <div class="image-zoom-overlay">
                            <span class="zoom-icon">üîç</span>
                        </div>
                    </div>
                    <div class="image-thumbnails" id="image-thumbnails">
                        <!-- Thumbnails will be dynamically added here -->
                    </div>
                </div>
                <div class="static-product-info" style="padding:15px; background-color: var(--background-light); border-radius: var(--radius-sm); margin-top:15px;">
                    <p>Pricing Includes an 8,000 stitch embroidered logo on one location.</p>
                    <!-- Other static info can go here -->
                </div>
                
                
                <!-- Color Swatches moved to left column below product image -->
                <div class="color-swatches-left-column" style="margin-top:15px;">
                    <div class="color-swatches-container compact">
                        <h3 class="section-title">Available Colors</h3>
                        <div class="color-swatches collapsed" id="color-swatches" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; padding: 5px; max-height: 300px;">
                            <!-- Color swatches will be dynamically added here by pricing-pages.js -->
                        </div>
                        <button class="show-more-colors" id="show-more-colors" style="display: none;">Show More Colors</button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Interactive Elements (Scrollable) -->
            <div class="product-interactive-column">

                <!-- Original .product-context and .pricing-content are now effectively merged or reorganized -->
                <!-- The content of .pricing-content (pricing grid, add to cart) goes into this right column -->
                
                <!-- Pricing Content (Grid, Tabs, Add to Cart Section) -->
                <div class="pricing-content-interactive"> <!-- New wrapper for clarity -->
                    <!-- Hidden Caspio Matrix - Keep this for data source -->
                    <div id="pricing-calculator" class="pricing-calculator" style="display:none !important; width:0; height:0; border:0; visibility: hidden;">
                        <div class="loading-message">Loading pricing data...</div>
                    </div>
                    
                    <!-- Custom Pricing Grid - Enhanced now that it's at the top -->
                    <div class="pricing-section">
                        <div class="pricing-header" style="margin-bottom: 20px;">
                            <!-- Enhanced header with more prominence -->
                             <h3 class="section-title" style="font-size: 1.3em; margin: 0;">Detailed Pricing per Quantity Tier</h3>
                             <div style="display: flex; align-items: center; gap: 15px;"> <!-- Wrapper for dropdown and color indicator -->
                                 <div class="stitch-count-selector" style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: var(--primary-light); border-radius: var(--radius-sm); border: 1px solid var(--primary-color);">
                                     <label for="client-stitch-count-select" style="font-size: 0.95em; font-weight: bold; color: var(--primary-color);">Stitch Count:</label>
                                     <select id="client-stitch-count-select" name="client-stitch-count-select" style="padding: 6px 10px; border-radius: 4px; border: 2px solid #ddd; font-weight: bold; background: white; min-width: 80px;">
                                         <option value="5000">5,000</option>
                                         <option value="8000" selected>8,000</option>
                                         <option value="10000">10,000</option>
                                     </select>
                                     <span id="stitch-count-indicator" style="font-size: 0.8em; color: var(--primary-color); opacity: 0; transition: opacity 0.3s ease;">Updated!</span>
                                 </div>
                                 <div class="selected-color-indicator">
                                <span>Selected Color:</span>
                                <div class="mini-color-swatch clickable" id="pricing-color-swatch" title="Click to view this color in the swatches"></div>
                                <strong id="pricing-color-name">Color Name</strong>
                            </div>
                        </div>
                        
                        
                        <div class="pricing-grid-container">
                            <table class="pricing-grid" id="custom-pricing-grid">
                                <thead>
                                    <tr id="pricing-header-row">
                                        <th>Quantity</th>
                                        <!-- Size headers will be dynamically populated. JS needs to add data-tier-label to these THs. -->
                                        <!-- Example: <th data-tier-label="1-23">1-23</th> -->
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Pricing data will be dynamically added here -->
                                </tbody>
                            </table>
                            
                            <!-- Added helpful pricing explanation -->
                            <div class="pricing-explanation" style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                <p><strong>Note:</strong> Prices shown are per item and include an 8,000 stitch embroidered logo.</p>
                            </div>
                            
                            <!-- Pricing info tabs removed as per user request -->
                            
                        </div>
                    </div>
                    
                    <!-- Back Logo Add-On Section - Optimal Placement -->
                    <div class="back-logo-addon-section" style="margin: 25px 0; padding: 20px; background: linear-gradient(135deg, #f8f9ff 0%, #e8f4ff 100%); border-radius: 12px; border: 2px solid #e3f2fd; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <input type="checkbox" id="back-logo-checkbox" style="width: 20px; height: 20px; margin-right: 12px; cursor: pointer; transform: scale(1.2);">
                            <label for="back-logo-checkbox" style="font-size: 1.1em; font-weight: bold; color: var(--primary-color); cursor: pointer; user-select: none;">
                                üéØ Add Back Logo Embroidery
                            </label>
                        </div>
                        
                        <div id="back-logo-details" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,86,179,0.2);">
                            <div class="back-logo-controls" style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                                
                                <!-- Stitch Count with Increment Arrows -->
                                <div class="stitch-count-control" style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-weight: 600; color: #333; margin-right: 8px;">Stitch Count:</span>
                                    <div class="increment-control" style="display: flex; align-items: center; background: white; border-radius: 8px; border: 2px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <button id="back-logo-decrement" type="button" style="
                                            width: 36px; height: 36px; 
                                            border: none; background: transparent; 
                                            font-size: 18px; font-weight: bold; color: var(--primary-color); 
                                            cursor: pointer; border-radius: 6px 0 0 6px;
                                            display: flex; align-items: center; justify-content: center;
                                            transition: background-color 0.2s ease;
                                        " onmouseover="this.style.backgroundColor='#f0f8ff'" onmouseout="this.style.backgroundColor='transparent'">‚àí</button>
                                        
                                        <span id="back-logo-stitch-display" style="
                                            padding: 8px 16px; font-weight: bold; color: #333; 
                                            background: #f8f9ff; min-width: 80px; text-align: center;
                                            border-left: 1px solid #ddd; border-right: 1px solid #ddd;
                                        ">5,000</span>
                                        
                                        <button id="back-logo-increment" type="button" style="
                                            width: 36px; height: 36px; 
                                            border: none; background: transparent; 
                                            font-size: 18px; font-weight: bold; color: var(--primary-color); 
                                            cursor: pointer; border-radius: 0 6px 6px 0;
                                            display: flex; align-items: center; justify-content: center;
                                            transition: background-color 0.2s ease;
                                        " onmouseover="this.style.backgroundColor='#f0f8ff'" onmouseout="this.style.backgroundColor='transparent'">+</button>
                                    </div>
                                    <span style="font-size: 0.85em; color: #666; margin-left: 8px;">(5K-15K)</span>
                                </div>
                                
                                <!-- Price Display -->
                                <div class="price-display-section" style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-weight: 600; color: #333;">Additional Cost:</span>
                                    <div id="back-logo-price" style="
                                        padding: 8px 16px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); 
                                        color: white; border-radius: 8px; font-weight: bold; font-size: 1.1em;
                                        box-shadow: 0 2px 6px rgba(40,167,69,0.3);
                                    ">$5.00 per item</div>
                                </div>
                            </div>
                            
                            <!-- Back Logo Summary Info -->
                            <div id="back-logo-pricing-display" style="display: none; margin-top: 15px; padding: 12px 16px; background: rgba(40,167,69,0.1); border-radius: 8px; border-left: 4px solid #28a745;">
                                <div style="font-size: 0.95em; color: #155724;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>üìç Back Logo:</strong> <span id="back-logo-display-stitch-count">5,000 stitches</span></span>
                                        <span id="back-logo-display-price" style="font-weight: bold; color: #28a745;">$5.00 per item</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Add to Cart Section - Enhanced UI -->
                    <div class="add-to-cart-section">
                        <h3 class="section-title" style="font-size: 1.3em; margin-top: 30px; padding-bottom: 10px; border-bottom: 1px solid var(--border-light);">Add to Cart</h3>
                        
                        <div class="size-grid-container" id="size-grid-container">
                            <!-- Populated by product-quantity-ui.js or similar.
                                 Each size card needs a place for dynamic unit price.
                            Example of a size card structure that JS will populate:
                            <div class="size-card">
                                <div class="size-label">M</div>
                                <div class="quantity-controls">
                                    <button class="quantity-btn decrease" aria-label="Decrease quantity">-</button>
                                    <input type="number" class="quantity-input" value="0" min="0" data-size="M" data-base-price="15.99">
                                    <button class="quantity-btn increase" aria-label="Increase quantity">+</button>
                                </div>
                                <div class="price-display">
                                    Unit Price: <span class="dynamic-unit-price">$0.00</span>
                                </div>
                            </div>
                             -->
                        </div>
                        <div id="quantity-matrix">
                            <!-- Will be populated by JavaScript -->
                        </div>
                        
                        
                        <div id="cart-contents-info" class="cart-contents-info" style="display: none; margin-bottom: 15px; padding: 10px; background-color: #f0f8ff; border-radius: 5px; border: 1px solid #d0e3ff; font-size: 0.9em;">
                            <!-- Will be dynamically populated by JavaScript -->
                        </div>
                        
                        <!-- The "pricing-tier-info" div that was here has been removed as per user request -->
                        
                        <div class="size-quantity-grid" id="size-quantity-grid" style="display: none;">
                        </div>
                        
                        <!-- This .cart-summary will be the sticky summary -->
                        <div class="cart-summary" id="sticky-product-cart-summary">
                            <div class="cart-total">
                                <div>
                                    <span class="total-label">Total Quantity:</span> <span class="total-quantity">0</span>
                                </div>
                                <div>
                                    <span class="total-label">Est. Total:</span>
                                    <span class="total-amount total-price" data-tier-key="" data-total-quantity="0" data-ltm-fee-applies="false">$0.00</span>
                                </div>
                            </div>
                            <div class="ltm-fee-notice" style="display: none;">
                                <span class="ltm-icon" style="font-style: normal; font-weight: bold; color: #0056b3;">‚ÑπÔ∏è</span>
                                <div style="flex: 1;">
                                    <div class="ltm-text" style="font-weight: bold;">Less Than Minimum fee applies</div>
                                    <div class="ltm-detail-text" style="font-size: 0.85em; margin-top: 5px; color: #6c757d;"></div>
                                </div>
                            </div>
                            <button id="add-to-cart-button" class="add-to-cart-button">
                                Add to Cart
                            </button>
                            <button id="view-cart-summary-button" class="view-cart-button" style="display: none; margin-top: 10px; width: 100%; padding: 10px; background-color: #17a2b8; color: white; border: none; border-radius: var(--radius-sm); cursor: pointer; font-size: 1em;">
                                View Cart (<span class="cart-count-display">0</span>)
                            </button>
                        </div>
                    </div>
                </div> <!-- End .pricing-content-interactive -->
            </div> <!-- End .product-interactive-column -->
        </div> <!-- End .product-page-columns-container -->
    </div> <!-- End .container -->
    
    <!-- JavaScript Files -->
    <script src="/shared_components/js/pricing-pages.js"></script>
    <script src="/shared_components/js/utils.js"></script> <!-- Moved up and removed defer -->
    <script src="/shared_components/js/pricing-matrix-capture.js"></script>
    <script src="/shared_components/js/pricing-matrix-api.js"></script>
    <script src="/shared_components/js/dp5-helper.js"></script>
    <script src="/shared_components/js/product-quantity-ui.js"></script>
    <script src="/shared_components/js/cart.js"></script>
    <script src="/shared_components/js/cart-integration.js"></script>
    <script src="/shared_components/js/cart-price-recalculator.js"></script>
    <script src="/shared_components/js/add-to-cart.js"></script>
    <script src="/shared_components/js/pricing-calculator.js"></script>
    <script src="/shared_components/js/app-config.js"></script>
    <script src="/shared_components/js/cap-embroidery-controller.js"></script> <!-- Consolidated controller replacing 6 separate files -->
    <script src="/shared_components/js/product-pricing-ui.js"></script> <!-- Added new script, removed defer -->
    
</body>
<script src="/shared_components/js/order-form-pdf.js"></script>
</html>