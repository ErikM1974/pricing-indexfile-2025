<!DOCTYPE html>
<html>
<head>
    <title>Back Logo Integration Debug Test</title>
</head>
<body>
    <h1>Back Logo Integration Debug Test</h1>
    
    <div>
        <h2>Step 1: Check if Back Logo Add-on System is Available</h2>
        <button onclick="testAddOnSystem()">Test Add-on System</button>
        <div id="addon-test-result"></div>
    </div>
    
    <div>
        <h2>Step 2: Check if Quote Adapter is Available</h2>
        <button onclick="testQuoteAdapter()">Test Quote Adapter</button>
        <div id="quote-test-result"></div>
    </div>
    
    <div>
        <h2>Step 3: Test Full Integration</h2>
        <button onclick="testFullIntegration()">Test Full Integration</button>
        <div id="integration-test-result"></div>
    </div>
    
    <div>
        <h2>Console Log</h2>
        <div id="console-log" style="background: #f0f0f0; padding: 10px; height: 300px; overflow-y: scroll; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        // Capture console logs
        const originalConsoleLog = console.log;
        const logContainer = document.getElementById('console-log');
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            logContainer.innerHTML += args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ') + '<br>';
            logContainer.scrollTop = logContainer.scrollHeight;
        };
        
        function testAddOnSystem() {
            const result = document.getElementById('addon-test-result');
            result.innerHTML = '';
            
            console.log('=== TESTING ADD-ON SYSTEM ===');
            
            if (window.CapEmbroideryBackLogoAddon) {
                console.log('✓ CapEmbroideryBackLogoAddon is available');
                console.log('Current state:', window.CapEmbroideryBackLogoAddon.getState());
                console.log('Is enabled:', window.CapEmbroideryBackLogoAddon.isEnabled());
                console.log('Stitch count:', window.CapEmbroideryBackLogoAddon.getStitchCount());
                console.log('Price:', window.CapEmbroideryBackLogoAddon.getPrice());
                result.innerHTML = '<span style="color: green;">✓ Add-on system available</span>';
            } else {
                console.log('✗ CapEmbroideryBackLogoAddon is NOT available');
                result.innerHTML = '<span style="color: red;">✗ Add-on system NOT available</span>';
            }
        }
        
        function testQuoteAdapter() {
            const result = document.getElementById('quote-test-result');
            result.innerHTML = '';
            
            console.log('=== TESTING QUOTE ADAPTER ===');
            
            if (window.capEmbroideryQuoteAdapter) {
                console.log('✓ capEmbroideryQuoteAdapter is available');
                console.log('Current quote:', window.capEmbroideryQuoteAdapter.currentQuote);
                
                // Test getCurrentBackLogoPrice method
                if (typeof window.capEmbroideryQuoteAdapter.getCurrentBackLogoPrice === 'function') {
                    const price = window.capEmbroideryQuoteAdapter.getCurrentBackLogoPrice();
                    console.log('getCurrentBackLogoPrice() returns:', price);
                }
                
                result.innerHTML = '<span style="color: green;">✓ Quote adapter available</span>';
            } else {
                console.log('✗ capEmbroideryQuoteAdapter is NOT available');
                result.innerHTML = '<span style="color: red;">✗ Quote adapter NOT available</span>';
            }
        }
        
        function testFullIntegration() {
            const result = document.getElementById('integration-test-result');
            result.innerHTML = '';
            
            console.log('=== TESTING FULL INTEGRATION ===');
            
            if (!window.CapEmbroideryBackLogoAddon) {
                console.log('✗ Cannot test - Add-on system not available');
                result.innerHTML = '<span style="color: red;">✗ Add-on system required</span>';
                return;
            }
            
            if (!window.capEmbroideryQuoteAdapter) {
                console.log('✗ Cannot test - Quote adapter not available');
                result.innerHTML = '<span style="color: red;">✗ Quote adapter required</span>';
                return;
            }
            
            // Simulate the integration test
            console.log('Simulating back logo enabled state...');
            
            // Test the quote adapter's back logo detection
            const backLogoEnabled = window.CapEmbroideryBackLogoAddon.isEnabled();
            const backLogoStitchCount = window.CapEmbroideryBackLogoAddon.getStitchCount();
            const backLogoPrice = window.capEmbroideryQuoteAdapter.getCurrentBackLogoPrice();
            
            console.log('Integration test results:');
            console.log('- Back logo enabled:', backLogoEnabled);
            console.log('- Back logo stitch count:', backLogoStitchCount);
            console.log('- Back logo price from quote adapter:', backLogoPrice);
            
            if (backLogoPrice > 0) {
                result.innerHTML = '<span style="color: green;">✓ Integration working - price detected</span>';
            } else {
                result.innerHTML = '<span style="color: orange;">⚠ Integration issue - no price detected</span>';
            }
        }
        
        // Auto-run tests when page loads
        window.addEventListener('load', function() {
            setTimeout(() => {
                testAddOnSystem();
                testQuoteAdapter();
                testFullIntegration();
            }, 1000);
        });
    </script>
</body>
</html>