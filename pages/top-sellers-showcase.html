<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Browse Northwest Custom Apparel's top-selling products. Quality apparel for screen printing, embroidery, and DTG printing.">
    <meta name="keywords" content="custom apparel, screen printing, embroidery, promotional products, Pacific Northwest">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Top Sellers - Northwest Custom Apparel">
    <meta property="og:description" content="Discover our most popular products for custom decoration">
    <meta property="og:image" content="https://cdn.caspio.com/A0E15000/Safety%20Stripes/web%20northwest%20custom%20apparel%20logo.png?ver=1">
    <meta property="og:type" content="website">
    
    <title>Top Sellers Catalog - Northwest Custom Apparel</title>
    <link rel="icon" href="https://cdn.caspio.com/A0E15000/Safety%20Stripes/NWCA%20Favicon%20for%20TEAMNWCA.com.png?ver=1" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- EmailJS for sample request notifications -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <!-- Cart Drawer Component -->
    <link rel="stylesheet" href="../shared_components/css/cart-drawer.css">
    <script src="../shared_components/js/cart-drawer.js"></script>

    <!-- Sample Order Service for ShopWorks Integration -->
    <script src="../shared_components/js/sample-order-service.js"></script>

    <!-- Embed Sample Request functionality directly to avoid path issues -->
    <script>
        // Embedded sample cart functionality
        class SampleCart {
            constructor() {
                this.maxSamples = null; // No hard limit - 3 samples recommended for best experience

                // Load cart with backward compatibility
                const cartData = sessionStorage.getItem('sampleCart');
                if (cartData) {
                    try {
                        const parsed = JSON.parse(cartData);
                        // New format: {samples: [...]}
                        // Old format: [...]
                        this.samples = Array.isArray(parsed) ? parsed : (parsed.samples || []);
                    } catch (e) {
                        console.error('[SampleCart] Error parsing cart data:', e);
                        this.samples = [];
                    }
                } else {
                    this.samples = [];
                }

                this.eligibilityCache = {};
                this.apiBase = 'https://caspio-pricing-proxy-ab30a049961a.herokuapp.com';
                this.initializeUI();
                this.bindEvents();
            }

            initializeUI() {
                if (!document.getElementById('sampleCartWidget')) {
                    const widget = document.createElement('div');
                    widget.id = 'sampleCartWidget';
                    widget.className = 'sample-cart-widget';
                    widget.setAttribute('role', 'button');
                    widget.setAttribute('tabindex', '0');
                    widget.innerHTML = `
                        <div class="sample-cart-icon">
                            <i class="fas fa-box-open"></i>
                            <span class="sample-count-badge">${this.samples.length}</span>
                        </div>
                        <span class="sample-cart-label">Sample Cart</span>
                    `;

                    // Add to header's contact-header section (top-right position)
                    const contactHeader = document.querySelector('.contact-header');
                    if (contactHeader) {
                        contactHeader.appendChild(widget);
                    } else {
                        // Fallback: add to body if header not found
                        document.body.appendChild(widget);
                    }
                }
                this.updateUI();
            }

            bindEvents() {
                const widget = document.getElementById('sampleCartWidget');
                if (widget) {
                    // Click handler
                    widget.addEventListener('click', () => {
                        if (window.cartDrawer) {
                            window.cartDrawer.open();
                        }
                    });

                    // Keyboard support (Enter/Space)
                    widget.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            if (window.cartDrawer) {
                                window.cartDrawer.open();
                            }
                        }
                    });
                }
            }

            async checkEligibility(styleNumber) {
                // Check cache first
                if (this.eligibilityCache[styleNumber] !== undefined) {
                    return this.eligibilityCache[styleNumber];
                }

                try {
                    const response = await fetch(`${this.apiBase}/api/size-pricing?styleNumber=${styleNumber}`);
                    const data = await response.json();
                    
                    // Check if product is in Sanmar (has pricing data)
                    if (!data || data.error || data.length === 0) {
                        console.log(`Style ${styleNumber}: Not in Sanmar - no samples available`);
                        const result = { 
                            eligible: false, 
                            reason: 'not_sanmar'
                        };
                        this.eligibilityCache[styleNumber] = result;
                        return result;
                    }
                    
                    // Find MINIMUM price (not average)
                    const firstItem = data[0];
                    const prices = firstItem.basePrices || {};
                    const priceValues = Object.values(prices).filter(p => p > 0);
                    
                    if (priceValues.length === 0) {
                        const result = { eligible: false, reason: 'no_pricing' };
                        this.eligibilityCache[styleNumber] = result;
                        return result;
                    }
                    
                    // Extract available colors and sizes from all items
                    const colorNames = new Set();
                    const sizesSet = new Set();

                    data.forEach(item => {
                        if (item.color) {
                            colorNames.add(item.color);
                        }
                        // Get sizes from basePrices keys
                        Object.keys(item.basePrices || {}).forEach(size => {
                            sizesSet.add(size);
                        });
                    });

                    // Fetch CATALOG_COLOR values from color swatches API
                    let colors = [];
                    try {
                        const swatchResponse = await fetch(`${this.apiBase}/api/color-swatches?styleNumber=${styleNumber}`);
                        if (swatchResponse.ok) {
                            const swatches = await swatchResponse.json();
                            colors = swatches.map(swatch => ({
                                name: swatch.COLOR_NAME,           // Display name
                                catalogColor: swatch.CATALOG_COLOR, // ShopWorks internal name
                                swatchUrl: swatch.COLOR_SQUARE_IMAGE // Sanmar swatch image URL
                            })).filter(color => colorNames.has(color.name));
                            console.log(`  → Fetched ${colors.length} colors with CATALOG_COLOR mapping`);
                        } else {
                            // Fallback to simple color array if API fails
                            console.warn(`  → Color swatches API failed, using fallback`);
                            colors = Array.from(colorNames).map(name => ({
                                name: name,
                                catalogColor: name, // Use display name as fallback
                                swatchUrl: null     // No image available for fallback
                            }));
                        }
                    } catch (swatchError) {
                        // Fallback to simple color array
                        console.warn(`  → Error fetching color swatches:`, swatchError);
                        colors = Array.from(colorNames).map(name => ({
                            name: name,
                            catalogColor: name, // Use display name as fallback
                            swatchUrl: null     // No image available for fallback
                        }));
                    }
                    
                    const sizes = Array.from(sizesSet).sort((a, b) => {
                        // Sort sizes logically
                        const sizeOrder = ['XS', 'S', 'M', 'L', 'XL', '2XL', '3XL', '4XL', '5XL', '6XL'];
                        return sizeOrder.indexOf(a) - sizeOrder.indexOf(b);
                    });
                    
                    const minPrice = Math.min(...priceValues);
                    console.log(`Style ${styleNumber}: Min price $${minPrice.toFixed(2)}, ${colors.length} colors, ${sizes.length} sizes`);
                    
                    if (minPrice < 10) {
                        const result = {
                            eligible: true,
                            type: 'free',
                            price: 0,
                            minCost: minPrice,
                            colors: colors,
                            sizes: sizes
                        };
                        this.eligibilityCache[styleNumber] = result;
                        console.log(`  → FREE sample`);
                        return result;
                    } else {
                        // Calculate markup with half-dollar ceiling: (cost ÷ 0.60) rounded UP to nearest $0.50
                        const priceWithMargin = minPrice / 0.60;
                        const samplePrice = Math.ceil(priceWithMargin * 2) / 2;  // Half-dollar ceiling

                        const result = {
                            eligible: true,
                            type: 'paid',
                            price: samplePrice,
                            minCost: minPrice,
                            colors: colors,
                            sizes: sizes
                        };
                        this.eligibilityCache[styleNumber] = result;
                        console.log(`  → PAID sample at $${samplePrice.toFixed(2)} (was ${minPrice.toFixed(2)})`);
                        return result;
                    }
                } catch (error) {
                    console.error(`Error checking eligibility for ${styleNumber}:`, error);
                    const result = { eligible: false, reason: 'api_error' };
                    this.eligibilityCache[styleNumber] = result;
                    return result;
                }
            }

            addSample(product) {
                // Check for duplicate
                if (this.samples.find(s => s.style === product.style)) {
                    this.showNotification('This item is already in your sample cart', 'info');
                    return false;
                }

                this.samples.push({
                    style: product.style,
                    name: product.name,
                    description: product.description,
                    imageUrl: product.imageUrl || '',
                    color: product.color || '',  // Store actual color name
                    colorCode: product.colorCode || '',  // Store color code
                    catalogColor: product.catalogColor || product.color || '',  // ShopWorks catalog color (CRITICAL!)
                    size: product.size || '',  // Store selected size
                    price: product.price || 0,
                    type: product.type || 'free',
                    addedAt: new Date().toISOString()
                });

                this.save();
                this.updateUI();
                
                // Custom message based on sample type
                if (product.type === 'paid') {
                    this.showNotification(`${product.name} added - $${product.price} sample`, 'success');
                } else {
                    this.showNotification(`${product.name} added - FREE sample`, 'success');
                }
                
                this.showWidget();
                
                return true;
            }

            removeSample(styleNumberOrIndex) {
                let index;

                // Support both styleNumber (string) and index (number)
                if (typeof styleNumberOrIndex === 'number') {
                    index = styleNumberOrIndex;
                } else {
                    index = this.samples.findIndex(s => s.style === styleNumberOrIndex);
                }

                if (index !== -1 && index < this.samples.length) {
                    const removed = this.samples.splice(index, 1)[0];
                    this.save();
                    this.updateUI();
                    this.showNotification(`${removed.name} removed from samples`, 'info');

                    if (this.samples.length === 0) {
                        this.hideWidget();
                    }

                    return true;
                }

                return false;
            }

            clearCart() {
                this.samples = [];
                this.save();
                this.updateUI();
                this.hideWidget();
            }

            save() {
                // Save in structured format for sample-cart.html compatibility
                sessionStorage.setItem('sampleCart', JSON.stringify({
                    samples: this.samples,
                    updatedAt: new Date().toISOString()
                }));
            }

            updateUI() {
                const badge = document.querySelector('.sample-count-badge');
                if (badge) {
                    badge.textContent = this.samples.length;
                    badge.style.display = this.samples.length > 0 ? 'flex' : 'none';
                }

                const widget = document.getElementById('sampleCartWidget');
                if (widget) {
                    // Update ARIA label for accessibility
                    const itemText = this.samples.length === 1 ? 'item' : 'items';
                    widget.setAttribute('aria-label', `Sample cart with ${this.samples.length} ${itemText}`);

                    // Show widget
                    if (this.samples.length > 0) {
                        widget.style.display = 'flex'; // Changed from 'block' to 'flex'
                    }
                }

                this.updateSampleButtons();
            }

            updateSampleButtons() {
                document.querySelectorAll('.btn-sample').forEach(btn => {
                    const style = btn.dataset.style;
                    if (style && this.samples.find(s => s.style === style)) {
                        btn.innerHTML = '<i class="fas fa-check"></i> In Sample Cart';
                        btn.classList.add('in-cart');
                        btn.disabled = false;
                    }
                });
            }

            showWidget() {
                const widget = document.getElementById('sampleCartWidget');
                if (widget && this.samples.length > 0) {
                    widget.style.display = 'block';
                    widget.classList.add('sample-cart-show');
                }
            }

            hideWidget() {
                const widget = document.getElementById('sampleCartWidget');
                if (widget) {
                    widget.classList.remove('sample-cart-show');
                    setTimeout(() => {
                        if (this.samples.length === 0) {
                            widget.style.display = 'none';
                        }
                    }, 300);
                }
            }

            openSampleModal() {
                // Open drawer to view cart
                if (window.cartDrawer) {
                    window.cartDrawer.open();
                }
            }

            showNotification(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `sample-toast sample-toast-${type}`;
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(toast);
                setTimeout(() => toast.classList.add('sample-toast-show'), 10);
                
                setTimeout(() => {
                    toast.classList.remove('sample-toast-show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            getCartSummary() {
                return {
                    items: this.samples,
                    count: this.samples.length
                };
            }

            async checkAllProductEligibility() {
                console.log('Checking product eligibility for samples...');
                const buttons = document.querySelectorAll('.btn-sample[data-style]');
                const checks = [];
                
                buttons.forEach(btn => {
                    const style = btn.dataset.style;
                    if (style) {
                        checks.push(this.checkAndUpdateButton(btn, style));
                    }
                });
                
                await Promise.all(checks);
                console.log('Eligibility check complete');
            }
            
            async checkAndUpdateButton(button, styleNumber) {
                const result = await this.checkEligibility(styleNumber);
                
                if (!result.eligible) {
                    // Hide button for non-Sanmar products
                    button.style.display = 'none';
                    return;
                }
                
                button.style.display = 'inline-flex';
                button.style.width = '100%';
                
                // Store pricing data
                button.dataset.samplePrice = result.price;
                button.dataset.sampleType = result.type;
                
                // Check if already in cart
                if (this.samples.find(s => s.style === styleNumber)) {
                    button.innerHTML = '<i class="fas fa-check"></i> In Sample Cart';
                    button.classList.add('in-cart');
                } else if (result.type === 'free') {
                    button.innerHTML = '<i class="fas fa-box-open"></i> Request Free Sample';
                    button.className = 'btn-sample btn-sample-free';
                } else {
                    button.innerHTML = `<i class="fas fa-shopping-cart"></i> Order Sample - $${result.price}`;
                    button.className = 'btn-sample btn-sample-paid';
                }
            }
        }

        // Embedded sample request service
        class SampleRequestService {
            constructor() {
                this.baseURL = 'https://caspio-pricing-proxy-ab30a049961a.herokuapp.com';
                this.quotePrefix = 'SR';
                
                // Initialize EmailJS
                emailjs.init('4qSbDO-SQs19TbP80');
                this.emailConfig = {
                    serviceId: 'service_1c4k67j',
                    templateId: 'template_free_sample'
                };
            }

            generateSampleRequestID() {
                const now = new Date();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const dateKey = `${month}${day}`;
                
                // Use timestamp + random to ensure uniqueness across all users/sessions
                const timestamp = now.getTime().toString();
                const uniqueId = timestamp.slice(-6) + Math.random().toString(36).substr(2, 3);
                
                return `${this.quotePrefix}${dateKey}-${uniqueId}`;
            }

            generateSessionID() {
                return `sample_sess_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            }

            async checkDuplicateRequest(email) {
                // Simplified for testing
                return false;
            }

            async saveSampleRequest(formData, samples) {
                try {
                    const quoteID = this.generateSampleRequestID();
                    const sessionID = this.generateSessionID();
                    
                    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
                        .toISOString()
                        .replace(/\.\d{3}Z$/, '');
                    
                    // Build simple notes without newlines (Caspio doesn't like special characters)
                    let notesContent = formData.notes || 'Sample request';
                    
                    // Add project details with pipe separators instead of newlines
                    if (formData.projectType) {
                        notesContent += ` | Project: ${formData.projectType}`;
                    }
                    if (formData.estimatedQuantity) {
                        notesContent += ` | Qty: ${formData.estimatedQuantity}`;
                    }
                    if (formData.timeline) {
                        notesContent += ` | Timeline: ${formData.timeline}`;
                    }
                    
                    // Add delivery info including street address
                    if (formData.deliveryMethod === 'ship') {
                        notesContent += ` | Ship to: ${formData.shippingAddress || 'TBD'}, ${formData.shippingCity || 'TBD'}, ${formData.shippingState || 'TBD'} ${formData.shippingZip || ''}`;
                    } else {
                        notesContent += ' | Pickup at NWCA';
                    }
                    
                    // Add sample count and total
                    if (samples && samples.length > 0) {
                        notesContent += ` | ${samples.length} samples`;
                    }
                    
                    // Get totals with proper defaults
                    const samplesCost = parseFloat((formData.samplesCost || 0).toFixed(2));
                    const totalAmount = parseFloat((formData.totalAmount || 0).toFixed(2));
                    
                    // Add total if there's a cost
                    if (totalAmount > 0) {
                        notesContent += ` | Total: $${totalAmount.toFixed(2)}`;
                    }
                    
                    const sessionData = {
                        QuoteID: quoteID,
                        SessionID: sessionID,
                        CustomerEmail: formData.email,
                        CustomerName: formData.name,
                        CompanyName: formData.company || '',
                        Phone: formData.phone || '',
                        TotalQuantity: samples.length,
                        SubtotalAmount: samplesCost,
                        LTMFeeTotal: 0, // No LTM fees for sample requests - this field is for Less Than Minimum fees only
                        TotalAmount: totalAmount,
                        Status: 'Sample Request',
                        ExpiresAt: expiresAt,
                        Notes: notesContent,
                        // ProjectName field - leave empty to avoid database type issues
                        ProjectName: '',
                        // New shipping fields
                        ShippingAddress: formData.shippingAddress || '',
                        ShippingCity: formData.shippingCity || '',
                        ShippingState: formData.shippingState || '',
                        ShippingZip: formData.shippingZip || '',
                        DeliveryMethod: formData.deliveryMethod || 'pickup'
                    };
                    
                    // Validate data before sending
                    console.log('Saving sample request session:', sessionData);
                    console.log('Session data validation:', {
                        hasQuoteID: !!sessionData.QuoteID,
                        hasEmail: !!sessionData.CustomerEmail,
                        subtotalIsNumber: !isNaN(sessionData.SubtotalAmount),
                        ltmIsZero: sessionData.LTMFeeTotal === 0,
                        totalIsNumber: !isNaN(sessionData.TotalAmount),
                        notesLength: sessionData.Notes.length
                    });
                    
                    console.log('Sending session data to API:', JSON.stringify(sessionData, null, 2));
                    
                    const sessionResponse = await fetch(`${this.baseURL}/api/quote_sessions`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(sessionData)
                    });
                    
                    if (!sessionResponse.ok) {
                        const errorText = await sessionResponse.text();
                        console.error('Session save failed:', errorText);
                        console.error('Failed session data:', sessionData);
                        throw new Error(`Failed to save session: ${errorText}`);
                    }
                    
                    console.log('Session saved successfully');
                    
                    // Save individual sample items
                    console.log(`Saving ${samples.length} sample items...`);
                    const itemPromises = samples.map(async (sample, index) => {
                        // Use the sample price if it's a paid sample, ensure it's a number
                        const itemPrice = parseFloat((sample.price || 0).toFixed(2));
                        
                        // Simple size/color data for each item
                        let sizeBreakdownData = {
                            size: sample.size || 'L',
                            color: sample.color || 'TBD'
                        };
                        
                        // Order details now stored in session record, not in individual items
                        
                        const itemData = {
                            QuoteID: quoteID,
                            LineNumber: index + 1,
                            StyleNumber: sample.style || 'UNKNOWN',
                            ProductName: sample.name || sample.description || 'Sample Item',
                            Color: sample.color || '',  // Use actual selected color, never "Customer Choice"
                            ColorCode: sample.colorCode || '',
                            EmbellishmentType: 'sample',
                            PrintLocation: '',
                            PrintLocationName: '',
                            Quantity: 1,
                            HasLTM: 'No',
                            BaseUnitPrice: itemPrice,
                            LTMPerUnit: 0,
                            FinalUnitPrice: itemPrice,
                            LineTotal: itemPrice,
                            SizeBreakdown: JSON.stringify(sizeBreakdownData),
                            PricingTier: itemPrice > 0 ? 'Paid Sample' : 'Free Sample',
                            ImageURL: sample.imageUrl || '',
                            AddedAt: new Date().toISOString().replace(/\.\d{3}Z$/, '')
                        };
                        
                        console.log(`Saving item ${index + 1}:`, itemData);
                        
                        const itemResponse = await fetch(`${this.baseURL}/api/quote_items`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(itemData)
                        });
                        
                        if (!itemResponse.ok) {
                            const errorText = await itemResponse.text();
                            console.error(`Failed to save item ${index + 1} (LineNumber ${index + 1}):`, errorText);
                            console.error('Failed item data:', itemData);
                            // Return false but don't throw to allow other items to save
                            return false;
                        }
                        
                        console.log(`Successfully saved item ${index + 1} (LineNumber ${index + 1})`);
                        return true;
                    });
                    
                    const itemResults = await Promise.all(itemPromises);
                    const successCount = itemResults.filter(result => result === true).length;
                    const failCount = itemResults.filter(result => result === false).length;
                    
                    console.log(`Items saved: ${successCount} successful, ${failCount} failed out of ${samples.length} total`);
                    
                    // Log which items failed
                    itemResults.forEach((success, index) => {
                        if (!success) {
                            console.error(`Item ${index + 1} (LineNumber ${index + 1}) failed to save`);
                        }
                    });
                    
                    // Send confirmation email
                    try {
                        await this.sendConfirmationEmail(formData, samples, quoteID);
                        console.log('Confirmation email sent successfully');
                    } catch (emailError) {
                        // Don't block the request if email fails
                        console.error('Email send error (non-blocking):', emailError);
                    }
                    
                    return {
                        success: true,
                        requestID: quoteID
                    };
                    
                } catch (error) {
                    console.error('Error saving sample request:', error);
                    return {
                        success: false,
                        error: error.message
                    };
                }
            }
            
            async sendConfirmationEmail(formData, samples, quoteID) {
                // Build samples HTML table for email
                const samplesHtml = this.buildSamplesHtmlTable(samples);
                
                // Extract shipping info
                const isShipping = formData.deliveryMethod === 'ship';
                
                // Calculate cost breakdown
                const samplesCost = formData.samplesCost || 0;
                const shippingCost = formData.shippingCost || 0;
                const salesTax = formData.salesTax || 0;
                const totalAmount = formData.totalAmount || 0;
                
                // Build email data with all required variables
                const emailData = {
                    // System fields
                    to_email: formData.email,
                    from_name: 'Northwest Custom Apparel',
                    reply_to: 'sales@nwcustomapparel.com',
                    
                    // Customer information
                    customer_name: formData.name || 'Valued Customer',
                    customer_email: formData.email || '',
                    customer_phone: formData.phone || 'Not provided',
                    company_name: formData.company || 'Not provided',
                    
                    // Order details
                    request_id: quoteID,
                    request_date: new Date().toLocaleDateString(),
                    sample_count: samples.length.toString(),
                    delivery_method: isShipping ? 'Ship' : 'Pickup',
                    
                    // Sample items (HTML table)
                    samples_html: samplesHtml,
                    
                    // Shipping information
                    shipping_address: formData.shippingAddress || '',
                    shipping_city: formData.shippingCity || '',
                    shipping_state: formData.shippingState || '',
                    shipping_zip: formData.shippingZip || '',
                    shipping_info: isShipping ? 
                        `${formData.shippingAddress || ''} ${formData.shippingCity || ''}, ${formData.shippingState || ''} ${formData.shippingZip || ''}`.trim() : 
                        'Pickup at NWCA',
                    
                    // Cost breakdown
                    samples_cost: `$${samplesCost.toFixed(2)}`,
                    shipping_cost: isShipping ? `$${shippingCost.toFixed(2)}` : '$0.00',
                    tax_amount: `$${salesTax.toFixed(2)}`,
                    total_amount: `$${totalAmount.toFixed(2)}`,
                    
                    // Project details
                    project_type: formData.projectType || 'Not specified',
                    estimated_quantity: formData.estimatedQuantity || 'Not specified',
                    timeline: formData.timeline || 'Not specified',
                    notes: formData.notes || 'No additional notes',
                    
                    // Company info
                    company_year: '1977',
                    company_phone: '253-922-5793',
                    
                    // Next steps message
                    next_steps: totalAmount > 0 ? 
                        'An account executive will contact you to process payment for your sample order.' : 
                        'Your free samples will be processed within 2 business days.',
                    
                    // Delivery timeline
                    delivery_timeline: isShipping ? 
                        'Your samples will be shipped within 2 business days.' : 
                        'Your samples will be ready for pickup within 2 business days.'
                };
                
                // Send email via EmailJS
                await emailjs.send(
                    this.emailConfig.serviceId,
                    this.emailConfig.templateId,
                    emailData
                );
                
                return true;
            }
            
            buildSamplesHtmlTable(samples) {
                if (!samples || samples.length === 0) {
                    return '<p>No samples in this request</p>';
                }
                
                const tableRows = samples.map(sample => `
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 12px; text-align: left;">${sample.style || 'N/A'}</td>
                        <td style="padding: 12px; text-align: left;">${sample.name || 'N/A'}</td>
                        <td style="padding: 12px; text-align: left;">${sample.color || 'TBD'}</td>
                        <td style="padding: 12px; text-align: center;">${sample.size || 'TBD'}</td>
                        <td style="padding: 12px; text-align: right;">
                            ${sample.price > 0 ? `$${sample.price.toFixed(2)}` : 'FREE'}
                        </td>
                    </tr>
                `).join('');
                
                return `
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: #4cb354; color: white;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Style #</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Product</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Color</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">Size</th>
                                <th style="padding: 12px; text-align: right; font-weight: 600;">Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>
                `;
            }
        }

        // ================================================================
        // SAMPLE PRICING UTILITY - Fetch API upcharges and calculate pricing
        // ================================================================

        /**
         * Calculate sample pricing with API-based size upcharges
         * @param {string} styleNumber - Product style number
         * @param {string} size - Size code (S, M, L, XL, 2XL, etc.)
         * @returns {Promise<Object>} - Pricing data with base price and all upcharges
         */
        async function calculateSamplePricing(styleNumber, size) {
            try {
                console.log(`[Sample Pricing] Calculating for ${styleNumber} size ${size}`);

                // Fetch pricing data from API
                const url = `https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/pricing-bundle?method=BLANK&styleNumber=${styleNumber}`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();

                // Get base cost for this specific size
                const sizeData = data.sizes?.find(s => s.size === size);
                const baseCost = sizeData ? parseFloat(sizeData.price) : parseFloat(data.sizes[0].price);

                // Get upcharge from API (handles tall sizes automatically!)
                const upcharge = parseFloat(data.sellingPriceDisplayAddOns?.[size] || 0);

                // Calculate sample pricing: blank product with 40% margin (÷0.6)
                const priceWithMargin = baseCost / 0.6;

                // Round using half-dollar ceiling (consistent with DTG/Screen Print)
                const roundedPrice = Math.ceil(priceWithMargin * 2) / 2;

                // Final price with upcharge
                const finalPrice = roundedPrice + upcharge;

                console.log(`[Sample Pricing] ${styleNumber} ${size}: Base $${baseCost.toFixed(2)} → Margin $${roundedPrice.toFixed(2)} + Upcharge $${upcharge.toFixed(2)} = $${finalPrice.toFixed(2)}`);

                return {
                    basePrice: finalPrice,
                    baseCost: baseCost,
                    marginPrice: roundedPrice,
                    upcharge: upcharge,
                    upcharges: data.sellingPriceDisplayAddOns || {}  // All upcharges for cart storage
                };
            } catch (error) {
                console.error(`[Sample Pricing] Error calculating pricing for ${styleNumber}:`, error);
                // Return fallback pricing (base margin only, no upcharge)
                return {
                    basePrice: 0,
                    baseCost: 0,
                    marginPrice: 0,
                    upcharge: 0,
                    upcharges: {},
                    error: error.message
                };
            }
        }

        // Make function globally available for product pages
        window.calculateSamplePricing = calculateSamplePricing;

        // Initialize when DOM is ready to avoid document.body being null
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.sampleCart = new SampleCart();
                window.sampleRequestService = new SampleRequestService();
            });
        } else {
            // DOM already loaded (shouldn't happen in head, but just in case)
            window.sampleCart = new SampleCart();
            window.sampleRequestService = new SampleRequestService();
        }
    </script>
    
    <style>
        :root {
            --primary-color: #4cb354;
            --primary-dark: #409a47;
            --primary-light: #5bc85f;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
            --success: #22c55e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 3px solid var(--primary-color);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            height: 60px;
        }

        .company-name {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .tagline {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .contact-header {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .contact-item:hover {
            color: var(--primary-color);
        }

        .contact-item i {
            color: var(--primary-color);
        }

        /* Search Section */
        .search-section {
            max-width: 700px;
            margin: -2rem auto 3rem;
            padding: 0 2rem;
            position: relative;
            z-index: 10;
        }
        
        .search-container {
            background: white;
            border-radius: 50px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
        }
        
        .search-container:focus-within {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        
        .search-icon {
            color: var(--text-secondary);
            font-size: 1.25rem;
            margin-right: 0.75rem;
        }
        
        .search-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1rem;
            padding: 0.75rem 0;
            color: var(--text-primary);
        }
        
        .search-input::placeholder {
            color: var(--text-secondary);
        }
        
        .search-clear {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.25rem;
            padding: 0.5rem;
            display: none;
            transition: color 0.2s ease;
        }
        
        .search-clear:hover {
            color: var(--primary-color);
        }
        
        .search-clear.active {
            display: block;
        }
        
        .search-results {
            margin-top: 1rem;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .search-results strong {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .no-results {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
        }
        
        .no-results i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .no-results h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .no-results p {
            margin-bottom: 1.5rem;
        }
        
        .reset-search {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .reset-search:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 2.5rem 0;
            text-align: center;
        }

        .hero-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .hero h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .hero-subtitle {
            font-size: 1.1rem;
            margin-bottom: 0;
            opacity: 0.95;
            font-weight: 400;
        }

        .hero-subtitle .separator {
            margin: 0 0.75rem;
            opacity: 0.6;
        }

        .hero-cta {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.875rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn-white {
            background: white;
            color: var(--primary-color);
        }

        .btn-white:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-outline:hover {
            background: white;
            color: var(--primary-color);
        }

        /* Filter Bar */
        .filter-bar {
            background: white;
            padding: 2rem 0;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 98px;
            z-index: 90;
        }

        .filter-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .filter-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 0.9375rem;
        }

        .decoration-filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 50px;
            font-size: 0.9375rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-btn:hover {
            border-color: var(--primary-color);
            background: var(--bg-color);
        }

        .filter-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .filter-btn i {
            font-size: 1.125rem;
        }

        /* Product Grid */
        .products-section {
            max-width: 1400px;
            margin: 3rem auto;
            padding: 0 2rem;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .product-badge {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(76, 179, 84, 0.95), rgba(76, 179, 84, 0.85));
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.8125rem;
            font-weight: 600;
            z-index: 10;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .product-image {
            height: 300px;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-style {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .product-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .color-swatches {
            display: flex;
            gap: 0.375rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .color-swatch {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .color-swatch:hover {
            transform: scale(1.2);
            border-color: var(--primary-color);
        }

        .color-swatch img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .more-colors {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--bg-color);
            border-radius: 50%;
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .product-cta {
            display: block;
            width: 100%;
            padding: 0.75rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .product-cta:hover {
            background: var(--primary-dark);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Contact Section */
        .contact-section {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            color: white;
            padding: 4rem 0;
            margin-top: 4rem;
        }

        .contact-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            text-align: center;
        }

        .contact-section h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .contact-subtitle {
            font-size: 1.125rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        /* CTA Buttons in Contact Section */
        .contact-section .hero-cta {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .contact-section .btn-white {
            background: white;
            color: var(--primary-color);
        }

        .contact-section .btn-white:hover {
            background: var(--bg-color);
            transform: translateY(-2px);
        }

        .contact-section .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .contact-section .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .ae-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .ae-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 12px;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ae-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-4px);
        }

        .ae-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .ae-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .ae-title {
            font-size: 0.9375rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .ae-email {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9375rem;
        }

        /* Quick View Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            padding: 2rem;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .modal-body {
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .modal-images {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .modal-main-image {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
        }

        .modal-main-image img {
            width: 100%;
            height: auto;
        }

        .modal-thumbnails {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }

        .modal-thumbnail {
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s ease;
        }

        .modal-thumbnail:hover,
        .modal-thumbnail.active {
            border-color: var(--primary-color);
        }

        .modal-thumbnail img {
            width: 100%;
            height: auto;
        }

        .modal-info h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .modal-style {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .modal-description {
            margin-bottom: 2rem;
            line-height: 1.8;
        }

        .modal-features {
            background: var(--bg-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .modal-features h4 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
        }

        .modal-features ul {
            list-style: none;
        }

        .modal-features li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .modal-features li:before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        .modal-cta {
            display: flex;
            gap: 1rem;
        }

        .modal-cta button {
            flex: 1;
            padding: 1rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-quote {
            background: var(--primary-color);
            color: white;
            border: none;
        }

        .btn-quote:hover {
            background: var(--primary-dark);
        }

        .btn-contact {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-contact:hover {
            background: var(--bg-color);
        }

        /* Footer */
        .footer {
            background: var(--text-primary);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .footer p {
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .decoration-filters {
                justify-content: center;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                gap: 1.5rem;
            }

            .modal-body {
                grid-template-columns: 1fr;
            }

            .ae-grid {
                grid-template-columns: 1fr;
            }

            .contact-header {
                flex-direction: column;
                gap: 1rem;
            }

            .contact-section .hero-cta {
                flex-direction: column;
            }

            .contact-section .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* No products message */
        .no-products {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .no-products i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .no-products h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        /* Sample Request Styles */
        .btn-sample {
            padding: 0.625rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: none; /* Hidden until eligibility checked */
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            width: 100%;
            justify-content: center;
            border: 2px solid;
        }
        
        .btn-sample-free {
            background: white;
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-sample-paid {
            background: white;
            color: #2563eb;
            border-color: #2563eb;
        }
        
        .btn-sample:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-sample.in-cart {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-light);
        }
        
        .btn-sample:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Sample Cart Widget */
        /* Sample Cart - Header Integrated */
        .sample-cart-widget {
            display: none; /* Hidden until items added */
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background: var(--primary-color, #2d5f3f);
            color: white;
            transition: background 0.2s ease; /* Simple transition */
            font-size: 0.95rem;
            margin-left: 0.5rem;
        }

        .sample-cart-widget:hover {
            background: #1f4229; /* Slightly darker on hover */
        }

        .sample-cart-widget:focus {
            outline: 2px solid #4CAF50;
            outline-offset: 2px;
        }

        .sample-cart-icon {
            position: relative;
            font-size: 1.2rem;
        }

        .sample-count-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .sample-cart-label {
            font-weight: 500;
            font-size: 0.95rem;
        }

        /* Mobile: Keep simple */
        @media (max-width: 768px) {
            .sample-cart-widget {
                padding: 0.5rem 0.75rem;
                gap: 0.4rem;
            }

            .sample-cart-label {
                font-size: 0.9rem;
            }

            .sample-cart-icon {
                font-size: 1.1rem;
            }
        }
        
        /* Sample Selection Modal */
        .sample-selection-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .sample-selection-modal.active {
            opacity: 1;
        }
        
        .sample-selection-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        
        .sample-selection-content h3 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
        }
        
        .sample-selection-content p {
            color: var(--text-secondary);
            margin: 0 0 1.5rem 0;
        }
        
        .selection-group {
            margin-bottom: 1.5rem;
        }
        
        .selection-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .selection-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .selection-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .selection-actions button {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-cancel {
            background: white;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        
        .btn-confirm {
            background: var(--primary-color);
            border: none;
            color: white;
        }
        
        .btn-confirm:hover {
            background: var(--primary-dark);
        }
        
        /* Toast Notifications */
        .sample-toast {
            position: fixed;
            bottom: 100px;
            right: 30px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 1100;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .sample-toast-show {
            transform: translateX(0);
        }
        
        .sample-toast-success {
            border-left: 4px solid var(--primary-color);
        }
        
        .sample-toast-warning {
            border-left: 4px solid #ff9800;
        }
        
        .sample-toast-info {
            border-left: 4px solid #2196f3;
        }
        
        /* Sample Request Modal */
        .sample-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .sample-modal.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 3rem;
        }
        
        .sample-modal-content {
            background: white;
            border-radius: 12px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .sample-modal-header {
            padding: 2rem;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }
        
        .sample-modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .sample-modal-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .sample-modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .sample-modal-close:hover {
            color: var(--text-primary);
        }
        
        .sample-modal-body {
            padding: 2rem;
        }
        
        .selected-samples {
            margin-bottom: 2rem;
        }
        
        .selected-samples h3 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        .sample-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-color);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }
        
        .sample-item-image {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            overflow: hidden;
            background: white;
        }
        
        .sample-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .sample-item-info {
            flex: 1;
        }
        
        .sample-item-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .sample-item-style {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .sample-item-remove {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 1.25rem;
            transition: color 0.2s ease;
        }
        
        .sample-item-remove:hover {
            color: #c82333;
        }
        
        /* Sample Request Form */
        .sample-form {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9375rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .delivery-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .radio-option {
            display: flex;
            align-items: flex-start;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .radio-option:hover {
            border-color: var(--primary-color);
            background: rgba(76, 179, 84, 0.05);
        }
        
        .radio-option input[type="radio"] {
            margin-right: 0.75rem;
            margin-top: 0.25rem;
        }
        
        .radio-option input[type="radio"]:checked + .radio-label {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .radio-label {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .radio-label i {
            margin-right: 0.5rem;
        }
        
        .radio-label small {
            display: block;
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            font-weight: normal;
        }
        
        .order-total-display {
            background: var(--bg-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }
        
        .order-total-display h4 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
        }
        
        .total-line {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            color: var(--text-secondary);
        }
        
        .total-line.total-final {
            border-top: 2px solid var(--border-color);
            margin-top: 0.5rem;
            padding-top: 1rem;
            font-weight: 600;
            font-size: 1.125rem;
            color: var(--text-primary);
        }
        
        .form-submit {
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 1rem;
        }
        
        .form-submit:hover:not(:disabled) {
            background: var(--primary-dark);
        }
        
        .form-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Sample eligibility badge */
        .sample-eligible-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary-color);
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 5;
        }
        
        /* Product card actions */
        .product-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo-section">
                <a href="/" style="display: flex; align-items: center; gap: 1rem; text-decoration: none;">
                    <img src="https://cdn.caspio.com/A0E15000/Safety%20Stripes/web%20northwest%20custom%20apparel%20logo.png?ver=1" alt="Northwest Custom Apparel" class="logo" style="cursor: pointer;">
                    <div>
                        <div class="company-name" style="color: var(--text-primary);">Northwest Custom Apparel</div>
                        <div class="tagline">Family Owned Since 1977</div>
                    </div>
                </a>
            </div>
            <div class="contact-header">
                <a href="tel:253-922-5793" class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>253-922-5793</span>
                </a>
                <a href="mailto:sales@nwcustomapparel.com" class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <span>Quick Quote</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-container">
            <h1>Start with Our Best Sellers</h1>
            <p class="hero-subtitle">Proven quality<span class="separator">•</span>Fast turnaround<span class="separator">•</span>Pacific Northwest favorites</p>
        </div>
    </section>

    <!-- Search Section -->
    <section class="search-section">
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" 
                   class="search-input" 
                   id="searchInput" 
                   placeholder="Search products by name, style, brand..." 
                   autocomplete="off">
            <button class="search-clear" id="searchClear" onclick="clearSearch()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="search-results" id="searchResults" style="display: none;">
            Found <strong id="resultCount">0</strong> products
        </div>
    </section>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="filter-container">
            <div class="filter-header">
                <div class="filter-title">Filter by Decoration Type</div>
                <div class="results-count" id="resultsCount">Showing 0 products</div>
            </div>
            <div class="decoration-filters">
                <button class="filter-btn active" data-type="all">
                    <i class="fas fa-th"></i>
                    <span>All Products</span>
                </button>
                <button class="filter-btn" data-type="dtg">
                    <i class="fas fa-print"></i>
                    <span>DTG Printing</span>
                </button>
                <button class="filter-btn" data-type="screenprint">
                    <i class="fas fa-paint-brush"></i>
                    <span>Screen Printing</span>
                </button>
                <button class="filter-btn" data-type="embroidery">
                    <i class="fas fa-sewing-needle"></i>
                    <span>Embroidery</span>
                </button>
                <button class="filter-btn" data-type="caps">
                    <i class="fas fa-hat-cowboy"></i>
                    <span>Caps & Hats</span>
                </button>
                <button class="filter-btn" data-type="freshPicks">
                    <i class="fas fa-sparkles"></i>
                    <span>Brinton's Fresh Picks 2025</span>
                </button>
                <button class="filter-btn" data-type="newProducts">
                    <i class="fas fa-star"></i>
                    <span>New Products</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Products Section -->
    <section class="products-section">
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <p style="margin-top: 1rem; color: var(--text-secondary);">Loading products...</p>
        </div>
        <div class="products-grid" id="productsGrid" style="display: none;">
            <!-- Products will be dynamically loaded here -->
        </div>
        <div class="no-products" id="noProducts" style="display: none;">
            <i class="fas fa-box-open"></i>
            <h3>No products found</h3>
            <p>Try selecting a different category</p>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact-section" id="contact">
        <div class="contact-container">
            <h2>Ready to Order? Contact Our Team</h2>
            <p class="contact-subtitle">Our experienced account executives are here to help with your custom apparel needs</p>

            <!-- CTA Buttons -->
            <div class="hero-cta" style="margin-bottom: 2.5rem;">
                <a href="mailto:sales@nwcustomapparel.com" class="btn btn-white">
                    <i class="fas fa-user-tie"></i>
                    Contact an Account Executive
                </a>
                <a href="tel:253-922-5793" class="btn btn-outline">
                    <i class="fas fa-phone"></i>
                    Call for Quick Quote: (253) 922-5793
                </a>
            </div>

            <div class="ae-grid">
                <a href="mailto:nika@nwcustomapparel.com" class="ae-card">
                    <i class="fas fa-user-circle ae-icon"></i>
                    <div class="ae-name">Nika Lao</div>
                    <div class="ae-title">Account Executive</div>
                    <div class="ae-email">
                        <i class="fas fa-envelope"></i>
                        nika@nwcustomapparel.com
                    </div>
                </a>
                <a href="mailto:taneisha@nwcustomapparel.com" class="ae-card">
                    <i class="fas fa-user-circle ae-icon"></i>
                    <div class="ae-name">Taneisha Clark</div>
                    <div class="ae-title">Account Executive</div>
                    <div class="ae-email">
                        <i class="fas fa-envelope"></i>
                        taneisha@nwcustomapparel.com
                    </div>
                </a>
                <a href="mailto:sales@nwcustomapparel.com" class="ae-card">
                    <i class="fas fa-users ae-icon"></i>
                    <div class="ae-name">Sales Team</div>
                    <div class="ae-title">General Inquiries</div>
                    <div class="ae-email">
                        <i class="fas fa-envelope"></i>
                        sales@nwcustomapparel.com
                    </div>
                </a>
            </div>
        </div>
    </section>

    <!-- Quick View Modal -->
    <div id="quickViewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Product Details</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Product details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 Northwest Custom Apparel. All rights reserved.</p>
            <p>2025 Freeman Road East, Milton, WA 98354 | 253-922-5793</p>
        </div>
    </footer>


    <script>
        // Complete top sellers data - ALL 60 products
        const completeTopSellers = {
            dtg: [
                { rank: 1, style: 'PC54', description: 'Port & Company - Core Cotton Tee', brand: 'Port & Company' },
                { rank: 2, style: 'PC450', description: 'Port & Company Fan Favorite Tee', brand: 'Port & Company' },
                { rank: 3, style: 'PC61', description: 'Port & Company - Essential Tee', brand: 'Port & Company' },
                { rank: 4, style: 'PC78H', description: 'Port & Company - Core Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 5, style: 'PC55', description: 'Port & Company - Core Blend Tee', brand: 'Port & Company' },
                { rank: 6, style: 'PC61LS', description: 'Port & Company - Long Sleeve Essential Tee', brand: 'Port & Company' },
                { rank: 7, style: 'PC600', description: 'Port & Company Bouncer Tee', brand: 'Port & Company' },
                { rank: 8, style: 'PC90H', description: 'Port & Company - Essential Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 9, style: 'BC3001', description: 'BellaCanvas Unisex Jersey Short Sleeve Tee', brand: 'BellaCanvas' },
                { rank: 10, style: 'GRT-50', description: 'Logo Mockup & Print Review Service', brand: 'Service' },
                { rank: 11, style: 'PC54LS', description: 'Port & Company - Long Sleeve Core Cotton Tee', brand: 'Port & Company' },
                { rank: 12, style: 'CTK87', description: 'Carhartt Workwear Pocket Short Sleeve T-Shirt', brand: 'Carhartt' }
            ],
            caps: [
                { rank: 1, style: 'C112', description: 'Port Authority Snapback Trucker Cap', brand: 'Port Authority' },
                { rank: 2, style: '112', description: 'Richardson Trucker Cap with Mesh Snap Back', brand: 'Richardson' },
                { rank: 3, style: 'NE1000', description: 'New Era - Structured Stretch Cotton Cap', brand: 'New Era' },
                { rank: 4, style: 'C110', description: 'Port Authority Flexfit 110 Mesh Cap', brand: 'Port Authority' },
                { rank: 5, style: 'CP90', description: 'Port & Company Knit Cap', brand: 'Port & Company' },
                { rank: 6, style: 'C826', description: 'Port Authority Pique Mesh Cap L/XL', brand: 'Port Authority' },
                { rank: 7, style: 'C114', description: 'Port Authority Digi Camo Snapback Trucker Cap', brand: 'Port Authority' },
                { rank: 8, style: 'C912', description: 'Port Authority Camouflage Cap With Air Mesh Back', brand: 'Port Authority' },
                { rank: 9, style: 'TM1MU423', description: 'Travismathew Cruz Trucker Cap', brand: 'TravisMathew' },
                { rank: 10, style: 'CP85', description: 'Port & Company Sandwich Bill Cap', brand: 'Port & Company' },
                { rank: 11, style: 'C865', description: 'Port Authority Flexfit Cap', brand: 'Port Authority' },
                { rank: 12, style: 'CP82', description: 'Port & Company Brushed Twill Cap', brand: 'Port & Company' }
            ],
            embroidery: [
                { rank: 1, style: 'NKDC1963', description: 'Nike Dri-Fit Micro Pique 2.0 Polo', brand: 'Nike' },
                { rank: 2, style: 'CT104670', description: 'Carhartt Storm Defender Shoreline Jacket', brand: 'Carhartt' },
                { rank: 3, style: 'EB532', description: 'Eddie Bauer Shaded Crosshatch Soft Shell Jacket', brand: 'Eddie Bauer' },
                { rank: 4, style: '267020', description: 'Nike Dri-Fit Classic Polo', brand: 'Nike' },
                { rank: 5, style: 'CT100617', description: 'Carhartt Rain Defender Paxton Heavyweight Hooded Zip Mock Sweatshirt', brand: 'Carhartt' },
                { rank: 6, style: 'ST253', description: 'Sport-Tek 1/4-Zip Sweatshirt', brand: 'Sport-Tek' },
                { rank: 7, style: 'C112', description: 'Port Authority Snapback Trucker Cap', brand: 'Port Authority' },
                { rank: 8, style: 'CTK121', description: 'Carhartt Midweight Hooded Sweatshirt', brand: 'Carhartt' },
                { rank: 9, style: 'CT103828', description: 'Carhartt Duck Detroit Jacket', brand: 'Carhartt' },
                { rank: 10, style: 'CT89176508', description: 'Carhartt Foundry Series Pro Backpack', brand: 'Carhartt' },
                { rank: 11, style: 'ST650', description: 'Sport-Tek Micropique Sport-Wick Polo', brand: 'Sport-Tek' },
                { rank: 12, style: 'CT104597', description: 'Carhartt Watch Cap 2.0', brand: 'Carhartt' },
                { rank: 13, style: 'EB550', description: 'Eddie Bauer - Rain Jacket', brand: 'Eddie Bauer' },
                { rank: 14, style: 'CT102286', description: 'Carhartt Gilliam Vest', brand: 'Carhartt' },
                { rank: 15, style: 'ST850', description: 'Sport-Tek Sport-Wick Stretch 1/4-Zip Pullover', brand: 'Sport-Tek' }
            ],
            screenprint: [
                { rank: 1, style: 'PC90H', description: 'Port & Company - Essential Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 2, style: 'PC55', description: 'Port & Company - Core Blend Tee', brand: 'Port & Company' },
                { rank: 3, style: '18500', description: 'Gildan - Heavy Blend Hooded Sweatshirt', brand: 'Gildan' },
                { rank: 4, style: 'PC78H', description: 'Port & Company - Core Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 5, style: 'PC600', description: 'Port & Company Bouncer Tee', brand: 'Port & Company' },
                { rank: 6, style: '996M', description: 'Jerzees - Nublend Pullover Hooded Sweatshirt', brand: 'Jerzees' },
                { rank: 7, style: 'BC3001', description: 'BellaCanvas Unisex Jersey Short Sleeve Tee', brand: 'BellaCanvas' },
                { rank: 8, style: '5186', description: 'Hanes Adult Long-Sleeve Beefy-T', brand: 'Hanes' },
                { rank: 9, style: 'PC55P', description: 'Port & Company - Core Blend Pocket Tee', brand: 'Port & Company' },
                { rank: 10, style: 'PC54', description: 'Port & Company - Core Cotton Tee', brand: 'Port & Company' },
                { rank: 11, style: 'CS204', description: 'CornerStone ANSI 107 Class 2 Segmented Tape Tee', brand: 'CornerStone' },
                { rank: 12, style: '5180', description: 'Hanes Beefy-T - 100 Cotton T-Shirt', brand: 'Hanes' },
                { rank: 13, style: 'DT6100', description: 'District V.I.T. Fleece Hoodie', brand: 'District' },
                { rank: 14, style: 'SPRESET', description: 'Screen Reset Charge', brand: 'Service' }
            ],
            freshPicks: [
                // Essential Value Tees
                { rank: 1, style: 'PC43', description: 'Port & Company Essential Pigment-Dyed Tee', brand: 'Port & Company' },
                { rank: 2, style: 'PC340', description: 'Port & Company CVC Tee', brand: 'Port & Company' },
                { rank: 3, style: 'PC330', description: 'Port & Company Tri-Blend Tee', brand: 'Port & Company' },
                
                // District Premium Collection
                { rank: 4, style: 'DT6000', description: 'District Perfect Weight Tee', brand: 'District' },
                { rank: 5, style: 'DT6200', description: 'District Very Important Tee', brand: 'District' },
                { rank: 6, style: 'DT106', description: 'District Re-Tee', brand: 'District' },
                { rank: 7, style: 'DM108', description: 'District Perfect Blend CVC Tee', brand: 'District' },
                { rank: 8, style: 'DT184', description: 'District Women\'s Perfect Blend CVC Tee', brand: 'District' },
                { rank: 9, style: 'DT8000', description: 'District Re-Fleece Full-Zip Hoodie', brand: 'District' },
                { rank: 10, style: 'DM130', description: 'District Perfect Tri Tee', brand: 'District' },
                { rank: 11, style: 'DT2101', description: 'District Flannel Shirt', brand: 'District' },
                { rank: 12, style: 'DT6065', description: 'District V.I.T. Heavyweight Tee', brand: 'District' },
                
                // Performance Collection
                { rank: 13, style: 'PC380', description: 'Port & Company Performance Blend Tee', brand: 'Port & Company' },
                { rank: 14, style: 'ST350', description: 'Sport-Tek PosiCharge Competitor Tee', brand: 'Sport-Tek' },
                { rank: 15, style: 'ST490', description: 'Sport-Tek Dry Zone Colorblock Raglan Polo', brand: 'Sport-Tek' },
                
                // Professional Polos
                { rank: 16, style: 'K200', description: 'Port Authority Pima Cotton Polo', brand: 'Port Authority' },
                { rank: 17, style: 'K500', description: 'Port Authority Silk Touch Polo', brand: 'Port Authority' },
                { rank: 18, style: 'K240', description: 'Port Authority Wearever Performance Pique Polo', brand: 'Port Authority' },
                { rank: 19, style: 'CS450', description: 'CornerStone Select Lightweight Snag-Proof Tactical Polo', brand: 'CornerStone' },
                { rank: 20, style: 'MM1014', description: 'Mercer+Mettle Stretch Jersey Polo', brand: 'Mercer+Mettle' },
                
                // Comfort Fleece
                { rank: 21, style: 'DT6150', description: 'District Featherweight French Terry Hoodie', brand: 'District' },
                { rank: 22, style: 'DT7800', description: 'District Cloud Fleece Hoodie', brand: 'District' },
                
                // Headwear Additions
                { rank: 23, style: 'STC39', description: 'Sport-Tek PosiCharge Competitor Cap', brand: 'Sport-Tek' },
                { rank: 24, style: 'STC54', description: 'Sport-Tek PosiCharge Competitor Mesh Back Cap', brand: 'Sport-Tek' }
            ]
        };

        // Brand placeholder styles for non-API products
        const brandPlaceholders = {
            'Nike': {
                background: 'linear-gradient(135deg, #111111, #333333)',
                icon: `<svg viewBox="0 0 24 24" style="width: 60px; height: 60px; fill: white;"><path d="M6.75 2.77l9.57 6.14c.27.18.57.27.9.27a1.5 1.5 0 0 0 1.02-.39c.77-.77.6-2.03-.39-2.84L6.23.01C5.5-.33 4.92.11 4.92.91c0 .52.09 1.19.22 1.86c.2 1.11.52 2.8.92 4.38c.5 1.94 1.15 3.9 2.06 5.16c.3.41.64.71 1 .87c.29.13.6.19.92.19c.52 0 1.03-.15 1.49-.45c1.55-.97 2.85-2.76 3.45-4.35Z"/></svg>`,
                tagline: 'Just Do It®',
                textColor: 'white'
            },
            'Carhartt': {
                background: 'linear-gradient(135deg, #8b6f47, #6d5943)',
                icon: '<span style="font-size: 48px; font-weight: bold; color: white;">C</span>',
                tagline: 'Outworking Since 1889',
                textColor: 'white'
            },
            'Eddie Bauer': {
                background: 'linear-gradient(135deg, #1a3a52, #2d5016)',
                icon: '<span style="font-size: 36px; font-weight: bold; color: white;">EB</span>',
                tagline: 'First Ascent',
                textColor: 'white'
            },
            'New Era': {
                background: 'linear-gradient(135deg, #000000, #1a1a1a)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">NEW ERA</span>',
                tagline: 'Authentic Performance',
                textColor: 'white'
            },
            'TravisMathew': {
                background: 'linear-gradient(135deg, #2c5aa0, #1e3a6f)',
                icon: '<span style="font-size: 28px; font-weight: 300; color: white;">TM</span>',
                tagline: 'Life on Tour',
                textColor: 'white'
            },
            'Gildan': {
                background: 'linear-gradient(135deg, #0066cc, #003d7a)',
                icon: '<span style="font-size: 36px; font-weight: bold; color: white;">G</span>',
                tagline: 'Quality Basics',
                textColor: 'white'
            },
            'BellaCanvas': {
                background: 'linear-gradient(135deg, #e91e63, #c2185b)',
                icon: '<span style="font-size: 28px; font-weight: 300; color: white;">BELLA</span>',
                tagline: 'Retail Inspired',
                textColor: 'white'
            },
            'Jerzees': {
                background: 'linear-gradient(135deg, #ff6b35, #f44336)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">J</span>',
                tagline: 'Quality Essentials',
                textColor: 'white'
            },
            'Hanes': {
                background: 'linear-gradient(135deg, #b71c1c, #d32f2f)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">H</span>',
                tagline: 'Comfort Made Better',
                textColor: 'white'
            },
            'Richardson': {
                background: 'linear-gradient(135deg, #37474f, #263238)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">R</span>',
                tagline: 'The Hat of Choice',
                textColor: 'white'
            },
            'District': {
                background: 'linear-gradient(135deg, #9c27b0, #7b1fa2)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">D</span>',
                tagline: 'Everyday Tees',
                textColor: 'white'
            },
            'CornerStone': {
                background: 'linear-gradient(135deg, #ff9800, #f57c00)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">CS</span>',
                tagline: 'Work Tough',
                textColor: 'white'
            },
            'Sport-Tek': {
                background: 'linear-gradient(135deg, #2e7d32, #388e3c)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">ST</span>',
                tagline: 'Sport Performance',
                textColor: 'white'
            },
            'Port Authority': {
                background: 'linear-gradient(135deg, #1565c0, #1976d2)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">PA</span>',
                tagline: 'Professional Apparel',
                textColor: 'white'
            },
            'Port & Company': {
                background: 'linear-gradient(135deg, #5e35b1, #673ab7)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">PC</span>',
                tagline: 'Essential Basics',
                textColor: 'white'
            },
            'Generic': {
                background: 'linear-gradient(135deg, #757575, #9e9e9e)',
                icon: '<i class="fas fa-tshirt" style="font-size: 48px; color: white;"></i>',
                tagline: 'Quality Apparel',
                textColor: 'white'
            }
        };

        // Simple image overrides for specific products
        const imageOverrides = {
            '112': 'https://c3eku948.caspio.com/dp/a0e150004df4984fb1ef4d30b01a/files/9108697'
        };
        
        // Product descriptions for items without API data
        const productDescriptions = {
            '112': {
                fullDescription: `The 112 is the standard by which all truckers are measured. Popular for its undeniable quality and versatility, this casual classic is constructed with the trademark attention to detail that we've built our reputation on. With a design shaped by more than 50 years of cap-making expertise and available in over 50 colorways, the 112 has inspired many imitations yet continues to be the most popular cap in the USA.`,
                features: [
                    'Six-panel construction delivers the classic look and feel the 112 is famous for',
                    'Premium materials and craftsmanship ensure an ideal fit for all sizes',
                    'Our Standard cotton sweatband provides comfort for all-day wear',
                    'Featured Decoration: Woven Patch'
                ],
                decorations: ['Embroidery', 'Leather', 'Patches', 'Labels', 'Transfers'],
                sizes: 'Now available in Extra Large, Small, and Youth sizes'
            }
        };
        
        // Product cache
        const productCache = {};
        let currentFilter = 'all';
        let allProducts = [];
        let searchTerm = '';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts('all');
            setupEventListeners();
            initializeSearch();
        });

        // Initialize search functionality
        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchClear = document.getElementById('searchClear');
            
            searchInput.addEventListener('input', (e) => {
                searchTerm = e.target.value.toLowerCase();
                searchClear.classList.toggle('active', searchTerm.length > 0);
                performSearch();
            });
        }
        
        // Clear search
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchClear').classList.remove('active');
            searchTerm = '';
            performSearch();
        }
        
        // Perform search and filter
        function performSearch() {
            const searchResults = document.getElementById('searchResults');
            const productsGrid = document.getElementById('productsGrid');
            const resultsCount = document.getElementById('resultsCount');
            let matchCount = 0;
            
            productsGrid.innerHTML = '';
            
            for (const product of allProducts) {
                // Build searchable text using both possible property names
                const name = product.name || product.description || '';
                const style = product.styleNumber || product.style || '';
                const brand = product.brand || detectBrand(name) || '';
                const searchableText = `${name} ${style} ${brand} ${product.type || ''}`.toLowerCase();
                
                // Check if matches search
                if (!searchTerm || searchableText.includes(searchTerm)) {
                    matchCount++;
                    const card = createProductCard(product);
                    if (card) {
                        productsGrid.appendChild(card);
                    }
                }
            }
            
            // Update results display
            if (searchTerm) {
                searchResults.style.display = 'block';
                document.getElementById('resultCount').textContent = matchCount;
            } else {
                searchResults.style.display = 'none';
            }
            
            resultsCount.textContent = `Showing ${matchCount} products`;
            
            // Show no results message if needed
            if (matchCount === 0 && searchTerm) {
                productsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1;">
                        <div class="no-results">
                            <i class="fas fa-search"></i>
                            <h3>No products found</h3>
                            <p>Try adjusting your search terms</p>
                            <button class="reset-search" onclick="clearSearch()">Clear Search</button>
                        </div>
                    </div>
                `;
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.type;
                    loadProducts(currentFilter);
                });
            });

            // Modal close on outside click
            document.getElementById('quickViewModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        // Load products based on filter
        async function loadProducts(type) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const productsGrid = document.getElementById('productsGrid');
            const noProducts = document.getElementById('noProducts');
            
            loadingIndicator.style.display = 'block';
            productsGrid.style.display = 'none';
            noProducts.style.display = 'none';
            
            allProducts = [];
            
            if (type === 'all') {
                // Load all categories - ALL 60 products
                for (const [category, products] of Object.entries(completeTopSellers)) {
                    for (const product of products) {
                        allProducts.push({...product, type: category});
                    }
                }
            } else if (type === 'newProducts') {
                // Fetch new products from API
                try {
                    const response = await fetch('https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/products/new?limit=100');
                    if (response.ok) {
                        const result = await response.json();
                        // Handle direct products array (no .data wrapper for /api/products/new)
                        const products = result.products || [];

                        // Group by style number first to get unique products
                        const uniqueProducts = new Map();
                        products.forEach(p => {
                            const style = p.STYLE;
                            if (!uniqueProducts.has(style)) {
                                uniqueProducts.set(style, p);
                            }
                        });

                        // Filter out DISCONTINUED products
                        const activeProducts = Array.from(uniqueProducts.values()).filter(p =>
                            !p.PRODUCT_TITLE?.includes('DISCONTINUED') &&
                            !p.PRODUCT_DESCRIPTION?.includes('DISCONTINUED')
                        );

                        // Convert API products to our format with comprehensive fallbacks
                        allProducts = activeProducts.map(product => ({
                            style: product.STYLE || 'UNKNOWN',
                            description: product.PRODUCT_TITLE?.split('.')[0]?.trim() || product.PRODUCT_DESCRIPTION || 'Unknown Product',
                            brand: product.MILL || 'Unknown Brand',
                            imageUrl: product.COLOR_PRODUCT_IMAGE || product.PRODUCT_IMAGE || product.THUMBNAIL_IMAGE,
                            type: 'newProducts'
                        }));
                    }
                } catch (error) {
                    console.error('Error fetching new products:', error);
                    allProducts = []; // Graceful failure
                }
            } else {
                // Load specific category
                if (completeTopSellers[type]) {
                    for (const product of completeTopSellers[type]) {
                        allProducts.push({...product, type});
                    }
                }
            }

            // Fetch product details from API for all products
            const productsWithDetails = await Promise.all(
                allProducts.map(async (product) => {
                    // Skip service items
                    if (product.brand === 'Service') {
                        return {
                            ...product,
                            details: null,
                            isService: true
                        };
                    }
                    
                    if (!productCache[product.style]) {
                        try {
                            const response = await fetch(`https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/product-details?styleNumber=${product.style}`);
                            if (response.ok) {
                                const details = await response.json();
                                if (details && details.length > 0) {
                                    productCache[product.style] = details;
                                }
                            }
                        } catch (error) {
                            console.error(`Error fetching ${product.style}:`, error);
                        }
                    }
                    return {
                        ...product,
                        details: productCache[product.style] || null
                    };
                })
            );

            // Store products for search
            allProducts = productsWithDetails;
            
            // Display products (or perform search if there's a search term)
            if (searchTerm) {
                performSearch();
            } else {
                displayProducts(productsWithDetails);
                document.getElementById('resultsCount').textContent = `Showing ${productsWithDetails.length} products`;
            }
            
            loadingIndicator.style.display = 'none';
            productsGrid.style.display = 'grid';
        }

        // Create product card
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            
            // Add data attributes for search
            card.dataset.productName = product.name || product.description || '';
            card.dataset.styleNumber = product.styleNumber || product.style || '';
            card.dataset.brand = product.brand || detectBrand(product.name || product.description) || '';
            card.dataset.category = product.type || '';
            
            const decorationType = getDecorationType(product.type);
            
            // Check if this is a service item
            if (product.isService) {
                // Don't show service items in catalog
                return null;
            }
            
            // Check if we have API data
                if (product.details && product.details.length > 0) {
                    // Product with real images from API
                    const firstProduct = product.details[0];
                    
                    // Get unique colors only
                    const uniqueColors = [];
                    const seenColors = new Set();
                    
                    for (const item of product.details) {
                        if (item.COLOR_NAME && !seenColors.has(item.COLOR_NAME)) {
                            seenColors.add(item.COLOR_NAME);
                            uniqueColors.push(item);
                        }
                    }
                    
                    const colorsToShow = uniqueColors.slice(0, 5);

                    // Detect Richardson products (not in Sanmar API)
                    const isRichardson = product.brand?.toLowerCase().includes('richardson') ||
                                       product.style === '112' ||
                                       product.description?.toLowerCase().includes('richardson');

                    card.onclick = () => navigateToProduct(product);

                    // Check for image override first
                    const imageUrl = imageOverrides[product.style] ||
                                    firstProduct.FRONT_MODEL ||
                                    firstProduct.FRONT_FLAT ||
                                    firstProduct.PRODUCT_IMAGE;
                    
                    card.innerHTML = `
                        <div class="product-image">
                            <div class="product-badge">${decorationType}</div>
                            <img src="${imageUrl}"
                                 alt="${product.description || 'Product Image'}"
                                 onerror="this.src='${firstProduct.PRODUCT_IMAGE || ''}'">
                        </div>
                        <div class="product-info">
                            <div class="product-style">Style #${product.style}</div>
                            <div class="product-name">${product.description || 'Unknown Product'}</div>
                            <div class="color-swatches">
                                ${colorsToShow.map(c => `
                                    <div class="color-swatch" title="${c.COLOR_NAME}">
                                        <img src="${c.COLOR_SQUARE_IMAGE}" alt="${c.COLOR_NAME}">
                                    </div>
                                `).join('')}
                                ${uniqueColors.length > 5 ? `
                                    <div class="more-colors">+${uniqueColors.length - 5}</div>
                                ` : ''}
                            </div>
                            <div class="product-actions">
                                ${isRichardson ? `
                                    <button class="btn-sample" disabled style="opacity: 0.5; cursor: not-allowed;"
                                            title="Richardson samples not available online - Call 253-922-5793">
                                        <i class="fas fa-phone"></i> Call for Sample
                                    </button>
                                ` : `
                                    <button class="btn-sample" data-style="${product.style}" data-eligible="pending"
                                            onclick="event.stopPropagation(); handleSampleRequest('${product.style}', '${(product.description || '').replace(/'/g, "\\'")}', '${firstProduct.FRONT_MODEL || firstProduct.PRODUCT_IMAGE || ''}')">
                                        <i class="fas fa-box-open"></i> Request Sample
                                    </button>
                                `}
                            </div>
                        </div>
                    `;
                } else {
                    // Product without API data - check for image from API, override, or use placeholder
                    const brandStyle = brandPlaceholders[product.brand] || brandPlaceholders['Generic'];
                    const productImage = product.imageUrl || imageOverrides[product.style];

                    // Detect Richardson products (not in Sanmar API)
                    const isRichardson = product.brand?.toLowerCase().includes('richardson') ||
                                       product.style === '112' ||
                                       product.description?.toLowerCase().includes('richardson');

                    card.onclick = () => navigateToProduct(product);

                    // If we have a product image (from API or override), use it; otherwise use the brand placeholder
                    if (productImage) {
                        card.innerHTML = `
                            <div class="product-image">
                                <div class="product-badge">${decorationType}</div>
                                <img src="${productImage}"
                                     alt="${product.description || 'Product Image'}"
                                     onerror="this.style.display='none'">
                            </div>
                        `;
                    } else {
                        card.innerHTML = `
                            <div class="product-image" style="background: ${brandStyle ? brandStyle.background : 'linear-gradient(135deg, #e0e0e0, #bdbdbd)'}; display: flex; flex-direction: column; justify-content: center; align-items: center; color: ${brandStyle ? brandStyle.textColor : '#666'}; position: relative;">
                                <div class="product-badge">${decorationType}</div>
                                ${brandStyle ? brandStyle.icon : '<i class="fas fa-tshirt" style="font-size: 48px;"></i>'}
                                <div style="margin-top: 1rem; font-size: 0.875rem; font-weight: 600;">${product.brand}</div>
                                ${brandStyle && brandStyle.tagline ? `<div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;">${brandStyle.tagline}</div>` : ''}
                            </div>
                        `;
                    }
                    
                    card.innerHTML += `
                        <div class="product-info">
                            <div class="product-style">Style #${product.style}</div>
                            <div class="product-name">${product.description || 'Unknown Product'}</div>
                            <div style="padding: 0.75rem 0; text-align: center; color: var(--text-secondary); font-size: 0.875rem;">
                                <i class="fas fa-award" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                                Premium ${product.brand} Product
                            </div>
                            <div class="product-actions">
                                ${isRichardson ? `
                                    <button class="btn-sample" disabled style="opacity: 0.5; cursor: not-allowed;"
                                            title="Richardson samples not available online - Call 253-922-5793">
                                        <i class="fas fa-phone"></i> Call for Sample
                                    </button>
                                ` : `
                                    <button class="btn-sample" data-style="${product.style}" data-eligible="pending"
                                            onclick="event.stopPropagation(); handleSampleRequest('${product.style}', '${(product.description || '').replace(/'/g, "\\'")}', '')">
                                        <i class="fas fa-box-open"></i> Request Sample
                                    </button>
                                `}
                            </div>
                        </div>
                    `;
            }
            
            return card;
        }
        
        // Display products in grid
        function displayProducts(products) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            
            products.forEach(product => {
                const card = createProductCard(product);
                if (card) {
                    grid.appendChild(card);
                }
            });
            
            // Check eligibility and update buttons after products are displayed
            setTimeout(() => {
                if (window.sampleCart && typeof window.sampleCart.checkAllProductEligibility === 'function') {
                    console.log('Checking sample eligibility for all products...');
                    window.sampleCart.checkAllProductEligibility();
                } else {
                    console.log('Sample cart not ready, retrying...');
                    setTimeout(() => {
                        if (window.sampleCart) {
                            window.sampleCart.checkAllProductEligibility();
                        }
                    }, 500);
                }
            }, 100);
        }
        
        // Detect brand from product name
        function detectBrand(name) {
            if (!name) return '';
            const nameLower = name.toLowerCase();
            if (nameLower.includes('nike')) return 'Nike';
            if (nameLower.includes('carhartt')) return 'Carhartt';
            if (nameLower.includes('eddie bauer')) return 'Eddie Bauer';
            if (nameLower.includes('new era')) return 'New Era';
            if (nameLower.includes('port & company')) return 'Port & Company';
            if (nameLower.includes('port authority')) return 'Port Authority';
            if (nameLower.includes('sport-tek')) return 'Sport-Tek';
            if (nameLower.includes('gildan')) return 'Gildan';
            if (nameLower.includes('jerzees')) return 'Jerzees';
            if (nameLower.includes('bella')) return 'Bella+Canvas';
            if (nameLower.includes('district')) return 'District';
            if (nameLower.includes('cornerstone')) return 'CornerStone';
            if (nameLower.includes('richardson')) return 'Richardson';
            return '';
        }

        // Navigate to product detail page
        function navigateToProduct(product) {
            // Special handling for Richardson 112 - dedicated product page
            if (product.style === '112') {
                window.location.href = '/richardson-112-product.html';
                return;
            }

            // Always navigate to product page for unified experience
            // (Modal removed - user wanted single navigation path)
            const params = new URLSearchParams({
                style: product.style,
                name: product.description,
                type: product.type,
                brand: product.brand,
                ref: 'showcase'
            });
            window.location.href = `/top-sellers-product.html?${params}`;
        }
        
        // Show product modal for items with custom descriptions
        function showProductModal(product, description) {
            // Create modal HTML
            const modalHtml = `
                <div id="productModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; max-width: 800px; max-height: 90vh; overflow-y: auto; border-radius: 12px; padding: 40px; margin: 20px; position: relative;">
                        <button onclick="closeProductModal()" style="position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer;">✕</button>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: start;">
                            <div>
                                ${imageOverrides[product.style] ? 
                                    `<img src="${imageOverrides[product.style]}" alt="${product.description}" style="width: 100%; border-radius: 8px;">` :
                                    `<div style="height: 300px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #999;">No Image Available</div>`
                                }
                            </div>
                            
                            <div>
                                <h2 style="margin: 0 0 10px 0; color: #333;">${product.description}</h2>
                                <div style="color: #666; margin-bottom: 20px;">Style #${product.style} | ${product.brand}</div>
                                
                                <p style="line-height: 1.6; color: #555; margin-bottom: 20px;">${description.fullDescription}</p>
                                
                                <h3 style="color: #333; margin-top: 20px; margin-bottom: 10px;">Key Features & Benefits</h3>
                                <ul style="color: #555; line-height: 1.8;">
                                    ${description.features.map(f => `<li>${f}</li>`).join('')}
                                </ul>
                                
                                <h3 style="color: #333; margin-top: 20px; margin-bottom: 10px;">Recommended Decorations</h3>
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    ${description.decorations.map(d => `<span style="background: #f0f0f0; padding: 5px 12px; border-radius: 20px; font-size: 14px;">${d}</span>`).join('')}
                                </div>
                                
                                ${description.sizes ? `<p style="color: #666; margin-top: 20px; font-style: italic;">${description.sizes}</p>` : ''}
                                
                                <button onclick="requestSampleFromModal('${product.style}', '${product.description.replace(/'/g, "\\'")}')" 
                                        style="margin-top: 20px; background: var(--primary-color, #4cb354); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 600;">
                                    Request Sample
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add modal to page
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHtml;
            document.body.appendChild(modalContainer);
        }
        
        // Close product modal
        function closeProductModal() {
            const modal = document.getElementById('productModal');
            if (modal) {
                modal.parentElement.remove();
            }
        }
        
        // Request sample from modal
        function requestSampleFromModal(style, description) {
            closeProductModal();
            if (typeof handleSampleRequest === 'function') {
                handleSampleRequest(style, description, imageOverrides[style] || '');
            }
        }

        // Get decoration type display name
        function getDecorationType(type) {
            const types = {
                'dtg': 'Best for DTG',
                'screenprint': 'Best for Screen Print',
                'embroidery': 'Best for Embroidery',
                'caps': 'Top Selling Cap',
                'freshPicks': "Brinton's Pick",
                'newProducts': "New Product"
            };
            return types[type] || 'Top Seller';
        }

        // Show quick view modal
        function showQuickView(product) {
            const modal = document.getElementById('quickViewModal');
            const modalBody = document.getElementById('modalBody');
            const modalTitle = document.getElementById('modalTitle');
            
            modalTitle.textContent = product.description;
            
            const firstProduct = product.details[0];
            const images = [];
            
            // Collect unique images
            if (firstProduct.FRONT_MODEL) images.push(firstProduct.FRONT_MODEL);
            if (firstProduct.BACK_MODEL) images.push(firstProduct.BACK_MODEL);
            if (firstProduct.FRONT_FLAT) images.push(firstProduct.FRONT_FLAT);
            if (firstProduct.BACK_FLAT) images.push(firstProduct.BACK_FLAT);
            
            // Parse description for features
            const features = firstProduct.PRODUCT_DESCRIPTION ? 
                firstProduct.PRODUCT_DESCRIPTION.split('     ').filter(f => f.trim()) : [];
            
            modalBody.innerHTML = `
                <div class="modal-images">
                    <div class="modal-main-image">
                        <img src="${images[0] || firstProduct.PRODUCT_IMAGE}" alt="${product.description}" id="mainModalImage">
                    </div>
                    ${images.length > 1 ? `
                        <div class="modal-thumbnails">
                            ${images.map((img, index) => `
                                <div class="modal-thumbnail ${index === 0 ? 'active' : ''}" onclick="changeModalImage('${img}', this)">
                                    <img src="${img}" alt="View ${index + 1}">
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
                <div class="modal-info">
                    <h3>${product.description}</h3>
                    <div class="modal-style">Style #${product.style}</div>
                    <div class="modal-description">
                        ${features[0] || 'Premium quality apparel perfect for custom decoration.'}
                    </div>
                    ${features.length > 1 ? `
                        <div class="modal-features">
                            <h4>Product Features</h4>
                            <ul>
                                ${features.slice(1).map(f => `<li>${f.trim()}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    <div class="modal-cta">
                        <button class="btn-quote" onclick="requestQuote('${product.style}', '${product.description.replace(/'/g, "\\'")}'); closeModal();">
                            <i class="fas fa-calculator"></i>
                            Request Custom Quote
                        </button>
                        <button class="btn-contact" onclick="window.location.href='mailto:sales@nwcustomapparel.com'">
                            <i class="fas fa-envelope"></i>
                            Contact Sales
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        // Change modal image
        function changeModalImage(src, thumbnail) {
            document.getElementById('mainModalImage').src = src;
            document.querySelectorAll('.modal-thumbnail').forEach(t => t.classList.remove('active'));
            thumbnail.classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('quickViewModal').classList.remove('active');
        }

        // Request quote
        function requestQuote(style, name) {
            const subject = `Quote Request: ${name} (Style #${style})`;
            const body = `Hello,\n\nI'm interested in getting a custom quote for:\n\nProduct: ${name}\nStyle: #${style}\n\nPlease provide pricing for custom decoration.\n\nThank you!`;
            
            window.location.href = `mailto:sales@nwcustomapparel.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }
        
        // Sample Request System Integration
        let sampleRequestService = null;
        
        // Initialize sample request system
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize service if available
            if (typeof SampleRequestService !== 'undefined') {
                sampleRequestService = new SampleRequestService();
            }
            
            // Listen for sample modal events
            window.addEventListener('openSampleModal', (e) => {
                openSampleModal(e.detail.samples);
            });
        });
        
        // Handle sample request button click
        async function handleSampleRequest(styleNumber, productName, imageUrl) {
            // Navigate to product detail page in sample mode
            // Determine product type from current tab filter
            let productType = 'dtg'; // default

            // Check active tab to determine type
            const activeTab = document.querySelector('.filter-option.active');
            if (activeTab) {
                const tabText = activeTab.textContent.trim().toLowerCase();
                if (tabText.includes('screen print')) {
                    productType = 'screenprint';
                } else if (tabText.includes('embroidery')) {
                    productType = 'embroidery';
                } else if (tabText.includes('caps')) {
                    productType = 'caps';
                }
            }

            // Get price from eligibility check
            let price = 0;
            let sampleType = 'free';
            if (window.sampleCart) {
                const eligibility = await window.sampleCart.checkEligibility(styleNumber);
                if (eligibility.eligible) {
                    price = eligibility.price || 0;
                    sampleType = eligibility.type || 'free';
                }
            }

            // Build URL for product detail page with sample mode AND price
            const url = `top-sellers-product.html?style=${encodeURIComponent(styleNumber)}&name=${encodeURIComponent(productName)}&type=${productType}&mode=sample&price=${price}&sampleType=${sampleType}`;

            // Navigate to product detail page
            window.location.href = url;
        }
        
        // Show modal for color/size selection
        async function showSampleSelectionModal(styleNumber, productName, imageUrl, price, type, eligibilityData) {
            // Validate we have colors and sizes
            if (!eligibilityData.colors || eligibilityData.colors.length === 0) {
                console.error('No colors available for', styleNumber);
                alert('Unable to load color options for this product. Please try again or contact customer service.');
                return;
            }

            if (!eligibilityData.sizes || eligibilityData.sizes.length === 0) {
                console.error('No sizes available for', styleNumber);
                alert('Unable to load size options for this product. Please try again or contact customer service.');
                return;
            }

            // Fetch upcharges from BLANK pricing endpoint
            let upcharges = {};
            try {
                const apiBase = 'https://caspio-pricing-proxy-ab30a049961a.herokuapp.com';
                const response = await fetch(`${apiBase}/api/pricing-bundle?method=BLANK&styleNumber=${styleNumber}`);
                if (response.ok) {
                    const data = await response.json();
                    upcharges = data.sellingPriceDisplayAddOns || {};
                    console.log('[Sample] Fetched upcharges for', styleNumber, upcharges);
                }
            } catch (error) {
                console.warn('[Sample] Failed to fetch upcharges:', error);
                // Continue without upcharges
            }

            // Open drawer with product selection
            if (window.cartDrawer) {
                const productData = {
                    style: styleNumber,
                    name: productName,
                    description: '',
                    imageUrl: imageUrl,
                    price: price || 0,
                    type: type || 'free',
                    upcharges: upcharges,
                    colors: eligibilityData.colors.map(c => ({
                        name: c.name,
                        code: c.name,
                        catalogColor: c.catalogColor || c.name,
                        swatchUrl: c.swatchUrl // Sanmar swatch image URL
                    })),
                    sizes: eligibilityData.sizes
                };

                window.cartDrawer.open(productData);
            }
        }
        
        // Handle sample form submission
        async function handleSampleFormSubmit(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitSampleRequest');
            const originalButtonText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            
            try {
                // Get delivery method
                const deliveryMethod = document.querySelector('input[name="deliveryMethod"]:checked').value;
                
                // Get form data
                const formData = {
                    firstName: document.getElementById('sampleFirstName').value,
                    lastName: document.getElementById('sampleLastName').value,
                    email: document.getElementById('sampleEmail').value,
                    phone: document.getElementById('samplePhone').value,
                    company: document.getElementById('sampleCompany').value,
                    projectType: document.getElementById('projectType').value,
                    estimatedQuantity: document.getElementById('estimatedQuantity').value,
                    timeline: document.getElementById('timeline').value,
                    notes: document.getElementById('sampleNotes').value,
                    deliveryMethod: deliveryMethod
                };

                // Validate shipping fields if ship method selected
                if (deliveryMethod === 'ship') {
                    formData.address1 = document.getElementById('shippingAddress1').value;
                    formData.address2 = document.getElementById('shippingAddress2').value || '';
                    formData.city = document.getElementById('shippingCity').value;
                    formData.state = document.getElementById('shippingState').value;
                    formData.zip = document.getElementById('shippingZip').value;

                    // Validate required shipping fields
                    if (!formData.address1 || !formData.city || !formData.state || !formData.zip) {
                        alert('Please fill out all required shipping address fields');
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalButtonText;
                        return;
                    }

                    formData.shippingCost = 10.00;
                } else {
                    formData.shippingCost = 0;
                }
                
                // Get samples from cart
                const cartSummary = window.sampleCart.getCartSummary();
                
                // Calculate totals
                let samplesCost = 0;
                cartSummary.items.forEach(item => {
                    if (item.price > 0) {
                        samplesCost += item.price;
                    }
                });
                formData.samplesCost = samplesCost;
                formData.totalAmount = samplesCost + formData.shippingCost;
                
                // Check for duplicate requests
                const isDuplicate = await sampleRequestService.checkDuplicateRequest(formData.email);
                if (isDuplicate) {
                    alert('You have already requested samples within the last 30 days. Please contact us directly if you need additional samples.');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalButtonText;
                    return;
                }
                
                // Calculate tax (10.1% Milton sales tax on taxable items)
                const taxRate = 0.101;
                const taxableAmount = samplesCost + formData.shippingCost;
                const salesTax = taxableAmount > 0 ? taxableAmount * taxRate : 0;
                const finalTotal = taxableAmount + salesTax;
                
                // Update form data with tax
                formData.salesTax = salesTax;
                formData.totalAmount = finalTotal;
                
                // Store original notes - comprehensive notes will be built in saveSampleRequest
                // Don't override formData.notes here
                
                // Store detailed order info for the AE
                formData.orderDetails = {
                    samples: cartSummary.items.map(item => ({
                        style: item.style || '',
                        name: item.name || '',
                        color: item.color || 'TBD',
                        size: item.size || 'TBD',
                        price: item.price || 0
                    })),
                    delivery: deliveryMethod,
                    shipping: deliveryMethod === 'ship' ? {
                        address: formData.shippingAddress || '',
                        city: formData.shippingCity || '',
                        state: formData.shippingState || '',
                        zip: formData.shippingZip || ''
                    } : null,
                    totals: {
                        samples: samplesCost || 0,
                        shipping: formData.shippingCost || 0,
                        tax: salesTax || 0,
                        total: finalTotal || 0
                    }
                };
                
                // Submit order to ShopWorks via sample-order-service.js
                console.log('[Sample Order] Submitting order to ShopWorks...');
                const result = await window.sampleOrderService.submitOrder(formData, cartSummary.items);

                if (result.success) {
                    console.log('[Sample Order] Order submitted successfully:', result.orderNumber);
                    // Show success message
                    let message;
                    if (formData.totalAmount > 0) {
                        let breakdown = `Samples: $${samplesCost.toFixed(2)}`;
                        if (formData.shippingCost > 0) {
                            breakdown += `\nShipping: $${formData.shippingCost.toFixed(2)}`;
                        }
                        if (formData.salesTax > 0) {
                            breakdown += `\nTax (10.1%): $${formData.salesTax.toFixed(2)}`;
                        }
                        breakdown += `\n────────────────`;
                        breakdown += `\nTotal: $${formData.totalAmount.toFixed(2)}`;
                        
                        message = `Success! Your sample order ${result.orderNumber} has been submitted to our production system.\n\n${breakdown}\n\n${deliveryMethod === 'ship' ? 'We\'ll ship your samples within 2 business days.' : 'Your samples will be ready for pickup within 2 business days.'}\n\nAn account executive will contact you to process payment.`;
                    } else {
                        message = `Success! Your FREE sample order ${result.orderNumber} has been submitted to our production system.\n\n${deliveryMethod === 'ship' ? 'We\'ll ship your samples within 2 business days.' : 'Your samples will be ready for pickup within 2 business days.'}\n\nYou'll receive a confirmation email shortly.`;
                    }
                    
                    alert(message);
                    
                    // Clear cart
                    window.sampleCart.clearCart();
                    
                    // Close modal
                    closeSampleModal();
                    
                    // Reset form
                    document.getElementById('sampleRequestForm').reset();
                } else {
                    throw new Error(result.error || 'Failed to submit request');
                }
                
            } catch (error) {
                console.error('Sample request error:', error);
                alert('There was an error submitting your request. Please try again or contact us directly.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalButtonText;
            }
        }
    </script>
</body>
</html>