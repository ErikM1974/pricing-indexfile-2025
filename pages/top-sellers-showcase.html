<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Browse Northwest Custom Apparel's top-selling products. Quality apparel for screen printing, embroidery, and DTG printing.">
    <meta name="keywords" content="custom apparel, screen printing, embroidery, promotional products, Pacific Northwest">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Top Sellers - Northwest Custom Apparel">
    <meta property="og:description" content="Discover our most popular products for custom decoration">
    <meta property="og:image" content="https://cdn.caspio.com/A0E15000/Safety%20Stripes/web%20northwest%20custom%20apparel%20logo.png?ver=1">
    <meta property="og:type" content="website">
    
    <title>Top Sellers Catalog - Northwest Custom Apparel</title>
    <link rel="icon" href="https://cdn.caspio.com/A0E15000/Safety%20Stripes/NWCA%20Favicon%20for%20TEAMNWCA.com.png?ver=1" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- EmailJS for sample request notifications -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <!-- Universal Cart Header Component -->
    <script src="../shared_components/js/universal-cart-header.js"></script>

    <!-- Cart Drawer Component -->
    <link rel="stylesheet" href="../shared_components/css/cart-drawer.css">
    <script src="../shared_components/js/cart-drawer.js"></script>

    <!-- Sample Inventory Service for Real-Time Stock Checking -->
    <script src="../shared_components/js/sample-inventory-service.js"></script>

    <!-- Sample Order Service for ShopWorks Integration -->
    <script src="../shared_components/js/sample-order-service.js"></script>

    <!-- Embed Sample Request functionality directly to avoid path issues -->
    <script>
        // Embedded sample cart functionality
        class SampleCart {
            constructor() {
                this.maxSamples = null; // No hard limit - 3 samples recommended for best experience

                // Load cart with backward compatibility
                const cartData = sessionStorage.getItem('sampleCart');
                if (cartData) {
                    try {
                        const parsed = JSON.parse(cartData);
                        // New format: {samples: [...]}
                        // Old format: [...]
                        this.samples = Array.isArray(parsed) ? parsed : (parsed.samples || []);
                    } catch (e) {
                        console.error('[SampleCart] Error parsing cart data:', e);
                        this.samples = [];
                    }
                } else {
                    this.samples = [];
                }

                this.eligibilityCache = {};
                this.apiBase = 'https://caspio-pricing-proxy-ab30a049961a.herokuapp.com';
                this.initializeUI();
                this.bindEvents();
            }

            initializeUI() {
                // Widget now handled by UniversalCartHeader component
                // Just update the universal header's cart count
                this.updateUI();
            }

            bindEvents() {
                // Cart widget events now handled by UniversalCartHeader component
                // No need to bind events here
            }

            async checkEligibility(styleNumber) {
                // Check cache first
                if (this.eligibilityCache[styleNumber] !== undefined) {
                    return this.eligibilityCache[styleNumber];
                }

                try {
                    const response = await fetch(`${this.apiBase}/api/size-pricing?styleNumber=${styleNumber}`);
                    const data = await response.json();
                    
                    // Check if product is in Sanmar (has pricing data)
                    if (!data || data.error || data.length === 0) {
                        console.log(`Style ${styleNumber}: Not in Sanmar - no samples available`);
                        const result = { 
                            eligible: false, 
                            reason: 'not_sanmar'
                        };
                        this.eligibilityCache[styleNumber] = result;
                        return result;
                    }
                    
                    // Find MINIMUM price (not average)
                    const firstItem = data[0];
                    const prices = firstItem.basePrices || {};
                    const priceValues = Object.values(prices).filter(p => p > 0);
                    
                    if (priceValues.length === 0) {
                        const result = { eligible: false, reason: 'no_pricing' };
                        this.eligibilityCache[styleNumber] = result;
                        return result;
                    }
                    
                    // Extract available colors and sizes from all items
                    const colorNames = new Set();
                    const sizesSet = new Set();

                    data.forEach(item => {
                        if (item.color) {
                            colorNames.add(item.color);
                        }
                        // Get sizes from basePrices keys
                        Object.keys(item.basePrices || {}).forEach(size => {
                            sizesSet.add(size);
                        });
                    });

                    // Fetch CATALOG_COLOR values from color swatches API
                    let colors = [];
                    try {
                        const swatchResponse = await fetch(`${this.apiBase}/api/color-swatches?styleNumber=${styleNumber}`);
                        if (swatchResponse.ok) {
                            const swatches = await swatchResponse.json();
                            colors = swatches.map(swatch => ({
                                name: swatch.COLOR_NAME,           // Display name
                                catalogColor: swatch.CATALOG_COLOR, // ShopWorks internal name
                                swatchUrl: swatch.COLOR_SQUARE_IMAGE // Sanmar swatch image URL
                            })).filter(color => colorNames.has(color.name));
                            console.log(`  â†’ Fetched ${colors.length} colors with CATALOG_COLOR mapping`);
                        } else {
                            // Fallback to simple color array if API fails
                            console.warn(`  â†’ Color swatches API failed, using fallback`);
                            colors = Array.from(colorNames).map(name => ({
                                name: name,
                                catalogColor: name, // Use display name as fallback
                                swatchUrl: null     // No image available for fallback
                            }));
                        }
                    } catch (swatchError) {
                        // Fallback to simple color array
                        console.warn(`  â†’ Error fetching color swatches:`, swatchError);
                        colors = Array.from(colorNames).map(name => ({
                            name: name,
                            catalogColor: name, // Use display name as fallback
                            swatchUrl: null     // No image available for fallback
                        }));
                    }
                    
                    const sizes = Array.from(sizesSet).sort((a, b) => {
                        // Sort sizes logically
                        const sizeOrder = ['XS', 'S', 'M', 'L', 'XL', '2XL', '3XL', '4XL', '5XL', '6XL'];
                        return sizeOrder.indexOf(a) - sizeOrder.indexOf(b);
                    });
                    
                    const minPrice = Math.min(...priceValues);
                    console.log(`Style ${styleNumber}: Min price $${minPrice.toFixed(2)}, ${colors.length} colors, ${sizes.length} sizes`);
                    
                    if (minPrice < 10) {
                        const result = {
                            eligible: true,
                            type: 'free',
                            price: 0,
                            minCost: minPrice,
                            colors: colors,
                            sizes: sizes
                        };
                        this.eligibilityCache[styleNumber] = result;
                        console.log(`  â†’ FREE sample`);
                        return result;
                    } else {
                        // Calculate markup with half-dollar ceiling: (cost Ã· 0.57) rounded UP to nearest $0.50 (2026 margin)
                        const priceWithMargin = minPrice / 0.57;
                        const samplePrice = Math.ceil(priceWithMargin * 2) / 2;  // Half-dollar ceiling

                        const result = {
                            eligible: true,
                            type: 'paid',
                            price: samplePrice,
                            minCost: minPrice,
                            colors: colors,
                            sizes: sizes
                        };
                        this.eligibilityCache[styleNumber] = result;
                        console.log(`  â†’ PAID sample at $${samplePrice.toFixed(2)} (was ${minPrice.toFixed(2)})`);
                        return result;
                    }
                } catch (error) {
                    console.error(`Error checking eligibility for ${styleNumber}:`, error);
                    const result = { eligible: false, reason: 'api_error' };
                    this.eligibilityCache[styleNumber] = result;
                    return result;
                }
            }

            async addSample(product) {
                // Check for duplicate
                if (this.samples.find(s => s.style === product.style)) {
                    this.showNotification('This item is already in your sample cart', 'info');
                    return false;
                }

                // ===== CHECK INVENTORY BEFORE ADDING =====
                if (window.sampleInventoryService && product.catalogColor && product.size) {
                    console.log(`[Sample Cart] Checking inventory for ${product.style} ${product.catalogColor} size ${product.size}...`);

                    try {
                        const availability = await window.sampleInventoryService.checkSizeAvailability(
                            product.style,
                            product.catalogColor,
                            product.size,
                            1  // Requesting 1 sample
                        );

                        if (!availability.available) {
                            // Out of stock - block adding
                            console.warn(`[Sample Cart] âŒ Out of stock: ${product.style} ${product.catalogColor} size ${product.size}`);

                            this.showNotification(
                                `${product.name} (${product.color}) - Size ${product.size} is currently out of stock`,
                                'warning'
                            );

                            return false; // Block adding to cart
                        } else if (availability.isLowStock) {
                            // Low stock - allow but warn
                            console.warn(`[Sample Cart] âš ï¸ Low stock: ${product.style} ${product.catalogColor} size ${product.size} (${availability.qtyInStock} left)`);

                            this.showNotification(
                                `Added to cart (only ${availability.qtyInStock} left in stock)`,
                                'warning'
                            );
                        } else {
                            // In stock
                            console.log(`[Sample Cart] âœ“ In stock: ${product.style} ${product.catalogColor} size ${product.size}`);
                        }
                    } catch (error) {
                        console.error('[Sample Cart] Error checking inventory:', error);
                        // Graceful degradation - allow adding but log the error
                        console.warn('[Sample Cart] Proceeding without inventory check due to error');
                    }
                } else {
                    console.warn('[Sample Cart] Inventory service not available or missing product data');
                }

                this.samples.push({
                    style: product.style,
                    name: product.name,
                    description: product.description,
                    imageUrl: product.imageUrl || '',
                    color: product.color || '',  // Store actual color name
                    colorCode: product.colorCode || '',  // Store color code
                    catalogColor: product.catalogColor || product.color || '',  // ShopWorks catalog color (CRITICAL!)
                    size: product.size || '',  // Store selected size
                    price: product.price || 0,
                    type: product.type || 'free',
                    addedAt: new Date().toISOString()
                });

                this.save();
                this.updateUI();
                
                // Custom message based on sample type
                if (product.type === 'paid') {
                    this.showNotification(`${product.name} added - $${product.price} sample`, 'success');
                } else {
                    this.showNotification(`${product.name} added - FREE sample`, 'success');
                }

                return true;
            }

            removeSample(styleNumberOrIndex) {
                let index;

                // Support both styleNumber (string) and index (number)
                if (typeof styleNumberOrIndex === 'number') {
                    index = styleNumberOrIndex;
                } else {
                    index = this.samples.findIndex(s => s.style === styleNumberOrIndex);
                }

                if (index !== -1 && index < this.samples.length) {
                    const removed = this.samples.splice(index, 1)[0];
                    this.save();
                    this.updateUI();
                    this.showNotification(`${removed.name} removed from samples`, 'info');

                    return true;
                }

                return false;
            }

            clearCart() {
                this.samples = [];
                this.save();
                this.updateUI();
            }

            save() {
                // Save in structured format for sample-cart.html compatibility
                sessionStorage.setItem('sampleCart', JSON.stringify({
                    samples: this.samples,
                    updatedAt: new Date().toISOString()
                }));
            }

            updateUI() {
                // === ENHANCED DEBUGGING ===
                console.log('ðŸ”„ [UPDATE UI] Called');
                console.log('ðŸ”„ [UPDATE UI] samples.length:', this.samples.length);
                console.log('ðŸ”„ [UPDATE UI] window.universalCartHeader exists:', !!window.universalCartHeader);

                // Trigger universal header to update cart count
                if (window.universalCartHeader) {
                    window.universalCartHeader.updateCartCount();
                    console.log('ðŸ”„ [UPDATE UI] Called updateCartCount()');
                } else {
                    console.warn('âš ï¸ [UPDATE UI] Universal header not available');
                }

                // Dispatch custom event for other components to listen to
                window.dispatchEvent(new CustomEvent('cartUpdated'));
                console.log('ðŸ”„ [UPDATE UI] Dispatched cartUpdated event');

                this.updateSampleButtons();
            }

            updateSampleButtons() {
                document.querySelectorAll('.btn-sample').forEach(btn => {
                    const style = btn.dataset.style;
                    if (style && this.samples.find(s => s.style === style)) {
                        btn.innerHTML = '<i class="fas fa-check"></i> In Sample Cart';
                        btn.classList.add('in-cart');
                        btn.disabled = false;
                    }
                });
            }

            // Widget visibility now handled by UniversalCartHeader component

            openSampleModal() {
                // Open drawer to view cart
                if (window.cartDrawer) {
                    window.cartDrawer.open();
                }
            }

            showNotification(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `sample-toast sample-toast-${type}`;
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(toast);
                setTimeout(() => toast.classList.add('sample-toast-show'), 10);
                
                setTimeout(() => {
                    toast.classList.remove('sample-toast-show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            getCartSummary() {
                return {
                    items: this.samples,
                    count: this.samples.length
                };
            }

            async checkAllProductEligibility() {
                console.log('Checking product eligibility for samples...');
                const buttons = document.querySelectorAll('.btn-sample[data-style]');
                const checks = [];
                
                buttons.forEach(btn => {
                    const style = btn.dataset.style;
                    if (style) {
                        checks.push(this.checkAndUpdateButton(btn, style));
                    }
                });
                
                await Promise.all(checks);
                console.log('Eligibility check complete');
            }
            
            async checkAndUpdateButton(button, styleNumber) {
                const result = await this.checkEligibility(styleNumber);
                
                if (!result.eligible) {
                    // Hide button for non-Sanmar products
                    button.style.display = 'none';
                    return;
                }
                
                button.style.display = 'inline-flex';
                button.style.width = '100%';
                
                // Store pricing data
                button.dataset.samplePrice = result.price;
                button.dataset.sampleType = result.type;
                
                // Check if already in cart
                if (this.samples.find(s => s.style === styleNumber)) {
                    button.innerHTML = '<i class="fas fa-check"></i> In Sample Cart';
                    button.classList.add('in-cart');
                } else if (result.type === 'free') {
                    button.innerHTML = '<i class="fas fa-box-open"></i> Request Free Sample';
                    button.className = 'btn-sample btn-sample-free';
                } else {
                    button.innerHTML = `<i class="fas fa-shopping-cart"></i> Order Sample - $${result.price}`;
                    button.className = 'btn-sample btn-sample-paid';
                }
            }
        }

        // Embedded sample request service
        class SampleRequestService {
            constructor() {
                this.baseURL = 'https://caspio-pricing-proxy-ab30a049961a.herokuapp.com';
                this.quotePrefix = 'SR';
                
                // Initialize EmailJS
                emailjs.init('4qSbDO-SQs19TbP80');
                this.emailConfig = {
                    serviceId: 'service_1c4k67j',
                    templateId: 'template_free_sample'
                };
            }

            generateSampleRequestID() {
                const now = new Date();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const dateKey = `${month}${day}`;
                
                // Use timestamp + random to ensure uniqueness across all users/sessions
                const timestamp = now.getTime().toString();
                const uniqueId = timestamp.slice(-6) + Math.random().toString(36).substr(2, 3);
                
                return `${this.quotePrefix}${dateKey}-${uniqueId}`;
            }

            generateSessionID() {
                return `sample_sess_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            }

            async checkDuplicateRequest(email) {
                // Simplified for testing
                return false;
            }

            async saveSampleRequest(formData, samples) {
                try {
                    const quoteID = this.generateSampleRequestID();
                    const sessionID = this.generateSessionID();
                    
                    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
                        .toISOString()
                        .replace(/\.\d{3}Z$/, '');
                    
                    // Build simple notes without newlines (Caspio doesn't like special characters)
                    let notesContent = formData.notes || 'Sample request';
                    
                    // Add project details with pipe separators instead of newlines
                    if (formData.projectType) {
                        notesContent += ` | Project: ${formData.projectType}`;
                    }
                    if (formData.estimatedQuantity) {
                        notesContent += ` | Qty: ${formData.estimatedQuantity}`;
                    }
                    if (formData.timeline) {
                        notesContent += ` | Timeline: ${formData.timeline}`;
                    }
                    
                    // Add delivery info including street address
                    if (formData.deliveryMethod === 'ship') {
                        notesContent += ` | Ship to: ${formData.shippingAddress || 'TBD'}, ${formData.shippingCity || 'TBD'}, ${formData.shippingState || 'TBD'} ${formData.shippingZip || ''}`;
                    } else {
                        notesContent += ' | Pickup at NWCA';
                    }
                    
                    // Add sample count and total
                    if (samples && samples.length > 0) {
                        notesContent += ` | ${samples.length} samples`;
                    }
                    
                    // Get totals with proper defaults
                    const samplesCost = parseFloat((formData.samplesCost || 0).toFixed(2));
                    const totalAmount = parseFloat((formData.totalAmount || 0).toFixed(2));
                    
                    // Add total if there's a cost
                    if (totalAmount > 0) {
                        notesContent += ` | Total: $${totalAmount.toFixed(2)}`;
                    }
                    
                    const sessionData = {
                        QuoteID: quoteID,
                        SessionID: sessionID,
                        CustomerEmail: formData.email,
                        CustomerName: formData.name,
                        CompanyName: formData.company || '',
                        Phone: formData.phone || '',
                        TotalQuantity: samples.length,
                        SubtotalAmount: samplesCost,
                        LTMFeeTotal: 0, // No LTM fees for sample requests - this field is for Less Than Minimum fees only
                        TotalAmount: totalAmount,
                        Status: 'Sample Request',
                        ExpiresAt: expiresAt,
                        Notes: notesContent,
                        // ProjectName field - leave empty to avoid database type issues
                        ProjectName: '',
                        // New shipping fields
                        ShippingAddress: formData.shippingAddress || '',
                        ShippingCity: formData.shippingCity || '',
                        ShippingState: formData.shippingState || '',
                        ShippingZip: formData.shippingZip || '',
                        DeliveryMethod: formData.deliveryMethod || 'pickup'
                    };
                    
                    // Validate data before sending
                    console.log('Saving sample request session:', sessionData);
                    console.log('Session data validation:', {
                        hasQuoteID: !!sessionData.QuoteID,
                        hasEmail: !!sessionData.CustomerEmail,
                        subtotalIsNumber: !isNaN(sessionData.SubtotalAmount),
                        ltmIsZero: sessionData.LTMFeeTotal === 0,
                        totalIsNumber: !isNaN(sessionData.TotalAmount),
                        notesLength: sessionData.Notes.length
                    });
                    
                    console.log('Sending session data to API:', JSON.stringify(sessionData, null, 2));
                    
                    const sessionResponse = await fetch(`${this.baseURL}/api/quote_sessions`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(sessionData)
                    });
                    
                    if (!sessionResponse.ok) {
                        const errorText = await sessionResponse.text();
                        console.error('Session save failed:', errorText);
                        console.error('Failed session data:', sessionData);
                        throw new Error(`Failed to save session: ${errorText}`);
                    }
                    
                    console.log('Session saved successfully');
                    
                    // Save individual sample items
                    console.log(`Saving ${samples.length} sample items...`);
                    const itemPromises = samples.map(async (sample, index) => {
                        // Use the sample price if it's a paid sample, ensure it's a number
                        const itemPrice = parseFloat((sample.price || 0).toFixed(2));
                        
                        // Simple size/color data for each item
                        let sizeBreakdownData = {
                            size: sample.size || 'L',
                            color: sample.color || 'TBD'
                        };
                        
                        // Order details now stored in session record, not in individual items
                        
                        const itemData = {
                            QuoteID: quoteID,
                            LineNumber: index + 1,
                            StyleNumber: sample.style || 'UNKNOWN',
                            ProductName: sample.name || sample.description || 'Sample Item',
                            Color: sample.color || '',  // Use actual selected color, never "Customer Choice"
                            ColorCode: sample.colorCode || '',
                            EmbellishmentType: 'sample',
                            PrintLocation: '',
                            PrintLocationName: '',
                            Quantity: 1,
                            HasLTM: 'No',
                            BaseUnitPrice: itemPrice,
                            LTMPerUnit: 0,
                            FinalUnitPrice: itemPrice,
                            LineTotal: itemPrice,
                            SizeBreakdown: JSON.stringify(sizeBreakdownData),
                            PricingTier: itemPrice > 0 ? 'Paid Sample' : 'Free Sample',
                            ImageURL: sample.imageUrl || '',
                            AddedAt: new Date().toISOString().replace(/\.\d{3}Z$/, '')
                        };
                        
                        console.log(`Saving item ${index + 1}:`, itemData);
                        
                        const itemResponse = await fetch(`${this.baseURL}/api/quote_items`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(itemData)
                        });
                        
                        if (!itemResponse.ok) {
                            const errorText = await itemResponse.text();
                            console.error(`Failed to save item ${index + 1} (LineNumber ${index + 1}):`, errorText);
                            console.error('Failed item data:', itemData);
                            // Return false but don't throw to allow other items to save
                            return false;
                        }
                        
                        console.log(`Successfully saved item ${index + 1} (LineNumber ${index + 1})`);
                        return true;
                    });
                    
                    const itemResults = await Promise.all(itemPromises);
                    const successCount = itemResults.filter(result => result === true).length;
                    const failCount = itemResults.filter(result => result === false).length;
                    
                    console.log(`Items saved: ${successCount} successful, ${failCount} failed out of ${samples.length} total`);
                    
                    // Log which items failed
                    itemResults.forEach((success, index) => {
                        if (!success) {
                            console.error(`Item ${index + 1} (LineNumber ${index + 1}) failed to save`);
                        }
                    });
                    
                    // Send confirmation email
                    try {
                        await this.sendConfirmationEmail(formData, samples, quoteID);
                        console.log('Confirmation email sent successfully');
                    } catch (emailError) {
                        // Don't block the request if email fails
                        console.error('Email send error (non-blocking):', emailError);
                    }
                    
                    return {
                        success: true,
                        requestID: quoteID
                    };
                    
                } catch (error) {
                    console.error('Error saving sample request:', error);
                    return {
                        success: false,
                        error: error.message
                    };
                }
            }
            
            async sendConfirmationEmail(formData, samples, quoteID) {
                // Build samples HTML table for email
                const samplesHtml = this.buildSamplesHtmlTable(samples);
                
                // Extract shipping info
                const isShipping = formData.deliveryMethod === 'ship';
                
                // Calculate cost breakdown
                const samplesCost = formData.samplesCost || 0;
                const shippingCost = formData.shippingCost || 0;
                const salesTax = formData.salesTax || 0;
                const totalAmount = formData.totalAmount || 0;
                
                // Build email data with all required variables
                const emailData = {
                    // System fields
                    to_email: formData.email,
                    from_name: 'Northwest Custom Apparel',
                    reply_to: 'sales@nwcustomapparel.com',
                    
                    // Customer information
                    customer_name: formData.name || 'Valued Customer',
                    customer_email: formData.email || '',
                    customer_phone: formData.phone || 'Not provided',
                    company_name: formData.company || 'Not provided',
                    
                    // Order details
                    request_id: quoteID,
                    request_date: new Date().toLocaleDateString(),
                    sample_count: samples.length.toString(),
                    delivery_method: isShipping ? 'Ship' : 'Pickup',
                    
                    // Sample items (HTML table)
                    samples_html: samplesHtml,
                    
                    // Shipping information
                    shipping_address: formData.shippingAddress || '',
                    shipping_city: formData.shippingCity || '',
                    shipping_state: formData.shippingState || '',
                    shipping_zip: formData.shippingZip || '',
                    shipping_info: isShipping ? 
                        `${formData.shippingAddress || ''} ${formData.shippingCity || ''}, ${formData.shippingState || ''} ${formData.shippingZip || ''}`.trim() : 
                        'Pickup at NWCA',
                    
                    // Cost breakdown
                    samples_cost: `$${samplesCost.toFixed(2)}`,
                    shipping_cost: isShipping ? `$${shippingCost.toFixed(2)}` : '$0.00',
                    tax_amount: `$${salesTax.toFixed(2)}`,
                    total_amount: `$${totalAmount.toFixed(2)}`,
                    
                    // Project details
                    project_type: formData.projectType || 'Not specified',
                    estimated_quantity: formData.estimatedQuantity || 'Not specified',
                    timeline: formData.timeline || 'Not specified',
                    notes: formData.notes || 'No additional notes',
                    
                    // Company info
                    company_year: '1977',
                    company_phone: '253-922-5793',
                    
                    // Next steps message
                    next_steps: totalAmount > 0 ? 
                        'An account executive will contact you to process payment for your sample order.' : 
                        'Your free samples will be processed within 2 business days.',
                    
                    // Delivery timeline
                    delivery_timeline: isShipping ? 
                        'Your samples will be shipped within 2 business days.' : 
                        'Your samples will be ready for pickup within 2 business days.'
                };
                
                // Send email via EmailJS
                await emailjs.send(
                    this.emailConfig.serviceId,
                    this.emailConfig.templateId,
                    emailData
                );
                
                return true;
            }
            
            buildSamplesHtmlTable(samples) {
                if (!samples || samples.length === 0) {
                    return '<p>No samples in this request</p>';
                }
                
                const tableRows = samples.map(sample => `
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 12px; text-align: left;">${sample.style || 'N/A'}</td>
                        <td style="padding: 12px; text-align: left;">${sample.name || 'N/A'}</td>
                        <td style="padding: 12px; text-align: left;">${sample.color || 'TBD'}</td>
                        <td style="padding: 12px; text-align: center;">${sample.size || 'TBD'}</td>
                        <td style="padding: 12px; text-align: right;">
                            ${sample.price > 0 ? `$${sample.price.toFixed(2)}` : 'FREE'}
                        </td>
                    </tr>
                `).join('');
                
                return `
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: #4cb354; color: white;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Style #</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Product</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Color</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">Size</th>
                                <th style="padding: 12px; text-align: right; font-weight: 600;">Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>
                `;
            }
        }

        // ================================================================
        // SAMPLE PRICING UTILITY - Fetch API upcharges and calculate pricing
        // ================================================================

        /**
         * Calculate sample pricing with API-based size upcharges
         * @param {string} styleNumber - Product style number
         * @param {string} size - Size code (S, M, L, XL, 2XL, etc.)
         * @returns {Promise<Object>} - Pricing data with base price and all upcharges
         */
        async function calculateSamplePricing(styleNumber, size) {
            try {
                console.log(`[Sample Pricing] Calculating for ${styleNumber} size ${size}`);

                // Fetch pricing data from API
                const url = `https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/pricing-bundle?method=BLANK&styleNumber=${styleNumber}`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();

                // Get base cost for this specific size
                const sizeData = data.sizes?.find(s => s.size === size);
                const baseCost = sizeData ? parseFloat(sizeData.price) : parseFloat(data.sizes[0].price);

                // Get upcharge from API (handles tall sizes automatically!)
                const upcharge = parseFloat(data.sellingPriceDisplayAddOns?.[size] || 0);

                // Calculate sample pricing: blank product with 43% margin (Ã·0.57) - 2026
                const priceWithMargin = baseCost / 0.57;

                // Round using half-dollar ceiling (consistent with DTG/Screen Print)
                const roundedPrice = Math.ceil(priceWithMargin * 2) / 2;

                // Final price with upcharge
                const finalPrice = roundedPrice + upcharge;

                console.log(`[Sample Pricing] ${styleNumber} ${size}: Base $${baseCost.toFixed(2)} â†’ Margin $${roundedPrice.toFixed(2)} + Upcharge $${upcharge.toFixed(2)} = $${finalPrice.toFixed(2)}`);

                return {
                    basePrice: finalPrice,
                    baseCost: baseCost,
                    marginPrice: roundedPrice,
                    upcharge: upcharge,
                    upcharges: data.sellingPriceDisplayAddOns || {}  // All upcharges for cart storage
                };
            } catch (error) {
                console.error(`[Sample Pricing] Error calculating pricing for ${styleNumber}:`, error);
                // Return fallback pricing (base margin only, no upcharge)
                return {
                    basePrice: 0,
                    baseCost: 0,
                    marginPrice: 0,
                    upcharge: 0,
                    upcharges: {},
                    error: error.message
                };
            }
        }

        // Make function globally available for product pages
        window.calculateSamplePricing = calculateSamplePricing;

        // Initialize when DOM is ready to avoid document.body being null
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.sampleCart = new SampleCart();
                window.sampleRequestService = new SampleRequestService();
            });
        } else {
            // DOM already loaded (shouldn't happen in head, but just in case)
            window.sampleCart = new SampleCart();
            window.sampleRequestService = new SampleRequestService();
        }

        // PHASE 0: Mobile filter toggle functionality
        function toggleFilters() {
            const toggle = document.getElementById('filterToggle');
            const content = document.getElementById('filterContent');

            if (!toggle || !content) return;

            const isExpanded = content.classList.contains('expanded');

            if (isExpanded) {
                content.classList.remove('expanded');
                toggle.classList.remove('expanded');
            } else {
                content.classList.add('expanded');
                toggle.classList.add('expanded');
            }
        }

        // Show/hide toggle button based on screen size
        function handleFilterToggleVisibility() {
            const toggle = document.getElementById('filterToggle');
            const content = document.getElementById('filterContent');

            if (!toggle || !content) return;

            if (window.innerWidth <= 768) {
                // Mobile: show toggle button, collapse content by default
                toggle.style.display = 'flex';
                // Don't auto-collapse if user manually expanded
                if (!toggle.classList.contains('user-interacted')) {
                    content.classList.remove('expanded');
                    toggle.classList.remove('expanded');
                }
            } else {
                // Desktop: hide toggle, always show content
                toggle.style.display = 'none';
                content.classList.add('expanded');
                content.style.maxHeight = 'none';
            }
        }

        // Mark user interaction
        if (document.getElementById('filterToggle')) {
            document.getElementById('filterToggle').addEventListener('click', function() {
                this.classList.add('user-interacted');
            });
        }

        // Initialize on load and resize
        window.addEventListener('load', handleFilterToggleVisibility);
        window.addEventListener('resize', handleFilterToggleVisibility);
    </script>
    
    <style>
        :root {
            /* Primary - Northwest Custom Apparel Green (unified) */
            --primary: #4cb354;
            --primary-hover: #409a47;
            --primary-light: #e8f5e9;

            /* Legacy aliases for backward compatibility */
            --primary-color: #4cb354;
            --primary-dark: #409a47;
            --success: #4cb354;

            /* Neutrals */
            --white: #ffffff;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-500: #6b7280;
            --gray-700: #374151;
            --gray-900: #111827;

            /* Legacy aliases */
            --bg-color: #f9fafb;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --text-primary: #111827;
            --text-secondary: #6b7280;

            /* Shadows */
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 12px 24px rgba(0, 0, 0, 0.12);

            /* Accent (minimal use - badges only) */
            --accent-red: #ef4444;
            --accent-gold: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 3px solid var(--primary-color);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            height: 60px;
        }

        .company-name {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .tagline {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .contact-header {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .contact-item:hover {
            color: var(--primary-color);
        }

        .contact-item i {
            color: var(--primary-color);
        }

        /* Search Section */
        .search-section {
            max-width: 700px;
            margin: -2rem auto 3rem;
            padding: 0 2rem;
            position: relative;
            z-index: 10;
        }
        
        .search-container {
            background: white;
            border-radius: 50px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
        }
        
        .search-container:focus-within {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        
        .search-icon {
            color: var(--text-secondary);
            font-size: 1.25rem;
            margin-right: 0.75rem;
        }
        
        .search-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1rem;
            padding: 0.75rem 0;
            color: var(--text-primary);
        }
        
        .search-input::placeholder {
            color: var(--text-secondary);
        }
        
        .search-clear {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.25rem;
            padding: 0.5rem;
            display: none;
            transition: color 0.2s ease;
        }
        
        .search-clear:hover {
            color: var(--primary-color);
        }
        
        .search-clear.active {
            display: block;
        }
        
        .search-results {
            margin-top: 1rem;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .search-results strong {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .no-results {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
        }
        
        .no-results i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .no-results h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .no-results p {
            margin-bottom: 1.5rem;
        }
        
        .reset-search {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .reset-search:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        /* Hero Section - Clean, minimal design */
        .hero {
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            color: white;
            padding: 2rem 0;
            text-align: center;
        }

        .hero-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .hero h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .hero-subtitle {
            font-size: 0.9375rem;
            margin-bottom: 0;
            opacity: 0.9;
            font-weight: 400;
        }

        .hero-subtitle .separator {
            margin: 0 0.5rem;
            opacity: 0.5;
        }

        .hero-cta {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.875rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn-white {
            background: white;
            color: var(--primary-color);
        }

        .btn-white:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-outline:hover {
            background: white;
            color: var(--primary-color);
        }

        /* New Arrivals Featured Carousel */
        .new-arrivals-banner {
            background: #FAFAF8;
            padding: 1.25rem 0;
            margin-bottom: 0;
        }

        .new-arrivals-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .new-arrivals-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .new-arrivals-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .new-arrivals-title i {
            color: #6B7280;
            font-size: 1rem;
        }

        .new-arrivals-title h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .view-all-btn {
            background: transparent;
            color: var(--text-secondary);
            border: none;
            padding: 0.5rem 0;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .view-all-btn:hover {
            color: var(--primary-color);
        }

        .new-arrivals-carousel {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            scroll-behavior: smooth;
            scroll-snap-type: x mandatory;
            padding: 1rem 0;
            -webkit-overflow-scrolling: touch;
        }

        .new-arrivals-carousel::-webkit-scrollbar {
            height: 8px;
        }

        .new-arrivals-carousel::-webkit-scrollbar-track {
            background: #F3F4F6;
            border-radius: 4px;
        }

        .new-arrivals-carousel::-webkit-scrollbar-thumb {
            background: #D1D5DB;
            border-radius: 4px;
        }

        .carousel-loading {
            text-align: center;
            padding: 2rem;
            width: 100%;
            color: #92400e;
        }

        .carousel-loading i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .carousel-product-card {
            flex: 0 0 280px;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            scroll-snap-align: start;
            transition: all 0.3s ease;
            cursor: pointer;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .carousel-product-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        /* Image container with badge */
        .carousel-product-card .product-image {
            position: relative;
            width: 100%;
            background: #f9fafb;
            padding: 1rem;
            border-radius: 8px 8px 0 0;
        }

        .carousel-product-image {
            width: 100%;
            height: 200px;
            object-fit: contain;
        }

        /* Badge positioned at bottom of image */
        .carousel-new-badge {
            position: absolute;
            bottom: 0.5rem;
            left: 0.5rem;
            background: #ef4444;
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            z-index: 1;
        }

        /* Info container with padding */
        .carousel-product-card .product-info {
            padding: 1rem 1.5rem 1.5rem 1.5rem;
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        /* Brand and style number */
        .carousel-product-card .product-style {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .carousel-product-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: auto;
            line-height: 1.3;
            min-height: 2.6rem;
        }

        /* Deprecated - kept for backward compatibility but no longer used */
        .carousel-sample-badge {
            position: absolute;
            bottom: 210px;
            left: 1rem;
            padding: 0.5rem 0.875rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            z-index: 2;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .carousel-sample-badge.free {
            background: #10b981;
            color: white;
        }

        .carousel-sample-badge.paid {
            background: #3b82f6;
            color: white;
        }

        .carousel-sample-btn {
            width: 100%;
            padding: 0.75rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .carousel-sample-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .carousel-sample-btn i {
            font-size: 1rem;
        }

        /* Mobile responsive for carousel */
        @media (max-width: 768px) {
            .new-arrivals-banner {
                padding: 1rem 0;
            }

            .new-arrivals-title h2 {
                font-size: 1.125rem;
            }

            .carousel-product-card {
                flex: 0 0 240px;
            }

            .carousel-product-image {
                height: 160px;
            }
        }

        /* ============================================
           NEW DESIGN: Sticky Category Tabs
           ============================================ */
        .category-tabs {
            position: sticky;
            top: 70px; /* Below header */
            z-index: 40;
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .tabs-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            gap: 0;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .tabs-container::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-family: inherit;
            font-size: 0.9375rem;
            font-weight: 500;
            color: var(--gray-500);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            margin-bottom: -1px;
        }

        .tab-btn:hover {
            color: var(--gray-700);
            background: var(--gray-50);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            font-weight: 600;
        }

        .tab-btn.tab-new2026 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .new-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-red);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        /* ============================================
           NEW DESIGN: Simple Filter Bar
           ============================================ */
        .filter-bar-simple {
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
            padding: 1rem 0;
        }

        .filter-bar-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .filter-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .filter-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-group label {
            font-size: 0.875rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        .filter-select {
            padding: 0.5rem 2rem 0.5rem 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 0.875rem;
            color: var(--gray-700);
            background: var(--white);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1rem;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .filter-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .results-count {
            font-size: 0.875rem;
            color: var(--gray-500);
        }

        /* ============================================
           LEGACY: Keep old filter-bar for backward compatibility
           (will be hidden but kept for JS references)
           ============================================ */
        /* Filter Bar */
        .filter-bar {
            display: none; /* Hidden - replaced by new design */
            background: white;
            padding: 2rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .filter-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 0.9375rem;
        }

        /* DTG Compatibility Section */
        .dtg-compatibility-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .dtg-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: #0369a1;
            font-weight: 600;
            font-size: 0.9375rem;
        }

        .dtg-header i {
            font-size: 1.125rem;
        }

        .dtg-filter-btn {
            width: 100%;
            padding: 1.25rem 1.5rem;
            background: white;
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
        }

        .dtg-filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.2);
            border-color: #0284c7;
        }

        .dtg-filter-btn.active {
            background: #0ea5e9;
            border-color: #0ea5e9;
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
        }

        .dtg-filter-btn.active .dtg-filter-content {
            color: white;
        }

        .dtg-filter-btn.active .count {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .dtg-filter-btn > i {
            font-size: 2rem;
            color: #10b981;
            flex-shrink: 0;
        }

        .dtg-filter-btn.active > i {
            color: white;
        }

        .dtg-filter-content {
            flex: 1;
            text-align: left;
        }

        .dtg-filter-title {
            display: block;
            font-size: 1.125rem;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 0.25rem;
        }

        .dtg-filter-subtitle {
            display: block;
            font-size: 0.875rem;
            color: #64748b;
        }

        /* Category Filters - Enhanced Card Style (PRIMARY NAVIGATION) */
        .category-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .filter-btn {
            padding: 1.5rem 1.25rem;
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            text-align: center;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .filter-btn:hover {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(45, 95, 63, 0.15);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            border-color: var(--primary-color);
            color: white;
            box-shadow: 0 4px 12px rgba(45, 95, 63, 0.3);
        }

        .filter-btn i {
            font-size: 2.25rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
            transition: all 0.3s ease;
        }

        .filter-btn:hover i {
            transform: scale(1.1);
        }

        .filter-btn.active i {
            color: white;
        }

        .filter-btn span:not(.count) {
            font-size: 1rem;
            font-weight: 600;
            line-height: 1.4;
        }

        .filter-btn .count {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: #F3F4F6;
            color: #6B7280;
            font-size: 0.8125rem;
            font-weight: 700;
            padding: 0.25rem 0.625rem;
            border-radius: 14px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .filter-btn.active .count {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            box-shadow: none;
        }

        .dtg-filter-btn .count {
            position: absolute;
            top: 50%;
            right: 1.5rem;
            transform: translateY(-50%);
            background: #F3F4F6;
            color: #6B7280;
            font-size: 1rem;
            font-weight: 700;
            padding: 0.375rem 0.75rem;
            border-radius: 12px;
        }

        /* Secondary Filters (Badge Style) */
        .secondary-filters {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 0;
            background: transparent;
            flex-wrap: wrap;
        }

        .filter-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #6B7280;
        }

        .badge-filter {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
        }

        .badge-filter:hover {
            border-color: var(--primary-color);
            background: #F9FAFB;
        }

        .badge-filter.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .badge-filter i {
            font-size: 1rem;
        }

        .badge-count {
            background: rgba(107, 114, 128, 0.08);
            color: #9CA3AF;
            padding: 0.125rem 0.5rem;
            border-radius: 10px;
            font-size: 0.6875rem;
            font-weight: 600;
            margin-left: 0.25rem;
        }

        .badge-filter.active .badge-count {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* Product Grid */
        .products-section {
            max-width: 1400px;
            margin: 3rem auto;
            padding: 0 2rem;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .product-card {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 16px;
            overflow: hidden;
            transition: border-color 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .product-card:hover {
            border-color: var(--primary-color);
        }

        .product-badge {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(76, 179, 84, 0.95), rgba(76, 179, 84, 0.85));
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.8125rem;
            font-weight: 600;
            z-index: 10;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .product-image {
            height: 300px;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center top;
            transition: transform 0.3s ease;
            background: #f9fafb;
        }

        .product-card:hover .product-image img {
            transform: scale(1.02);
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-style {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .product-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .color-swatches {
            display: flex;
            gap: 0.375rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .color-swatch {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            overflow: hidden;
            transition: all 0.2s ease;
            position: relative;
        }

        .color-swatch:hover::before,
        .color-swatch.active::before {
            content: '';
            position: absolute;
            inset: -4px;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .color-swatch:hover {
            border-color: var(--primary-color);
        }

        .color-swatch img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .more-colors {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--bg-color);
            border-radius: 50%;
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .product-cta {
            display: block;
            width: 100%;
            padding: 0.75rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            outline: 2px solid transparent;
            outline-offset: 2px;
        }

        .product-cta:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .product-cta:focus-visible {
            outline-color: var(--primary-color);
        }

        .product-cta i {
            transition: transform 0.2s ease;
        }

        .product-cta:hover i {
            transform: translateX(2px);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Contact Section */
        .contact-section {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            color: white;
            padding: 4rem 0;
            margin-top: 4rem;
        }

        .contact-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            text-align: center;
        }

        .contact-section h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .contact-subtitle {
            font-size: 1.125rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        /* CTA Buttons in Contact Section */
        .contact-section .hero-cta {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .contact-section .btn-white {
            background: white;
            color: var(--primary-color);
        }

        .contact-section .btn-white:hover {
            background: var(--bg-color);
            transform: translateY(-2px);
        }

        .contact-section .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .contact-section .btn-outline:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .ae-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .ae-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 12px;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ae-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-4px);
        }

        .ae-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .ae-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .ae-title {
            font-size: 0.9375rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .ae-email {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9375rem;
        }

        /* Quick View Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            padding: 2rem;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .modal-body {
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .modal-images {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .modal-main-image {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
        }

        .modal-main-image img {
            width: 100%;
            height: auto;
        }

        .modal-thumbnails {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }

        .modal-thumbnail {
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s ease;
        }

        .modal-thumbnail:hover,
        .modal-thumbnail.active {
            border-color: var(--primary-color);
        }

        .modal-thumbnail img {
            width: 100%;
            height: auto;
        }

        .modal-info h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .modal-style {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .modal-description {
            margin-bottom: 2rem;
            line-height: 1.8;
        }

        .modal-features {
            background: var(--bg-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .modal-features h4 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
        }

        .modal-features ul {
            list-style: none;
        }

        .modal-features li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .modal-features li:before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        .modal-cta {
            display: flex;
            gap: 1rem;
        }

        .modal-cta button {
            flex: 1;
            padding: 1rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-quote {
            background: var(--primary-color);
            color: white;
            border: none;
        }

        .btn-quote:hover {
            background: var(--primary-dark);
        }

        .btn-contact {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-contact:hover {
            background: var(--bg-color);
        }

        /* Sample Info Footer (moved from top of page) */
        .sample-info-footer {
            background: var(--gray-100);
            border-top: 1px solid var(--gray-200);
            padding: 2rem 0;
        }

        .sample-info-footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .sample-info-footer h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 1rem;
            text-align: center;
        }

        .sample-info-footer-grid {
            display: flex;
            justify-content: center;
            gap: 3rem;
            flex-wrap: wrap;
        }

        .sample-info-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            max-width: 250px;
        }

        .sample-info-item i {
            color: var(--primary);
            font-size: 1.25rem;
            margin-top: 0.125rem;
        }

        .sample-info-item strong {
            display: block;
            font-size: 0.875rem;
            color: var(--gray-700);
            margin-bottom: 0.25rem;
        }

        .sample-info-item p {
            font-size: 0.8125rem;
            color: var(--gray-500);
            margin: 0;
            line-height: 1.4;
        }

        /* Footer */
        .footer {
            background: var(--text-primary);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .footer p {
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            /* Tab navigation responsive */
            .category-tabs {
                top: 60px;
            }

            .tabs-container {
                padding: 0 1rem;
            }

            .tab-btn {
                padding: 0.75rem 1rem;
                font-size: 0.8125rem;
            }

            /* Filter bar responsive */
            .filter-bar-container {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-left {
                justify-content: center;
            }

            .filter-right {
                justify-content: center;
            }

            .filter-group {
                flex: 1;
                min-width: 120px;
            }

            .filter-select {
                width: 100%;
            }

            /* Sample info footer responsive */
            .sample-info-footer-grid {
                flex-direction: column;
                gap: 1.5rem;
                align-items: center;
            }

            .sample-info-item {
                max-width: none;
                text-align: center;
                flex-direction: column;
                align-items: center;
            }

            .decoration-filters {
                justify-content: center;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                gap: 1.5rem;
            }

            .modal-body {
                grid-template-columns: 1fr;
            }

            .ae-grid {
                grid-template-columns: 1fr;
            }

            .contact-header {
                flex-direction: column;
                gap: 1rem;
            }

            .contact-section .hero-cta {
                flex-direction: column;
            }

            .contact-section .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* No products message */
        .no-products {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .no-products i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .no-products h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        /* Sample Request Styles */
        .btn-sample {
            padding: 0.625rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: none; /* Hidden until eligibility checked */
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            width: 100%;
            justify-content: center;
            border: 2px solid;
        }
        
        .btn-sample-free {
            background: white;
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-sample-paid {
            background: white;
            color: #2563eb;
            border-color: #2563eb;
        }
        
        .btn-sample:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-sample.in-cart {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-light);
        }
        
        .btn-sample:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Sample Cart Widget */
        /* Sample Cart - Header Integrated */
        .sample-cart-widget {
            display: none; /* Hidden until items added */
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background: var(--primary-color, #2d5f3f);
            color: white;
            transition: background 0.2s ease; /* Simple transition */
            font-size: 0.95rem;
            margin-left: 0.5rem;
        }

        .sample-cart-widget:hover {
            background: #1f4229; /* Slightly darker on hover */
        }

        .sample-cart-widget:focus {
            outline: 2px solid #4CAF50;
            outline-offset: 2px;
        }

        .sample-cart-icon {
            position: relative;
            font-size: 1.2rem;
        }

        .sample-count-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .sample-cart-label {
            font-weight: 500;
            font-size: 0.95rem;
        }

        /* Mobile: Keep simple */
        @media (max-width: 768px) {
            .sample-cart-widget {
                padding: 0.5rem 0.75rem;
                gap: 0.4rem;
            }

            .sample-cart-label {
                font-size: 0.9rem;
            }

            .sample-cart-icon {
                font-size: 1.1rem;
            }
        }
        
        /* Sample Selection Modal */
        .sample-selection-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .sample-selection-modal.active {
            opacity: 1;
        }
        
        .sample-selection-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        
        .sample-selection-content h3 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
        }
        
        .sample-selection-content p {
            color: var(--text-secondary);
            margin: 0 0 1.5rem 0;
        }
        
        .selection-group {
            margin-bottom: 1.5rem;
        }
        
        .selection-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .selection-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .selection-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .selection-actions button {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-cancel {
            background: white;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        
        .btn-confirm {
            background: var(--primary-color);
            border: none;
            color: white;
        }
        
        .btn-confirm:hover {
            background: var(--primary-dark);
        }
        
        /* Toast Notifications */
        .sample-toast {
            position: fixed;
            bottom: 100px;
            right: 30px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 1100;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .sample-toast-show {
            transform: translateX(0);
        }
        
        .sample-toast-success {
            border-left: 4px solid var(--primary-color);
        }
        
        .sample-toast-warning {
            border-left: 4px solid #ff9800;
        }
        
        .sample-toast-info {
            border-left: 4px solid #2196f3;
        }
        
        /* Sample Request Modal */
        .sample-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .sample-modal.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 3rem;
        }
        
        .sample-modal-content {
            background: white;
            border-radius: 12px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .sample-modal-header {
            padding: 2rem;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }
        
        .sample-modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .sample-modal-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .sample-modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .sample-modal-close:hover {
            color: var(--text-primary);
        }
        
        .sample-modal-body {
            padding: 2rem;
        }
        
        .selected-samples {
            margin-bottom: 2rem;
        }
        
        .selected-samples h3 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        .sample-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-color);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }
        
        .sample-item-image {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            overflow: hidden;
            background: white;
        }
        
        .sample-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .sample-item-info {
            flex: 1;
        }
        
        .sample-item-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .sample-item-style {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .sample-item-remove {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 1.25rem;
            transition: color 0.2s ease;
        }
        
        .sample-item-remove:hover {
            color: #c82333;
        }
        
        /* Sample Request Form */
        .sample-form {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9375rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .delivery-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .radio-option {
            display: flex;
            align-items: flex-start;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .radio-option:hover {
            border-color: var(--primary-color);
            background: rgba(76, 179, 84, 0.05);
        }
        
        .radio-option input[type="radio"] {
            margin-right: 0.75rem;
            margin-top: 0.25rem;
        }
        
        .radio-option input[type="radio"]:checked + .radio-label {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .radio-label {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .radio-label i {
            margin-right: 0.5rem;
        }
        
        .radio-label small {
            display: block;
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            font-weight: normal;
        }
        
        .order-total-display {
            background: var(--bg-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }
        
        .order-total-display h4 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
        }
        
        .total-line {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            color: var(--text-secondary);
        }
        
        .total-line.total-final {
            border-top: 2px solid var(--border-color);
            margin-top: 0.5rem;
            padding-top: 1rem;
            font-weight: 600;
            font-size: 1.125rem;
            color: var(--text-primary);
        }
        
        .form-submit {
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 1rem;
        }
        
        .form-submit:hover:not(:disabled) {
            background: var(--primary-dark);
        }
        
        .form-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Sample eligibility badge */
        .sample-eligible-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary-color);
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 5;
        }
        
        /* Product card actions */
        .product-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        /* DTG Badge Styling - White Text on Solid Green for Maximum Visibility */
        .dtg-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            background: linear-gradient(135deg, #10b981, #059669);
            border: 1px solid rgba(5, 150, 105, 0.3);
            color: #ffffff;
            padding: 0.25rem 0.625rem;
            border-radius: 16px;
            font-size: 0.6875rem;
            font-weight: 500;
            cursor: help;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(16, 185, 129, 0.15);
        }

        .dtg-badge:hover {
            background: linear-gradient(135deg, #059669, #047857);
            border-color: rgba(5, 150, 105, 0.5);
            box-shadow: 0 2px 5px rgba(16, 185, 129, 0.25);
            transform: translateY(-1px);
        }

        .dtg-badge i {
            font-size: 0.75rem;
            color: #ffffff;
        }

        /* DTG Filter Button Active State */
        .dtg-filter-btn.active {
            background: linear-gradient(135deg, #0ea5e9, #06b6d4);
            border-color: #0ea5e9;
            transform: scale(1.02);
        }

        .dtg-filter-btn.active .dtg-filter-title,
        .dtg-filter-btn.active .dtg-filter-subtitle {
            color: white;
        }

        .dtg-filter-btn.active i {
            color: white;
        }

        .dtg-filter-btn.active .count {
            background: white;
            color: #0ea5e9;
        }

        /* Badge Filter Active State */
        .badge-filter.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Mobile Responsive Updates */
        @media (max-width: 768px) {
            .category-filters {
                grid-template-columns: repeat(2, 1fr);
            }

            .dtg-filter-content {
                flex: 1;
            }

            .dtg-filter-subtitle {
                font-size: 0.7rem;
            }

            /* PHASE 0: Collapsible Filters on Mobile */
            .filter-bar {
                padding: 1rem 0;
                position: relative;  /* Not sticky on mobile */
                top: auto;
            }

            .filter-toggle-btn {
                display: flex;
                width: 100%;
                padding: 1rem;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                justify-content: space-between;
                align-items: center;
                font-size: 1rem;
                font-weight: 600;
                color: var(--text-primary);
                cursor: pointer;
                transition: all 0.3s ease;
                margin: 0 1rem;
            }

            .filter-toggle-btn:hover {
                background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            }

            .filter-toggle-btn i {
                transition: transform 0.3s ease;
                color: var(--primary-color);
            }

            .filter-toggle-btn.expanded i {
                transform: rotate(180deg);
            }

            .filter-content-wrapper {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.5s ease;
            }

            .filter-content-wrapper.expanded {
                max-height: 2000px;  /* Large enough for all filters */
            }

            .filter-container {
                padding: 0 1rem;
            }

            /* Compact category cards */
            .filter-btn {
                padding: 0.75rem;
                min-height: 90px;  /* Reduced from ~120px */
            }

            .filter-btn i {
                font-size: 1.5rem;  /* Slightly smaller icons */
            }

            .filter-btn span:first-of-type {
                font-size: 0.875rem;  /* Smaller text */
            }

            .filter-btn .count {
                font-size: 0.75rem;  /* Smaller count badge */
            }

            /* Reduce horizontal padding */
            .filter-container {
                padding: 0 1rem;
            }

            .sample-info-container {
                padding: 0 1rem;
            }

            .products-container {
                padding: 0 1rem;
            }
        }

        /* Sample Info Banner */
        .sample-info-banner {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 2.5rem 0;
            margin-bottom: 0;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        .sample-info-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .sample-info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-bottom: 1.5rem;
        }

        .sample-info-card {
            background: white;
            padding: 1.75rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: all 0.3s ease;
        }

        .sample-info-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }

        .sample-info-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 1rem;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .sample-info-card h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .sample-info-card p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin: 0;
        }

        /* Mobile Responsive for Sample Info Banner */
        @media (max-width: 768px) {
            .sample-info-banner {
                padding: 1.5rem 0;
            }

            .sample-info-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .sample-info-card {
                padding: 1.25rem;
            }

            .sample-info-icon {
                width: 50px;
                height: 50px;
                font-size: 1.25rem;
            }

            .sample-info-card h3 {
                font-size: 1rem;
            }

            .sample-info-card p {
                font-size: 0.875rem;
            }
        }

        /* PHASE 1: Small phone breakpoint (iPhone SE, small Android) */
        @media (max-width: 480px) {
            .filter-toggle-btn {
                font-size: 0.9rem;
                padding: 0.875rem;
                margin: 0 0.5rem;
            }

            .filter-container,
            .sample-info-container,
            .products-container {
                padding: 0 0.5rem;
            }

            .filter-btn {
                min-height: 85px;
                padding: 0.5rem;
            }

            .filter-btn i {
                font-size: 1.25rem;
            }

            .filter-btn span:first-of-type {
                font-size: 0.8rem;
            }

            .products-grid {
                grid-template-columns: 1fr;  /* Single column on very small screens */
                gap: 1rem;
            }

            .product-card {
                max-width: 100%;
            }

            /* Scale down headings for small screens */
            .hero h1 {
                font-size: 1.5rem;
            }

            .sample-info-card h3 {
                font-size: 0.9rem;
            }

            .sample-info-card p {
                font-size: 0.8rem;
            }
        }

        /* PHASE 3: Tablet breakpoint (iPad) */
        @media (max-width: 1024px) and (min-width: 769px) {
            .filter-container {
                padding: 0 1.5rem;
            }

            .products-grid {
                grid-template-columns: repeat(3, 1fr);  /* 3 columns for tablets */
            }

            .filter-btn {
                min-height: 100px;
            }
        }
    </style>
</head>
<body>
    <!-- Universal Header Placeholder -->
    <div id="universal-header-placeholder"></div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-container">
            <h1>Start with Our Best Sellers</h1>
            <p class="hero-subtitle">Proven quality<span class="separator">â€¢</span>Fast turnaround<span class="separator">â€¢</span>Pacific Northwest favorites</p>
        </div>
    </section>

    <!-- Search Section -->
    <section class="search-section">
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" 
                   class="search-input" 
                   id="searchInput" 
                   placeholder="Search products by name, style, brand..." 
                   autocomplete="off">
            <button class="search-clear" id="searchClear" onclick="clearSearch()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="search-results" id="searchResults" style="display: none;">
            Found <strong id="resultCount">0</strong> products
        </div>
    </section>

    <!-- Sticky Category Tabs -->
    <nav class="category-tabs" id="categoryTabs">
        <div class="tabs-container">
            <button class="tab-btn active" data-tab="all" data-filter-type="primary">
                All Products
            </button>
            <button class="tab-btn" data-tab="tshirts" data-filter-type="primary">
                T-Shirts
            </button>
            <button class="tab-btn" data-tab="hoodies" data-filter-type="primary">
                Hoodies
            </button>
            <button class="tab-btn" data-tab="polos" data-filter-type="primary">
                Polos
            </button>
            <button class="tab-btn" data-tab="caps" data-filter-type="primary">
                Caps
            </button>
            <button class="tab-btn" data-tab="jackets" data-filter-type="primary">
                Jackets
            </button>
            <button class="tab-btn" data-tab="richardson" data-filter-type="secondary">
                Richardson
            </button>
            <button class="tab-btn tab-new2026" data-tab="new2026" data-filter-type="secondary">
                <span class="new-dot" style="background: #10b981;"></span>
                2026
            </button>
        </div>
    </nav>

    <!-- Simple Filter Bar -->
    <div class="filter-bar-simple">
        <div class="filter-bar-container">
            <div class="filter-left">
                <span class="results-count" id="resultsCount">Showing 77 products</span>
            </div>
            <div class="filter-right">
                <div class="filter-group">
                    <label for="sortSelect">Sort:</label>
                    <select id="sortSelect" class="filter-select">
                        <option value="popular">Most Popular</option>
                        <option value="newest">Newest First</option>
                        <option value="name">Name A-Z</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="brandSelect">Brand:</label>
                    <select id="brandSelect" class="filter-select">
                        <option value="all">All Brands</option>
                        <option value="Carhartt">Carhartt</option>
                        <option value="Port Authority">Port Authority</option>
                        <option value="Port & Company">Port & Company</option>
                        <option value="Richardson">Richardson</option>
                    </select>
                </div>
                <label class="filter-checkbox">
                    <input type="checkbox" id="dtgFilter">
                    <span>DTG Only</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Products Section -->
    <section class="products-section">
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <p style="margin-top: 1rem; color: var(--text-secondary);">Loading products...</p>
        </div>
        <div class="products-grid" id="productsGrid" style="display: none;">
            <!-- Products will be dynamically loaded here -->
        </div>
        <div class="no-products" id="noProducts" style="display: none;">
            <i class="fas fa-box-open"></i>
            <h3>No products found</h3>
            <p>Try selecting a different category</p>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact-section" id="contact">
        <div class="contact-container">
            <h2>Ready to Order? Contact Our Team</h2>
            <p class="contact-subtitle">Our experienced account executives are here to help with your custom apparel needs</p>

            <!-- CTA Buttons -->
            <div class="hero-cta" style="margin-bottom: 2.5rem;">
                <a href="mailto:sales@nwcustomapparel.com" class="btn btn-white">
                    <i class="fas fa-user-tie"></i>
                    Contact an Account Executive
                </a>
                <a href="tel:253-922-5793" class="btn btn-outline">
                    <i class="fas fa-phone"></i>
                    Call for Quick Quote: (253) 922-5793
                </a>
            </div>

            <div class="ae-grid">
                <a href="mailto:nika@nwcustomapparel.com" class="ae-card">
                    <i class="fas fa-user-circle ae-icon"></i>
                    <div class="ae-name">Nika Lao</div>
                    <div class="ae-title">Account Executive</div>
                    <div class="ae-email">
                        <i class="fas fa-envelope"></i>
                        nika@nwcustomapparel.com
                    </div>
                </a>
                <a href="mailto:taneisha@nwcustomapparel.com" class="ae-card">
                    <i class="fas fa-user-circle ae-icon"></i>
                    <div class="ae-name">Taneisha Clark</div>
                    <div class="ae-title">Account Executive</div>
                    <div class="ae-email">
                        <i class="fas fa-envelope"></i>
                        taneisha@nwcustomapparel.com
                    </div>
                </a>
                <a href="mailto:sales@nwcustomapparel.com" class="ae-card">
                    <i class="fas fa-users ae-icon"></i>
                    <div class="ae-name">Sales Team</div>
                    <div class="ae-title">General Inquiries</div>
                    <div class="ae-email">
                        <i class="fas fa-envelope"></i>
                        sales@nwcustomapparel.com
                    </div>
                </a>
            </div>
        </div>
    </section>

    <!-- Quick View Modal -->
    <div id="quickViewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Product Details</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Product details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Sample Program Info (moved from top) -->
    <section class="sample-info-footer">
        <div class="sample-info-footer-container">
            <h3>About Our Sample Program</h3>
            <div class="sample-info-footer-grid">
                <div class="sample-info-item">
                    <i class="fas fa-tshirt"></i>
                    <div>
                        <strong>Blank Products</strong>
                        <p>Samples arrive with NO LOGOS or decoration</p>
                    </div>
                </div>
                <div class="sample-info-item">
                    <i class="fas fa-tags"></i>
                    <div>
                        <strong>Free & Paid Options</strong>
                        <p>Up to 3 free samples â€¢ Paid samples available</p>
                    </div>
                </div>
                <div class="sample-info-item">
                    <i class="fas fa-truck"></i>
                    <div>
                        <strong>Delivery</strong>
                        <p>7-10 business days â€¢ All samples are final sale</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2026 Northwest Custom Apparel. All rights reserved.</p>
            <p>2025 Freeman Road East, Milton, WA 98354 | 253-922-5793</p>
        </div>
    </footer>


    <script>
        // Complete top sellers data - ALL 60 products
        const completeTopSellers = {
            dtg: [
                { rank: 1, style: 'PC54', description: 'Port & Company - Core Cotton Tee', brand: 'Port & Company' },
                { rank: 2, style: 'PC450', description: 'Port & Company Fan Favorite Tee', brand: 'Port & Company' },
                { rank: 3, style: 'PC61', description: 'Port & Company - Essential Tee', brand: 'Port & Company' },
                { rank: 4, style: 'PC78H', description: 'Port & Company - Core Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 5, style: 'PC55', description: 'Port & Company - Core Blend Tee', brand: 'Port & Company' },
                { rank: 6, style: 'PC61LS', description: 'Port & Company - Long Sleeve Essential Tee', brand: 'Port & Company' },
                { rank: 7, style: 'PC600', description: 'Port & Company Bouncer Tee', brand: 'Port & Company' },
                { rank: 8, style: 'BC3001', description: 'BellaCanvas Unisex Jersey Short Sleeve Tee', brand: 'BellaCanvas' },
                { rank: 11, style: 'PC54LS', description: 'Port & Company - Long Sleeve Core Cotton Tee', brand: 'Port & Company' },
                { rank: 12, style: 'CTK87', description: 'Carhartt Workwear Pocket Short Sleeve T-Shirt', brand: 'Carhartt' }
            ],
            caps: [
                { rank: 1, style: 'C112', description: 'Port Authority Snapback Trucker Cap', brand: 'Port Authority' },
                { rank: 2, style: '112', description: 'Richardson Trucker Cap with Mesh Snap Back', brand: 'Richardson' },
                { rank: 3, style: 'NE1000', description: 'New Era - Structured Stretch Cotton Cap', brand: 'New Era' },
                { rank: 4, style: 'C110', description: 'Port Authority Flexfit 110 Mesh Cap', brand: 'Port Authority' },
                { rank: 5, style: 'CP90', description: 'Port & Company Knit Cap', brand: 'Port & Company' },
                { rank: 6, style: 'C826', description: 'Port Authority Pique Mesh Cap L/XL', brand: 'Port Authority' },
                { rank: 7, style: 'C114', description: 'Port Authority Digi Camo Snapback Trucker Cap', brand: 'Port Authority' },
                { rank: 8, style: 'C912', description: 'Port Authority Camouflage Cap With Air Mesh Back', brand: 'Port Authority' },
                { rank: 9, style: 'TM1MU423', description: 'Travismathew Cruz Trucker Cap', brand: 'TravisMathew' },
                { rank: 10, style: 'CP85', description: 'Port & Company Sandwich Bill Cap', brand: 'Port & Company' },
                { rank: 11, style: 'C865', description: 'Port Authority Flexfit Cap', brand: 'Port Authority' },
                { rank: 12, style: 'CP82', description: 'Port & Company Brushed Twill Cap', brand: 'Port & Company' }
            ],
            embroidery: [
                { rank: 1, style: 'NKDC1963', description: 'Nike Dri-Fit Micro Pique 2.0 Polo', brand: 'Nike' },
                { rank: 2, style: 'CT104670', description: 'Carhartt Storm Defender Shoreline Jacket', brand: 'Carhartt' },
                { rank: 3, style: 'EB532', description: 'Eddie Bauer Shaded Crosshatch Soft Shell Jacket', brand: 'Eddie Bauer' },
                { rank: 4, style: '267020', description: 'Nike Dri-Fit Classic Polo', brand: 'Nike' },
                { rank: 5, style: 'CT100617', description: 'Carhartt Rain Defender Paxton Heavyweight Hooded Zip Mock Sweatshirt', brand: 'Carhartt' },
                { rank: 6, style: 'ST253', description: 'Sport-Tek 1/4-Zip Sweatshirt', brand: 'Sport-Tek' },
                { rank: 7, style: 'C112', description: 'Port Authority Snapback Trucker Cap', brand: 'Port Authority' },
                { rank: 8, style: 'CTK121', description: 'Carhartt Midweight Hooded Sweatshirt', brand: 'Carhartt' },
                { rank: 9, style: 'CT103828', description: 'Carhartt Duck Detroit Jacket', brand: 'Carhartt' },
                { rank: 10, style: 'CT89176508', description: 'Carhartt Foundry Series Pro Backpack', brand: 'Carhartt' },
                { rank: 11, style: 'ST650', description: 'Sport-Tek Micropique Sport-Wick Polo', brand: 'Sport-Tek' },
                { rank: 12, style: 'CT104597', description: 'Carhartt Watch Cap 2.0', brand: 'Carhartt' },
                { rank: 13, style: 'EB550', description: 'Eddie Bauer - Rain Jacket', brand: 'Eddie Bauer' },
                { rank: 14, style: 'CT102286', description: 'Carhartt Gilliam Vest', brand: 'Carhartt' },
                { rank: 15, style: 'ST850', description: 'Sport-Tek Sport-Wick Stretch 1/4-Zip Pullover', brand: 'Sport-Tek' }
            ],
            screenprint: [
                { rank: 1, style: 'PC90H', description: 'Port & Company - Essential Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 2, style: 'PC55', description: 'Port & Company - Core Blend Tee', brand: 'Port & Company' },
                { rank: 3, style: '18500', description: 'Gildan - Heavy Blend Hooded Sweatshirt', brand: 'Gildan' },
                { rank: 4, style: 'PC78H', description: 'Port & Company - Core Fleece Pullover Hooded Sweatshirt', brand: 'Port & Company' },
                { rank: 5, style: 'PC600', description: 'Port & Company Bouncer Tee', brand: 'Port & Company' },
                { rank: 6, style: '996M', description: 'Jerzees - Nublend Pullover Hooded Sweatshirt', brand: 'Jerzees' },
                { rank: 7, style: 'BC3001', description: 'BellaCanvas Unisex Jersey Short Sleeve Tee', brand: 'BellaCanvas' },
                { rank: 8, style: '5186', description: 'Hanes Adult Long-Sleeve Beefy-T', brand: 'Hanes' },
                { rank: 9, style: 'PC55P', description: 'Port & Company - Core Blend Pocket Tee', brand: 'Port & Company' },
                { rank: 10, style: 'PC54', description: 'Port & Company - Core Cotton Tee', brand: 'Port & Company' },
                { rank: 11, style: 'CS204', description: 'CornerStone ANSI 107 Class 2 Segmented Tape Tee', brand: 'CornerStone' },
                { rank: 12, style: '5180', description: 'Hanes Beefy-T - 100 Cotton T-Shirt', brand: 'Hanes' },
                { rank: 13, style: 'DT6100', description: 'District V.I.T. Fleece Hoodie', brand: 'District' }
            ],
            freshPicks: [
                // Essential Value Tees
                { rank: 1, style: 'PC43', description: 'Port & Company Essential Pigment-Dyed Tee', brand: 'Port & Company' },
                { rank: 2, style: 'PC340', description: 'Port & Company CVC Tee', brand: 'Port & Company' },
                { rank: 3, style: 'PC330', description: 'Port & Company Tri-Blend Tee', brand: 'Port & Company' },
                
                // District Premium Collection
                { rank: 4, style: 'DT6000', description: 'District Perfect Weight Tee', brand: 'District' },
                { rank: 5, style: 'DT6200', description: 'District Very Important Tee', brand: 'District' },
                { rank: 6, style: 'DT106', description: 'District Re-Tee', brand: 'District' },
                { rank: 7, style: 'DM108', description: 'District Perfect Blend CVC Tee', brand: 'District' },
                { rank: 8, style: 'DT184', description: 'District Women\'s Perfect Blend CVC Tee', brand: 'District' },
                { rank: 9, style: 'DT8000', description: 'District Re-Fleece Full-Zip Hoodie', brand: 'District' },
                { rank: 10, style: 'DM130', description: 'District Perfect Tri Tee', brand: 'District' },
                { rank: 11, style: 'DT2101', description: 'District Flannel Shirt', brand: 'District' },
                { rank: 12, style: 'DT6065', description: 'District V.I.T. Heavyweight Tee', brand: 'District' },
                
                // Performance Collection
                { rank: 13, style: 'PC380', description: 'Port & Company Performance Blend Tee', brand: 'Port & Company' },
                { rank: 14, style: 'ST350', description: 'Sport-Tek PosiCharge Competitor Tee', brand: 'Sport-Tek' },
                { rank: 15, style: 'ST490', description: 'Sport-Tek Dry Zone Colorblock Raglan Polo', brand: 'Sport-Tek' },
                
                // Professional Polos
                { rank: 16, style: 'K200', description: 'Port Authority Pima Cotton Polo', brand: 'Port Authority' },
                { rank: 17, style: 'K500', description: 'Port Authority Silk Touch Polo', brand: 'Port Authority' },
                { rank: 18, style: 'K240', description: 'Port Authority Wearever Performance Pique Polo', brand: 'Port Authority' },
                { rank: 19, style: 'CS450', description: 'CornerStone Select Lightweight Snag-Proof Tactical Polo', brand: 'CornerStone' },
                { rank: 20, style: 'MM1014', description: 'Mercer+Mettle Stretch Jersey Polo', brand: 'Mercer+Mettle' },
                
                // Comfort Fleece
                { rank: 21, style: 'DT6150', description: 'District Featherweight French Terry Hoodie', brand: 'District' },
                { rank: 22, style: 'DT7800', description: 'District Cloud Fleece Hoodie', brand: 'District' },
                
                // Headwear Additions
                { rank: 23, style: 'STC39', description: 'Sport-Tek PosiCharge Competitor Cap', brand: 'Sport-Tek' },
                { rank: 24, style: 'STC54', description: 'Sport-Tek PosiCharge Competitor Mesh Back Cap', brand: 'Sport-Tek' }
            ]
        };

        // Brand placeholder styles for non-API products
        const brandPlaceholders = {
            'Nike': {
                background: 'linear-gradient(135deg, #111111, #333333)',
                icon: `<svg viewBox="0 0 24 24" style="width: 60px; height: 60px; fill: white;"><path d="M6.75 2.77l9.57 6.14c.27.18.57.27.9.27a1.5 1.5 0 0 0 1.02-.39c.77-.77.6-2.03-.39-2.84L6.23.01C5.5-.33 4.92.11 4.92.91c0 .52.09 1.19.22 1.86c.2 1.11.52 2.8.92 4.38c.5 1.94 1.15 3.9 2.06 5.16c.3.41.64.71 1 .87c.29.13.6.19.92.19c.52 0 1.03-.15 1.49-.45c1.55-.97 2.85-2.76 3.45-4.35Z"/></svg>`,
                tagline: 'Just Do ItÂ®',
                textColor: 'white'
            },
            'Carhartt': {
                background: 'linear-gradient(135deg, #8b6f47, #6d5943)',
                icon: '<span style="font-size: 48px; font-weight: bold; color: white;">C</span>',
                tagline: 'Outworking Since 1889',
                textColor: 'white'
            },
            'Eddie Bauer': {
                background: 'linear-gradient(135deg, #1a3a52, #2d5016)',
                icon: '<span style="font-size: 36px; font-weight: bold; color: white;">EB</span>',
                tagline: 'First Ascent',
                textColor: 'white'
            },
            'New Era': {
                background: 'linear-gradient(135deg, #000000, #1a1a1a)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">NEW ERA</span>',
                tagline: 'Authentic Performance',
                textColor: 'white'
            },
            'TravisMathew': {
                background: 'linear-gradient(135deg, #2c5aa0, #1e3a6f)',
                icon: '<span style="font-size: 28px; font-weight: 300; color: white;">TM</span>',
                tagline: 'Life on Tour',
                textColor: 'white'
            },
            'Gildan': {
                background: 'linear-gradient(135deg, #0066cc, #003d7a)',
                icon: '<span style="font-size: 36px; font-weight: bold; color: white;">G</span>',
                tagline: 'Quality Basics',
                textColor: 'white'
            },
            'BellaCanvas': {
                background: 'linear-gradient(135deg, #e91e63, #c2185b)',
                icon: '<span style="font-size: 28px; font-weight: 300; color: white;">BELLA</span>',
                tagline: 'Retail Inspired',
                textColor: 'white'
            },
            'Jerzees': {
                background: 'linear-gradient(135deg, #ff6b35, #f44336)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">J</span>',
                tagline: 'Quality Essentials',
                textColor: 'white'
            },
            'Hanes': {
                background: 'linear-gradient(135deg, #b71c1c, #d32f2f)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">H</span>',
                tagline: 'Comfort Made Better',
                textColor: 'white'
            },
            'Richardson': {
                background: 'linear-gradient(135deg, #37474f, #263238)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">R</span>',
                tagline: 'The Hat of Choice',
                textColor: 'white'
            },
            'District': {
                background: 'linear-gradient(135deg, #9c27b0, #7b1fa2)',
                icon: '<span style="font-size: 32px; font-weight: bold; color: white;">D</span>',
                tagline: 'Everyday Tees',
                textColor: 'white'
            },
            'CornerStone': {
                background: 'linear-gradient(135deg, #ff9800, #f57c00)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">CS</span>',
                tagline: 'Work Tough',
                textColor: 'white'
            },
            'Sport-Tek': {
                background: 'linear-gradient(135deg, #2e7d32, #388e3c)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">ST</span>',
                tagline: 'Sport Performance',
                textColor: 'white'
            },
            'Port Authority': {
                background: 'linear-gradient(135deg, #1565c0, #1976d2)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">PA</span>',
                tagline: 'Professional Apparel',
                textColor: 'white'
            },
            'Port & Company': {
                background: 'linear-gradient(135deg, #5e35b1, #673ab7)',
                icon: '<span style="font-size: 28px; font-weight: bold; color: white;">PC</span>',
                tagline: 'Essential Basics',
                textColor: 'white'
            },
            'Generic': {
                background: 'linear-gradient(135deg, #757575, #9e9e9e)',
                icon: '<i class="fas fa-tshirt" style="font-size: 48px; color: white;"></i>',
                tagline: 'Quality Apparel',
                textColor: 'white'
            }
        };

        // Simple image overrides for specific products
        // OPTION A: Hardcoded (quick, works immediately)
        // Note: Richardson caps now use SanMar API for images (FRONT_MODEL field)
        const imageOverrides = {
            // Original overrides for products that need custom images
            'C112': 'https://c3eku948.caspio.com/dp/a0e150004df4984fb1ef4d30b01a/files/9116050', // C112 override only
            'CP90': 'https://c3eku948.caspio.com/dp/a0e150004df4984fb1ef4d30b01a/files/9169209', // CP90 Port & Company Knit Cap
            'CT104597': 'https://c3eku948.caspio.com/dp/a0e150004df4984fb1ef4d30b01a/files/9169220'  // CT104597 Carhartt product
        };

        // OPTION B: Database-driven (scalable, requires API setup)
        // Load image overrides from Caspio API
        async function loadImageOverridesFromAPI() {
            try {
                const response = await fetch('https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/product-image-overrides');
                if (!response.ok) {
                    console.warn('[ImageOverrides] API not available, using hardcoded overrides');
                    return;
                }

                const overrides = await response.json();

                // Merge API overrides with hardcoded ones (API takes priority)
                overrides.forEach(override => {
                    if (override.StyleNumber && override.ImageURL) {
                        imageOverrides[override.StyleNumber] = override.ImageURL;
                        console.log(`[ImageOverrides] Loaded override for ${override.StyleNumber}`);
                    }
                });

                console.log(`[ImageOverrides] Loaded ${overrides.length} overrides from API`);

            } catch (error) {
                console.warn('[ImageOverrides] Failed to load from API:', error.message);
                // Continue with hardcoded overrides
            }
        }

        // Product descriptions for items without API data
        const productDescriptions = {
            '112': {
                fullDescription: `The 112 is the standard by which all truckers are measured. Popular for its undeniable quality and versatility, this casual classic is constructed with the trademark attention to detail that we've built our reputation on. With a design shaped by more than 50 years of cap-making expertise and available in over 50 colorways, the 112 has inspired many imitations yet continues to be the most popular cap in the USA.`,
                features: [
                    'Six-panel construction delivers the classic look and feel the 112 is famous for',
                    'Premium materials and craftsmanship ensure an ideal fit for all sizes',
                    'Our Standard cotton sweatband provides comfort for all-day wear',
                    'Featured Decoration: Woven Patch'
                ],
                decorations: ['Embroidery', 'Leather', 'Patches', 'Labels', 'Transfers'],
                sizes: 'Now available in Extra Large, Small, and Youth sizes'
            }
        };
        
        // Product category mapping - maps each style number to product category
        const productCategoryMap = {
            // T-Shirts (28 products)
            'PC54': 'tshirts',
            'PC450': 'tshirts',
            'PC61': 'tshirts',
            'PC55': 'tshirts',
            'PC61LS': 'tshirts',
            'PC600': 'tshirts',
            'BC3001': 'tshirts',
            'PC54LS': 'tshirts',
            'CTK87': 'tshirts', // Also in workwear
            '5186': 'tshirts',
            'PC55P': 'tshirts',
            'CS204': 'tshirts',
            '5180': 'tshirts',
            'PC43': 'tshirts',
            'PC340': 'tshirts',
            'PC330': 'tshirts',
            'DT6000': 'tshirts',
            'DT6200': 'tshirts',
            'DT106': 'tshirts',
            'DM108': 'tshirts',
            'DT184': 'tshirts',
            'DM130': 'tshirts',
            'DT6065': 'tshirts',
            'PC380': 'tshirts',
            'ST350': 'tshirts',

            // Hoodies (12 products)
            'PC78H': 'hoodies',
            'PC90H': 'hoodies',
            '18500': 'hoodies',
            '996M': 'hoodies',
            'DT6100': 'hoodies',
            'DT8000': 'hoodies',
            'DT6150': 'hoodies',
            'DT7800': 'hoodies',

            // Polos (8 products)
            'NKDC1963': 'polos',
            '267020': 'polos',
            'ST650': 'polos',
            'K200': 'polos',
            'K500': 'polos',
            'K240': 'polos',
            'CS450': 'polos',
            'MM1014': 'polos',
            'ST490': 'polos',

            // Caps & Hats (18 products)
            'C112': 'caps',
            '112': 'caps',
            'NE1000': 'caps',
            'C110': 'caps',
            'CP90': 'caps',
            'C826': 'caps',
            'C114': 'caps',
            'C912': 'caps',
            'TM1MU423': 'caps',
            'CP85': 'caps',
            'C865': 'caps',
            'CP82': 'caps',
            'CT104597': 'caps',
            'STC39': 'caps',
            'STC54': 'caps',

            // Jackets (7 products)
            'CT104670': 'jackets',
            'EB532': 'jackets',
            'CT100617': 'jackets',
            'ST253': 'jackets',
            'CT103828': 'jackets',
            'EB550': 'jackets',
            'CT102286': 'jackets',
            'ST850': 'jackets',

            // Workwear (4 products)
            'CT89176508': 'workwear',
            'CTK121': 'workwear'
        };

        // DTG-compatible products (high cotton content)
        const dtgCompatibleProducts = new Set([
            'PC54', 'PC450', 'PC61', 'PC78H', 'PC55', 'PC61LS', 'PC600',
            'PC90H', 'BC3001', 'PC54LS', 'CTK87'
        ]);

        // Product cache
        const productCache = {};
        let currentFilter = { category: 'all', type: 'primary' };
        let dtgFilterActive = false;
        let allProducts = [];
        let searchTerm = '';

        // Load New Arrivals Carousel
        async function loadNewArrivalsCarousel() {
            const carouselContainer = document.getElementById('newArrivalsCarousel');

            try {
                console.log('[NewArrivals] Fetching new products from API...');
                const response = await fetch('https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/products/new?limit=100');

                if (!response.ok) {
                    throw new Error(`API returned ${response.status}`);
                }

                const result = await response.json();
                const products = result.products || [];

                console.log(`[NewArrivals] Received ${products.length} products`);

                // Group by style to eliminate color duplicates (same as existing "New Products" filter)
                const uniqueProducts = new Map();
                products.forEach(p => {
                    if (!uniqueProducts.has(p.STYLE)) {
                        uniqueProducts.set(p.STYLE, p);
                    }
                });

                // Filter out DISCONTINUED products
                const activeProducts = Array.from(uniqueProducts.values()).filter(p =>
                    !p.PRODUCT_TITLE?.includes('DISCONTINUED') &&
                    !p.PRODUCT_DESCRIPTION?.includes('DISCONTINUED')
                );

                console.log(`[NewArrivals] Displaying ${Math.min(activeProducts.length, 4)} featured products`);

                // Display first 4 products in carousel
                const featuredProducts = activeProducts.slice(0, 4);

                if (featuredProducts.length === 0) {
                    carouselContainer.innerHTML = '<div class="carousel-loading"><p>No new arrivals at this time</p></div>';
                    return;
                }

                // Check pricing eligibility for all products
                const productsWithPricing = await Promise.all(
                    featuredProducts.map(async product => {
                        const eligibility = await window.sampleCart.checkEligibility(product.STYLE);
                        return {
                            ...product,
                            isFree: eligibility.type === 'free',
                            price: eligibility.price || 0,
                            eligible: eligibility.eligible
                        };
                    })
                );

                carouselContainer.innerHTML = productsWithPricing.map(product => {
                    // Generate button text with price
                    const buttonText = product.eligible ?
                        (product.isFree ?
                            'Request Free Sample' :
                            `Request Sample - $${product.price.toFixed(2)}`
                        ) : 'View Product';

                    return `
                    <div class="carousel-product-card" onclick="window.location.href='top-sellers-product.html?style=${product.STYLE}&name=${encodeURIComponent(product.PRODUCT_TITLE?.split('.')[0]?.trim() || 'Product')}'">
                        <div class="product-image">
                            <img src="${product.COLOR_PRODUCT_IMAGE || product.PRODUCT_IMAGE || product.THUMBNAIL_IMAGE || `https://via.placeholder.com/280x200?text=${product.MILL}`}"
                                 alt="${product.PRODUCT_TITLE || product.STYLE}"
                                 class="carousel-product-image"
                                 onerror="this.src='https://via.placeholder.com/280x200?text=${product.MILL}'">
                            <div class="carousel-new-badge">NEW</div>
                        </div>
                        <div class="product-info">
                            <div class="product-style">${product.MILL || 'Brand'} â€¢ ${product.STYLE}</div>
                            <div class="carousel-product-name">${product.PRODUCT_TITLE?.split('.')[0]?.trim() || product.STYLE}</div>
                            <button class="carousel-sample-btn" onclick="event.stopPropagation(); requestSampleFromCarousel('${product.STYLE}', '${(product.PRODUCT_TITLE?.split('.')[0]?.trim() || product.STYLE).replace(/'/g, "\\'")}', '${product.MILL || 'Brand'}', '${product.isFree ? 'free' : 'paid'}', ${product.price || 0})">
                                <i class="fas fa-box"></i>
                                ${buttonText}
                            </button>
                        </div>
                    </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('[NewArrivals] Error loading carousel:', error);
                carouselContainer.innerHTML = '<div class="carousel-loading"><p>Unable to load new arrivals</p></div>';
            }
        }

        // Load Bestsellers Carousel (Hybrid: API + Richardson 112)
        async function loadBestsellersCarousel() {
            const carouselContainer = document.getElementById('bestsellersCarousel');

            try {
                console.log('[Bestsellers] Fetching top sellers from API...');
                const response = await fetch('https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/products/topsellers?limit=100');

                if (!response.ok) {
                    throw new Error(`API returned ${response.status}`);
                }

                const result = await response.json();
                const products = result.products || [];

                console.log(`[Bestsellers] Received ${products.length} products`);

                // Group by style to eliminate color duplicates
                const uniqueProducts = new Map();
                products.forEach(p => {
                    if (!uniqueProducts.has(p.STYLE)) {
                        uniqueProducts.set(p.STYLE, p);
                    }
                });

                // Filter out DISCONTINUED products
                const activeProducts = Array.from(uniqueProducts.values()).filter(p =>
                    !p.PRODUCT_TITLE?.includes('DISCONTINUED') &&
                    !p.PRODUCT_DESCRIPTION?.includes('DISCONTINUED')
                );

                console.log(`[Bestsellers] Displaying ${Math.min(activeProducts.length, 4)} featured products`);

                // Display first 4 products in carousel
                const featuredProducts = activeProducts.slice(0, 4);

                if (featuredProducts.length === 0) {
                    carouselContainer.innerHTML = '<div class="carousel-loading"><p>No bestsellers at this time</p></div>';
                    return;
                }

                // Check pricing eligibility for all products
                const productsWithPricing = await Promise.all(
                    featuredProducts.map(async product => {
                        const eligibility = await window.sampleCart.checkEligibility(product.STYLE);
                        return {
                            ...product,
                            isFree: eligibility.type === 'free',
                            price: eligibility.price || 0,
                            eligible: eligibility.eligible
                        };
                    })
                );

                carouselContainer.innerHTML = productsWithPricing.map(product => {
                    // Generate button text with price
                    const buttonText = product.eligible ?
                        (product.isFree ?
                            'Request Free Sample' :
                            `Request Sample - $${product.price.toFixed(2)}`
                        ) : 'View Product';

                    return `
                    <div class="carousel-product-card" onclick="window.location.href='top-sellers-product.html?style=${product.STYLE}&name=${encodeURIComponent(product.PRODUCT_TITLE?.split('.')[0]?.trim() || 'Product')}'">
                        <div class="product-image">
                            <img src="${imageOverrides[product.STYLE] || product.COLOR_PRODUCT_IMAGE || product.PRODUCT_IMAGE || product.THUMBNAIL_IMAGE || `https://via.placeholder.com/280x200?text=${product.MILL}`}"
                                 alt="${product.PRODUCT_TITLE || product.STYLE}"
                                 class="carousel-product-image"
                                 onerror="this.src='https://via.placeholder.com/280x200?text=${product.MILL}'">
                            <div class="carousel-new-badge" style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); color: #000;">â˜… TOP SELLER</div>
                        </div>
                        <div class="product-info">
                            <div class="product-style">${product.MILL || 'Brand'} â€¢ ${product.STYLE}</div>
                            <div class="carousel-product-name">${product.PRODUCT_TITLE?.split('.')[0]?.trim() || product.STYLE}</div>
                            <button class="carousel-sample-btn" onclick="event.stopPropagation(); requestSampleFromCarousel('${product.STYLE}', '${(product.PRODUCT_TITLE?.split('.')[0]?.trim() || product.STYLE).replace(/'/g, "\\'")}', '${product.MILL || 'Brand'}', '${product.isFree ? 'free' : 'paid'}', ${product.price || 0})">
                                <i class="fas fa-box"></i>
                                ${buttonText}
                            </button>
                        </div>
                    </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('[Bestsellers] Error loading carousel:', error);
                carouselContainer.innerHTML = `
                    <div class="carousel-error" style="padding: 2rem; text-align: center; color: var(--gray-500);">
                        <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <p>Unable to load best sellers. Please refresh the page.</p>
                    </div>
                `;
            }
        }

        // Richardson Caps data (curated list - images fetched from SanMar API)
        const richardsonProducts = [
            // Trucker & 5-Panel
            { style: '112', name: 'Trucker Cap', description: 'The #1 selling trucker cap in the USA' },
            { style: '111', name: 'Garment Washed Trucker', description: 'Relaxed fit washed trucker' },
            { style: '112FP', name: 'Five-Panel Trucker', description: 'Classic five-panel design' },
            { style: '112FPR', name: 'Five-Panel with Rope', description: 'Five-panel with rope accent' },
            { style: '112PFP', name: 'Printed Five-Panel Trucker', description: 'Printed mesh back trucker' },
            { style: '112PL', name: '112+ R-Flex Adjustable', description: 'Stretch-fit adjustable trucker' },
            { style: '112PT', name: 'Printed Tactical Trucker', description: 'Tactical-style mesh back' },
            { style: '115', name: 'Low Pro Trucker', description: 'Low profile trucker cap' },
            // 7-Panel, Performance & More
            { style: '168', name: '7-Panel Trucker Solid', description: 'Seven-panel solid mesh' },
            { style: '168P', name: '7-Panel Trucker Printed', description: 'Seven-panel printed mesh' },
            { style: '169', name: 'Cannon 7-Panel Flatbill', description: 'Flatbill seven-panel' },
            { style: '173', name: 'Hood River', description: 'Premium unstructured cap' },
            { style: '212', name: 'Pro Twill Snapback', description: 'Pro-style snapback' },
            { style: '220', name: 'Performance Lite Relaxed', description: 'Lightweight performance cap' },
            { style: '225', name: 'Performance Lite Casual', description: 'Casual performance fit' },
            { style: '256', name: 'Umpqua Gramps Cap Solid', description: 'Retro grandpa style solid' },
            { style: '256P', name: 'Umpqua Gramps Cap Printed', description: 'Retro grandpa style printed' },
            { style: '312', name: 'Solid Twill Trucker', description: 'Classic twill trucker' },
            { style: '323FPC', name: 'Full Fabric 5-Panel Champ', description: 'Full fabric camper style' },
            { style: '326', name: 'Peached Cotton Twill', description: 'Soft peached cotton' },
            { style: '336', name: 'Burnside', description: 'Classic burnside style' },
            { style: '355', name: 'Laser Perf Performance Rope', description: 'Perforated performance cap' },
            { style: '356', name: '5-Panel Relaxed Gramps', description: 'Relaxed five-panel style' }
        ];

        // New 2026 Products - Only styles with images in SanMar API
        const new2026Products = [
            // Jerzees
            { style: '363TK', name: 'Jerzees Classics Unisex Cotton Tank', brand: 'Jerzees' },
            // Gildan (only styles with images)
            { style: '64PLSMA', name: 'Gildan Softstyle Plasma Print Tee', brand: 'Gildan' },
            { style: '65000', name: 'Gildan Softstyle Midweight Tee', brand: 'Gildan' },
            { style: '65000B', name: 'Gildan Youth Softstyle Midweight Tee', brand: 'Gildan' },
            { style: '65000L', name: 'Gildan Ladies Softstyle Midweight Tee', brand: 'Gildan' },
            { style: '67000', name: 'Gildan Softstyle CVC Tee', brand: 'Gildan' },
            { style: '67000L', name: 'Gildan Ladies Softstyle CVC Tee', brand: 'Gildan' },
            // Brooks Brothers (only styles with images)
            { style: 'BB18000', name: 'Brooks Brothers Wrinkle-Free Pinpoint', brand: 'Brooks Brothers' },
            { style: 'BB18002', name: 'Brooks Brothers Wrinkle-Free Pinpoint Stripe', brand: 'Brooks Brothers' },
            { style: 'BB18200', name: 'Brooks Brothers Tech Stretch Patterned', brand: 'Brooks Brothers' },
            { style: 'BB18202', name: 'Brooks Brothers Wrinkle-Free Windowpane Tech Stretch', brand: 'Brooks Brothers' },
            // BELLA+CANVAS (only styles with images)
            { style: 'BC3739', name: 'BELLA+CANVAS Unisex Sponge Fleece Drop Shoulder Sweatshirt', brand: 'BELLA+CANVAS' },
            { style: 'BC6415', name: 'BELLA+CANVAS Ladies Relaxed Triblend Tee', brand: 'BELLA+CANVAS' },
            // Port Authority (only styles with images)
            { style: 'BG226', name: 'Port Authority Everyday Zip Tote', brand: 'Port Authority' },
            { style: 'C950', name: 'Port Authority Performance Trucker Snapback Cap', brand: 'Port Authority' },
            // District (only styles with images)
            { style: 'DT365', name: 'District Perfect Tri Tee Long Sleeve', brand: 'District' },
            { style: 'DT365A', name: 'District Perfect Tri Tee Long Sleeve ATHLETICS', brand: 'District' },
            { style: 'DT8100', name: 'District Re-Fleece Hoodie', brand: 'District' },
            { style: 'DT8102', name: 'District Re-Fleece Crewneck', brand: 'District' },
            { style: 'DT8104', name: 'District Re-Fleece Quarter Zip', brand: 'District' },
            // OGIO (only styles with images)
            { style: 'OG1000', name: 'OGIO Evolution Hoodie', brand: 'OGIO' },
            { style: 'OG1002', name: 'OGIO Evolution Crewneck', brand: 'OGIO' },
            // Sport-Tek (only styles with images)
            { style: 'ST760', name: 'Sport-Tek Classic Mesh Reversible Tank', brand: 'Sport-Tek' },
            // Mercer+Mettle (only styles with images)
            { style: 'MM1001', name: 'Mercer+Mettle Stretch Open Collar Polo', brand: 'Mercer+Mettle' },
            { style: 'MM2011', name: 'Mercer+Mettle Stretch Quarter Zip', brand: 'Mercer+Mettle' },
            { style: 'MM3010', name: 'Mercer+Mettle Everyday Cotton Tee', brand: 'Mercer+Mettle' },
            // The North Face
            { style: 'NF0A8BSH', name: 'The North Face Aurora Jacket', brand: 'The North Face' },
            // Carhartt (merged from "New" category)
            { style: 'CT107082', name: 'Carhartt Montana Insulated Hooded Jacket', brand: 'Carhartt' },
            { style: 'CT107115', name: 'Carhartt Women\'s Rain Defender Soft Shell Jacket', brand: 'Carhartt' },
            // New Era (merged from "New" category)
            { style: 'NE410', name: 'New Era Foam Rope Trucker Cap', brand: 'New Era' },
            { style: 'NE215', name: 'New Era 9TWENTY Unstructured Mesh Snapback Cap', brand: 'New Era' }
        ];

        // Load Richardson Caps Carousel (fetches images from SanMar API)
        async function loadRichardsonCarousel() {
            const carouselContainer = document.getElementById('richardsonCarousel');

            try {
                console.log('[Richardson] Loading Richardson caps carousel from API...');

                // Display first 6 Richardson products in carousel
                const featuredProducts = richardsonProducts.slice(0, 6);

                // Fetch product details from SanMar API for all products concurrently
                const productsWithDetails = await Promise.all(
                    featuredProducts.map(async product => {
                        try {
                            // Fetch product details from SanMar API
                            const response = await fetch(
                                `https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/product-details?styleNumber=${product.style}`
                            );

                            let imageUrl = null;
                            let productTitle = product.name;

                            if (response.ok) {
                                const details = await response.json();
                                if (details && details.length > 0) {
                                    // Cache the details for later use
                                    productCache[product.style] = details;

                                    // Use FRONT_MODEL as primary image (best for caps)
                                    imageUrl = details[0].FRONT_MODEL ||
                                              details[0].COLOR_PRODUCT_IMAGE ||
                                              details[0].PRODUCT_IMAGE ||
                                              details[0].THUMBNAIL_IMAGE;

                                    // Use product title from API if available
                                    if (details[0].PRODUCT_TITLE) {
                                        productTitle = details[0].PRODUCT_TITLE.split('.')[0].trim();
                                    }

                                    console.log(`[Richardson] Loaded ${product.style}: ${imageUrl}`);
                                }
                            }

                            // Check pricing eligibility
                            const eligibility = await window.sampleCart.checkEligibility(product.style);

                            return {
                                ...product,
                                name: productTitle,
                                imageUrl: imageUrl,
                                isFree: eligibility.type === 'free',
                                price: eligibility.price || 0,
                                eligible: eligibility.eligible !== false
                            };
                        } catch (error) {
                            console.warn(`[Richardson] Error fetching ${product.style}:`, error.message);
                            const eligibility = await window.sampleCart.checkEligibility(product.style);
                            return {
                                ...product,
                                imageUrl: null,
                                isFree: eligibility.type === 'free',
                                price: eligibility.price || 0,
                                eligible: eligibility.eligible !== false
                            };
                        }
                    })
                );

                carouselContainer.innerHTML = productsWithDetails.map(product => {
                    const imageUrl = product.imageUrl || `https://via.placeholder.com/280x200?text=Richardson+${product.style}`;
                    const buttonText = product.eligible ?
                        (product.isFree ? 'Request Free Sample' : `Request Sample - $${product.price.toFixed(2)}`)
                        : 'View Product';

                    return `
                    <div class="carousel-product-card" onclick="window.location.href='top-sellers-product.html?style=${product.style}&name=${encodeURIComponent('Richardson ' + product.name)}'">
                        <div class="product-image">
                            <img src="${imageUrl}"
                                 alt="Richardson ${product.name}"
                                 class="carousel-product-image"
                                 onerror="this.src='https://via.placeholder.com/280x200?text=Richardson+${product.style}'">
                            <div class="carousel-new-badge" style="background: linear-gradient(135deg, #1a365d, #2d4a7c); color: white;">RICHARDSON</div>
                        </div>
                        <div class="product-info">
                            <div class="product-style" style="color: #ccc;">Richardson â€¢ ${product.style}</div>
                            <div class="carousel-product-name" style="color: white;">${product.name}</div>
                            <button class="carousel-sample-btn" onclick="event.stopPropagation(); requestSampleFromCarousel('${product.style}', 'Richardson - ${product.name}', 'Richardson', '${product.isFree ? 'free' : 'paid'}', ${product.price || 0})" style="background: white; color: #1a365d;">
                                <i class="fas fa-box"></i>
                                ${buttonText}
                            </button>
                        </div>
                    </div>
                    `;
                }).join('');

                console.log(`[Richardson] Displayed ${productsWithDetails.length} Richardson caps in carousel`);

            } catch (error) {
                console.error('[Richardson] Error loading carousel:', error);
                carouselContainer.innerHTML = '<div class="carousel-loading" style="color: white;"><p>Unable to load Richardson caps</p></div>';
            }
        }

        // Filter by brand (for Richardson "View All" button)
        function filterByBrand(brand) {
            console.log(`[Filter] Filtering by brand: ${brand}`);
            if (brand === 'Richardson') {
                // Show Richardson products in the grid
                loadProducts('richardson', 'secondary');

                // Update filter button states
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.badge-filter').forEach(btn => {
                    if (btn.dataset.category === 'richardson') {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
        }

        // Request sample from carousel
        function requestSampleFromCarousel(style, name, brand, sampleType = 'free', price = 0) {
            console.log('[Carousel] Sample request for:', style, `(${sampleType}, $${price})`);

            // Navigate to product page for sample request with correct pricing
            const priceParam = price > 0 ? `&price=${price}` : '';
            window.location.href = `/pages/top-sellers-product.html?style=${style}&name=${encodeURIComponent(name)}&mode=sample&sampleType=${sampleType}${priceParam}`;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize universal header
            window.universalCartHeader = new UniversalCartHeader({
                isCartPage: false,
                showContactInfo: true
            });

            // Load image overrides from API (falls back to hardcoded if API unavailable)
            await loadImageOverridesFromAPI();

            // Setup UI immediately (search, filters, event listeners)
            setupEventListeners();
            initializeSearch();
            checkEducationModal();

            // Load main products grid
            loadProducts('all', 'primary');
        });

        // Initialize search functionality
        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchClear = document.getElementById('searchClear');
            
            searchInput.addEventListener('input', (e) => {
                searchTerm = e.target.value.toLowerCase();
                searchClear.classList.toggle('active', searchTerm.length > 0);
                performSearch();
            });
        }
        
        // Clear search
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchClear').classList.remove('active');
            searchTerm = '';
            performSearch();
        }
        
        // Perform search and filter
        function performSearch() {
            const searchResults = document.getElementById('searchResults');
            const productsGrid = document.getElementById('productsGrid');
            const resultsCount = document.getElementById('resultsCount');
            let matchCount = 0;
            
            productsGrid.innerHTML = '';
            
            for (const product of allProducts) {
                // Build searchable text using both possible property names
                const name = product.name || product.description || '';
                const style = product.styleNumber || product.style || '';
                const brand = product.brand || detectBrand(name) || '';
                const searchableText = `${name} ${style} ${brand} ${product.type || ''}`.toLowerCase();
                
                // Check if matches search
                if (!searchTerm || searchableText.includes(searchTerm)) {
                    matchCount++;
                    const card = createProductCard(product);
                    if (card) {
                        productsGrid.appendChild(card);
                    }
                }
            }
            
            // Update results display
            if (searchTerm) {
                searchResults.style.display = 'block';
                document.getElementById('resultCount').textContent = matchCount;
            } else {
                searchResults.style.display = 'none';
            }
            
            resultsCount.textContent = `Showing ${matchCount} products`;
            
            // Show no results message if needed
            if (matchCount === 0 && searchTerm) {
                productsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1;">
                        <div class="no-results">
                            <i class="fas fa-search"></i>
                            <h3>No products found</h3>
                            <p>Try adjusting your search terms</p>
                            <button class="reset-search" onclick="clearSearch()">Clear Search</button>
                        </div>
                    </div>
                `;
            }

            // Check sample eligibility for search results (same pattern as displayProducts)
            if (matchCount > 0) {
                setTimeout(() => {
                    if (window.sampleCart && typeof window.sampleCart.checkAllProductEligibility === 'function') {
                        console.log('[Search] Checking sample eligibility for search results...');
                        window.sampleCart.checkAllProductEligibility();
                    } else {
                        console.log('[Search] Sample cart not ready, retrying...');
                        setTimeout(() => {
                            if (window.sampleCart) {
                                window.sampleCart.checkAllProductEligibility();
                            }
                        }, 500);
                    }
                }, 100);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // NEW: Tab navigation buttons
            document.querySelectorAll('.category-tabs .tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active from all tabs
                    document.querySelectorAll('.category-tabs .tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const category = this.dataset.tab;
                    const filterType = this.dataset.filterType;

                    // Reset DTG filter when changing tabs
                    dtgFilterActive = false;
                    const dtgCheckbox = document.getElementById('dtgFilter');
                    if (dtgCheckbox) dtgCheckbox.checked = false;

                    currentFilter = { category: category, type: filterType };
                    loadProducts(category, filterType);
                });
            });

            // NEW: DTG checkbox filter
            const dtgCheckbox = document.getElementById('dtgFilter');
            if (dtgCheckbox) {
                dtgCheckbox.addEventListener('change', function() {
                    dtgFilterActive = this.checked;

                    if (dtgFilterActive) {
                        // Show education modal on first click
                        if (!sessionStorage.getItem('dtgEducationShown')) {
                            showDTGEducationModal();
                        }
                        loadProducts('dtgCompatible', 'dtg');
                    } else {
                        // Return to current tab selection
                        loadProducts(currentFilter.category, currentFilter.type);
                    }
                });
            }

            // NEW: Brand filter dropdown
            const brandSelect = document.getElementById('brandSelect');
            if (brandSelect) {
                brandSelect.addEventListener('change', function() {
                    // For now, brand filtering works alongside category
                    // If Richardson is selected, switch to Richardson tab
                    if (this.value === 'Richardson') {
                        document.querySelectorAll('.category-tabs .tab-btn').forEach(b => b.classList.remove('active'));
                        document.querySelector('.tab-btn[data-tab="richardson"]')?.classList.add('active');
                        currentFilter = { category: 'richardson', type: 'secondary' };
                        loadProducts('richardson', 'secondary');
                    } else if (this.value === 'all') {
                        // Keep current tab but reload
                        loadProducts(currentFilter.category, currentFilter.type);
                    } else {
                        // Filter by brand within current view
                        // This could be extended to filter the current product list
                        console.log('[Filter] Brand filter:', this.value);
                    }
                });
            }

            // NEW: Sort dropdown
            const sortSelect = document.getElementById('sortSelect');
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    console.log('[Sort] Sort by:', this.value);
                    // Sort functionality can be added here
                    // For now, we'll just log it
                });
            }

            // LEGACY: Primary category filter buttons (for backward compatibility)
            document.querySelectorAll('.filter-btn[data-filter-type="primary"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const category = this.dataset.category;
                    currentFilter = { category: category, type: 'primary' };
                    loadProducts(category, 'primary');
                });
            });

            // LEGACY: Secondary filters (for backward compatibility)
            document.querySelectorAll('.badge-filter[data-filter-type="secondary"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.dataset.category;
                    const isActive = this.classList.contains('active');

                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.badge-filter').forEach(b => b.classList.remove('active'));

                    if (isActive) {
                        currentFilter = { category: 'all', type: 'primary' };
                        loadProducts('all', 'primary');
                        document.querySelector('.filter-btn[data-category="all"]')?.classList.add('active');
                    } else {
                        this.classList.add('active');
                        currentFilter = { category: category, type: 'secondary' };
                        loadProducts(category, 'secondary');
                    }
                });
            });

            // LEGACY: DTG badge filter (for backward compatibility)
            const dtgBadge = document.querySelector('.badge-filter[data-filter-type="dtg"]');
            if (dtgBadge) {
                dtgBadge.addEventListener('click', function() {
                    dtgFilterActive = !dtgFilterActive;
                    this.classList.toggle('active', dtgFilterActive);

                    if (dtgFilterActive) {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        document.querySelectorAll('.badge-filter[data-filter-type="secondary"]').forEach(b => b.classList.remove('active'));

                        if (!sessionStorage.getItem('dtgEducationShown')) {
                            showDTGEducationModal();
                        }

                        loadProducts('dtgCompatible', 'dtg');
                    } else {
                        if (currentFilter.category !== 'dtgCompatible') {
                            loadProducts(currentFilter.category, currentFilter.type);
                            if (currentFilter.type === 'primary') {
                                document.querySelector(`.filter-btn[data-category="${currentFilter.category}"]`)?.classList.add('active');
                            }
                        } else {
                            loadProducts('all', 'primary');
                            document.querySelector('.filter-btn[data-category="all"]')?.classList.add('active');
                        }
                    }
                });
            }

            // Modal close on outside click
            document.getElementById('quickViewModal')?.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        // Helper function: Preload images for products (fast concurrent fetch)
        async function preloadImagesForProducts(styleNumbers) {
            console.log(`[ImagePreload] Starting concurrent fetch for ${styleNumbers.length} products...`);
            console.time('[ImagePreload] Total Time');

            // Fetch images concurrently (not sequential) - much faster
            const imagePromises = styleNumbers.map(async (style) => {
                // Skip if already cached
                if (productCache[style]) {
                    return { style, fromCache: true };
                }

                try {
                    const response = await fetch(
                        `https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/product-details?styleNumber=${style}`
                    );

                    if (response.ok) {
                        const details = await response.json();
                        if (details && details.length > 0) {
                            productCache[style] = details;
                            return { style, success: true };
                        }
                    }
                    return { style, success: false };
                } catch (error) {
                    console.warn(`[ImagePreload] Failed to fetch ${style}:`, error.message);
                    return { style, success: false, error: error.message };
                }
            });

            // Wait for all to complete (concurrent, not sequential!)
            const results = await Promise.all(imagePromises);

            const successful = results.filter(r => r.success || r.fromCache).length;
            console.timeEnd('[ImagePreload] Total Time');
            console.log(`[ImagePreload] âœ“ Loaded ${successful}/${styleNumbers.length} product images`);

            return results;
        }

        // Load products based on filter
        async function loadProducts(category, filterType) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const productsGrid = document.getElementById('productsGrid');
            const noProducts = document.getElementById('noProducts');

            loadingIndicator.style.display = 'block';
            productsGrid.style.display = 'none';
            noProducts.style.display = 'none';

            allProducts = [];

            if (filterType === 'dtg') {
                // DTG-Compatible filter - show only DTG-compatible products

                // Step 1: Collect all style numbers that will be displayed
                const stylesToPreload = [];
                for (const [categoryKey, products] of Object.entries(completeTopSellers)) {
                    for (const product of products) {
                        if (dtgCompatibleProducts.has(product.style)) {
                            stylesToPreload.push(product.style);
                        }
                    }
                }

                // Step 2: Preload images concurrently
                await preloadImagesForProducts(stylesToPreload);

                // Step 3: Build products with images now available in cache
                for (const [categoryKey, products] of Object.entries(completeTopSellers)) {
                    for (const product of products) {
                        const style = product.style;
                        if (dtgCompatibleProducts.has(style)) {
                            const productCategory = productCategoryMap[style] || 'other';

                            // Get image from cache or override
                            const cachedDetails = productCache[style];
                            const imageUrl = imageOverrides[style] ||
                                           (cachedDetails && cachedDetails[0] &&
                                            (cachedDetails[0].COLOR_PRODUCT_IMAGE ||
                                             cachedDetails[0].PRODUCT_IMAGE ||
                                             cachedDetails[0].THUMBNAIL_IMAGE));

                            allProducts.push({
                                ...product,
                                type: categoryKey,
                                category: productCategory,
                                isDTG: true,
                                imageUrl: imageUrl || null,
                                details: cachedDetails || null
                            });
                        }
                    }
                }
            } else if (category === 'all') {
                // Load all products with category mapping

                // Step 1: Collect all style numbers
                const stylesToPreload = [];
                for (const [categoryKey, products] of Object.entries(completeTopSellers)) {
                    for (const product of products) {
                        stylesToPreload.push(product.style);
                    }
                }

                // Step 2: Preload images concurrently
                await preloadImagesForProducts(stylesToPreload);

                // Step 3: Build products with images now available in cache
                for (const [categoryKey, products] of Object.entries(completeTopSellers)) {
                    for (const product of products) {
                        const style = product.style;
                        const productCategory = productCategoryMap[style] || 'other';
                        const isDTG = dtgCompatibleProducts.has(style);

                        // Get image from cache or override
                        const cachedDetails = productCache[style];
                        const imageUrl = imageOverrides[style] ||
                                       (cachedDetails && cachedDetails[0] &&
                                        (cachedDetails[0].COLOR_PRODUCT_IMAGE ||
                                         cachedDetails[0].PRODUCT_IMAGE ||
                                         cachedDetails[0].THUMBNAIL_IMAGE));

                        allProducts.push({
                            ...product,
                            type: categoryKey,
                            category: productCategory,
                            isDTG,
                            imageUrl: imageUrl || null,
                            details: cachedDetails || null
                        });
                    }
                }
            } else if (category === 'bestsellers') {
                // Fetch top sellers from API (Hybrid: API + Richardson 112)
                try {
                    console.log('[TopSellers] Fetching bestsellers from API...');

                    // Fetch top sellers from API (Sanmar products)
                    const response = await fetch('https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/products/topsellers?limit=100');
                    const result = await response.json();
                    const products = result.products || [];

                    console.log(`[TopSellers] API returned ${products.length} records`);

                    // Deduplicate by style (eliminate color variants)
                    const uniqueProducts = new Map();
                    products.forEach(p => {
                        if (!uniqueProducts.has(p.STYLE)) {
                            uniqueProducts.set(p.STYLE, p);
                        }
                    });

                    console.log(`[TopSellers] After deduplication: ${uniqueProducts.size} unique styles`);

                    // Filter out discontinued, map to display format
                    allProducts = Array.from(uniqueProducts.values())
                        .filter(p => !p.PRODUCT_TITLE?.includes('DISCONTINUED'))
                        .map(product => {
                            const style = product.STYLE || 'UNKNOWN';
                            const productCategory = productCategoryMap[style] || 'other';
                            const isDTG = dtgCompatibleProducts.has(style);

                            return {
                                style: style,
                                description: product.PRODUCT_TITLE?.split('.')[0]?.trim() || 'Unknown Product',
                                brand: product.MILL || 'Unknown Brand',
                                imageUrl: product.COLOR_PRODUCT_IMAGE || product.PRODUCT_IMAGE || product.THUMBNAIL_IMAGE,
                                type: 'bestsellers',
                                category: productCategory,
                                isDTG: isDTG
                            };
                        });

                    console.log(`[TopSellers] Loaded ${allProducts.length} products from API`);

                } catch (error) {
                    console.error('[TopSellers] Error loading from API:', error);
                    allProducts = [];
                    console.warn('[TopSellers] API failed, no products loaded');
                }
            } else if (filterType === 'primary') {
                // Filter by product category (tshirts, hoodies, polos, caps, jackets, workwear)

                // Step 1: Collect all style numbers that match the category
                const stylesToPreload = [];
                for (const [categoryKey, products] of Object.entries(completeTopSellers)) {
                    for (const product of products) {
                        const productCategory = productCategoryMap[product.style] || 'other';
                        if (productCategory === category) {
                            stylesToPreload.push(product.style);
                        }
                    }
                }

                // Step 2: Preload images concurrently
                await preloadImagesForProducts(stylesToPreload);

                // Step 3: Build products with images now available in cache
                for (const [categoryKey, products] of Object.entries(completeTopSellers)) {
                    for (const product of products) {
                        const style = product.style;
                        const productCategory = productCategoryMap[style] || 'other';
                        const isDTG = dtgCompatibleProducts.has(style);

                        if (productCategory === category) {
                            // Get image from cache or override
                            const cachedDetails = productCache[style];
                            const imageUrl = imageOverrides[style] ||
                                           (cachedDetails && cachedDetails[0] &&
                                            (cachedDetails[0].COLOR_PRODUCT_IMAGE ||
                                             cachedDetails[0].PRODUCT_IMAGE ||
                                             cachedDetails[0].THUMBNAIL_IMAGE));

                            allProducts.push({
                                ...product,
                                type: categoryKey,
                                category: productCategory,
                                isDTG,
                                imageUrl: imageUrl || null,
                                details: cachedDetails || null
                            });
                        }
                    }
                }
            } else if (filterType === 'secondary') {
                // Handle Richardson caps filter
                if (category === 'richardson') {
                    console.log('[Richardson] Loading Richardson products for grid from API...');

                    // Step 1: Collect all Richardson style numbers
                    const stylesToPreload = richardsonProducts.map(p => p.style);

                    // Step 2: Preload images concurrently from SanMar API
                    await preloadImagesForProducts(stylesToPreload);

                    // Step 3: Build products with images now available in cache
                    allProducts = richardsonProducts.map(product => {
                        const cachedDetails = productCache[product.style];
                        // Use FRONT_MODEL as primary image for caps (best angle)
                        const imageUrl = cachedDetails && cachedDetails[0] ?
                            (cachedDetails[0].FRONT_MODEL ||
                             cachedDetails[0].COLOR_PRODUCT_IMAGE ||
                             cachedDetails[0].PRODUCT_IMAGE ||
                             cachedDetails[0].THUMBNAIL_IMAGE) : null;

                        // Get product title from API if available
                        const productTitle = cachedDetails && cachedDetails[0] && cachedDetails[0].PRODUCT_TITLE ?
                            cachedDetails[0].PRODUCT_TITLE.split('.')[0].trim() :
                            'Richardson ' + product.name;

                        return {
                            style: product.style,
                            description: productTitle,
                            brand: 'Richardson',
                            imageUrl: imageUrl,
                            type: 'richardson',
                            category: 'caps',
                            isDTG: false,
                            details: cachedDetails || null
                        };
                    });

                    console.log(`[Richardson] Loaded ${allProducts.length} Richardson products from API`);
                }
                // Handle New 2026 Products
                else if (category === 'new2026') {
                    console.log('[New2026] Loading new 2026 products from API...');

                    // Step 1: Collect all style numbers
                    const stylesToPreload = new2026Products.map(p => p.style);

                    // Step 2: Preload images concurrently from SanMar API
                    await preloadImagesForProducts(stylesToPreload);

                    // Step 3: Build products with images now available in cache
                    allProducts = new2026Products.map(product => {
                        const cachedDetails = productCache[product.style];
                        const imageUrl = cachedDetails && cachedDetails[0] ?
                            (cachedDetails[0].COLOR_PRODUCT_IMAGE ||
                             cachedDetails[0].FRONT_MODEL ||
                             cachedDetails[0].PRODUCT_IMAGE ||
                             cachedDetails[0].THUMBNAIL_IMAGE) : null;

                        // Get product title from API if available
                        const productTitle = cachedDetails && cachedDetails[0] && cachedDetails[0].PRODUCT_TITLE ?
                            cachedDetails[0].PRODUCT_TITLE.split('.')[0].trim() :
                            product.name;

                        // Determine category based on product name
                        let productCategory = 'other';
                        const nameLower = product.name.toLowerCase();
                        if (nameLower.includes('tee') || nameLower.includes('tank')) productCategory = 'tshirts';
                        else if (nameLower.includes('hoodie') || nameLower.includes('fleece') || nameLower.includes('sweatshirt')) productCategory = 'hoodies';
                        else if (nameLower.includes('polo')) productCategory = 'polos';
                        else if (nameLower.includes('cap') || nameLower.includes('trucker')) productCategory = 'caps';
                        else if (nameLower.includes('jacket') || nameLower.includes('zip')) productCategory = 'jackets';

                        return {
                            style: product.style,
                            description: productTitle,
                            brand: product.brand,
                            imageUrl: imageUrl,
                            type: 'new2026',
                            category: productCategory,
                            isDTG: false,
                            details: cachedDetails || null
                        };
                    });

                    console.log(`[New2026] Loaded ${allProducts.length} new 2026 products from API`);
                }
                // Filter by freshPicks or other secondary categories
                else if (completeTopSellers[category]) {
                    // Step 1: Collect all style numbers
                    const stylesToPreload = completeTopSellers[category].map(p => p.style);

                    // Step 2: Preload images concurrently
                    await preloadImagesForProducts(stylesToPreload);

                    // Step 3: Build products with images now available in cache
                    for (const product of completeTopSellers[category]) {
                        const style = product.style;
                        const productCategory = productCategoryMap[style] || 'other';
                        const isDTG = dtgCompatibleProducts.has(style);

                        // Get image from cache or override
                        const cachedDetails = productCache[style];
                        const imageUrl = imageOverrides[style] ||
                                       (cachedDetails && cachedDetails[0] &&
                                        (cachedDetails[0].COLOR_PRODUCT_IMAGE ||
                                         cachedDetails[0].PRODUCT_IMAGE ||
                                         cachedDetails[0].THUMBNAIL_IMAGE));

                        allProducts.push({
                            ...product,
                            type: category,
                            category: productCategory,
                            isDTG,
                            imageUrl: imageUrl || null,
                            details: cachedDetails || null
                        });
                    }
                }
            }

            // Helper function: Enrich product details in background (non-blocking)
            function enrichProductDetailsInBackground(products) {
                console.log('[Background] Starting non-blocking product details enrichment');

                // Fetch details for products not yet in cache, but don't block rendering
                for (const product of products) {
                    // Skip service items
                    if (product.brand === 'Service' || product.isService) continue;

                    // Skip if already cached
                    if (productCache[product.style]) continue;

                    // Fetch in background (no await - fire and forget)
                    fetch(`https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/product-details?styleNumber=${product.style}`)
                        .then(response => response.ok ? response.json() : null)
                        .then(details => {
                            if (details && details.length > 0) {
                                productCache[product.style] = details;
                                console.log(`[Background] Cached details for ${product.style}`);
                            }
                        })
                        .catch(error => {
                            // Silently fail - details aren't critical for display
                            console.warn(`[Background] Failed to fetch ${product.style}:`, error.message);
                        });
                }

                console.log(`[Background] Initiated background fetch for ${products.filter(p => !p.isService && !productCache[p.style]).length} products`);
            }

            // PERFORMANCE FIX: Skip blocking API calls for product details
            // Images are already available from initial API response (imageUrl field)
            // Details can be fetched on-demand when user clicks a product

            console.time('[Performance] Display Products Grid');

            // Display products immediately with images already loaded
            // Store products for search
            // allProducts already contains imageUrl from lines 4153, 4198, etc.

            // Display products (or perform search if there's a search term)
            if (searchTerm) {
                performSearch();
            } else {
                displayProducts(allProducts);
                document.getElementById('resultsCount').textContent = `Showing ${allProducts.length} products`;
            }

            console.timeEnd('[Performance] Display Products Grid');
            console.log(`[Performance] Displayed ${allProducts.length} products with images immediately`);

            // OPTIONAL: Fetch product details in background (non-blocking)
            // This enriches the cache for when users click on products
            enrichProductDetailsInBackground(allProducts);

            loadingIndicator.style.display = 'none';
            productsGrid.style.display = 'grid';
        }

        // Create product card
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            
            // Add data attributes for search
            card.dataset.productName = product.name || product.description || '';
            card.dataset.styleNumber = product.styleNumber || product.style || '';
            card.dataset.brand = product.brand || detectBrand(product.name || product.description) || '';
            card.dataset.category = product.type || '';

            const decorationType = getDecorationType(product.type, product.isDTG);
            
            // Check if this is a service item
            if (product.isService) {
                // Don't show service items in catalog
                return null;
            }
            
            // Check if we have API data
                if (product.details && product.details.length > 0) {
                    // Product with real images from API
                    const firstProduct = product.details[0];
                    
                    // Get unique colors only
                    const uniqueColors = [];
                    const seenColors = new Set();
                    
                    for (const item of product.details) {
                        if (item.COLOR_NAME && !seenColors.has(item.COLOR_NAME)) {
                            seenColors.add(item.COLOR_NAME);
                            uniqueColors.push(item);
                        }
                    }
                    
                    const colorsToShow = uniqueColors.slice(0, 5);

                    card.onclick = () => navigateToProduct(product);

                    // Check for image override first
                    const imageUrl = imageOverrides[product.style] ||
                                    firstProduct.FRONT_MODEL ||
                                    firstProduct.FRONT_FLAT ||
                                    firstProduct.PRODUCT_IMAGE;
                    
                    card.innerHTML = `
                        <div class="product-image">
                            <div class="product-badge">${decorationType}</div>
                            <img src="${imageUrl}"
                                 alt="${product.description || 'Product Image'}"
                                 loading="lazy"
                                 onerror="this.src='${firstProduct.PRODUCT_IMAGE || ''}'">
                        </div>
                        <div class="product-info">
                            <div class="product-style">Style #${product.style}</div>
                            <div class="product-name">${product.description || 'Unknown Product'}</div>
                            <div class="color-swatches">
                                ${colorsToShow.map(c => `
                                    <div class="color-swatch" title="${c.COLOR_NAME}">
                                        <img src="${c.COLOR_SQUARE_IMAGE}" alt="${c.COLOR_NAME}" loading="lazy">
                                    </div>
                                `).join('')}
                                ${uniqueColors.length > 5 ? `
                                    <div class="more-colors">+${uniqueColors.length - 5}</div>
                                ` : ''}
                            </div>
                            <div class="product-actions">
                                <button class="btn-sample" data-style="${product.style}" data-eligible="pending"
                                        onclick="event.stopPropagation(); handleSampleRequest('${product.style}', '${(product.description || '').replace(/'/g, "\\'")}', '${firstProduct.FRONT_MODEL || firstProduct.PRODUCT_IMAGE || ''}')">
                                    <i class="fas fa-box-open"></i> Request Sample
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    // Product without API data - check for image from API, override, or use placeholder
                    const brandStyle = brandPlaceholders[product.brand] || brandPlaceholders['Generic'];
                    const productImage = product.imageUrl || imageOverrides[product.style];

                    card.onclick = () => navigateToProduct(product);

                    // If we have a product image (from API or override), use it; otherwise use the brand placeholder
                    if (productImage) {
                        card.innerHTML = `
                            <div class="product-image">
                                <div class="product-badge">${decorationType}</div>
                                <img src="${productImage}"
                                     alt="${product.description || 'Product Image'}"
                                     onerror="this.style.display='none'">
                            </div>
                        `;
                    } else {
                        card.innerHTML = `
                            <div class="product-image" style="background: ${brandStyle ? brandStyle.background : 'linear-gradient(135deg, #e0e0e0, #bdbdbd)'}; display: flex; flex-direction: column; justify-content: center; align-items: center; color: ${brandStyle ? brandStyle.textColor : '#666'}; position: relative;">
                                <div class="product-badge">${decorationType}</div>
                                ${brandStyle ? brandStyle.icon : '<i class="fas fa-tshirt" style="font-size: 48px;"></i>'}
                                <div style="margin-top: 1rem; font-size: 0.875rem; font-weight: 600;">${product.brand}</div>
                                ${brandStyle && brandStyle.tagline ? `<div style="font-size: 0.75rem; opacity: 0.8; margin-top: 0.25rem;">${brandStyle.tagline}</div>` : ''}
                            </div>
                        `;
                    }
                    
                    card.innerHTML += `
                        <div class="product-info">
                            <div class="product-style">Style #${product.style}</div>
                            <div class="product-name">${product.description || 'Unknown Product'}</div>
                            <div style="padding: 0.75rem 0; text-align: center; color: var(--text-secondary); font-size: 0.875rem;">
                                <i class="fas fa-award" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                                Premium ${product.brand} Product
                            </div>
                            <div class="product-actions">
                                <button class="btn-sample" data-style="${product.style}" data-eligible="pending"
                                        onclick="event.stopPropagation(); handleSampleRequest('${product.style}', '${(product.description || '').replace(/'/g, "\\'")}', '${productImage || ''}')">
                                    <i class="fas fa-box-open"></i> Request Sample
                                </button>
                            </div>
                        </div>
                    `;
            }
            
            return card;
        }
        
        // Display products in grid
        function displayProducts(products) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            
            products.forEach(product => {
                const card = createProductCard(product);
                if (card) {
                    grid.appendChild(card);
                }
            });
            
            // Check eligibility and update buttons after products are displayed
            setTimeout(() => {
                if (window.sampleCart && typeof window.sampleCart.checkAllProductEligibility === 'function') {
                    console.log('Checking sample eligibility for all products...');
                    window.sampleCart.checkAllProductEligibility();
                } else {
                    console.log('Sample cart not ready, retrying...');
                    setTimeout(() => {
                        if (window.sampleCart) {
                            window.sampleCart.checkAllProductEligibility();
                        }
                    }, 500);
                }
            }, 100);
        }
        
        // Detect brand from product name
        function detectBrand(name) {
            if (!name) return '';
            const nameLower = name.toLowerCase();
            if (nameLower.includes('nike')) return 'Nike';
            if (nameLower.includes('carhartt')) return 'Carhartt';
            if (nameLower.includes('eddie bauer')) return 'Eddie Bauer';
            if (nameLower.includes('new era')) return 'New Era';
            if (nameLower.includes('port & company')) return 'Port & Company';
            if (nameLower.includes('port authority')) return 'Port Authority';
            if (nameLower.includes('sport-tek')) return 'Sport-Tek';
            if (nameLower.includes('gildan')) return 'Gildan';
            if (nameLower.includes('jerzees')) return 'Jerzees';
            if (nameLower.includes('bella')) return 'Bella+Canvas';
            if (nameLower.includes('district')) return 'District';
            if (nameLower.includes('cornerstone')) return 'CornerStone';
            if (nameLower.includes('richardson')) return 'Richardson';
            return '';
        }

        // Navigate to product detail page
        function navigateToProduct(product) {
            // Special handling for Richardson 112 - dedicated product page
            if (product.style === '112') {
                window.location.href = '/richardson-112-product.html';
                return;
            }

            // Always navigate to product page for unified experience
            // (Modal removed - user wanted single navigation path)
            const params = new URLSearchParams({
                style: product.style,
                name: product.description,
                type: product.type,
                brand: product.brand,
                ref: 'showcase'
            });
            window.location.href = `/top-sellers-product.html?${params}`;
        }
        
        // Show product modal for items with custom descriptions
        function showProductModal(product, description) {
            // Create modal HTML
            const modalHtml = `
                <div id="productModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; max-width: 800px; max-height: 90vh; overflow-y: auto; border-radius: 12px; padding: 40px; margin: 20px; position: relative;">
                        <button onclick="closeProductModal()" style="position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer;">âœ•</button>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: start;">
                            <div>
                                ${imageOverrides[product.style] ? 
                                    `<img src="${imageOverrides[product.style]}" alt="${product.description}" style="width: 100%; border-radius: 8px;">` :
                                    `<div style="height: 300px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #999;">No Image Available</div>`
                                }
                            </div>
                            
                            <div>
                                <h2 style="margin: 0 0 10px 0; color: #333;">${product.description}</h2>
                                <div style="color: #666; margin-bottom: 20px;">Style #${product.style} | ${product.brand}</div>
                                
                                <p style="line-height: 1.6; color: #555; margin-bottom: 20px;">${description.fullDescription}</p>
                                
                                <h3 style="color: #333; margin-top: 20px; margin-bottom: 10px;">Key Features & Benefits</h3>
                                <ul style="color: #555; line-height: 1.8;">
                                    ${description.features.map(f => `<li>${f}</li>`).join('')}
                                </ul>
                                
                                <h3 style="color: #333; margin-top: 20px; margin-bottom: 10px;">Recommended Decorations</h3>
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    ${description.decorations.map(d => `<span style="background: #f0f0f0; padding: 5px 12px; border-radius: 20px; font-size: 14px;">${d}</span>`).join('')}
                                </div>
                                
                                ${description.sizes ? `<p style="color: #666; margin-top: 20px; font-style: italic;">${description.sizes}</p>` : ''}
                                
                                <button onclick="requestSampleFromModal('${product.style}', '${product.description.replace(/'/g, "\\'")}')" 
                                        style="margin-top: 20px; background: var(--primary-color, #4cb354); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 600;">
                                    Request Sample
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add modal to page
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHtml;
            document.body.appendChild(modalContainer);
        }
        
        // Close product modal
        function closeProductModal() {
            const modal = document.getElementById('productModal');
            if (modal) {
                modal.parentElement.remove();
            }
        }
        
        // Request sample from modal
        function requestSampleFromModal(style, description) {
            closeProductModal();
            if (typeof handleSampleRequest === 'function') {
                handleSampleRequest(style, description, imageOverrides[style] || '');
            }
        }

        // Get decoration type display name
        function getDecorationType(type, isDTG) {
            // If product is DTG-compatible, show DTG badge
            if (isDTG) {
                return '<span class="dtg-badge" title="100% cotton or high-cotton blend - Perfect for Direct-to-Garment printing"><i class="fas fa-check-circle"></i> DTG-Compatible</span>';
            }

            const types = {
                'dtg': 'Best for DTG',
                'screenprint': 'Best for Screen Print',
                'embroidery': 'Best for Embroidery',
                'caps': 'Top Selling Cap',
                'freshPicks': "Brinton's Pick",
                'new2026': "New 2026",
                'bestsellers': "Top Seller",
                'richardson': "Richardson Cap"
            };
            return types[type] || 'Top Seller';
        }

        // Check if education modal should be shown
        function checkEducationModal() {
            // Modal will be shown on first DTG filter click
            // This function just checks if we should preload resources
        }

        // Show DTG education modal
        function showDTGEducationModal() {
            // Create modal HTML
            const modalHTML = `
                <div id="dtgEducationModal" class="modal" style="display: block;">
                    <div class="modal-content" style="max-width: 600px;">
                        <div class="modal-header" style="background: linear-gradient(135deg, #0ea5e9, #06b6d4); color: white;">
                            <h2 class="modal-title" style="margin: 0; color: white; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-info-circle"></i>
                                About DTG-Compatible Garments
                            </h2>
                            <button class="modal-close" onclick="closeDTGEducationModal()" style="color: white;">&times;</button>
                        </div>
                        <div class="modal-body" style="padding: 2rem;">
                            <div style="margin-bottom: 1.5rem;">
                                <h3 style="color: #0ea5e9; margin-bottom: 0.75rem;"><i class="fas fa-check-circle"></i> What is DTG Printing?</h3>
                                <p style="color: #4b5563; line-height: 1.6;">
                                    Direct-to-Garment (DTG) printing is a digital printing method that produces vibrant, full-color designs directly onto fabric.
                                    It's perfect for detailed artwork, photographs, and complex designs.
                                </p>
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <h3 style="color: #0ea5e9; margin-bottom: 0.75rem;"><i class="fas fa-exclamation-triangle"></i> Why Fabric Content Matters</h3>
                                <p style="color: #4b5563; line-height: 1.6; margin-bottom: 0.75rem;">
                                    DTG printing is <strong>very finicky</strong> and only works on garments with high cotton content:
                                </p>
                                <ul style="color: #4b5563; line-height: 1.8; margin-left: 1.5rem;">
                                    <li><strong>Best:</strong> 100% cotton garments</li>
                                    <li><strong>Good:</strong> 50% or higher cotton blends</li>
                                    <li><strong>Won't Work:</strong> Polyester, performance fabrics, low-cotton blends</li>
                                </ul>
                            </div>

                            <div style="background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                                <p style="margin: 0; color: #1e40af; font-weight: 500;">
                                    <i class="fas fa-lightbulb"></i> <strong>10+ Years of Testing:</strong>
                                    All products marked "DTG-Compatible" have been tested and verified by our team over more than 10 years of DTG printing experience.
                                </p>
                            </div>

                            <div>
                                <h3 style="color: #0ea5e9; margin-bottom: 0.75rem;"><i class="fas fa-tools"></i> Other Decoration Methods</h3>
                                <p style="color: #4b5563; line-height: 1.6;">
                                    <strong>Screen printing</strong> and <strong>embroidery</strong> work on virtually all fabric types,
                                    so you don't need to worry about fabric content for those methods.
                                </p>
                            </div>
                        </div>
                        <div class="modal-footer" style="padding: 1rem 2rem; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 1rem;">
                            <button onclick="closeDTGEducationModal()" class="btn-primary" style="background: #0ea5e9;">
                                Got it! Show me DTG-Compatible Products
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Insert modal into page
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // Mark as shown
            sessionStorage.setItem('dtgEducationShown', 'true');

            // Close on outside click
            document.getElementById('dtgEducationModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDTGEducationModal();
                }
            });
        }

        // Close DTG education modal
        function closeDTGEducationModal() {
            const modal = document.getElementById('dtgEducationModal');
            if (modal) {
                modal.remove();
            }
        }

        // Show quick view modal
        function showQuickView(product) {
            const modal = document.getElementById('quickViewModal');
            const modalBody = document.getElementById('modalBody');
            const modalTitle = document.getElementById('modalTitle');
            
            modalTitle.textContent = product.description;
            
            const firstProduct = product.details[0];
            const images = [];
            
            // Collect unique images
            if (firstProduct.FRONT_MODEL) images.push(firstProduct.FRONT_MODEL);
            if (firstProduct.BACK_MODEL) images.push(firstProduct.BACK_MODEL);
            if (firstProduct.FRONT_FLAT) images.push(firstProduct.FRONT_FLAT);
            if (firstProduct.BACK_FLAT) images.push(firstProduct.BACK_FLAT);
            
            // Parse description for features
            const features = firstProduct.PRODUCT_DESCRIPTION ? 
                firstProduct.PRODUCT_DESCRIPTION.split('     ').filter(f => f.trim()) : [];
            
            modalBody.innerHTML = `
                <div class="modal-images">
                    <div class="modal-main-image">
                        <img src="${images[0] || firstProduct.PRODUCT_IMAGE}" alt="${product.description}" id="mainModalImage">
                    </div>
                    ${images.length > 1 ? `
                        <div class="modal-thumbnails">
                            ${images.map((img, index) => `
                                <div class="modal-thumbnail ${index === 0 ? 'active' : ''}" onclick="changeModalImage('${img}', this)">
                                    <img src="${img}" alt="View ${index + 1}">
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
                <div class="modal-info">
                    <h3>${product.description}</h3>
                    <div class="modal-style">Style #${product.style}</div>
                    <div class="modal-description">
                        ${features[0] || 'Premium quality apparel perfect for custom decoration.'}
                    </div>
                    ${features.length > 1 ? `
                        <div class="modal-features">
                            <h4>Product Features</h4>
                            <ul>
                                ${features.slice(1).map(f => `<li>${f.trim()}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    <div class="modal-cta">
                        <button class="btn-quote" onclick="requestQuote('${product.style}', '${product.description.replace(/'/g, "\\'")}'); closeModal();">
                            <i class="fas fa-calculator"></i>
                            Request Custom Quote
                        </button>
                        <button class="btn-contact" onclick="window.location.href='mailto:sales@nwcustomapparel.com'">
                            <i class="fas fa-envelope"></i>
                            Contact Sales
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        // Change modal image
        function changeModalImage(src, thumbnail) {
            document.getElementById('mainModalImage').src = src;
            document.querySelectorAll('.modal-thumbnail').forEach(t => t.classList.remove('active'));
            thumbnail.classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('quickViewModal').classList.remove('active');
        }

        // Request quote
        function requestQuote(style, name) {
            const subject = `Quote Request: ${name} (Style #${style})`;
            const body = `Hello,\n\nI'm interested in getting a custom quote for:\n\nProduct: ${name}\nStyle: #${style}\n\nPlease provide pricing for custom decoration.\n\nThank you!`;
            
            window.location.href = `mailto:sales@nwcustomapparel.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }
        
        // Sample Request System Integration
        let sampleRequestService = null;
        
        // Initialize sample request system
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize service if available
            if (typeof SampleRequestService !== 'undefined') {
                sampleRequestService = new SampleRequestService();
            }
            
            // Listen for sample modal events
            window.addEventListener('openSampleModal', (e) => {
                openSampleModal(e.detail.samples);
            });
        });
        
        // Handle sample request button click
        async function handleSampleRequest(styleNumber, productName, imageUrl) {
            // Navigate to product detail page in sample mode
            // Determine product type from current tab filter
            let productType = 'dtg'; // default

            // Check active tab to determine type
            const activeTab = document.querySelector('.filter-option.active');
            if (activeTab) {
                const tabText = activeTab.textContent.trim().toLowerCase();
                if (tabText.includes('screen print')) {
                    productType = 'screenprint';
                } else if (tabText.includes('embroidery')) {
                    productType = 'embroidery';
                } else if (tabText.includes('caps')) {
                    productType = 'caps';
                }
            }

            // Get price from eligibility check
            let price = 0;
            let sampleType = 'free';
            if (window.sampleCart) {
                const eligibility = await window.sampleCart.checkEligibility(styleNumber);
                if (eligibility.eligible) {
                    price = eligibility.price || 0;
                    sampleType = eligibility.type || 'free';
                }
            }

            // Build URL for product detail page with sample mode AND price
            const url = `top-sellers-product.html?style=${encodeURIComponent(styleNumber)}&name=${encodeURIComponent(productName)}&type=${productType}&mode=sample&price=${price}&sampleType=${sampleType}`;

            // Navigate to product detail page
            window.location.href = url;
        }
        
        // Show modal for color/size selection
        async function showSampleSelectionModal(styleNumber, productName, imageUrl, price, type, eligibilityData) {
            // Validate we have colors and sizes
            if (!eligibilityData.colors || eligibilityData.colors.length === 0) {
                console.error('No colors available for', styleNumber);
                alert('Unable to load color options for this product. Please try again or contact customer service.');
                return;
            }

            if (!eligibilityData.sizes || eligibilityData.sizes.length === 0) {
                console.error('No sizes available for', styleNumber);
                alert('Unable to load size options for this product. Please try again or contact customer service.');
                return;
            }

            // Fetch upcharges from BLANK pricing endpoint
            let upcharges = {};
            try {
                const apiBase = 'https://caspio-pricing-proxy-ab30a049961a.herokuapp.com';
                const response = await fetch(`${apiBase}/api/pricing-bundle?method=BLANK&styleNumber=${styleNumber}`);
                if (response.ok) {
                    const data = await response.json();
                    upcharges = data.sellingPriceDisplayAddOns || {};
                    console.log('[Sample] Fetched upcharges for', styleNumber, upcharges);
                }
            } catch (error) {
                console.warn('[Sample] Failed to fetch upcharges:', error);
                // Continue without upcharges
            }

            // Open drawer with product selection
            if (window.cartDrawer) {
                const productData = {
                    style: styleNumber,
                    name: productName,
                    description: '',
                    imageUrl: imageUrl,
                    price: price || 0,
                    type: type || 'free',
                    upcharges: upcharges,
                    colors: eligibilityData.colors.map(c => ({
                        name: c.name,
                        code: c.name,
                        catalogColor: c.catalogColor || c.name,
                        swatchUrl: c.swatchUrl // Sanmar swatch image URL
                    })),
                    sizes: eligibilityData.sizes
                };

                window.cartDrawer.open(productData);
            }
        }
        
        // Handle sample form submission
        async function handleSampleFormSubmit(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitSampleRequest');
            const originalButtonText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            
            try {
                // Get delivery method
                const deliveryMethod = document.querySelector('input[name="deliveryMethod"]:checked').value;
                
                // Get form data
                const formData = {
                    firstName: document.getElementById('sampleFirstName').value,
                    lastName: document.getElementById('sampleLastName').value,
                    email: document.getElementById('sampleEmail').value,
                    phone: document.getElementById('samplePhone').value,
                    company: document.getElementById('sampleCompany').value,
                    projectType: document.getElementById('projectType').value,
                    estimatedQuantity: document.getElementById('estimatedQuantity').value,
                    timeline: document.getElementById('timeline').value,
                    notes: document.getElementById('sampleNotes').value,
                    deliveryMethod: deliveryMethod
                };

                // Validate shipping fields if ship method selected
                if (deliveryMethod === 'ship') {
                    formData.address1 = document.getElementById('shippingAddress1').value;
                    formData.address2 = document.getElementById('shippingAddress2').value || '';
                    formData.city = document.getElementById('shippingCity').value;
                    formData.state = document.getElementById('shippingState').value;
                    formData.zip = document.getElementById('shippingZip').value;

                    // Validate required shipping fields
                    if (!formData.address1 || !formData.city || !formData.state || !formData.zip) {
                        alert('Please fill out all required shipping address fields');
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalButtonText;
                        return;
                    }

                    formData.shippingCost = 10.00;
                } else {
                    formData.shippingCost = 0;
                }
                
                // Get samples from cart
                const cartSummary = window.sampleCart.getCartSummary();
                
                // Calculate totals
                let samplesCost = 0;
                cartSummary.items.forEach(item => {
                    if (item.price > 0) {
                        samplesCost += item.price;
                    }
                });
                formData.samplesCost = samplesCost;
                formData.totalAmount = samplesCost + formData.shippingCost;
                
                // Check for duplicate requests
                const isDuplicate = await sampleRequestService.checkDuplicateRequest(formData.email);
                if (isDuplicate) {
                    alert('You have already requested samples within the last 30 days. Please contact us directly if you need additional samples.');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalButtonText;
                    return;
                }
                
                // Calculate tax (10.1% Milton sales tax on taxable items)
                const taxRate = 0.101;
                const taxableAmount = samplesCost + formData.shippingCost;
                const salesTax = taxableAmount > 0 ? taxableAmount * taxRate : 0;
                const finalTotal = taxableAmount + salesTax;
                
                // Update form data with tax
                formData.salesTax = salesTax;
                formData.totalAmount = finalTotal;
                
                // Store original notes - comprehensive notes will be built in saveSampleRequest
                // Don't override formData.notes here
                
                // Store detailed order info for the AE
                formData.orderDetails = {
                    samples: cartSummary.items.map(item => ({
                        style: item.style || '',
                        name: item.name || '',
                        color: item.color || 'TBD',
                        size: item.size || 'TBD',
                        price: item.price || 0
                    })),
                    delivery: deliveryMethod,
                    shipping: deliveryMethod === 'ship' ? {
                        address: formData.shippingAddress || '',
                        city: formData.shippingCity || '',
                        state: formData.shippingState || '',
                        zip: formData.shippingZip || ''
                    } : null,
                    totals: {
                        samples: samplesCost || 0,
                        shipping: formData.shippingCost || 0,
                        tax: salesTax || 0,
                        total: finalTotal || 0
                    }
                };
                
                // Submit order to ShopWorks via sample-order-service.js
                console.log('[Sample Order] Submitting order to ShopWorks...');
                const result = await window.sampleOrderService.submitOrder(formData, cartSummary.items);

                if (result.success) {
                    console.log('[Sample Order] Order submitted successfully:', result.orderNumber);
                    // Show success message
                    let message;
                    if (formData.totalAmount > 0) {
                        let breakdown = `Samples: $${samplesCost.toFixed(2)}`;
                        if (formData.shippingCost > 0) {
                            breakdown += `\nShipping: $${formData.shippingCost.toFixed(2)}`;
                        }
                        if (formData.salesTax > 0) {
                            breakdown += `\nTax (10.1%): $${formData.salesTax.toFixed(2)}`;
                        }
                        breakdown += `\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`;
                        breakdown += `\nTotal: $${formData.totalAmount.toFixed(2)}`;
                        
                        message = `Success! Your sample order ${result.orderNumber} has been submitted to our production system.\n\n${breakdown}\n\n${deliveryMethod === 'ship' ? 'We\'ll ship your samples within 2 business days.' : 'Your samples will be ready for pickup within 2 business days.'}\n\nAn account executive will contact you to process payment.`;
                    } else {
                        message = `Success! Your FREE sample order ${result.orderNumber} has been submitted to our production system.\n\n${deliveryMethod === 'ship' ? 'We\'ll ship your samples within 2 business days.' : 'Your samples will be ready for pickup within 2 business days.'}\n\nYou'll receive a confirmation email shortly.`;
                    }
                    
                    alert(message);
                    
                    // Clear cart
                    window.sampleCart.clearCart();
                    
                    // Close modal
                    closeSampleModal();
                    
                    // Reset form
                    document.getElementById('sampleRequestForm').reset();
                } else {
                    throw new Error(result.error || 'Failed to submit request');
                }
                
            } catch (error) {
                console.error('Sample request error:', error);
                alert('There was an error submitting your request. Please try again or contact us directly.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalButtonText;
            }
        }
    </script>
</body>
</html>