<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sample Cart - Northwest Custom Apparel</title>
    <link rel="icon" href="https://cdn.caspio.com/A0E15000/Safety%20Stripes/NWCA%20Favicon%20for%20TEAMNWCA.com.png?ver=1" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- EmailJS for sample request notifications -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <!-- Universal Cart Header Component -->
    <script src="../shared_components/js/universal-cart-header.js"></script>

    <!-- Sample Order Service for ShopWorks Integration -->
    <script src="../shared_components/js/sample-order-service.js"></script>

    <!-- Sample Inventory Service for Real-Time Stock Checking -->
    <script src="../shared_components/js/sample-inventory-service.js"></script>

    <style>
        :root {
            --primary-color: #4cb354;
            --primary-dark: #409a47;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .header {
            background: white;
            border-bottom: 2px solid var(--primary-color);
            padding: 1.5rem 0;
            box-shadow: var(--shadow);
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .company-logo {
            height: 50px;
            transition: opacity 0.2s;
        }

        .company-logo:hover {
            opacity: 0.8;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .contact-info {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .contact-info a {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .contact-info a:hover {
            color: var(--primary-color);
        }

        /* Cart Indicator Badge */
        .cart-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            background: var(--primary-color);
            color: white;
            border-radius: 8px;
            font-weight: 600;
            position: relative;
            box-shadow: var(--shadow);
        }

        .cart-indicator i {
            font-size: 1.25rem;
        }

        .cart-count-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .cart-label {
            font-size: 0.95rem;
        }

        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Breadcrumb Navigation */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
            transition: opacity 0.2s;
        }

        .breadcrumb a:hover {
            opacity: 0.7;
        }

        .breadcrumb-separator {
            color: var(--border-color);
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .page-title i {
            color: var(--primary-color);
            font-size: 1.75rem;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 1.05rem;
        }

        /* Cart Summary Bar */
        .cart-summary-bar {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 1.25rem 2rem;
            border-radius: 12px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            gap: 2rem;
        }

        .cart-summary-bar .summary-item {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .cart-summary-bar .summary-item i {
            font-size: 1.5rem;
            opacity: 0.9;
            line-height: 1;
            display: flex;
            align-items: center;
        }

        .cart-summary-bar .summary-item > div {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .cart-summary-bar .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.2;
            margin-bottom: 0.15rem;
        }

        .cart-summary-bar .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .cart-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
        }

        .cart-item {
            display: grid;
            grid-template-columns: 100px 1fr auto;
            gap: 1.5rem;
            padding: 1.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .item-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .item-details h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .item-details .item-style {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .item-details .item-color {
            display: inline-block;
            background: var(--bg-color);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .item-sizes {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .size-badge {
            display: inline-flex;
            align-items: center;
            margin: 0.25rem;
            overflow: hidden;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: default;
        }

        .size-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .size-info {
            background: linear-gradient(135deg, var(--primary-color) 0%, #2c7a4f 100%);
            color: white;
            padding: 0.5rem 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
            letter-spacing: 0.025em;
        }

        .size-price {
            background: linear-gradient(135deg, #1e5a3a 0%, #184a2f 100%);
            color: white;
            padding: 0.5rem 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            letter-spacing: 0.015em;
            border-left: 1px solid rgba(255, 255, 255, 0.2);
        }

        .item-remove {
            color: #ef4444;
            cursor: pointer;
            font-size: 1.25rem;
            transition: opacity 0.2s;
        }

        .item-remove:hover {
            opacity: 0.7;
        }

        /* ===== Inventory Status Badges ===== */
        .inventory-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8125rem;
            font-weight: 600;
            margin: 0.5rem 0;
            transition: all 0.2s;
        }

        .inventory-status-badge i {
            font-size: 0.875rem;
        }

        .inventory-status-badge.in-stock {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #34d399;
        }

        .inventory-status-badge.low-stock {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fbbf24;
        }

        .inventory-status-badge.out-of-stock {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #f87171;
        }

        .inventory-status-badge.checking {
            background: #e5e7eb;
            color: #4b5563;
            border: 1px solid #d1d5db;
        }

        .inventory-status-badge.checking i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Size Availability Indicators */
        .size-unavailable {
            opacity: 0.5;
            position: relative;
        }

        .size-unavailable::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #ef4444;
            transform: translateY(-50%) rotate(-15deg);
        }

        .size-unavailable .size-info,
        .size-unavailable .size-price {
            text-decoration: line-through;
        }

        /* Inventory Warning Messages */
        .inventory-warning {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.9375rem;
        }

        .inventory-warning i {
            font-size: 1.25rem;
            margin-top: 0.125rem;
        }

        .inventory-warning.warning {
            background: #fff7ed;
            border: 1px solid #fed7aa;
            color: #9a3412;
        }

        .inventory-warning.error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }

        .inventory-warning strong {
            display: block;
            margin-bottom: 0.25rem;
        }

        /* Checkout Validation Alert */
        .checkout-validation-alert {
            background: #fef2f2;
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 1.25rem;
            margin: 1.5rem 0;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .checkout-validation-alert i {
            font-size: 1.5rem;
            color: #dc2626;
            margin-top: 0.125rem;
        }

        .checkout-validation-alert .alert-content h3 {
            font-size: 1.125rem;
            color: #991b1b;
            margin-bottom: 0.5rem;
        }

        .checkout-validation-alert .alert-content p {
            color: #7f1d1d;
            margin-bottom: 0.75rem;
        }

        .checkout-validation-alert .out-of-stock-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .checkout-validation-alert .out-of-stock-list li {
            padding: 0.5rem 0;
            color: #991b1b;
            font-weight: 500;
        }

        .checkout-validation-alert .out-of-stock-list li i {
            font-size: 0.875rem;
            margin-right: 0.5rem;
        }

        /* Loading Overlay for Inventory Checks */
        .inventory-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .inventory-loading-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 300px;
        }

        .inventory-loading-content i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            animation: spin 1s linear infinite;
        }

        .inventory-loading-content h3 {
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
        }

        .inventory-loading-content p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .empty-cart {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-cart i {
            font-size: 5rem;
            margin-bottom: 1.5rem;
            color: var(--border-color);
            animation: emptyCartPulse 2s ease-in-out infinite;
        }

        @keyframes emptyCartPulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.05); opacity: 0.7; }
        }

        .empty-cart h3 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .empty-cart p {
            font-size: 1.05rem;
            margin-bottom: 2rem;
        }

        .empty-cart .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
            text-align: left;
        }

        .empty-cart .feature {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .empty-cart .feature i {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin: 0;
            animation: none;
        }

        .empty-cart .feature-text h4 {
            font-size: 1rem;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .empty-cart .feature-text p {
            font-size: 0.875rem;
            margin: 0;
            color: var(--text-secondary);
        }

        .form-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
        }

        .form-section h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-group label .required {
            color: #ef4444;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 0.875rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary i {
            color: white !important;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--bg-color);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .success-message {
            background: white;
            border-radius: 12px;
            padding: 3rem;
            box-shadow: var(--shadow-md);
            text-align: center;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .success-message i {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .success-message h2 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .success-message p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        /* File Input Styling */
        .form-group input[type="file"] {
            width: 100%;
            padding: 0.75rem;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            background: var(--bg-color);
            cursor: pointer;
            transition: border-color 0.2s, background 0.2s;
        }

        .form-group input[type="file"]:hover {
            border-color: var(--primary-color);
            background: white;
        }

        .form-group input[type="file"]:focus {
            outline: none;
            border-color: var(--primary-color);
            border-style: solid;
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            .header-actions {
                width: 100%;
                flex-direction: column;
                gap: 1rem;
            }

            .contact-info {
                width: 100%;
                justify-content: center;
                gap: 1rem;
            }

            .cart-indicator {
                width: 100%;
                justify-content: center;
            }

            .cart-summary-bar {
                flex-direction: column;
                gap: 1rem;
            }

            .cart-summary-bar .summary-item {
                width: 100%;
                justify-content: center;
                text-align: center;
            }

            .breadcrumb {
                font-size: 0.8rem;
                flex-wrap: wrap;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .cart-item {
                grid-template-columns: 80px 1fr;
                gap: 1rem;
            }

            .item-remove {
                grid-column: 2;
                text-align: right;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        /* ==============================================
           BILLING/SHIPPING ADDRESS STYLING
           ============================================== */

        /* Same as billing checkbox container */
        .same-as-billing-container {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            cursor: pointer;
            font-size: 1rem;
            margin: 0;
        }

        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin: 0;
        }

        .checkbox-label span {
            user-select: none;
        }

        /* Smooth transition for shipping section */
        .shipping-address-section {
            transition: opacity 0.3s ease, max-height 0.3s ease;
            overflow: hidden;
        }

        .shipping-address-section[style*="display: none"] {
            opacity: 0;
            max-height: 0;
        }

        /* Section headers styling */
        .form-section h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary, #333);
        }

        .form-section h2 i {
            color: var(--primary-color, #2d5f3f);
        }
    </style>
</head>
<body>
    <!-- Universal Header Placeholder -->
    <div id="universal-header-placeholder"></div>

    <!-- Main Content -->
    <div class="container">
        <!-- Cart Section -->
        <div id="cartContainer">
            <!-- Breadcrumb Navigation -->
            <nav class="breadcrumb" aria-label="Breadcrumb">
                <a href="/"><i class="fas fa-home"></i> Home</a>
                <span class="breadcrumb-separator">‚Ä∫</span>
                <a href="/pages/top-sellers-showcase.html">Products</a>
                <span class="breadcrumb-separator">‚Ä∫</span>
                <span>Sample Cart</span>
            </nav>

            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-shopping-cart"></i>
                    Your Sample Cart
                </h1>
                <p class="page-subtitle">Review your selected samples and complete the form below to submit your request.</p>
            </div>

            <!-- Cart Summary Bar -->
            <div class="cart-summary-bar" id="cartSummaryBar">
                <div class="summary-item">
                    <i class="fas fa-box-open"></i>
                    <div>
                        <div class="summary-label">Items in Cart</div>
                        <div class="summary-value" id="summaryItemCount">0</div>
                    </div>
                </div>
                <div class="summary-item">
                    <i class="fas fa-tshirt"></i>
                    <div>
                        <div class="summary-label">Total Pieces</div>
                        <div class="summary-value" id="summaryTotalPieces">0</div>
                    </div>
                </div>
                <div class="summary-item">
                    <i class="fas fa-calculator"></i>
                    <div>
                        <div class="summary-label">Estimated Total</div>
                        <div class="summary-value" id="summaryTotalPrice">$0.00</div>
                    </div>
                </div>
            </div>

            <div class="cart-section">
                <div id="cartItems">
                    <!-- Cart items will be populated here -->
                </div>
            </div>

            <!-- Contact Form -->
            <div class="form-section" id="contactForm">
                <h2><i class="fas fa-user"></i> Contact Information</h2>
                <form id="sampleRequestForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>
                                First Name <span class="required">*</span>
                            </label>
                            <input type="text" name="firstName" required>
                        </div>

                        <div class="form-group">
                            <label>
                                Last Name <span class="required">*</span>
                            </label>
                            <input type="text" name="lastName" required>
                        </div>

                        <div class="form-group">
                            <label>
                                Email <span class="required">*</span>
                            </label>
                            <input type="email" name="email" required>
                        </div>

                        <div class="form-group">
                            <label>
                                Phone <span class="required">*</span>
                            </label>
                            <input type="tel" name="phone" required>
                        </div>

                        <div class="form-group">
                            <label>
                                Company
                            </label>
                            <input type="text" name="company">
                        </div>

                        <div class="form-group">
                            <label>
                                Sales Representative
                            </label>
                            <select name="salesRep" id="salesRep">
                                <option value="House" selected>House (No Specific Rep)</option>
                                <option value="Nika Lao">Nika Lao</option>
                                <option value="Taneisha Clark">Taneisha Clark</option>
                                <option value="Ruth Nhong">Ruth Nhong</option>
                                <option value="Erik Mickelson">Erik Mickelson</option>
                            </select>
                        </div>

                        <!-- BILLING ADDRESS SECTION -->
                        <h2 style="margin-top: 2rem;"><i class="fas fa-credit-card"></i> Billing Address</h2>

                        <div class="form-group">
                            <label>
                                Street Address <span class="required">*</span>
                            </label>
                            <input type="text" name="billing_address1" id="billing-address1" required placeholder="123 Main St">
                        </div>

                        <div class="form-group">
                            <label>
                                Apt/Suite
                            </label>
                            <input type="text" name="billing_address2" id="billing-address2" placeholder="Apt 4B">
                        </div>

                        <div class="form-group">
                            <label>
                                City <span class="required">*</span>
                            </label>
                            <input type="text" name="billing_city" id="billing-city" required>
                        </div>

                        <div class="form-group">
                            <label>
                                State <span class="required">*</span>
                            </label>
                            <input type="text" name="billing_state" id="billing-state" required placeholder="WA" maxlength="2" pattern="[A-Za-z]{2}" style="text-transform: uppercase;">
                        </div>

                        <div class="form-group">
                            <label>
                                ZIP Code <span class="required">*</span>
                            </label>
                            <input type="text" name="billing_zip" id="billing-zip" required placeholder="98101" pattern="\d{5}" maxlength="5" inputmode="numeric">
                        </div>

                        <!-- SAME AS BILLING CHECKBOX -->
                        <div class="form-group full-width same-as-billing-container">
                            <label class="checkbox-label">
                                <input type="checkbox" id="same-as-billing" checked>
                                <span>Ship to the same address</span>
                            </label>
                        </div>

                        <!-- SHIPPING ADDRESS SECTION (hidden by default) -->
                        <div id="shipping-section" class="shipping-address-section" style="display: none;">
                            <h2><i class="fas fa-shipping-fast"></i> Shipping Address</h2>

                            <div class="form-group">
                                <label>
                                    Street Address
                                </label>
                                <input type="text" name="shipping_address1" id="shipping-address1" placeholder="123 Main St">
                            </div>

                            <div class="form-group">
                                <label>
                                    Apt/Suite
                                </label>
                                <input type="text" name="shipping_address2" id="shipping-address2" placeholder="Apt 4B">
                            </div>

                            <div class="form-group">
                                <label>
                                    City
                                </label>
                                <input type="text" name="shipping_city" id="shipping-city">
                            </div>

                            <div class="form-group">
                                <label>
                                    State
                                </label>
                                <input type="text" name="shipping_state" id="shipping-state" placeholder="WA" maxlength="2" pattern="[A-Za-z]{2}" style="text-transform: uppercase;">
                            </div>

                            <div class="form-group">
                                <label>
                                    ZIP Code
                                </label>
                                <input type="text" name="shipping_zip" id="shipping-zip" placeholder="98101" pattern="\d{5}" maxlength="5" inputmode="numeric">
                            </div>
                        </div>

                        <!-- Shipping Method: Hidden field defaulting to UPS Ground -->
                        <input type="hidden" name="shippingMethod" value="UPS Ground">
                        <div class="form-group full-width">
                            <label>
                                Additional Notes
                            </label>
                            <textarea name="notes" placeholder="Any specific requirements or questions..."></textarea>
                        </div>

                        <!-- Logo Upload Section -->
                        <div class="form-group full-width">
                            <label>
                                Upload Logo/Artwork
                                <span style="color: var(--text-secondary); font-weight: normal;">(Optional - AI, PDF, PNG, JPG)</span>
                            </label>
                            <input
                                type="file"
                                id="logoUpload"
                                name="logoUpload"
                                accept=".ai,.pdf,.png,.jpg,.jpeg,.eps,.psd,.svg"
                                style="padding: 0.5rem;">
                            <small style="display: block; margin-top: 0.5rem; color: var(--text-secondary);">
                                Upload your company logo or artwork design (if available)
                            </small>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            Submit Sample Request
                        </button>
                        <a href="/pages/top-sellers-showcase.html" class="btn btn-secondary">
                            <i class="fas fa-shopping-bag"></i>
                            Continue Shopping
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <i class="fas fa-check-circle"></i>
            <h2>Sample Request Submitted!</h2>
            <p>Thank you for your request. We'll process your samples and be in touch shortly.</p>
            <p><strong>Confirmation ID:</strong> <span id="confirmationId"></span></p>
            <div class="button-group" style="justify-content: center;">
                <a href="/top-sellers-showcase.html" class="btn btn-primary">
                    <i class="fas fa-home"></i>
                    Back to Top Sellers
                </a>
            </div>
        </div>
    </div>

    <script>
        // Initialize EmailJS
        emailjs.init('4qSbDO-SQs19TbP80');

        // Initialize Sample Order Service
        const sampleOrderService = new SampleOrderService();
        window.sampleOrderService = sampleOrderService;
        console.log('[Sample Cart] Service initialized');

        // ==============================================
        // SIZE SORTING UTILITY
        // ==============================================

        /**
         * Sort sizes in natural order: Youth ‚Üí Standard ‚Üí Tall ‚Üí Oversized
         * @param {Object} sizes - Object with size as key and quantity as value
         * @returns {Array} - Sorted array of size keys
         */
        function sortSizesByOrder(sizes) {
            const order = [
                'YXS', 'YS', 'YM', 'YL', 'YXL',          // Youth
                'XS', 'S', 'M', 'L', 'XL',                // Standard
                'MT', 'LT', 'XLT',                        // Tall (medium/large/XL)
                '2XL', '2XLT',                            // 2X and 2X Tall
                '3XL', '3XLT',                            // 3X and 3X Tall
                '4XL', '5XL', '6XL',                      // Extra oversized
                'OSFA'                                    // One size
            ];

            return Object.keys(sizes)
                .filter(size => sizes[size] > 0)
                .sort((a, b) => {
                    const indexA = order.indexOf(a);
                    const indexB = order.indexOf(b);
                    if (indexA === -1) return 1;         // Unknown sizes go to end
                    if (indexB === -1) return -1;
                    return indexA - indexB;
                });
        }

        // ==============================================
        // DEBUG UTILITIES - Sample Cart & Checkout
        // ==============================================
        window.CART_DEBUG = {
            enabled: true,

            // Log cart load from sessionStorage
            logCartLoad: function(cart) {
                if (!this.enabled) return;
                console.group('üì• [Cart Load] From SessionStorage');
                console.log('Items Count:', cart.length);
                console.table(cart.map((item, i) => ({
                    Index: i,
                    Style: item.style,
                    Name: item.name,
                    Color: item.color,
                    Sizes: Object.entries(item.sizes).map(([s,q]) => `${s}:${q}`).join(', '),
                    Type: item.sampleType || 'free'
                })));
                console.groupEnd();
            },

            // Log form data before submission
            logFormSubmission: function(customerData, samplesForService) {
                if (!this.enabled) return;
                console.group('üì§ [Form Submit] Order Data');
                console.log('Customer Data:', JSON.stringify(customerData, null, 2));
                console.log('Samples for Service:', JSON.stringify(samplesForService, null, 2));
                console.log('Total Items:', samplesForService.length);
                console.groupEnd();
            },

            // Log API request
            logAPIRequest: function(endpoint, payload) {
                if (!this.enabled) return;
                console.group('üåê [API Request] ManageOrders PUSH');
                console.log('Endpoint:', endpoint);
                console.log('Payload:', JSON.stringify(payload, null, 2));
                console.log('Timestamp:', new Date().toISOString());
                console.groupEnd();
            },

            // Log API response
            logAPIResponse: function(response, data) {
                if (!this.enabled) return;
                console.group('‚úÖ [API Response] ManageOrders');
                console.log('Status:', response.status, response.statusText);
                console.log('Data:', JSON.stringify(data, null, 2));
                console.groupEnd();
            }
        };

        // Helper function to safely read cart from storage
        function getCartSamples() {
            console.log('üîç [GET CART] Function called');
            try {
                const stored = sessionStorage.getItem('sampleCart');
                console.log('üîç [GET CART] Raw sessionStorage:', stored);

                if (!stored) {
                    console.log('üîç [GET CART] No cart found, returning empty array');
                    return [];
                }

                const parsed = JSON.parse(stored);
                console.log('üîç [GET CART] Parsed data:', parsed);

                // Handle both old (array) and new (nested) formats
                if (Array.isArray(parsed)) {
                    console.log('üîç [GET CART] Old format (array), returning:', parsed);
                    return parsed; // Old format
                } else if (parsed && parsed.samples && Array.isArray(parsed.samples)) {
                    console.log('üîç [GET CART] New format (nested), returning samples:', parsed.samples);
                    return parsed.samples; // New format
                } else {
                    console.warn('‚ö†Ô∏è [GET CART] Unrecognized cart format:', parsed);
                    return [];
                }
            } catch (e) {
                console.error('‚ùå [GET CART] Error parsing cart:', e);
                return [];
            }
        }

        // Migrate old cart items to include upcharges (backward compatibility)
        async function migrateCartUpcharges(cart) {
            if (!cart || cart.length === 0) return cart;

            console.group('üîÑ [Cart Migration] Checking for missing upcharges');

            let updated = false;
            const apiBase = 'https://caspio-pricing-proxy-ab30a049961a.herokuapp.com';

            for (let i = 0; i < cart.length; i++) {
                const item = cart[i];

                // Check if upcharges field is missing
                if (!item.upcharges || Object.keys(item.upcharges).length === 0) {
                    console.log(`üì¶ [Migration] Fetching upcharges for ${item.style} (missing upcharges field)`);

                    try {
                        const response = await fetch(`${apiBase}/api/pricing-bundle?method=BLANK&styleNumber=${item.style}`);

                        if (response.ok) {
                            const data = await response.json();
                            const upcharges = data.sellingPriceDisplayAddOns || {};

                            // Add upcharges to item
                            cart[i].upcharges = upcharges;
                            updated = true;

                            console.log(`‚úÖ [Migration] Added upcharges for ${item.style}:`, upcharges);
                        } else {
                            console.warn(`‚ö†Ô∏è [Migration] API failed for ${item.style}:`, response.status);
                            // Add empty upcharges object to prevent repeated attempts
                            cart[i].upcharges = {};
                        }
                    } catch (error) {
                        console.error(`‚ùå [Migration] Error fetching upcharges for ${item.style}:`, error);
                        // Add empty upcharges object to prevent repeated attempts
                        cart[i].upcharges = {};
                    }
                } else {
                    console.log(`‚úì [Migration] ${item.style} already has upcharges, skipping`);
                }
            }

            console.log(`üìä [Migration] Summary: ${updated ? 'Cart updated' : 'No updates needed'}`);
            console.groupEnd();

            // If we updated any items, save the migrated cart back to sessionStorage
            if (updated) {
                const cartData = {
                    samples: cart,
                    timestamp: new Date().toISOString()
                };
                sessionStorage.setItem('sampleCart', JSON.stringify(cartData));
                console.log('üíæ [Migration] Saved migrated cart to sessionStorage');
            }

            return cart;
        }

        // Update cart summary bar and badge
        function updateCartSummary(cart) {
            const itemCount = cart.length;
            let totalPieces = 0;
            let totalPrice = 0;

            cart.forEach(item => {
                const upcharges = item.upcharges || {};
                const basePrice = parseFloat(item.price) || 0;

                Object.entries(item.sizes).forEach(([size, qty]) => {
                    if (qty > 0) {
                        totalPieces += qty;
                        const upcharge = upcharges[size] || 0;
                        const sizePrice = basePrice + upcharge;
                        totalPrice += qty * sizePrice;
                    }
                });
            });

            // Update header cart badge
            const badge = document.querySelector('.cart-count-badge');
            if (badge) {
                badge.textContent = itemCount;
                badge.style.display = itemCount > 0 ? 'flex' : 'none';
            }

            // Update summary bar
            document.getElementById('summaryItemCount').textContent = itemCount;
            document.getElementById('summaryTotalPieces').textContent = totalPieces;
            document.getElementById('summaryTotalPrice').textContent = `$${totalPrice.toFixed(2)}`;
        }

        // Load and display cart items
        async function loadCart() {
            // === ENSURE CONTAINER IS VISIBLE (Fix for browser back button edge cases) ===
            const cartContainer = document.getElementById('cartContainer');
            if (cartContainer) {
                cartContainer.style.display = 'block';
                console.log('üîß [FIX] Ensured cartContainer is visible');
            }

            // === ENHANCED DEBUGGING ===
            console.log('üì¶ [LOAD CART] Function called');
            console.log('üì¶ [LOAD CART] sessionStorage value:', sessionStorage.getItem('sampleCart'));

            let cart = getCartSamples();
            console.log('üì¶ [LOAD CART] Parsed cart:', cart);
            console.log('üì¶ [LOAD CART] Cart length:', cart.length);

            // Migrate old cart items to include upcharges (backward compatibility)
            cart = await migrateCartUpcharges(cart);
            console.log('üì¶ [LOAD CART] After migration:', cart);

            // Update summary bar and badge
            updateCartSummary(cart);

            // DEBUG: Log cart load
            if (window.CART_DEBUG) {
                window.CART_DEBUG.logCartLoad(cart);
            }

            // Get cart container (declare once for entire function)
            const container = document.getElementById('cartItems');

            // ===== CHECK INVENTORY FOR ALL ITEMS =====
            if (cart.length > 0 && window.sampleInventoryService) {
                console.log('[Sample Cart] Checking inventory for cart items...');

                // Show loading indicator
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-circle-notch fa-spin" style="font-size: 2rem; color: var(--primary-color);"></i>
                        <p style="margin-top: 1rem; color: var(--text-secondary);">Checking inventory...</p>
                    </div>
                `;

                try {
                    // Check inventory for all cart items
                    cart = await window.sampleInventoryService.checkCartInventory(cart);

                    console.log('[Sample Cart] ‚úì Inventory check complete');

                    // Save updated cart with inventory status
                    const cartData = {
                        samples: cart,
                        timestamp: new Date().toISOString()
                    };
                    sessionStorage.setItem('sampleCart', JSON.stringify(cartData));

                    // === DEBUG: Verify what was saved ===
                    const verifyCart = JSON.parse(sessionStorage.getItem('sampleCart'));
                    console.log('üíæ [SAVE VERIFY] Saved to sessionStorage:', verifyCart.samples.length, 'items');
                    console.log('üíæ [SAVE VERIFY] First item:', verifyCart.samples[0]);

                } catch (error) {
                    console.error('[Sample Cart] Error checking inventory:', error);
                    // Continue anyway - graceful degradation
                }
            }

            // === CRITICAL DEBUG POINT: Check cart after inventory ===
            console.log('üîç [POST-INVENTORY] cart:', cart);
            console.log('üîç [POST-INVENTORY] cart.length:', cart.length);
            console.log('üîç [POST-INVENTORY] cart is array?', Array.isArray(cart));
            console.log('üîç [POST-INVENTORY] cart items summary:', cart.map(item => ({
                style: item.style,
                color: item.color,
                inventoryStatus: item.inventoryStatus,
                hasSizes: !!item.sizes
            })));

            // Validate cart is still an array
            if (!Array.isArray(cart)) {
                console.error('‚ùå CRITICAL: cart is not an array!', typeof cart, cart);
                cart = []; // Recover with empty array
            }

            // Display cart contents (container already declared at top of function)

            console.log('üîç [PRE-DISPLAY CHECK] About to check if cart is empty');
            console.log('üîç [PRE-DISPLAY CHECK] cart.length:', cart.length);

            if (cart.length === 0) {
                console.log('üîç [PRE-DISPLAY CHECK] ‚ö†Ô∏è Cart IS EMPTY - will show empty message');
                container.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>Your sample cart is empty</h3>
                        <p>Start exploring our top-selling products and add samples to your cart!</p>

                        <div class="features">
                            <div class="feature">
                                <i class="fas fa-shipping-fast"></i>
                                <div class="feature-text">
                                    <h4>Free Samples</h4>
                                    <p>Get physical samples to feel the quality</p>
                                </div>
                            </div>
                            <div class="feature">
                                <i class="fas fa-palette"></i>
                                <div class="feature-text">
                                    <h4>All Colors</h4>
                                    <p>See the actual colors before ordering</p>
                                </div>
                            </div>
                            <div class="feature">
                                <i class="fas fa-ruler"></i>
                                <div class="feature-text">
                                    <h4>Check Sizes</h4>
                                    <p>Try on different sizes for the perfect fit</p>
                                </div>
                            </div>
                        </div>

                        <a href="/pages/top-sellers-showcase.html" class="btn btn-primary" style="margin-top: 1rem; padding: 1rem 2.5rem; font-size: 1.1rem;">
                            <i class="fas fa-search"></i>
                            Browse Top Sellers
                        </a>

                        <p style="margin-top: 2rem; font-size: 0.9rem;">
                            Need help? Call us at <a href="tel:253-922-5793" style="color: var(--primary-color); font-weight: 600;">253-922-5793</a>
                        </p>
                    </div>
                `;
                // Hide contact form and summary bar
                document.getElementById('contactForm').style.display = 'none';
                document.getElementById('cartSummaryBar').style.display = 'none';
                return;
            } else {
                // Show contact form and summary bar if cart has items
                console.log('üîç [DISPLAY] ‚úì Cart has items - showing form and items');
                document.getElementById('contactForm').style.display = 'block';
                document.getElementById('cartSummaryBar').style.display = 'flex';
            }

            // === CRITICAL DEBUG POINT: Before rendering ===
            console.log('üé® [RENDER START] About to render cart items');
            console.log('üé® [RENDER START] Container element:', container);
            console.log('üé® [RENDER START] Cart length:', cart.length);
            console.log('üé® [RENDER START] Cart items:', cart);

            // Display cart items (wrapped in try-catch for error handling)
            try {
                container.innerHTML = cart.map((item, index) => {
                    // === DEBUG: Log each item being rendered ===
                    console.log(`üé® [RENDER ITEM ${index}] Rendering:`, {
                        style: item.style,
                        color: item.color,
                        sizes: item.sizes,
                        hasSizes: !!item.sizes,
                        sizeType: typeof item.sizes,
                        inventoryStatus: item.inventoryStatus
                    });

                    // Validate item.sizes before using it
                    if (!item.sizes || typeof item.sizes !== 'object') {
                        console.error(`üé® [RENDER ITEM ${index}] ‚ùå Invalid sizes:`, item.sizes);
                        item.sizes = {}; // Default to empty object
                    }
                // Get upcharges for this product (from API when added to cart)
                const upcharges = item.upcharges || {};
                const basePrice = parseFloat(item.price) || 0;

                // Get inventory status
                const inventoryStatus = item.inventoryStatus || 'unknown';
                const sizeAvailability = item.sizeAvailability || {};

                // Sort sizes in natural order
                const sortedSizes = sortSizesByOrder(item.sizes);

                // Calculate total with size-specific pricing
                let itemTotal = 0;
                const sizesDisplay = sortedSizes
                    .map(size => {
                        const qty = item.sizes[size];
                        const upcharge = upcharges[size] || 0;
                        const sizePrice = basePrice + upcharge;
                        itemTotal += qty * sizePrice;

                        // Check if this size is available
                        const sizeInfo = sizeAvailability[size] || {};
                        const isAvailable = sizeInfo.available !== false;
                        const unavailableClass = !isAvailable ? ' size-unavailable' : '';

                        return `
                            <div class="size-badge${unavailableClass}" title="${!isAvailable ? 'Out of Stock' : ''}">
                                <span class="size-info">${size} (${qty})</span>
                                <span class="size-price">$${sizePrice.toFixed(2)}</span>
                            </div>
                        `;
                    })
                    .join('');

                const totalQty = Object.values(item.sizes).reduce((sum, qty) => sum + qty, 0);

                // Generate inventory status badge
                let inventoryBadge = '';
                if (inventoryStatus === 'in_stock') {
                    inventoryBadge = '<div class="inventory-status-badge in-stock"><i class="fas fa-check-circle"></i> In Stock</div>';
                } else if (inventoryStatus === 'low_stock') {
                    inventoryBadge = '<div class="inventory-status-badge low-stock"><i class="fas fa-exclamation-triangle"></i> Low Stock</div>';
                } else if (inventoryStatus === 'out_of_stock') {
                    inventoryBadge = '<div class="inventory-status-badge out-of-stock"><i class="fas fa-times-circle"></i> Out of Stock</div>';
                } else if (inventoryStatus === 'unknown') {
                    inventoryBadge = '<div class="inventory-status-badge checking"><i class="fas fa-question-circle"></i> Unable to Verify</div>';
                }

                // Generate size-specific warnings
                let sizeWarnings = '';
                if (item.hasWarnings) {
                    const unavailableSizes = Object.entries(sizeAvailability)
                        .filter(([size, info]) => info.available === false && item.sizes[size] > 0)
                        .map(([size]) => size);

                    if (unavailableSizes.length > 0) {
                        sizeWarnings = `
                            <div class="inventory-warning error">
                                <i class="fas fa-exclamation-circle"></i>
                                <div>
                                    <strong>Some sizes are unavailable:</strong>
                                    ${unavailableSizes.join(', ')}
                                </div>
                            </div>
                        `;
                    }
                }

                return `
                    <div class="cart-item" data-index="${index}">
                        <img src="${item.imageUrl || 'https://via.placeholder.com/100'}" alt="${item.name}" class="item-image">
                        <div class="item-details">
                            <h3>${item.name}</h3>
                            <div class="item-style">Style: ${item.style}</div>
                            <div class="item-color">Color: ${item.color}</div>
                            ${inventoryBadge}
                            ${sizeWarnings}
                            <div class="item-sizes">Sizes: ${sizesDisplay}</div>
                            <div class="item-price" style="margin-top: 0.5rem; font-weight: 600; color: var(--primary-color);">
                                ${totalQty} ${totalQty === 1 ? 'item' : 'items'} = $${itemTotal.toFixed(2)}
                            </div>
                        </div>
                        <div class="item-remove" onclick="removeItem(${index})">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                `;
                }).join('');

                console.log('‚úÖ [RENDER SUCCESS] Cart items rendered successfully');
                console.log('‚úÖ [RENDER SUCCESS] Container HTML length:', container.innerHTML.length);

            } catch (error) {
                console.error('‚ùå [RENDER ERROR] Failed to render cart items:', error);
                console.error('‚ùå [RENDER ERROR] Error message:', error.message);
                console.error('‚ùå [RENDER ERROR] Error stack:', error.stack);
                container.innerHTML = `
                    <div class="alert alert-danger" style="margin: 2rem; padding: 1.5rem; background: #fee2e2; border: 1px solid #f87171; border-radius: 8px;">
                        <h4 style="color: #991b1b; margin-bottom: 0.5rem;"><i class="fas fa-exclamation-triangle"></i> Display Error</h4>
                        <p style="color: #7f1d1d; margin: 0;">Failed to render cart items. Error: ${error.message}</p>
                        <button onclick="location.reload()" class="btn btn-primary" style="margin-top: 1rem;">
                            <i class="fas fa-sync"></i> Reload Page
                        </button>
                    </div>
                `;
            }
        }

        // Remove item from cart
        function removeItem(index) {
            const cart = getCartSamples();
            cart.splice(index, 1);

            // Save with nested structure
            const cartData = {
                samples: cart,
                timestamp: new Date().toISOString()
            };
            sessionStorage.setItem('sampleCart', JSON.stringify(cartData));
            loadCart();
        }

        // ==============================================
        // BILLING/SHIPPING ADDRESS MANAGEMENT
        // ==============================================

        // Copy billing address to shipping address
        function copyBillingToShipping() {
            const fields = ['address1', 'address2', 'city', 'state', 'zip'];
            fields.forEach(field => {
                const billingValue = document.getElementById(`billing-${field}`).value;
                document.getElementById(`shipping-${field}`).value = billingValue;
            });
            console.log('[Address] Copied billing to shipping');
        }

        // Toggle shipping section visibility
        document.getElementById('same-as-billing').addEventListener('change', function() {
            const shippingSection = document.getElementById('shipping-section');

            if (this.checked) {
                // Hide shipping section and copy billing data
                shippingSection.style.display = 'none';
                copyBillingToShipping();
                console.log('[Address] Shipping address hidden (same as billing)');
            } else {
                // Show shipping section
                shippingSection.style.display = 'block';
                console.log('[Address] Shipping address shown (different from billing)');
            }
        });

        // Auto-copy billing to shipping as user types (if checkbox is checked)
        ['address1', 'address2', 'city', 'state', 'zip'].forEach(field => {
            document.getElementById(`billing-${field}`).addEventListener('blur', function() {
                if (document.getElementById('same-as-billing').checked) {
                    copyBillingToShipping();
                }
            });
        });

        // Helper function to convert file to base64
        async function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = (error) => {
                    console.error('[Sample Cart] File read error:', error);
                    reject(error);
                };
                reader.readAsDataURL(file);
            });
        }

        // Handle form submission
        document.getElementById('sampleRequestForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // ===== VALIDATE INVENTORY BEFORE CHECKOUT =====
            const cart = getCartSamples();

            if (window.sampleInventoryService) {
                const validation = window.sampleInventoryService.validateCheckout(cart);

                if (!validation.canProceed) {
                    // Show validation alert
                    const alertHtml = `
                        <div class="checkout-validation-alert">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div class="alert-content">
                                <h3>Cannot Complete Order</h3>
                                <p>${validation.message}</p>
                                <ul class="out-of-stock-list">
                                    ${validation.outOfStockItems.map(item => `
                                        <li>
                                            <i class="fas fa-times-circle"></i>
                                            ${item.name} (${item.color})
                                        </li>
                                    `).join('')}
                                </ul>
                                <p style="margin-top: 1rem;">Please remove out-of-stock items from your cart and try again.</p>
                            </div>
                        </div>
                    `;

                    // Insert alert before form
                    const existingAlert = document.querySelector('.checkout-validation-alert');
                    if (existingAlert) {
                        existingAlert.remove();
                    }

                    const form = document.getElementById('sampleRequestForm');
                    form.insertAdjacentHTML('beforebegin', alertHtml);

                    // Scroll to alert
                    document.querySelector('.checkout-validation-alert').scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });

                    console.error('[Sample Cart] ‚ùå Checkout blocked: Out of stock items');
                    return false; // Block submission
                }

                // Show warnings if any (but allow to proceed)
                if (validation.warnings.length > 0) {
                    console.warn('[Sample Cart] ‚ö†Ô∏è Warnings:', validation.warnings);
                }
            }

            // Ensure shipping fields are populated before submission
            const sameAsBilling = document.getElementById('same-as-billing').checked;
            if (sameAsBilling) {
                copyBillingToShipping();
            }

            const formData = new FormData(e.target);
            // cart already declared at line 1610 - reuse it
            // Get customer data from form (no splitting needed - separate fields now)
            const firstName = formData.get('firstName').trim();
            const lastName = formData.get('lastName').trim();

            // Prepare customer data for ShopWorks (with separate billing & shipping)
            const customerData = {
                firstName: firstName,
                lastName: lastName,
                email: formData.get('email'),
                phone: formData.get('phone'),
                company: formData.get('company') || '',
                salesRep: formData.get('salesRep') || 'House',

                // Billing address
                billing_address1: formData.get('billing_address1'),
                billing_address2: formData.get('billing_address2') || '',
                billing_city: formData.get('billing_city'),
                billing_state: formData.get('billing_state').toUpperCase(),
                billing_zip: formData.get('billing_zip'),

                // Shipping address
                shipping_address1: formData.get('shipping_address1'),
                shipping_address2: formData.get('shipping_address2') || '',
                shipping_city: formData.get('shipping_city'),
                shipping_state: formData.get('shipping_state').toUpperCase(),
                shipping_zip: formData.get('shipping_zip'),

                shippingMethod: formData.get('shippingMethod') || 'UPS Ground',
                notes: formData.get('notes') || ''
            };

            // Pass samples with sizes object intact (service will expand into line items)
            const samplesForService = cart.map(item => ({
                style: item.style,
                name: item.name,
                color: item.color,
                catalogColor: item.catalogColor,
                sizes: item.sizes,  // Keep as object {S: 1, M: 2, L: 1} or {OSFA: 1}
                price: item.price || 0,  // Use 0 not 0.01 for consistency
                type: item.sampleType || 'free',
                upcharges: item.upcharges || {}  // Size-specific upcharges from API
            }));

            console.log('[Sample Cart] Submitting order with:', {
                customer: customerData,
                sampleCount: samplesForService.length
            });

            // DEBUG: Log form submission
            if (window.CART_DEBUG) {
                window.CART_DEBUG.logFormSubmission(customerData, samplesForService);
            }

            // Disable submit button
            const submitBtn = e.target.querySelector('[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';

            try {
                let shopWorksOrderNumber = null;

                // Handle logo file upload (if provided)
                let logoFile = null;
                const logoInput = document.getElementById('logoUpload');
                if (logoInput.files && logoInput.files[0]) {
                    const file = logoInput.files[0];
                    console.log('[Sample Cart] Processing logo file:', file.name, file.type, file.size);

                    try {
                        const base64Data = await convertFileToBase64(file);
                        logoFile = {
                            fileName: file.name,
                            fileData: base64Data,
                            category: 'reference',  // CHANGED: Sample orders ship BLANK (no decoration)
                            description: 'Customer reference logo (samples ship BLANK)'
                        };
                        console.log('[Sample Cart] ‚úÖ Logo file converted to base64 (reference only)');
                    } catch (error) {
                        console.error('[Sample Cart] ‚ùå Failed to convert logo file:', error);
                        // Continue without logo - don't block order submission
                    }
                }

                // Send to ShopWorks
                if (window.sampleOrderService) {
                    const result = await window.sampleOrderService.submitSampleOrder(
                        customerData,
                        samplesForService,
                        logoFile
                    );

                    if (!result.success) {
                        throw new Error(`ShopWorks submission failed: ${result.error || result.message}`);
                    }

                    shopWorksOrderNumber = result.orderNumber;
                    console.log('[Sample Cart] ‚úÖ Order created in ShopWorks:', shopWorksOrderNumber);
                }

                // Send email notification (using simple template for now)
                const emailData = {
                    to_name: 'Northwest Custom Apparel',
                    from_name: `${firstName} ${lastName}`,
                    from_email: customerData.email,
                    from_phone: customerData.phone,
                    from_company: customerData.company,
                    message: customerData.notes,
                    order_number: shopWorksOrderNumber || 'PENDING',
                    samples: cart.map(item => {
                        const sizes = Object.entries(item.sizes)
                            .filter(([s, q]) => q > 0)
                            .map(([s, q]) => `${s} (${q})`)
                            .join(', ');
                        return `${item.name} (${item.style}) - ${item.color} - Sizes: ${sizes}`;
                    }).join('\n')
                };

                // Try to send email (don't fail if this errors)
                try {
                    await emailjs.send('service_1c4k67j', 'template_sample_request', emailData);
                    console.log('[Sample Cart] ‚úÖ Email notification sent');
                } catch (emailError) {
                    console.warn('[Sample Cart] ‚ö†Ô∏è Email failed but order was created:', emailError);
                }

                // Clear cart
                sessionStorage.removeItem('sampleCart');

                // Show success message
                document.getElementById('cartContainer').style.display = 'none';
                document.getElementById('confirmationId').textContent = shopWorksOrderNumber || 'SR-' + Date.now().toString().slice(-6);
                document.getElementById('successMessage').classList.add('show');

            } catch (error) {
                console.error('[Sample Cart] ‚ùå Error submitting order:', error);
                alert('There was an error submitting your order. Please try again or call us at 253-922-5793.\n\nError: ' + error.message);
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Sample Request';
            }
        });

        // Initialize universal header
        window.universalCartHeader = new UniversalCartHeader({
            isCartPage: true,  // This is the cart page, so don't make it clickable
            showContactInfo: true
        });

        // Load cart on page load
        loadCart();
    </script>
</body>
</html>
