<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Richardson 112 Trucker Hat | Northwest Custom Apparel</title>
    <link rel="icon" href="https://cdn.caspio.com/A0E15000/Safety%20Stripes/NWCA%20Favicon%20for%20TEAMNWCA.com.png?ver=1" type="image/png">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <!-- Cart Drawer Component -->
    <link rel="stylesheet" href="../shared_components/css/cart-drawer.css">
    <script src="../shared_components/js/cart-drawer.js"></script>

    <!-- Sample Order Service for ShopWorks Integration -->
    <script src="../shared_components/js/sample-order-service.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="/shared_components/css/universal-header.css">
    <link rel="stylesheet" href="/pages/top-sellers-product.css">
    <link rel="stylesheet" href="/calculators/richardson-color-selector.css">
    <link rel="stylesheet" href="/pages/richardson-112-product.css">

    <!-- JavaScript -->
    <script src="/calculators/richardson-112-images.js"></script>
    <script src="/calculators/richardson-color-selector-enhancement.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="public-header">
        <div class="header-container">
            <div class="company-branding">
                <a href="/index.html" style="display: flex; align-items: center; gap: 1rem; text-decoration: none;">
                    <img src="https://cdn.caspio.com/A0E15000/Safety%20Stripes/web%20northwest%20custom%20apparel%20logo.png?ver=1"
                         alt="Northwest Custom Apparel"
                         class="company-logo">
                    <div class="company-info">
                        <h1>Northwest Custom Apparel</h1>
                        <div class="company-tagline">Family Owned Since 1977</div>
                    </div>
                </a>
            </div>
            <div class="contact-info">
                <a href="tel:253-922-5793">
                    <i class="fas fa-phone"></i>
                    253-922-5793
                </a>
                <a href="mailto:sales@nwcustomapparel.com">
                    <i class="fas fa-envelope"></i>
                    Contact Sales
                </a>
            </div>
        </div>
    </header>

    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb-nav">
        <nav>
            <a href="/index.html">
                <i class="fas fa-home"></i>
                Home
            </a>
            <span>/</span>
            <a href="/pages/top-sellers-showcase.html">Top Sellers</a>
            <span>/</span>
            <span>Richardson 112</span>
        </nav>
    </div>

    <!-- Back to Best Sellers Button -->
    <div class="back-button-section">
        <div style="max-width: 1400px; margin: 0 auto; padding: 0 2rem;">
            <a href="/pages/top-sellers-showcase.html" class="back-button">
                <i class="fas fa-arrow-left"></i>
                <span>Back to Best Sellers</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <main style="max-width: 1400px; margin: 0 auto; padding: 2rem;">

        <!-- Product Showcase -->
        <div class="product-showcase" style="display: grid; grid-template-columns: 60% 40%; gap: 2rem; margin-bottom: 3rem;">

            <!-- LEFT: Main Image (60%) -->
            <div class="product-image-section" style="position: relative;">
                <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <img id="mainProductImage"
                         src="https://cdnm.sanmar.com/imglib/mresjpg/2025/f29/112_black_hat_detail.jpg"
                         alt="Richardson 112 Trucker Hat"
                         style="width: 100%; height: auto; border-radius: 8px;">
                    <p id="currentColorName" style="text-align: center; margin-top: 1rem; font-size: 1.25rem; font-weight: 600; color: #2c3e50;">Black</p>

                    <!-- Thumbnail Strip -->
                    <div id="thumbnailStrip" class="thumbnail-strip" style="display: flex; justify-content: center; gap: 0.75rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- RIGHT: Product Info (40%) -->
            <div class="product-info-section">

                <!-- Title -->
                <div style="margin-bottom: 1.5rem;">
                    <h1 style="font-size: 2.5rem; font-weight: 700; color: #2c3e50; margin: 0 0 0.5rem 0;">Richardson 112</h1>
                    <p style="font-size: 1.125rem; color: #6b7280; margin: 0;">
                        <i class="fas fa-star" style="color: #fbbf24;"></i>
                        #1 Best Seller - Over 50 Colorways
                    </p>
                    <img src="https://cdn.caspio.com/A0E15000/Safety%20Stripes/richardson-sports-logo-vector.png?ver=1"
                         alt="Richardson Headwear"
                         style="height: 40px; margin-top: 1rem;">
                </div>

                <!-- Color Category Tabs -->
                <div class="color-category-tabs" style="display: flex; gap: 0.5rem; margin: 1.5rem 0; border-bottom: 2px solid #e5e7eb;">
                    <button class="tab active" data-category="Solid" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 3px solid #4cb354; cursor: pointer; font-weight: 600; color: #4cb354; transition: all 0.2s;">
                        Solid (19)
                    </button>
                    <button class="tab" data-category="Split" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: #6b7280; transition: all 0.2s;">
                        Split (28)
                    </button>
                    <button class="tab" data-category="Tri-Color" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: #6b7280; transition: all 0.2s;">
                        Tri-Color (25)
                    </button>
                    <button class="tab" data-category="Combination" style="padding: 0.75rem 1.5rem; background: transparent; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: #6b7280; transition: all 0.2s;">
                        Combination (18)
                    </button>
                </div>

                <!-- Color Grid -->
                <div class="color-grid" id="colorGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); gap: 1rem; margin: 1.5rem 0; max-height: 400px; overflow-y: auto; padding: 0.5rem; background: #f9fafb; border-radius: 8px;">
                    <!-- Dynamically populated -->
                </div>

                <!-- Decoration Method Selection -->
                <div class="decoration-selector" style="margin: 2rem 0; padding: 1rem; background: #f9fafb; border-radius: 8px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Decoration Method:</label>
                    <div class="decoration-options" style="display: flex; gap: 1rem;">
                        <button class="decoration-btn active" data-method="embroidery" style="flex: 1; padding: 0.75rem; border: 2px solid #4cb354; background: #e8f5e9; border-radius: 6px; cursor: pointer; font-weight: 600; color: #4cb354; transition: all 0.2s;">
                            <i class="fas fa-scissors"></i> Embroidery
                        </button>
                        <button class="decoration-btn" data-method="leatherette" style="flex: 1; padding: 0.75rem; border: 2px solid #e5e7eb; background: white; border-radius: 6px; cursor: pointer; font-weight: 600; color: #6b7280; transition: all 0.2s;">
                            <i class="fas fa-leaf"></i> Leatherette Laser Patch
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Product Description -->
        <div class="product-description" style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 3rem;">
            <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 1.5rem; color: #2c3e50;">About the Richardson 112</h2>
            <p style="font-size: 1.125rem; line-height: 1.8; color: #4b5563; margin-bottom: 1.5rem;">
                The 112 is the standard by which all truckers are measured. Popular for its undeniable quality and versatility,
                this casual classic is constructed with the trademark attention to detail that we've built our reputation on.
                With a design shaped by more than 50 years of cap-making expertise and available in over 50 colorways,
                the 112 has inspired many imitations yet continues to be the most popular cap in the USA.
            </p>

            <h3 style="font-size: 1.5rem; font-weight: 600; margin: 2rem 0 1rem; color: #2c3e50;">Features</h3>
            <ul style="list-style: none; padding: 0; margin: 0;">
                <li style="padding: 0.75rem 0; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 1rem;">
                    <i class="fas fa-check-circle" style="color: #4cb354; font-size: 1.25rem;"></i>
                    <span style="font-size: 1rem; color: #4b5563;">Six-panel construction delivers the classic look and feel the 112 is famous for</span>
                </li>
                <li style="padding: 0.75rem 0; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 1rem;">
                    <i class="fas fa-check-circle" style="color: #4cb354; font-size: 1.25rem;"></i>
                    <span style="font-size: 1rem; color: #4b5563;">Premium materials and craftsmanship ensure an ideal fit for all sizes</span>
                </li>
                <li style="padding: 0.75rem 0; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 1rem;">
                    <i class="fas fa-check-circle" style="color: #4cb354; font-size: 1.25rem;"></i>
                    <span style="font-size: 1rem; color: #4b5563;">Standard cotton sweatband provides comfort for all-day wear</span>
                </li>
                <li style="padding: 0.75rem 0; display: flex; align-items: center; gap: 1rem;">
                    <i class="fas fa-check-circle" style="color: #4cb354; font-size: 1.25rem;"></i>
                    <span style="font-size: 1rem; color: #4b5563;">Now available in Extra Large, Small, and Youth sizes</span>
                </li>
            </ul>

            <h3 style="font-size: 1.5rem; font-weight: 600; margin: 2rem 0 1rem; color: #2c3e50;">Decoration Methods</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1rem;">
                <div style="padding: 1.5rem; background: #f9fafb; border-radius: 8px; border: 2px solid #e5e7eb;">
                    <h4 style="display: flex; align-items: center; gap: 0.5rem; font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem; color: #2c3e50;">
                        <i class="fas fa-scissors" style="color: #4cb354;"></i>
                        Embroidery
                    </h4>
                    <p style="font-size: 0.875rem; color: #6b7280; margin: 0;">
                        Classic embroidered decoration with up to 8,000 stitches. Perfect for detailed logos and designs.
                    </p>
                </div>
                <div style="padding: 1.5rem; background: #f9fafb; border-radius: 8px; border: 2px solid #e5e7eb;">
                    <h4 style="display: flex; align-items: center; gap: 0.5rem; font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem; color: #2c3e50;">
                        <i class="fas fa-leaf" style="color: #4cb354;"></i>
                        Leatherette Laser Patch
                    </h4>
                    <p style="font-size: 0.875rem; color: #6b7280; margin: 0;">
                        Premium laser-engraved leatherette patch approximately 2.5" x 1.5". Modern and sophisticated look.
                    </p>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer style="background: #2c3e50; color: white; padding: 2rem; text-align: center; margin-top: 4rem;">
        <p style="margin: 0;">&copy; 2025 Northwest Custom Apparel. All rights reserved.</p>
        <p style="margin: 0.5rem 0 0;">Call us at <a href="tel:253-922-5793" style="color: #4cb354; text-decoration: none;">253-922-5793</a></p>
    </footer>

    <!-- JavaScript -->
    <script>
        // Fetch Richardson 112 colors from SanMar API
        async function fetchRichardson112Colors() {
            console.log('[Richardson 112] Fetching colors from SanMar API...');
            const response = await fetch('https://caspio-pricing-proxy-ab30a049961a.herokuapp.com/api/product-details?styleNumber=112');

            if (!response.ok) {
                throw new Error(`API request failed: ${response.status}`);
            }

            const data = await response.json();
            console.log('[Richardson 112] API returned', data.length, 'records');

            // Deduplicate by COLOR_NAME and categorize by pattern
            const colorMap = new Map();
            data.forEach(item => {
                if (!colorMap.has(item.COLOR_NAME)) {
                    // Determine category based on color name pattern (count "/" separators)
                    let category = 'Solid';
                    const slashCount = (item.COLOR_NAME.match(/\//g) || []).length;

                    if (slashCount === 1) {
                        category = 'Split';
                    } else if (slashCount === 2) {
                        category = 'Tri-Color';
                    } else if (slashCount >= 3) {
                        category = 'Combination';
                    }

                    colorMap.set(item.COLOR_NAME, {
                        style: '112',
                        category: category,
                        color: item.COLOR_NAME,
                        catalogColor: item.CATALOG_COLOR,
                        url: item.FRONT_MODEL || item.FRONT_FLAT || item.PRODUCT_IMAGE,  // Main image
                        swatchUrl: item.COLOR_SQUARE_IMAGE,  // Swatch thumbnail (small image)
                        // All image types for thumbnail gallery
                        images: {
                            'model-front': item.FRONT_MODEL || null,
                            'model-back': item.BACK_MODEL || null,
                            'flat-front': item.FRONT_FLAT || null,
                            'flat-back': item.BACK_FLAT || null
                        }
                    });
                }
            });

            const colors = Array.from(colorMap.values());
            console.log('[Richardson 112] Processed', colors.length, 'unique colors from API');
            return colors;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            console.log('[Richardson 112] Page loaded');

            // State
            let currentCategory = 'Solid';
            let currentDecorationMethod = 'embroidery';
            let colorData = [];
            let selectedColorData = null;  // Track selected color for cart integration
            let availableImages = {};  // Available image types for current color
            let currentImageType = 'model-front';  // Current selected view

            // View labels for thumbnails
            const viewLabels = {
                'model-front': 'Front View',
                'model-back': 'Back View',
                'flat-front': 'Flat Front',
                'flat-back': 'Flat Back'
            };

            // Show loading state
            function showLoading() {
                document.getElementById('colorGrid').innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 2rem;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #4cb354;"></i>
                        <p style="margin-top: 1rem; color: #6b7280;">Loading colors...</p>
                    </div>
                `;
            }

            // Show loading while fetching
            showLoading();

            // Try to fetch from SanMar API first, fallback to hardcoded data
            try {
                colorData = await fetchRichardson112Colors();
                console.log('[Richardson 112] Using SanMar API data');

                // Update tab counts based on actual data
                updateTabCounts(colorData);
            } catch (error) {
                console.warn('[Richardson 112] API fetch failed, falling back to hardcoded data:', error);
                // Use the existing RICHARDSON_112_COLORS from richardson-112-images.js
                if (typeof RICHARDSON_112_COLORS !== 'undefined' && RICHARDSON_112_COLORS.length > 0) {
                    colorData = RICHARDSON_112_COLORS;
                    console.log('[Richardson 112] Using fallback hardcoded data');
                }
            }

            // Store globally for other functions
            window.RICHARDSON_112_COLORS_DATA = colorData;
            window.selectedColorData = selectedColorData;

            // Update tab counts
            function updateTabCounts(colors) {
                const counts = {
                    'Solid': colors.filter(c => c.category === 'Solid').length,
                    'Split': colors.filter(c => c.category === 'Split').length,
                    'Tri-Color': colors.filter(c => c.category === 'Tri-Color').length,
                    'Combination': colors.filter(c => c.category === 'Combination').length
                };

                document.querySelectorAll('.tab').forEach(tab => {
                    const category = tab.dataset.category;
                    if (counts[category] !== undefined) {
                        tab.textContent = `${category} (${counts[category]})`;
                    }
                });
            }

            // Create thumbnails for the current color's available images
            function createThumbnails() {
                const thumbnailStrip = document.getElementById('thumbnailStrip');
                if (!thumbnailStrip) return;

                thumbnailStrip.innerHTML = '';

                // Check if we have any images to show
                const imageTypes = ['model-front', 'model-back', 'flat-front', 'flat-back'];
                const availableViews = imageTypes.filter(type => availableImages[type]);

                if (availableViews.length === 0) {
                    thumbnailStrip.style.display = 'none';
                    return;
                }

                thumbnailStrip.style.display = 'flex';

                availableViews.forEach(viewType => {
                    const thumb = document.createElement('div');
                    thumb.className = 'thumbnail' + (viewType === currentImageType ? ' active' : '');
                    thumb.dataset.viewType = viewType;
                    thumb.title = viewLabels[viewType] || viewType;

                    thumb.innerHTML = `
                        <img src="${availableImages[viewType]}" alt="${viewLabels[viewType] || viewType}" loading="lazy">
                    `;

                    thumb.addEventListener('click', () => selectView(viewType));
                    thumbnailStrip.appendChild(thumb);
                });

                console.log('[Richardson 112] Created', availableViews.length, 'thumbnails');
            }

            // Select a view from the thumbnail strip
            function selectView(viewType) {
                if (!availableImages[viewType]) return;

                currentImageType = viewType;
                document.getElementById('mainProductImage').src = availableImages[viewType];

                // Update active state on thumbnails
                document.querySelectorAll('.thumbnail').forEach(thumb => {
                    thumb.classList.toggle('active', thumb.dataset.viewType === viewType);
                });

                console.log('[Richardson 112] Selected view:', viewType);
            }

            // Make functions globally available
            window.createThumbnails = createThumbnails;
            window.selectView = selectView;

            // Populate color grid for a category
            function populateColorGrid(category) {
                console.log('[Richardson 112] Populating grid for category:', category);
                const filtered = colorData.filter(c => c.category === category);
                const grid = document.getElementById('colorGrid');
                grid.innerHTML = '';

                filtered.forEach(color => {
                    const swatch = document.createElement('div');
                    swatch.className = 'color-swatch';
                    swatch.style.textAlign = 'center';
                    swatch.dataset.catalogColor = color.catalogColor || '';  // Store for inventory
                    swatch.dataset.colorName = color.color;

                    // Use swatchUrl (COLOR_SQUARE_IMAGE) for thumbnail, fall back to main url
                    const thumbnailUrl = color.swatchUrl || color.url;
                    const mainImageUrl = color.url;

                    const img = document.createElement('img');
                    img.src = thumbnailUrl;
                    img.alt = color.color;
                    img.className = 'color-swatch-image';
                    img.style.cssText = 'width: 70px; height: 70px; border-radius: 8px; border: 3px solid transparent; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); object-fit: contain; background: #f9fafb;';

                    img.onmouseover = function() {
                        this.style.borderColor = '#4cb354';
                        this.style.transform = 'scale(1.05)';
                    };
                    img.onmouseout = function() {
                        this.style.borderColor = 'transparent';
                        this.style.transform = 'scale(1)';
                    };
                    img.onerror = function() {
                        this.src = mainImageUrl;
                    };

                    // Click handler - passes full color object with images
                    img.addEventListener('click', function() {
                        selectColorWithImages(color, this);
                    });

                    const label = document.createElement('span');
                    label.style.cssText = 'display: block; font-size: 0.75rem; margin-top: 0.25rem; color: #6b7280;';
                    label.textContent = color.color;

                    swatch.appendChild(img);
                    swatch.appendChild(label);
                    grid.appendChild(swatch);
                });

                console.log('[Richardson 112] Loaded', filtered.length, 'colors for', category);

                // Update main image to first color in category if available
                if (filtered.length > 0) {
                    const firstColor = filtered[0];
                    selectColorWithImages(firstColor, null);
                }
            }

            // Select color with full image data - updates main image, thumbnails, and stores cart data
            function selectColorWithImages(colorObj, clickedElement) {
                const imageUrl = colorObj.url;
                const colorName = colorObj.color;
                const catalogColor = colorObj.catalogColor || '';

                // Update main image
                document.getElementById('mainProductImage').src = imageUrl;
                document.getElementById('currentColorName').textContent = colorName;

                // Store selected color data for cart integration (CRITICAL for inventory checks)
                selectedColorData = {
                    colorName: colorName,
                    catalogColor: catalogColor,  // This is what ShopWorks needs!
                    imageUrl: imageUrl
                };
                window.selectedColorData = selectedColorData;

                // Update available images for thumbnail gallery
                if (colorObj.images) {
                    availableImages = {};
                    Object.keys(colorObj.images).forEach(key => {
                        if (colorObj.images[key]) {
                            availableImages[key] = colorObj.images[key];
                        }
                    });
                } else {
                    // Fallback: only the main image is available
                    availableImages = { 'model-front': imageUrl };
                }

                // Reset to model-front view when changing colors
                currentImageType = 'model-front';

                // Create thumbnails for the new color
                createThumbnails();

                // Update swatch active state
                document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                if (clickedElement) {
                    clickedElement.closest('.color-swatch')?.classList.add('active');
                }

                console.log('[Richardson 112] Selected color:', colorName, '| CATALOG_COLOR:', catalogColor, '| Available views:', Object.keys(availableImages).length);
            }

            // Make function globally available
            window.selectColorWithImages = selectColorWithImages;

            // Legacy function for backward compatibility (simple select without thumbnails)
            window.selectColor = function(imageUrl, colorName, catalogColor, clickedElement) {
                // Find the color in colorData by name to get full object
                const colorObj = colorData.find(c => c.color === colorName);
                if (colorObj) {
                    selectColorWithImages(colorObj, clickedElement);
                } else {
                    // Fallback for colors not found - basic update
                    document.getElementById('mainProductImage').src = imageUrl;
                    document.getElementById('currentColorName').textContent = colorName;
                    availableImages = { 'model-front': imageUrl };
                    createThumbnails();
                }
            };

            // Legacy function for backward compatibility
            window.updateMainImage = function(imageUrl, colorName) {
                selectColor(imageUrl, colorName, '', null);
            };

            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active from all tabs
                    document.querySelectorAll('.tab').forEach(t => {
                        t.style.borderBottomColor = 'transparent';
                        t.style.color = '#6b7280';
                        t.classList.remove('active');
                    });

                    // Add active to clicked tab
                    tab.style.borderBottomColor = '#4cb354';
                    tab.style.color = '#4cb354';
                    tab.classList.add('active');

                    currentCategory = tab.dataset.category;
                    populateColorGrid(currentCategory);

                    console.log('[Richardson 112] Switched to category:', currentCategory);
                });
            });

            // Decoration method switching (visual only)
            document.querySelectorAll('.decoration-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active from all buttons
                    document.querySelectorAll('.decoration-btn').forEach(b => {
                        b.style.borderColor = '#e5e7eb';
                        b.style.background = 'white';
                        b.style.color = '#6b7280';
                        b.classList.remove('active');
                    });

                    // Add active to clicked button
                    btn.style.borderColor = '#4cb354';
                    btn.style.background = '#e8f5e9';
                    btn.style.color = '#4cb354';
                    btn.classList.add('active');

                    currentDecorationMethod = btn.dataset.method;
                    console.log('[Richardson 112] Selected decoration method:', currentDecorationMethod);
                });
            });

            // Request quote function
            function requestQuote() {
                const subject = 'Quote Request: Richardson 112 Trucker Hat';
                const decorationMethod = currentDecorationMethod === 'embroidery' ? 'Embroidery' : 'Leatherette Laser Patch';
                const body = `Hello,\n\nI'm interested in getting a custom quote for:\n\nProduct: Richardson 112 Trucker Hat\nDecoration Method: ${decorationMethod}\n\nPlease provide pricing for custom decoration.\n\nThank you!`;

                window.location.href = `mailto:sales@nwcustomapparel.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            }

            // Make requestQuote available globally
            window.requestQuote = requestQuote;

            // Initial load
            if (colorData.length > 0) {
                populateColorGrid('Solid');
                console.log('[Richardson 112] Initialization complete with', colorData.length, 'colors');
            } else {
                console.error('[Richardson 112] No color data available');
                document.getElementById('colorGrid').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #6b7280;">
                        <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                        Unable to load colors. Please refresh the page or call us at 253-922-5793.
                    </div>
                `;
            }
        });
    </script>

    <!-- Sample Cart Functionality -->
    <script>
        // Embedded sample cart functionality
        class SampleCart {
            constructor() {
                this.maxSamples = null; // No hard limit - 3 samples recommended for best experience

                // Load cart with backward compatibility
                const cartData = sessionStorage.getItem('sampleCart');
                if (cartData) {
                    try {
                        const parsed = JSON.parse(cartData);
                        // New format: {samples: [...]}
                        // Old format: [...]
                        this.samples = Array.isArray(parsed) ? parsed : (parsed.samples || []);
                    } catch (e) {
                        console.error('[SampleCart] Error parsing cart data:', e);
                        this.samples = [];
                    }
                } else {
                    this.samples = [];
                }

                this.eligibilityCache = {};
                this.apiBase = 'https://caspio-pricing-proxy-ab30a049961a.herokuapp.com';
                this.initializeUI();
                this.bindEvents();
            }

            initializeUI() {
                if (!document.getElementById('sampleCartWidget')) {
                    const widget = document.createElement('div');
                    widget.id = 'sampleCartWidget';
                    widget.className = 'sample-cart-widget';
                    widget.setAttribute('role', 'button');
                    widget.setAttribute('tabindex', '0');
                    widget.innerHTML = `
                        <div class="sample-cart-icon">
                            <i class="fas fa-box-open"></i>
                            <span class="sample-count-badge">${this.samples.length}</span>
                        </div>
                        <span class="sample-cart-label">Sample Cart</span>
                    `;

                    // Add to header's contact-info section (top-right position)
                    const contactInfo = document.querySelector('.contact-info');
                    if (contactInfo) {
                        contactInfo.appendChild(widget);
                    } else {
                        // Fallback: add to body if header not found
                        document.body.appendChild(widget);
                    }
                }
                this.updateUI();
            }

            bindEvents() {
                const widget = document.getElementById('sampleCartWidget');
                if (widget) {
                    // Click handler
                    widget.addEventListener('click', () => {
                        if (window.cartDrawer) {
                            window.cartDrawer.open();
                        }
                    });

                    // Keyboard support (Enter/Space)
                    widget.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            if (window.cartDrawer) {
                                window.cartDrawer.open();
                            }
                        }
                    });
                }

                // Listen for storage events (cart updates from other tabs)
                window.addEventListener('storage', (e) => {
                    if (e.key === 'sampleCart') {
                        this.loadCart();
                        this.updateUI();
                    }
                });
            }

            loadCart() {
                const cartData = sessionStorage.getItem('sampleCart');
                if (cartData) {
                    try {
                        const parsed = JSON.parse(cartData);
                        this.samples = Array.isArray(parsed) ? parsed : (parsed.samples || []);
                    } catch (e) {
                        this.samples = [];
                    }
                } else {
                    this.samples = [];
                }
            }

            updateUI() {
                const widget = document.getElementById('sampleCartWidget');
                if (!widget) return;

                const badge = widget.querySelector('.sample-count-badge');
                if (badge) {
                    badge.textContent = this.samples.length;
                }

                // Show/hide widget based on cart contents
                if (this.samples.length > 0) {
                    widget.style.display = 'flex';
                } else {
                    widget.style.display = 'none';
                }
            }
        }

        // Initialize sample cart when DOM is ready
        let sampleCart = null;
        document.addEventListener('DOMContentLoaded', function() {
            sampleCart = new SampleCart();
            window.sampleCart = sampleCart; // Make globally accessible
        });
    </script>
</body>
</html>
