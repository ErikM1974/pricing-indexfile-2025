<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 1 Verification Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #003f7f;
            border-bottom: 2px solid #003f7f;
            padding-bottom: 10px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-card h3 {
            color: #003f7f;
            margin-top: 0;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
        .status.pass {
            background: #d4edda;
            color: #155724;
        }
        .status.fail {
            background: #f8d7da;
            color: #721c24;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:before {
            content: "‚úì ";
            color: #28a745;
            font-weight: bold;
        }
        .feature-list li.missing:before {
            content: "‚úó ";
            color: #dc3545;
        }
        button {
            background: #003f7f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #002855;
        }
        .summary {
            background: #f8f9fa;
            border-left: 4px solid #003f7f;
            padding: 15px;
            margin: 20px 0;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîç Phase 1 Infrastructure Verification</h1>
    
    <div class="summary">
        <h2>Test Summary</h2>
        <p>This page verifies that all Phase 1 features are properly implemented in each quote builder.</p>
        <p><strong>Expected Features:</strong></p>
        <ul>
            <li>‚úÖ Inline fallback classes (QuoteBuilderBase & QuoteFormatter)</li>
            <li>‚úÖ Cache-busting version parameters on all infrastructure files</li>
            <li>‚úÖ Print/Copy/Email buttons in success modal</li>
            <li>‚úÖ Standardized sales rep list (no Taylar, includes Taneisha)</li>
            <li>‚úÖ Save to database checkbox</li>
            <li>‚úÖ Console logging for debugging</li>
        </ul>
    </div>

    <div class="test-grid" id="test-results"></div>

    <h2>Live Testing</h2>
    <div>
        <button onclick="testDTG()">Test DTG Quote Builder</button>
        <button onclick="testEmbroidery()">Test Embroidery Quote Builder</button>
        <button onclick="testCap()">Test Cap Embroidery Quote Builder</button>
        <button onclick="testScreenPrint()">Test Screen Print Quote Builder</button>
        <button onclick="runAllTests()">Run All Tests</button>
    </div>

    <div id="iframe-container"></div>

    <script>
        const quoteBuilders = [
            {
                name: 'DTG Quote Builder',
                file: 'dtg-quote-builder.html',
                prefix: 'DTG'
            },
            {
                name: 'Embroidery Quote Builder',
                file: 'embroidery-quote-builder.html',
                prefix: 'EMB'
            },
            {
                name: 'Cap Embroidery Quote Builder',
                file: 'cap-embroidery-quote-builder.html',
                prefix: 'CAPEMB'
            },
            {
                name: 'Screen Print Quote Builder',
                file: 'screenprint-quote-builder.html',
                prefix: 'SP'
            }
        ];

        async function verifyQuoteBuilder(builder) {
            console.log(`üîç Verifying ${builder.name}...`);
            
            try {
                const response = await fetch(builder.file);
                const html = await response.text();
                
                const features = {
                    inlineFallback: html.includes('if (typeof QuoteBuilderBase === \'undefined\')'),
                    cacheBusting: html.includes('?v=20250911'),
                    printButton: html.includes('printQuote()') || html.includes('Print Quote'),
                    copyButton: html.includes('copyQuote()') || html.includes('Copy Quote'),
                    emailButton: html.includes('emailQuote()') || html.includes('Email Quote'),
                    noTaylar: !html.includes('taylar@nwcustomapparel.com'),
                    hasTaneisha: html.includes('taneisha@nwcustomapparel.com'),
                    saveToDb: html.includes('save-to-database') || html.includes('saveToDatabase'),
                    consoleLogging: html.includes('console.log('),
                    correctPrefix: html.includes(`prefix: '${builder.prefix}'`)
                };
                
                const allPass = Object.values(features).every(v => v);
                
                return {
                    name: builder.name,
                    features,
                    status: allPass ? 'pass' : (Object.values(features).filter(v => v).length > 5 ? 'warning' : 'fail')
                };
                
            } catch (error) {
                console.error(`Error verifying ${builder.name}:`, error);
                return {
                    name: builder.name,
                    features: {},
                    status: 'fail',
                    error: error.message
                };
            }
        }

        async function runAllTests() {
            const container = document.getElementById('test-results');
            container.innerHTML = '<p>Running tests...</p>';
            
            const results = await Promise.all(quoteBuilders.map(verifyQuoteBuilder));
            
            container.innerHTML = '';
            
            results.forEach(result => {
                const card = document.createElement('div');
                card.className = 'test-card';
                
                const statusClass = result.status;
                const statusText = result.status === 'pass' ? '‚úÖ PASS' : 
                                  result.status === 'warning' ? '‚ö†Ô∏è PARTIAL' : '‚ùå FAIL';
                
                card.innerHTML = `
                    <h3>${result.name}</h3>
                    <div class="status ${statusClass}">${statusText}</div>
                    ${result.error ? `<p style="color: red;">Error: ${result.error}</p>` : ''}
                    <ul class="feature-list">
                        ${result.features.inlineFallback ? '<li>Inline fallback classes</li>' : '<li class="missing">Inline fallback classes</li>'}
                        ${result.features.cacheBusting ? '<li>Cache busting versions</li>' : '<li class="missing">Cache busting versions</li>'}
                        ${result.features.printButton ? '<li>Print button</li>' : '<li class="missing">Print button</li>'}
                        ${result.features.copyButton ? '<li>Copy button</li>' : '<li class="missing">Copy button</li>'}
                        ${result.features.emailButton ? '<li>Email button</li>' : '<li class="missing">Email button</li>'}
                        ${result.features.noTaylar ? '<li>Taylar removed</li>' : '<li class="missing">Taylar still present</li>'}
                        ${result.features.hasTaneisha ? '<li>Taneisha included</li>' : '<li class="missing">Taneisha missing</li>'}
                        ${result.features.saveToDb ? '<li>Save to database option</li>' : '<li class="missing">Save to database option</li>'}
                        ${result.features.consoleLogging ? '<li>Console logging</li>' : '<li class="missing">Console logging</li>'}
                        ${result.features.correctPrefix ? '<li>Correct prefix (${result.name.includes('DTG') ? 'DTG' : result.name.includes('Cap') ? 'CAPEMB' : result.name.includes('Embroidery') ? 'EMB' : 'SP'})</li>' : '<li class="missing">Incorrect prefix</li>'}
                    </ul>
                `;
                
                container.appendChild(card);
            });
            
            // Summary
            const passCount = results.filter(r => r.status === 'pass').length;
            const summary = document.createElement('div');
            summary.className = 'summary';
            summary.style.marginTop = '20px';
            summary.innerHTML = `
                <h3>Overall Results</h3>
                <p><strong>${passCount} of ${results.length}</strong> quote builders passed all tests.</p>
                ${passCount === results.length ? 
                    '<p style="color: green;">‚úÖ All Phase 1 features are properly implemented!</p>' :
                    '<p style="color: orange;">‚ö†Ô∏è Some features may need attention. Check individual results above.</p>'
                }
            `;
            container.appendChild(summary);
        }

        function testDTG() {
            loadQuoteBuilder('dtg-quote-builder.html');
        }

        function testEmbroidery() {
            loadQuoteBuilder('embroidery-quote-builder.html');
        }

        function testCap() {
            loadQuoteBuilder('cap-embroidery-quote-builder.html');
        }

        function testScreenPrint() {
            loadQuoteBuilder('screenprint-quote-builder.html');
        }

        function loadQuoteBuilder(file) {
            const container = document.getElementById('iframe-container');
            container.innerHTML = `
                <h3>Testing: ${file}</h3>
                <p>Open browser console (F12) to see initialization messages.</p>
                <iframe src="${file}" id="test-iframe"></iframe>
                <button onclick="document.getElementById('test-iframe').contentWindow.location.reload()">Reload Frame</button>
                <button onclick="checkIframeConsole()">Check Console Output</button>
            `;
        }

        function checkIframeConsole() {
            const iframe = document.getElementById('test-iframe');
            if (iframe && iframe.contentWindow) {
                // Try to access console output
                try {
                    console.log('Checking iframe for Phase 1 features...');
                    const win = iframe.contentWindow;
                    
                    console.log('QuoteBuilderBase:', typeof win.QuoteBuilderBase);
                    console.log('QuoteFormatter:', typeof win.QuoteFormatter);
                    console.log('quoteBuilderBase instance:', win.quoteBuilderBase);
                    console.log('quoteFormatter instance:', win.quoteFormatter);
                    
                    if (win.quoteBuilderBase) {
                        win.quoteBuilderBase.showSuccess('Test toast notification!');
                    }
                } catch (e) {
                    console.error('Cannot access iframe:', e);
                }
            }
        }

        // Run tests on load
        window.addEventListener('load', () => {
            runAllTests();
        });
    </script>
</body>
</html>