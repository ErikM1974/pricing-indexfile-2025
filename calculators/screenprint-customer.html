<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Customer Supplied Screen Print Calculator - Northwest Custom Apparel</title>
    <link rel="icon" href="https://cdn.caspio.com/A0E15000/Safety%20Stripes/NWCA%20Favicon%20for%20TEAMNWCA.com.png?ver=1" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- Customer Screen Print Quote Service -->
    <script src="screenprint-customer-quote-service.js"></script>
    
    <style>
        /* Root variables - NWCA Green Theme */
        :root {
            --primary-color: #4cb354; /* NWCA Green */
            --primary-dark: #409a47;
            --primary-light: #5bc85f;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --hover-bg: #f3f4f6;
            --success-bg: #d1fae5;
            --success-text: #065f46;
            --warning-bg: #fef3c7;
            --warning-text: #92400e;
            --focus-shadow: 0 0 0 0.25rem rgba(76, 179, 84, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo {
            height: 40px;
            width: auto;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: var(--primary-dark);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Section styling */
        .section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .section h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        /* Calculator grid */
        .calculator-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 800px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Form elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.2s;
            background-color: #fff;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: var(--focus-shadow);
        }

        /* Input grid */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        /* Switch styles */
        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #f0fdf4;
            padding: 12px;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* Results section */
        .results-section {
            background-color: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .results-section h3 {
            margin-top: 0;
            font-size: 20px;
            font-weight: 600;
        }

        .price-display {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary-color);
            margin: 1rem 0;
        }

        .price-display.prompt {
            font-size: 18px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .price-display-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: -1rem;
            margin-bottom: 1.5rem;
        }

        /* Order summary */
        .order-summary {
            text-align: left;
            font-size: 14px;
            margin-top: 1.5rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-top: 1px solid #dcfce7;
            font-size: 16px;
        }

        .summary-item.total {
            font-weight: bold;
            font-size: 18px;
            border-top: 2px solid #bbf7d0;
        }

        /* Notice section */
        .notice-section {
            padding: 1.5rem;
            background-color: #fffbeb;
            border: 1px solid #fde68a;
            border-radius: 8px;
            color: #b45309;
        }

        .notice-section h2 {
            color: #92400e;
            margin-top: 0;
        }

        .notice-section p {
            margin: 0 0 10px 0;
            line-height: 1.6;
            font-size: 14px;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--hover-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        /* Quote button */
        .quote-actions {
            margin-top: 1.5rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-overlay.active {
            display: block;
        }

        .modal-content {
            background: white;
            max-width: 600px;
            margin: 50px auto;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            background: var(--bg-color);
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            padding: 1.5rem;
            background: var(--bg-color);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Form grid in modal */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        /* Checkbox group */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-input {
            width: 1.25rem;
            height: 1.25rem;
            cursor: pointer;
        }

        /* Quote preview */
        .quote-preview {
            background: var(--bg-color);
            padding: 1.5rem;
            border-radius: 6px;
            margin-top: 1.5rem;
        }

        .quote-preview table {
            width: 100%;
            border-collapse: collapse;
        }

        .quote-preview th {
            background: var(--primary-color);
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 500;
        }

        .quote-preview td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        /* Success modal specific */
        .modal-header.success {
            background: var(--success-bg);
            text-align: center;
        }

        .success-icon {
            font-size: 3rem;
            color: var(--success-text);
        }

        .quote-id-display {
            background: var(--bg-color);
            padding: 1.5rem;
            border-radius: 6px;
            margin: 1.5rem 0;
        }

        .quote-id-display .quote-id {
            font-family: monospace;
            font-size: 1.125rem;
            font-weight: 600;
        }

        /* Loading state */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }
            
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block !important;
            }
            
            .section {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        /* Safety stripes specific */
        .safety-notice {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            color: #92400e;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header no-print">
        <div class="header-container">
            <div class="header-left">
                <img src="https://cdn.caspio.com/A0E15000/Safety%20Stripes/web%20northwest%20custom%20apparel%20logo.png?ver=1" 
                     alt="Northwest Custom Apparel" class="logo">
            </div>
            <nav class="breadcrumb">
                <a href="/staff-dashboard.html">Staff Dashboard</a>
                <span>/</span>
                <span>Customer Supplied Screen Print</span>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <div class="section">
            <h2>Customer Supplied Screen Print Calculator</h2>
            <div class="calculator-grid">
                <div class="input-section">
                    <div class="form-group">
                        <label for="quantity" class="form-label">Quantity</label>
                        <input type="number" id="quantity" class="form-control" placeholder="Minimum 24" min="24">
                    </div>
                    
                    <div class="input-grid">
                        <div class="form-group">
                            <label for="frontColors" class="form-label">Front Print Colors</label>
                            <select id="frontColors" class="form-control">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="backColors" class="form-label">Back Print Colors</label>
                            <select id="backColors" class="form-control">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                        </div>
                    </div>

                    <div class="switch-container">
                        <label for="darkShirtToggle">Dark Garment? (Adds white base)</label>
                        <label class="switch">
                            <input type="checkbox" id="darkShirtToggle">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="switch-container">
                        <label for="safetyStripesToggle">Safety Stripes? (Pocket/Shoulder)</label>
                        <label class="switch">
                            <input type="checkbox" id="safetyStripesToggle">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div id="safetyStripesNotice" class="safety-notice" style="display: none;">
                        <strong>Safety Stripes:</strong> Available in pocket or shoulder placement. Contact sales for specific requirements.
                    </div>
                </div>

                <div class="results-section">
                    <h3>Your Quote</h3>
                    <div class="price-display prompt" id="priceDisplay">Enter Details</div>
                    <div class="price-display-label">Price per Shirt</div>
                    <hr style="border:none; border-top:1px solid #bbf7d0; margin: 1.5rem 0;">
                    <div class="order-summary" id="orderSummary"></div>
                    <div class="quote-actions" id="quoteActions" style="display: none;">
                        <button type="button" class="btn btn-secondary" onclick="window.print()">
                            <i class="fas fa-print"></i>
                            Print Quote
                        </button>
                        <button type="button" class="btn btn-primary" id="sendQuoteBtn">
                            <i class="fas fa-paper-plane"></i>
                            Send Quote
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="notice-section">
            <h2>Important Notice: Customer Supplied Garments</h2>
            <p>Northwest Custom Apparel is not responsible for the damage of ANY customer supplied garments. Should items be damaged while in our facility, we will NOT reimburse you for their value or replace them. Please sign our garment waiver form upon drop-off.</p>
        </div>
    </main>

    <!-- Quote Modal -->
    <div class="modal-overlay" id="quoteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Send Screen Print Quote</h3>
            </div>
            <div class="modal-body">
                <form id="quoteForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Customer Name <span style="color: red;">*</span></label>
                            <input type="text" class="form-control" id="customerName" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email <span style="color: red;">*</span></label>
                            <input type="email" class="form-control" id="customerEmail" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Phone (Optional)</label>
                            <input type="tel" class="form-control" id="customerPhone" placeholder="(555) 123-4567">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Company (Optional)</label>
                            <input type="text" class="form-control" id="companyName">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Project Name (Optional)</label>
                        <input type="text" class="form-control" id="projectName" placeholder="Project or order description">
                    </div>


                    <div class="form-group">
                        <label class="form-label">Sales Representative <span style="color: red;">*</span></label>
                        <select class="form-control" id="salesRep" required>
                            <option value="sales@nwcustomapparel.com">General Sales</option>
                            <option value="ruth@nwcustomapparel.com">Ruth Nhong</option>
                            <option value="taylar@nwcustomapparel.com">Taylar</option>
                            <option value="nika@nwcustomapparel.com">Nika</option>
                            <option value="erik@nwcustomapparel.com">Erik</option>
                            <option value="adriyella@nwcustomapparel.com">Adriyella</option>
                            <option value="bradley@nwcustomapparel.com">Bradley</option>
                            <option value="jim@nwcustomapparel.com">Jim</option>
                            <option value="art@nwcustomapparel.com">Steve (Artist)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notes (Optional)</label>
                        <textarea class="form-control" id="notes" rows="3" placeholder="Special instructions or notes"></textarea>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="saveToDatabase" checked>
                        <label for="saveToDatabase">Save quote to database</label>
                    </div>

                    <div class="quote-preview" id="quotePreview"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeQuoteModal()">Cancel</button>
                <button type="submit" form="quoteForm" class="btn btn-primary" id="submitQuoteBtn">
                    <i class="fas fa-paper-plane"></i>
                    Send Quote
                </button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-content">
            <div class="modal-header success">
                <i class="fas fa-check-circle success-icon"></i>
                <h2 style="color: var(--success-text); margin-top: 1rem;">Quote Sent Successfully!</h2>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <p style="font-size: 1.125rem; color: var(--text-secondary); margin-bottom: 1rem;">
                        Your quote has been sent to:
                    </p>
                    <p style="font-weight: 600;" id="modalCustomerName"></p>
                    <p style="color: var(--text-secondary);" id="modalCustomerEmail"></p>
                </div>
                
                <div class="quote-id-display">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span style="font-weight: 600;">Quote ID:</span>
                        <span class="quote-id" id="modalQuoteId"></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600;">Total Amount:</span>
                        <span style="font-size: 1.25rem; color: var(--primary-color); font-weight: 600;" id="modalTotalAmount"></span>
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <button type="button" class="btn btn-secondary" onclick="copyQuoteId()">
                        <i class="fas fa-copy"></i>
                        Copy Quote ID
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="printQuote()">
                    <i class="fas fa-print"></i>
                    Print Quote
                </button>
                <button type="button" class="btn btn-primary" onclick="closeSuccessModal()">
                    <i class="fas fa-check"></i>
                    Done
                </button>
            </div>
        </div>
    </div>

    <script>
        // Customer Supplied Screen Print Calculator
        class CustomerScreenPrintCalculator {
            constructor() {
                // Configuration
                this.SCREEN_FEE_PER_COLOR = 30.00;
                this.LTM_FEE = 100.00;
                this.MINIMUM_QUANTITY = 24;
                
                // Retail pricing tiers
                this.RETAIL_PRINT_PRICING = {
                    "24-71":   [null, 6.25, 8.00, 10.00, 11.75, 13.75, 15.50],
                    "72-143":  [null, 3.25, 4.00, 4.75, 5.50, 6.25, 7.00],
                    "144-287": [null, 2.50, 3.00, 3.75, 4.25, 5.00, 5.50],
                    "288-499": [null, 2.00, 2.50, 2.75, 3.25, 3.50, 4.00],
                    "500+":    [null, 1.75, 2.00, 2.25, 2.50, 2.75, 3.00],
                };

                // Initialize elements
                this.initializeElements();
                
                // Initialize EmailJS
                emailjs.init('4qSbDO-SQs19TbP80');
                this.emailConfig = {
                    serviceId: 'service_1c4k67j',
                    templateId: 'template_igd6jtm'
                };
                
                // Initialize quote service
                this.quoteService = new CustomerScreenPrintQuoteService();
                
                // Store current calculation
                this.currentCalculation = null;
                this.lastQuoteData = null;
                
                // Attach event listeners
                this.attachEventListeners();
                
                // Initial display
                this.resetDisplay("Enter Details");
            }

            initializeElements() {
                // Calculator inputs
                this.quantity = document.getElementById('quantity');
                this.frontColors = document.getElementById('frontColors');
                this.backColors = document.getElementById('backColors');
                this.darkShirtToggle = document.getElementById('darkShirtToggle');
                this.safetyStripesToggle = document.getElementById('safetyStripesToggle');
                this.safetyStripesNotice = document.getElementById('safetyStripesNotice');
                
                // Display elements
                this.priceDisplay = document.getElementById('priceDisplay');
                this.orderSummary = document.getElementById('orderSummary');
                this.quoteActions = document.getElementById('quoteActions');
                
                // Quote form elements
                this.quoteForm = document.getElementById('quoteForm');
                this.customerName = document.getElementById('customerName');
                this.customerEmail = document.getElementById('customerEmail');
                this.customerPhone = document.getElementById('customerPhone');
                this.companyName = document.getElementById('companyName');
                this.projectName = document.getElementById('projectName');
                this.salesRep = document.getElementById('salesRep');
                this.notes = document.getElementById('notes');
                this.saveToDatabase = document.getElementById('saveToDatabase');
                this.quotePreview = document.getElementById('quotePreview');
                
                // Buttons
                this.sendQuoteBtn = document.getElementById('sendQuoteBtn');
                this.submitQuoteBtn = document.getElementById('submitQuoteBtn');
            }

            attachEventListeners() {
                // Calculator inputs
                this.quantity.addEventListener('input', () => this.calculatePrice());
                this.frontColors.addEventListener('change', () => this.calculatePrice());
                this.backColors.addEventListener('change', () => this.calculatePrice());
                this.darkShirtToggle.addEventListener('change', () => this.calculatePrice());
                this.safetyStripesToggle.addEventListener('change', () => {
                    this.safetyStripesNotice.style.display = this.safetyStripesToggle.checked ? 'block' : 'none';
                    this.calculatePrice();
                });
                
                // Quote form
                this.sendQuoteBtn.addEventListener('click', () => this.openQuoteModal());
                this.quoteForm.addEventListener('submit', (e) => this.handleQuoteSubmit(e));
            }

            getPriceTier(quantity) {
                if (quantity >= 500) return "500+";
                if (quantity >= 288) return "288-499";
                if (quantity >= 144) return "144-287";
                if (quantity >= 72) return "72-143";
                if (quantity >= 24) return "24-71";
                return null;
            }

            calculatePrice() {
                const quantity = parseInt(this.quantity.value) || 0;
                const frontColors = parseInt(this.frontColors.value);
                const backColors = parseInt(this.backColors.value);
                const isDarkShirt = this.darkShirtToggle.checked;
                const hasSafetyStripes = this.safetyStripesToggle.checked;

                if (quantity === 0) {
                    this.resetDisplay("Enter Quantity");
                    return;
                }
                if (quantity < this.MINIMUM_QUANTITY) {
                    this.resetDisplay(`Min ${this.MINIMUM_QUANTITY} pieces`);
                    return;
                }
                if (frontColors === 0 && backColors === 0) {
                    this.resetDisplay("Select Colors");
                    return;
                }

                const priceTier = this.getPriceTier(quantity);
                if (!priceTier) {
                    this.resetDisplay("Invalid quantity");
                    return;
                }

                let ltmFeeTotal = 0;
                if (quantity >= 24 && quantity < 72) {
                    ltmFeeTotal = this.LTM_FEE;
                }
                
                let effectiveFrontColors = frontColors;
                if (isDarkShirt && frontColors > 0) {
                    effectiveFrontColors++;
                }

                const frontPrintCost = (frontColors > 0) ? (this.RETAIL_PRINT_PRICING[priceTier][effectiveFrontColors] || 0) : 0;
                const backPrintCost = (backColors > 0) ? (this.RETAIL_PRINT_PRICING[priceTier][backColors] || 0) : 0;
                
                let pricePerShirt = frontPrintCost + backPrintCost;

                // Add safety stripes cost if selected
                let safetyStripesCost = 0;
                if (hasSafetyStripes) {
                    safetyStripesCost = 2.00; // $2 per shirt for safety stripes
                    pricePerShirt += safetyStripesCost;
                }

                // Round the final price per shirt UP to the nearest dollar
                pricePerShirt = Math.ceil(pricePerShirt);
                
                const totalScreenColors = effectiveFrontColors + backColors;
                const totalSetupFee = totalScreenColors * this.SCREEN_FEE_PER_COLOR;
                
                const orderSubtotal = pricePerShirt * quantity;
                const finalTotal = orderSubtotal + totalSetupFee + ltmFeeTotal;

                // Store current calculation
                this.currentCalculation = {
                    quantity,
                    frontColors,
                    backColors,
                    effectiveFrontColors,
                    isDarkShirt,
                    hasSafetyStripes,
                    pricePerShirt,
                    totalScreenColors,
                    totalSetupFee,
                    ltmFeeTotal,
                    orderSubtotal,
                    finalTotal,
                    priceTier
                };

                // Update display
                this.priceDisplay.classList.remove('prompt');
                this.priceDisplay.textContent = `$${pricePerShirt.toFixed(2)}`;
                
                let summaryHtml = `
                    <div class="summary-item">
                        <span>Subtotal (${quantity} prints)</span>
                        <strong>$${orderSubtotal.toFixed(2)}</strong>
                    </div>`;
                
                if (ltmFeeTotal > 0) {
                    summaryHtml += `
                    <div class="summary-item">
                        <span>LTM Fee</span>
                        <strong>$${ltmFeeTotal.toFixed(2)}</strong>
                    </div>`;
                }
                
                summaryHtml += `
                    <div class="summary-item">
                        <span>Setup Fee (${totalScreenColors} screens)</span>
                        <strong>$${totalSetupFee.toFixed(2)}</strong>
                    </div>
                    <div class="summary-item total">
                        <span>Total Order Cost</span>
                        <strong>$${finalTotal.toFixed(2)}</strong>
                    </div>`;
                
                this.orderSummary.innerHTML = summaryHtml;
                this.quoteActions.style.display = 'flex';
            }

            resetDisplay(promptText) {
                this.priceDisplay.textContent = promptText;
                this.priceDisplay.classList.add('prompt');
                this.orderSummary.innerHTML = '';
                this.quoteActions.style.display = 'none';
                this.currentCalculation = null;
            }

            openQuoteModal() {
                if (!this.currentCalculation) return;
                
                // Update quote preview
                this.updateQuotePreview();
                
                // Show modal
                document.getElementById('quoteModal').classList.add('active');
            }

            updateQuotePreview() {
                if (!this.currentCalculation) return;
                
                const calc = this.currentCalculation;
                let previewHtml = `
                    <h4 style="margin-top: 0;">Quote Summary</h4>
                    <table style="width: 100%;">
                        <tr>
                            <th style="background: var(--primary-color); color: white; padding: 8px;">Description</th>
                            <th style="background: var(--primary-color); color: white; padding: 8px; text-align: center;">Qty</th>
                            <th style="background: var(--primary-color); color: white; padding: 8px; text-align: right;">Price</th>
                            <th style="background: var(--primary-color); color: white; padding: 8px; text-align: right;">Total</th>
                        </tr>`;
                
                // Show front print if applicable
                if (calc.frontColors > 0) {
                    const frontCost = this.RETAIL_PRINT_PRICING[calc.priceTier][calc.effectiveFrontColors] || 0;
                    previewHtml += `
                        <tr>
                            <td style="padding: 8px;">Front Print - ${calc.effectiveFrontColors} color${calc.effectiveFrontColors > 1 ? 's' : ''}${calc.isDarkShirt && calc.frontColors > 0 ? ' (includes white base)' : ''}</td>
                            <td style="padding: 8px; text-align: center;">${calc.quantity}</td>
                            <td style="padding: 8px; text-align: right;">$${frontCost.toFixed(2)}</td>
                            <td style="padding: 8px; text-align: right;">$${(frontCost * calc.quantity).toFixed(2)}</td>
                        </tr>`;
                }
                
                // Show back print if applicable
                if (calc.backColors > 0) {
                    const backCost = this.RETAIL_PRINT_PRICING[calc.priceTier][calc.backColors] || 0;
                    previewHtml += `
                        <tr>
                            <td style="padding: 8px;">Back Print - ${calc.backColors} color${calc.backColors > 1 ? 's' : ''}</td>
                            <td style="padding: 8px; text-align: center;">${calc.quantity}</td>
                            <td style="padding: 8px; text-align: right;">$${backCost.toFixed(2)}</td>
                            <td style="padding: 8px; text-align: right;">$${(backCost * calc.quantity).toFixed(2)}</td>
                        </tr>`;
                }
                
                // Show safety stripes if applicable
                if (calc.hasSafetyStripes) {
                    previewHtml += `
                        <tr>
                            <td style="padding: 8px;">Safety Stripes</td>
                            <td style="padding: 8px; text-align: center;">${calc.quantity}</td>
                            <td style="padding: 8px; text-align: right;">$2.00</td>
                            <td style="padding: 8px; text-align: right;">$${(2.00 * calc.quantity).toFixed(2)}</td>
                        </tr>`;
                }
                
                if (calc.ltmFeeTotal > 0) {
                    previewHtml += `
                        <tr>
                            <td style="padding: 8px;" colspan="3">Less Than Minimum Fee</td>
                            <td style="padding: 8px; text-align: right;">$${calc.ltmFeeTotal.toFixed(2)}</td>
                        </tr>`;
                }
                
                previewHtml += `
                        <tr>
                            <td style="padding: 8px;" colspan="3">Setup Fee (${calc.totalScreenColors} screens @ $${this.SCREEN_FEE_PER_COLOR})</td>
                            <td style="padding: 8px; text-align: right;">$${calc.totalSetupFee.toFixed(2)}</td>
                        </tr>
                        <tr style="font-weight: bold; border-top: 2px solid var(--primary-color);">
                            <td style="padding: 8px;" colspan="3">Total</td>
                            <td style="padding: 8px; text-align: right;">$${calc.finalTotal.toFixed(2)}</td>
                        </tr>
                    </table>`;
                
                this.quotePreview.innerHTML = previewHtml;
            }

            async handleQuoteSubmit(e) {
                e.preventDefault();
                
                if (!this.validateQuoteForm()) return;
                if (!this.currentCalculation) return;
                
                try {
                    this.showLoading();
                    
                    // Build quote data
                    const quoteData = {
                        // Customer info
                        customerName: this.customerName.value.trim(),
                        customerEmail: this.customerEmail.value.trim(),
                        customerPhone: this.customerPhone.value.trim(),
                        companyName: this.companyName.value.trim(),
                        projectName: this.projectName.value.trim(),
                        
                        // Order details
                        quantity: this.currentCalculation.quantity,
                        frontColors: this.currentCalculation.frontColors,
                        backColors: this.currentCalculation.backColors,
                        isDarkGarment: this.currentCalculation.isDarkShirt,
                        safetyStripes: this.currentCalculation.hasSafetyStripes,
                        
                        // Pricing
                        pricePerShirt: this.currentCalculation.pricePerShirt,
                        orderSubtotal: this.currentCalculation.orderSubtotal,
                        ltmFeeTotal: this.currentCalculation.ltmFeeTotal,
                        setupFee: this.currentCalculation.totalSetupFee,
                        finalTotal: this.currentCalculation.finalTotal,
                        
                        // Options
                        notes: this.notes.value.trim(),
                        
                        // Sales rep
                        salesRepEmail: this.salesRep.value,
                        salesRepName: this.getSalesRepName(this.salesRep.value)
                    };
                    
                    // Generate quote ID
                    const quoteId = this.quoteService.generateQuoteID();
                    quoteData.quoteId = quoteId;
                    
                    // Save to database if enabled
                    if (this.saveToDatabase.checked) {
                        const saveResult = await this.quoteService.saveQuote(quoteData);
                        if (!saveResult.success) {
                            console.error('Database save failed:', saveResult.error);
                        }
                    }
                    
                    // Send email
                    const emailData = this.buildEmailData(quoteData);
                    
                    
                    await emailjs.send(
                        this.emailConfig.serviceId,
                        this.emailConfig.templateId,
                        emailData
                    );
                    
                    // Show success
                    this.showSuccessModal(quoteId, quoteData);
                    
                    // Close quote modal
                    this.closeQuoteModal();
                    
                    // Reset form
                    this.quoteForm.reset();
                    
                } catch (error) {
                    console.error('Quote submission error:', error);
                    alert('Failed to send quote. Please try again.');
                } finally {
                    this.hideLoading();
                }
            }

            buildEmailData(quoteData) {
                return {
                    // Email routing
                    to_email: quoteData.customerEmail,
                    from_name: 'Northwest Custom Apparel',
                    reply_to: quoteData.salesRepEmail,
                    
                    // Quote identification
                    quote_type: 'Customer Supplied Screen Print',
                    quote_id: quoteData.quoteId,
                    quote_date: new Date().toLocaleDateString(),
                    
                    // Customer info
                    customer_name: quoteData.customerName,
                    customer_email: quoteData.customerEmail,
                    company_name: quoteData.companyName || '',
                    customer_phone: quoteData.customerPhone || '',
                    project_name: quoteData.projectName || '',
                    
                    // Pricing
                    grand_total: quoteData.finalTotal.toFixed(2),
                    
                    // Content
                    products_html: this.generateQuoteHTML(quoteData),
                    notes: quoteData.notes || 'No special notes for this order',
                    
                    // Sales rep
                    sales_rep_name: quoteData.salesRepName,
                    sales_rep_email: quoteData.salesRepEmail,
                    sales_rep_phone: '253-922-5793',
                    
                    // Company
                    company_year: '1977'
                };
            }

            generateQuoteHTML(quoteData) {
                const calc = this.currentCalculation;
                
                let html = `
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                        <thead>
                            <tr style="background: #4cb354; color: white;">
                                <th style="padding: 12px; text-align: left;">Description</th>
                                <th style="padding: 12px; text-align: center;">Quantity</th>
                                <th style="padding: 12px; text-align: right;">Price</th>
                                <th style="padding: 12px; text-align: right;">Total</th>
                            </tr>
                        </thead>
                        <tbody>`;
                
                // Show front print if applicable
                if (calc.frontColors > 0) {
                    const frontCost = this.RETAIL_PRINT_PRICING[calc.priceTier][calc.effectiveFrontColors] || 0;
                    html += `
                            <tr>
                                <td style="padding: 12px; border-bottom: 1px solid #ddd;">
                                    Front Print - ${calc.effectiveFrontColors} color${calc.effectiveFrontColors > 1 ? 's' : ''}
                                    ${calc.isDarkShirt && calc.frontColors > 0 ? '<br><small style="color: #666;">(includes white base)</small>' : ''}
                                </td>
                                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">${calc.quantity}</td>
                                <td style="padding: 12px; text-align: right; border-bottom: 1px solid #ddd;">$${frontCost.toFixed(2)}</td>
                                <td style="padding: 12px; text-align: right; border-bottom: 1px solid #ddd;">$${(frontCost * calc.quantity).toFixed(2)}</td>
                            </tr>`;
                }
                
                // Show back print if applicable
                if (calc.backColors > 0) {
                    const backCost = this.RETAIL_PRINT_PRICING[calc.priceTier][calc.backColors] || 0;
                    html += `
                            <tr>
                                <td style="padding: 12px; border-bottom: 1px solid #ddd;">Back Print - ${calc.backColors} color${calc.backColors > 1 ? 's' : ''}</td>
                                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">${calc.quantity}</td>
                                <td style="padding: 12px; text-align: right; border-bottom: 1px solid #ddd;">$${backCost.toFixed(2)}</td>
                                <td style="padding: 12px; text-align: right; border-bottom: 1px solid #ddd;">$${(backCost * calc.quantity).toFixed(2)}</td>
                            </tr>`;
                }
                
                // Show safety stripes if applicable
                if (calc.hasSafetyStripes) {
                    html += `
                            <tr>
                                <td style="padding: 12px; border-bottom: 1px solid #ddd;">Safety Stripes (Pocket/Shoulder)</td>
                                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #ddd;">${calc.quantity}</td>
                                <td style="padding: 12px; text-align: right; border-bottom: 1px solid #ddd;">$2.00</td>
                                <td style="padding: 12px; text-align: right; border-bottom: 1px solid #ddd;">$${(2.00 * calc.quantity).toFixed(2)}</td>
                            </tr>`;
                }
                
                if (calc.ltmFeeTotal > 0) {
                    html += `
                            <tr>
                                <td style="padding: 12px; border-bottom: 1px solid #ddd;" colspan="3">Less Than Minimum Fee</td>
                                <td style="padding: 12px; text-align: right; border-bottom: 1px solid #ddd;">$${calc.ltmFeeTotal.toFixed(2)}</td>
                            </tr>`;
                }
                
                html += `
                            <tr>
                                <td style="padding: 12px; border-bottom: 1px solid #ddd;" colspan="3">Setup Fee (${calc.totalScreenColors} screens @ $${this.SCREEN_FEE_PER_COLOR})</td>
                                <td style="padding: 12px; text-align: right; border-bottom: 1px solid #ddd;">$${calc.totalSetupFee.toFixed(2)}</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr style="font-weight: bold;">
                                <td style="padding: 12px; border-top: 2px solid #4cb354;" colspan="3">Total</td>
                                <td style="padding: 12px; text-align: right; border-top: 2px solid #4cb354;">$${calc.finalTotal.toFixed(2)}</td>
                            </tr>
                        </tfoot>
                    </table>`;
                
                return html;
            }

            validateQuoteForm() {
                const errors = [];
                
                if (!this.customerName.value.trim()) {
                    errors.push('Customer name is required');
                }
                
                if (!this.validateEmail(this.customerEmail.value)) {
                    errors.push('Valid email is required');
                }
                
                if (errors.length > 0) {
                    alert(errors.join('\n'));
                    return false;
                }
                
                return true;
            }

            validateEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }

            getSalesRepName(email) {
                const reps = {
                    'ruth@nwcustomapparel.com': 'Ruth Nhong',
                    'taylar@nwcustomapparel.com': 'Taylar',
                    'nika@nwcustomapparel.com': 'Nika',
                    'erik@nwcustomapparel.com': 'Erik',
                    'adriyella@nwcustomapparel.com': 'Adriyella',
                    'bradley@nwcustomapparel.com': 'Bradley',
                    'jim@nwcustomapparel.com': 'Jim',
                    'art@nwcustomapparel.com': 'Steve (Artist)',
                    'sales@nwcustomapparel.com': 'Northwest Custom Apparel Sales Team'
                };
                return reps[email] || 'Sales Team';
            }

            showSuccessModal(quoteId, quoteData) {
                document.getElementById('modalQuoteId').textContent = quoteId;
                document.getElementById('modalCustomerName').textContent = quoteData.customerName;
                document.getElementById('modalCustomerEmail').textContent = quoteData.customerEmail;
                document.getElementById('modalTotalAmount').textContent = `$${quoteData.finalTotal.toFixed(2)}`;
                
                this.lastQuoteData = quoteData;
                
                document.getElementById('successModal').classList.add('active');
            }

            closeQuoteModal() {
                document.getElementById('quoteModal').classList.remove('active');
            }

            showLoading() {
                this.submitQuoteBtn.disabled = true;
                this.submitQuoteBtn.innerHTML = '<span class="loading"></span> Sending...';
            }

            hideLoading() {
                this.submitQuoteBtn.disabled = false;
                this.submitQuoteBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send Quote';
            }
        }

        // Modal functions
        function closeQuoteModal() {
            document.getElementById('quoteModal').classList.remove('active');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        function copyQuoteId() {
            const quoteId = document.getElementById('modalQuoteId').textContent;
            navigator.clipboard.writeText(quoteId).then(() => {
                alert('Quote ID copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy Quote ID');
            });
        }

        function printQuote() {
            const calculator = window.calculator;
            if (!calculator.lastQuoteData) return;
            
            const data = calculator.lastQuoteData;
            const calc = calculator.currentCalculation;
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Quote ${data.quoteId}</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            max-width: 800px;
                            margin: 0 auto;
                            padding: 20px;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                        }
                        .logo {
                            max-width: 300px;
                            margin-bottom: 20px;
                        }
                        .quote-info {
                            margin-bottom: 30px;
                        }
                        .info-grid {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 20px;
                            margin-bottom: 30px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 30px;
                        }
                        th, td {
                            padding: 10px;
                            text-align: left;
                            border-bottom: 1px solid #ddd;
                        }
                        th {
                            background-color: #f5f5f5;
                            font-weight: bold;
                        }
                        .total {
                            font-size: 1.2em;
                            font-weight: bold;
                            text-align: right;
                            margin-top: 20px;
                        }
                        .notice {
                            background: #fffbeb;
                            border: 1px solid #fde68a;
                            padding: 15px;
                            margin-top: 30px;
                            color: #92400e;
                        }
                        @media print {
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <img src="https://cdn.caspio.com/A0E15000/Safety%20Stripes/web%20northwest%20custom%20apparel%20logo.png?ver=1" 
                             alt="Northwest Custom Apparel" class="logo">
                        <h2>Customer Supplied Screen Print Quote</h2>
                    </div>
                    
                    <div class="quote-info">
                        <p><strong>Quote ID:</strong> ${data.quoteId}</p>
                        <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <div class="info-grid">
                        <div>
                            <h3>Customer Information</h3>
                            <p><strong>Name:</strong> ${data.customerName}</p>
                            <p><strong>Email:</strong> ${data.customerEmail}</p>
                            ${data.customerPhone ? `<p><strong>Phone:</strong> ${data.customerPhone}</p>` : ''}
                            ${data.companyName ? `<p><strong>Company:</strong> ${data.companyName}</p>` : ''}
                        </div>
                        <div>
                            <h3>Order Details</h3>
                            <p><strong>Quantity:</strong> ${data.quantity}</p>
                            <p><strong>Front Colors:</strong> ${data.frontColors}</p>
                            <p><strong>Back Colors:</strong> ${data.backColors}</p>
                            ${data.isDarkGarment ? '<p><strong>Dark Garment:</strong> Yes (white base added)</p>' : ''}
                            ${data.safetyStripes ? '<p><strong>Safety Stripes:</strong> Yes</p>' : ''}
                            ${data.projectName ? `<p><strong>Project:</strong> ${data.projectName}</p>` : ''}
                        </div>
                    </div>
                    
                    ${calculator.generateQuoteHTML(data)}
                    
                    ${data.notes ? `
                        <div style="background: #f5f5f5; padding: 15px; margin-top: 30px;">
                            <h3>Notes</h3>
                            <p>${data.notes}</p>
                        </div>
                    ` : ''}
                    
                    <div class="notice">
                        <h3>Important Notice: Customer Supplied Garments</h3>
                        <p>Northwest Custom Apparel is not responsible for the damage of ANY customer supplied garments. Should items be damaged while in our facility, we will NOT reimburse you for their value or replace them.</p>
                    </div>
                    
                    <div style="margin-top: 50px; text-align: center; color: #666;">
                        <p>Family Owned & Operated Since 1977</p>
                        <p>253-922-5793 | sales@nwcustomapparel.com</p>
                    </div>
                    
                    <script>
                        window.onload = () => {
                            window.print();
                            setTimeout(() => window.close(), 500);
                        };
                    <\/script>
                </body>
                </html>
            `);
        }

        // Initialize calculator when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            window.calculator = new CustomerScreenPrintCalculator();
        });
    </script>
</body>
</html>